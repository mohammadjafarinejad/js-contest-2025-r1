{"version":3,"file":"main.438cfd733af6b056d964.js","mappings":"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B,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAu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","sources":["webpack://telegram-t/webpack/runtime/create fake namespace object","webpack://telegram-t/webpack/runtime/load script","webpack://telegram-t/./src/api/gramjs/worker/connector.ts","webpack://telegram-t/./src/api/types/media.ts","webpack://telegram-t/./src/api/types/messages.ts","webpack://telegram-t/./src/components/common/AnimatedIcon.tsx","webpack://telegram-t/./src/lib/rlottie/RLottie.async.ts","webpack://telegram-t/./src/components/common/AnimatedSticker.tsx","webpack://telegram-t/./src/components/common/Blockquote.tsx","webpack://telegram-t/./src/components/common/Blockquote.module.scss?d7ef","webpack://telegram-t/./src/components/common/CustomEmoji.tsx","webpack://telegram-t/./src/components/common/CustomEmoji.module.scss?8f5a","webpack://telegram-t/./src/components/common/MessageSummary.tsx","webpack://telegram-t/./src/components/common/MessageText.tsx","webpack://telegram-t/./src/lib/punycode.js","webpack://telegram-t/./src/components/common/SafeLink.tsx","webpack://telegram-t/./src/components/common/Sparkles.module.scss?15c2","webpack://telegram-t/./src/components/common/Sparkles.tsx","webpack://telegram-t/./src/components/common/StickerView.module.scss?7ce5","webpack://telegram-t/./src/components/common/StickerView.tsx","webpack://telegram-t/./src/hooks/useMountAfterHeavyAnimation.ts","webpack://telegram-t/./src/components/common/TopicDefaultIcon.module.scss?06b0","webpack://telegram-t/./src/components/common/TopicDefaultIcon.tsx","webpack://telegram-t/./src/util/prettyCodeLanguageNames.ts","webpack://telegram-t/./src/components/common/code/CodeOverlay.module.scss?733a","webpack://telegram-t/./src/components/common/code/CodeOverlay.tsx","webpack://telegram-t/./src/components/common/code/CodeBlock.tsx","webpack://telegram-t/./src/hooks/useDidMountEffect.ts","webpack://telegram-t/./src/components/common/helpers/animatedAssets.ts","webpack://telegram-t/./src/components/common/helpers/documentInfo.ts","webpack://telegram-t/./src/components/common/helpers/mediaDimensions.ts","webpack://telegram-t/./src/components/common/ChatLink.tsx","webpack://telegram-t/./src/components/common/GroupCallLink.tsx","webpack://telegram-t/./src/components/common/MessageLink.tsx","webpack://telegram-t/./src/components/common/UserLink.tsx","webpack://telegram-t/./src/components/common/helpers/renderActionMessageText.tsx","webpack://telegram-t/./src/components/common/helpers/renderText.tsx","webpack://telegram-t/./src/components/common/spoiler/Spoiler.tsx","webpack://telegram-t/./src/components/common/helpers/renderTextWithEntities.tsx","webpack://telegram-t/./src/hooks/useEnsureCustomEmoji.ts","webpack://telegram-t/./src/components/common/hooks/useCustomEmoji.ts","webpack://telegram-t/./src/components/common/icons/Icon.tsx","webpack://telegram-t/./src/components/common/icons/StarIcon.module.scss?d424","webpack://telegram-t/./src/components/common/icons/StarIcon.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/customEmoji.ts","webpack://telegram-t/./src/components/middle/helpers/preventMessageInputBlur.ts","webpack://telegram-t/./src/components/middle/message/MentionLink.tsx","webpack://telegram-t/./src/components/ui/Button.tsx","webpack://telegram-t/./src/components/ui/Checkbox.tsx","webpack://telegram-t/./src/components/ui/DropdownMenu.tsx","webpack://telegram-t/./src/components/ui/InputText.tsx","webpack://telegram-t/./src/components/ui/Link.module.scss?2387","webpack://telegram-t/./src/components/ui/Link.tsx","webpack://telegram-t/./src/components/ui/Loading.tsx","webpack://telegram-t/./src/hooks/useMenuPosition.ts","webpack://telegram-t/./src/components/ui/Menu.tsx","webpack://telegram-t/./src/components/ui/MenuItem.tsx","webpack://telegram-t/./src/components/middle/message/hooks/useVideoAutoPause.ts","webpack://telegram-t/./src/components/ui/OptimizedVideo.tsx","webpack://telegram-t/./src/components/ui/Portal.ts","webpack://telegram-t/./src/components/ui/RippleEffect.tsx","webpack://telegram-t/./src/components/ui/Spinner.tsx","webpack://telegram-t/./src/components/ui/Transition.tsx","webpack://telegram-t/./src/config.ts","webpack://telegram-t/./src/contest/contest.tsx","webpack://telegram-t/./src/contest/text-editor/MessageInputController.tsx","webpack://telegram-t/./src/contest/text-editor/lib/marked/defaults.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/rules.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/helpers.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/Tokenizer.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/Lexer.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/Renderer.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/TextRenderer.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/Parser.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/Hooks.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/marked.ts","webpack://telegram-t/./src/contest/text-editor/lib/marked/Instance.ts","webpack://telegram-t/./src/contest/text-editor/TokenHelper.tsx","webpack://telegram-t/./src/contest/text-editor/index.tsx","webpack://telegram-t/./src/contest/text-editor/utils/index.ts","webpack://telegram-t/./src/global/actions/api/initial.ts","webpack://telegram-t/./src/global/actions/api/settings.ts","webpack://telegram-t/./src/global/actions/apiUpdaters/initial.ts","webpack://telegram-t/./src/global/actions/ui/initial.ts","webpack://telegram-t/./src/global/actions/ui/settings.ts","webpack://telegram-t/./src/global/cache.ts","webpack://telegram-t/./src/global/helpers/bots.ts","webpack://telegram-t/./src/global/helpers/chats.ts","webpack://telegram-t/./src/global/helpers/reactions.ts","webpack://telegram-t/./src/global/helpers/media.ts","webpack://telegram-t/./src/global/helpers/misc.ts","webpack://telegram-t/./src/global/helpers/messageMedia.ts","webpack://telegram-t/./src/global/helpers/messageSummary.ts","webpack://telegram-t/./src/global/helpers/messages.ts","webpack://telegram-t/./src/global/helpers/middleSearch.ts","webpack://telegram-t/./src/global/helpers/replies.ts","webpack://telegram-t/./src/global/helpers/symbols.ts","webpack://telegram-t/./src/global/helpers/users.ts","webpack://telegram-t/./src/global/index.ts","webpack://telegram-t/./src/global/initialState.ts","webpack://telegram-t/./src/global/reducers/chats.ts","webpack://telegram-t/./src/global/reducers/symbols.ts","webpack://telegram-t/./src/global/reducers/users.ts","webpack://telegram-t/./src/global/reducers/globalSearch.ts","webpack://telegram-t/./src/global/reducers/management.ts","webpack://telegram-t/./src/global/reducers/settings.ts","webpack://telegram-t/./src/global/reducers/twoFaSettings.ts","webpack://telegram-t/./src/global/reducers/passcode.ts","webpack://telegram-t/./src/global/reducers/payments.ts","webpack://telegram-t/./src/global/reducers/statistics.ts","webpack://telegram-t/./src/global/reducers/peers.ts","webpack://telegram-t/./src/global/reducers/stories.ts","webpack://telegram-t/./src/global/reducers/topics.ts","webpack://telegram-t/./src/global/helpers/getEmojiOnlyCountForMessage.ts","webpack://telegram-t/./src/global/reducers/messages.ts","webpack://telegram-t/./src/global/reducers/middleSearch.ts","webpack://telegram-t/./src/global/reducers/tabs.ts","webpack://telegram-t/./src/global/reducers/translations.ts","webpack://telegram-t/./src/global/selectors/chats.ts","webpack://telegram-t/./src/global/selectors/management.ts","webpack://telegram-t/./src/global/selectors/statistics.ts","webpack://telegram-t/./src/global/selectors/ui.ts","webpack://telegram-t/./src/global/selectors/globalSearch.ts","webpack://telegram-t/./src/global/selectors/payments.ts","webpack://telegram-t/./src/global/selectors/settings.ts","webpack://telegram-t/./src/global/selectors/messages.ts","webpack://telegram-t/./src/global/selectors/middleSearch.ts","webpack://telegram-t/./src/global/selectors/peers.ts","webpack://telegram-t/./src/global/selectors/stories.ts","webpack://telegram-t/./src/global/selectors/symbols.ts","webpack://telegram-t/./src/global/selectors/tabs.ts","webpack://telegram-t/./src/global/selectors/topics.ts","webpack://telegram-t/./src/global/selectors/users.ts","webpack://telegram-t/./src/hooks/data/useSelector.ts","webpack://telegram-t/./src/hooks/data/useSelectorSignal.ts","webpack://telegram-t/./src/hooks/element/useCollapsibleLines.ts","webpack://telegram-t/./src/hooks/stickers/useColorFilter.tsx","webpack://telegram-t/./src/hooks/stickers/useDynamicColorListener.ts","webpack://telegram-t/./src/hooks/useAppLayout.ts","webpack://telegram-t/./src/hooks/useAsync.ts","webpack://telegram-t/./src/hooks/useBuffering.ts","webpack://telegram-t/./src/hooks/useCoordsInSharedCanvas.ts","webpack://telegram-t/./src/hooks/useCurrentOrPrev.ts","webpack://telegram-t/./src/hooks/useDebouncedCallback.ts","webpack://telegram-t/./src/hooks/useDerivedSignal.ts","webpack://telegram-t/./src/hooks/useDerivedState.ts","webpack://telegram-t/./src/hooks/useEffectOnce.ts","webpack://telegram-t/./src/hooks/useEffectWithPrevDeps.ts","webpack://telegram-t/./src/hooks/useElectronDrag.ts","webpack://telegram-t/./src/hooks/useFlag.ts","webpack://telegram-t/./src/hooks/useForceUpdate.ts","webpack://telegram-t/./src/hooks/useHeavyAnimation.ts","webpack://telegram-t/./src/hooks/useHistoryBack.ts","webpack://telegram-t/./src/hooks/useIntersectionObserver.ts","webpack://telegram-t/./src/hooks/useKeyboardListNavigation.ts","webpack://telegram-t/./src/hooks/useLang.ts","webpack://telegram-t/./src/hooks/useLastCallback.ts","webpack://telegram-t/./src/hooks/useMedia.ts","webpack://telegram-t/./src/hooks/useMediaTransition.ts","webpack://telegram-t/./src/hooks/useMediaTransitionDeprecated.ts","webpack://telegram-t/./src/hooks/useModuleLoader.ts","webpack://telegram-t/./src/hooks/useOldLang.ts","webpack://telegram-t/./src/hooks/usePreviousDeprecated.ts","webpack://telegram-t/./src/hooks/usePriorityPlaybackCheck.ts","webpack://telegram-t/./src/hooks/useResizeObserver.ts","webpack://telegram-t/./src/hooks/useSharedIntersectionObserver.ts","webpack://telegram-t/./src/hooks/useSyncEffectWithPrevDeps.ts","webpack://telegram-t/./src/hooks/useShowTransition.ts","webpack://telegram-t/./src/hooks/useShowTransitionDeprecated.ts","webpack://telegram-t/./src/hooks/useSignalEffect.ts","webpack://telegram-t/./src/hooks/useStateRef.ts","webpack://telegram-t/./src/hooks/useSyncEffect.ts","webpack://telegram-t/./src/hooks/useThrottledCallback.ts","webpack://telegram-t/./src/hooks/useThumbnail.ts","webpack://telegram-t/./src/hooks/useUniqueId.ts","webpack://telegram-t/./src/hooks/useVideoCleanup.ts","webpack://telegram-t/./src/hooks/useVirtualBackdrop.ts","webpack://telegram-t/./src/hooks/window/useBackgroundMode.ts","webpack://telegram-t/./src/hooks/window/useDevicePixelRatio.ts","webpack://telegram-t/./src/hooks/window/useWindowSize.ts","webpack://telegram-t/./src/lib/fasterdom/fasterdom.ts","webpack://telegram-t/./src/lib/fasterdom/layoutCauses.ts","webpack://telegram-t/./src/lib/fasterdom/stricterdom.ts","webpack://telegram-t/./src/lib/teact/dom-events.ts","webpack://telegram-t/./src/lib/teact/heavyAnimation.ts","webpack://telegram-t/./src/lib/teact/teact-dom.ts","webpack://telegram-t/./src/util/debugOverlay.ts","webpack://telegram-t/./src/lib/teact/teact.ts","webpack://telegram-t/./src/lib/teact/teactn.tsx","webpack://telegram-t/./src/lib/twemojiRegex.js","webpack://telegram-t/./src/types/index.ts","webpack://telegram-t/./src/util/Deferred.ts","webpack://telegram-t/./src/util/animation.ts","webpack://telegram-t/./src/util/appBadge.ts","webpack://telegram-t/./src/util/areDeepEqual.ts","webpack://telegram-t/./src/util/arePropsShallowEqual.ts","webpack://telegram-t/./node_modules/idb-keyval/dist/index.js","webpack://telegram-t/./src/util/browser/idb.ts","webpack://telegram-t/./src/util/browser/unloadVideo.ts","webpack://telegram-t/./src/util/buildClassName.ts","webpack://telegram-t/./src/util/buildStyle.ts","webpack://telegram-t/./src/util/cacheApi.ts","webpack://telegram-t/./src/util/callbacks.ts","webpack://telegram-t/./src/util/captureEscKeyListener.ts","webpack://telegram-t/./src/util/captureEvents.ts","webpack://telegram-t/./src/util/lethargy.ts","webpack://telegram-t/./src/util/captureKeyboardListeners.ts","webpack://telegram-t/./src/util/clipboard.ts","webpack://telegram-t/./src/util/cssAnimationEndListeners.ts","webpack://telegram-t/./src/util/dates/dateFormat.ts","webpack://telegram-t/./src/util/dates/units.ts","webpack://telegram-t/./src/util/debugConsole.ts","webpack://telegram-t/./src/util/deepLinkParser.ts","webpack://telegram-t/./src/util/deeplink.ts","webpack://telegram-t/./src/util/element/calcTextLineHeightAndCount.ts","webpack://telegram-t/./src/util/element/jsxToHtml.ts","webpack://telegram-t/./src/util/emoji/customEmojiManager.ts","webpack://telegram-t/./src/util/emoji/emoji.ts","webpack://telegram-t/./src/util/emoji/fixNonStandardEmoji.ts","webpack://telegram-t/./src/util/emoji/parseEmojiOnlyString.ts","webpack://telegram-t/./src/util/ensureProtocol.ts","webpack://telegram-t/./src/util/establishMultitabRole.ts","webpack://telegram-t/./src/util/files.ts","webpack://telegram-t/./src/util/folderManager.ts","webpack://telegram-t/./src/util/forceReflow.ts","webpack://telegram-t/./src/util/formatCurrency.tsx","webpack://telegram-t/./src/util/forumColors.ts","webpack://telegram-t/./src/util/generateUniqueId.ts","webpack://telegram-t/./src/util/getReadableErrorText.ts","webpack://telegram-t/./src/util/handleError.ts","webpack://telegram-t/./src/util/installPrompt.ts","webpack://telegram-t/./src/util/iteratees.ts","webpack://telegram-t/./src/util/keys/messageKey.ts","webpack://telegram-t/./src/util/keys/searchResultKey.ts","webpack://telegram-t/./src/util/data/readStrings.ts","webpack://telegram-t/./src/util/data/readFallbackStrings.ts","webpack://telegram-t/./src/assets/localization/initialStrings.ts","webpack://telegram-t/./src/util/localization/index.ts","webpack://telegram-t/./src/util/browser/intlListFormat.ts","webpack://telegram-t/./src/util/localization/types.ts","webpack://telegram-t/./src/util/math.ts","webpack://telegram-t/./src/util/oggToWav.ts","webpack://telegram-t/./src/util/mediaLoader.ts","webpack://telegram-t/./src/util/memo.ts","webpack://telegram-t/./src/util/moduleLoader.ts","webpack://telegram-t/./src/util/deepDiff.ts","webpack://telegram-t/./src/util/deepMerge.ts","webpack://telegram-t/./src/util/multitab.ts","webpack://telegram-t/./src/util/notifications.ts","webpack://telegram-t/./src/util/oldLangProvider.ts","webpack://telegram-t/./src/util/parseHtmlAsFormattedText.ts","webpack://telegram-t/./src/util/passcode.ts","webpack://telegram-t/./src/util/patchSafariProgressiveAudio.ts","webpack://telegram-t/./src/util/perfomanceSettings.ts","webpack://telegram-t/./src/util/permanentWebVersion.ts","webpack://telegram-t/./src/util/phoneNumber.ts","webpack://telegram-t/./src/util/primitives/LimitedMap.ts","webpack://telegram-t/./src/util/replaceWithTeact.ts","webpack://telegram-t/./src/util/requestActionTimeout.ts","webpack://telegram-t/./src/util/routing.ts","webpack://telegram-t/./src/util/safeExec.ts","webpack://telegram-t/./src/util/safePlay.ts","webpack://telegram-t/./src/util/schedulers.ts","webpack://telegram-t/./src/util/searchWords.ts","webpack://telegram-t/./src/util/serverTime.ts","webpack://telegram-t/./src/util/sessions.ts","webpack://telegram-t/./src/util/signals.ts","webpack://telegram-t/./src/util/stopEvent.ts","webpack://telegram-t/./src/util/svgController.ts","webpack://telegram-t/./src/util/swipeController.ts","webpack://telegram-t/./src/util/switchTheme.ts","webpack://telegram-t/./src/util/systemTheme.ts","webpack://telegram-t/./src/util/textFormat.ts","webpack://telegram-t/./src/util/theme.ts","webpack://telegram-t/./src/util/themeStyle.ts","webpack://telegram-t/./src/util/trimText.ts","webpack://telegram-t/./src/util/username.ts","webpack://telegram-t/./src/util/websync.ts","webpack://telegram-t/./src/util/windowEnvironment.ts","webpack://telegram-t/./src/util/windowSize.ts","webpack://telegram-t/./src/util/withCache.ts","webpack://telegram-t/webpack/bootstrap","webpack://telegram-t/webpack/runtime/compat get default export","webpack://telegram-t/webpack/runtime/define property getters","webpack://telegram-t/webpack/runtime/ensure chunk","webpack://telegram-t/webpack/runtime/get javascript chunk filename","webpack://telegram-t/webpack/runtime/get mini-css chunk filename","webpack://telegram-t/webpack/runtime/global","webpack://telegram-t/webpack/runtime/hasOwnProperty shorthand","webpack://telegram-t/webpack/runtime/make namespace object","webpack://telegram-t/webpack/runtime/publicPath","webpack://telegram-t/webpack/runtime/css loading","webpack://telegram-t/webpack/runtime/jsonp chunk loading","webpack://telegram-t/./src/util/setupServiceWorker.ts","webpack://telegram-t/./src/global/intervals.ts","webpack://telegram-t/./src/util/init.ts","webpack://telegram-t/./src/global/init.ts","webpack://telegram-t/./src/util/betterView.ts","webpack://telegram-t/./src/util/activeTabMonitor.ts","webpack://telegram-t/./src/components/auth/AuthCode.async.tsx","webpack://telegram-t/./src/components/auth/AuthPassword.async.tsx","webpack://telegram-t/./src/util/fonts.ts","webpack://telegram-t/./src/components/auth/helpers/getSuggestedLanguage.ts","webpack://telegram-t/./src/hooks/useLangString.ts","webpack://telegram-t/./src/components/auth/CountryCodeInput.tsx","webpack://telegram-t/./src/components/auth/AuthPhoneNumber.tsx","webpack://telegram-t/./src/components/auth/AuthQrCode.tsx","webpack://telegram-t/./src/components/auth/AuthRegister.async.tsx","webpack://telegram-t/./src/components/auth/Auth.tsx","webpack://telegram-t/./src/components/App.module.scss?a9d3","webpack://telegram-t/./src/components/common/UiLoader.module.scss?03f6","webpack://telegram-t/./src/components/common/UiLoader.tsx","webpack://telegram-t/./src/components/main/AppInactive.tsx","webpack://telegram-t/./src/components/main/LockScreen.async.tsx","webpack://telegram-t/./src/components/main/Main.async.tsx","webpack://telegram-t/./src/components/App.tsx","webpack://telegram-t/./src/index.tsx","webpack://telegram-t/./src/util/updateWebmanifest.ts"],"sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var inProgress = {};\nvar dataWebpackPrefix = \"telegram-t:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","import type { Api } from '../../../lib/gramjs';\nimport type { TypedBroadcastChannel } from '../../../util/multitab';\nimport type { ApiInitialArgs, ApiOnProgress, OnApiUpdate } from '../../types';\nimport type { LocalDb } from '../localDb';\nimport type { MethodArgs, MethodResponse, Methods } from '../methods/types';\nimport type { OriginPayload, ThenArg, WorkerMessageEvent } from './types';\n\nimport { DATA_BROADCAST_CHANNEL_NAME, DEBUG, IGNORE_UNHANDLED_ERRORS } from '../../../config';\nimport { logDebugMessage } from '../../../util/debugConsole';\nimport Deferred from '../../../util/Deferred';\nimport { getCurrentTabId, subscribeToMasterChange } from '../../../util/establishMultitabRole';\nimport generateUniqueId from '../../../util/generateUniqueId';\nimport { pause, throttleWithTickEnd } from '../../../util/schedulers';\nimport { IS_MULTITAB_SUPPORTED } from '../../../util/windowEnvironment';\n\ntype RequestState = {\n  messageId: string;\n  resolve: Function;\n  reject: Function;\n  callback?: AnyToVoidFunction;\n  DEBUG_payload?: any;\n};\n\nconst HEALTH_CHECK_TIMEOUT = 150;\nconst HEALTH_CHECK_MIN_DELAY = 5 * 1000; // 5 sec\nconst NO_QUEUE_BEFORE_INIT = new Set(['destroy']);\n\nlet worker: Worker | undefined;\n\nconst requestStates = new Map<string, RequestState>();\nconst requestStatesByCallback = new Map<AnyToVoidFunction, RequestState>();\n\nlet pendingPayloads: OriginPayload[] = [];\n\nconst savedLocalDb: LocalDb = {\n  chats: {},\n  users: {},\n  documents: {},\n  stickerSets: {},\n  photos: {},\n  webDocuments: {},\n  commonBoxState: {},\n  channelPtsById: {},\n};\n\nlet isMasterTab = true;\nsubscribeToMasterChange((isMasterTabNew) => {\n  isMasterTab = isMasterTabNew;\n});\n\nconst channel = IS_MULTITAB_SUPPORTED\n  ? new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) as TypedBroadcastChannel\n  : undefined;\n\nconst postMessagesOnTickEnd = throttleWithTickEnd(() => {\n  const payloads = pendingPayloads;\n  pendingPayloads = [];\n  worker?.postMessage({ payloads });\n});\n\nfunction postMessageOnTickEnd(payload: OriginPayload) {\n  pendingPayloads.push(payload);\n  postMessagesOnTickEnd();\n}\n\nexport function initApiOnMasterTab(initialArgs: ApiInitialArgs) {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'initApi',\n    token: getCurrentTabId(),\n    initialArgs,\n  });\n}\n\nlet updateCallback: OnApiUpdate;\n\nlet localApiRequestsQueue: { fnName: any; args: any; deferred: Deferred<any> }[] = [];\nlet apiRequestsQueue: { fnName: any; args: any; deferred: Deferred<any> }[] = [];\nlet isInited = false;\n\nexport function initApi(onUpdate: OnApiUpdate, initialArgs: ApiInitialArgs) {\n  updateCallback = onUpdate;\n\n  if (!isMasterTab) {\n    initApiOnMasterTab(initialArgs);\n    return Promise.resolve();\n  }\n\n  if (!worker) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.log('>>> START LOAD WORKER');\n    }\n\n    worker = new Worker(new URL('./worker.ts', import.meta.url));\n    subscribeToWorker(onUpdate);\n\n    if (initialArgs.platform === 'iOS') {\n      setupIosHealthCheck();\n    }\n  }\n\n  return makeRequest({\n    type: 'initApi',\n    args: [initialArgs, savedLocalDb],\n  }).then(() => {\n    isInited = true;\n\n    apiRequestsQueue.forEach((request) => {\n      callApi(request.fnName, ...request.args)\n        .then(request.deferred.resolve)\n        .catch(request.deferred.reject);\n    });\n    apiRequestsQueue = [];\n\n    localApiRequestsQueue.forEach((request) => {\n      callApiLocal(request.fnName, ...request.args)\n        .then(request.deferred.resolve)\n        .catch(request.deferred.reject);\n    });\n    localApiRequestsQueue = [];\n  });\n}\n\nexport function updateLocalDb(name: keyof LocalDb, prop: string, value: any) {\n  savedLocalDb[name][prop] = value;\n}\n\nexport function updateFullLocalDb(initial: LocalDb) {\n  Object.assign(savedLocalDb, initial);\n}\n\nexport function callApiOnMasterTab(payload: any) {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'callApi',\n    token: getCurrentTabId(),\n    ...payload,\n  });\n}\n\nexport function setShouldEnableDebugLog(value: boolean) {\n  return makeRequest({\n    type: 'toggleDebugMode',\n    isEnabled: value,\n  });\n}\n\n/*\n * Call a worker method on this tab's worker, without transferring to master tab\n * Mostly needed to disconnect worker when re-electing master\n */\nexport function callApiLocal<T extends keyof Methods>(fnName: T, ...args: MethodArgs<T>) {\n  if (!isInited) {\n    if (NO_QUEUE_BEFORE_INIT.has(fnName)) {\n      return Promise.resolve(undefined) as MethodResponse<T>;\n    }\n\n    const deferred = new Deferred();\n    localApiRequestsQueue.push({ fnName, args, deferred });\n\n    return deferred.promise as MethodResponse<T>;\n  }\n\n  const promise = makeRequest({\n    type: 'callMethod',\n    name: fnName,\n    args,\n  });\n\n  // Some TypeScript magic to make sure `VirtualClass` is never returned from any method\n  if (DEBUG) {\n    (async () => {\n      try {\n        type ForbiddenTypes =\n          Api.VirtualClass<any>\n          | (Api.VirtualClass<any> | undefined)[];\n        type ForbiddenResponses =\n          ForbiddenTypes\n          | (AnyLiteral & { [k: string]: ForbiddenTypes });\n\n        // Unwrap all chained promises\n        const response = await promise;\n        // Make sure responses do not include `VirtualClass` instances\n        const allowedResponse: Exclude<typeof response, ForbiddenResponses> = response;\n        // Suppress \"unused variable\" constraint\n        void allowedResponse;\n      } catch (err) {\n        // Do noting\n      }\n    })();\n  }\n\n  return promise as MethodResponse<T>;\n}\n\nexport function callApi<T extends keyof Methods>(fnName: T, ...args: MethodArgs<T>) {\n  if (!isInited && isMasterTab) {\n    if (NO_QUEUE_BEFORE_INIT.has(fnName)) {\n      return Promise.resolve(undefined) as MethodResponse<T>;\n    }\n\n    const deferred = new Deferred();\n    apiRequestsQueue.push({ fnName, args, deferred });\n\n    return deferred.promise as MethodResponse<T>;\n  }\n\n  const promise = isMasterTab ? makeRequest({\n    type: 'callMethod',\n    name: fnName,\n    args,\n  }) : makeRequestToMaster({\n    name: fnName,\n    args,\n  });\n\n  // Some TypeScript magic to make sure `VirtualClass` is never returned from any method\n  if (DEBUG) {\n    (async () => {\n      try {\n        type ForbiddenTypes =\n          Api.VirtualClass<any>\n          | (Api.VirtualClass<any> | undefined)[];\n        type ForbiddenResponses =\n          ForbiddenTypes\n          | (AnyLiteral & { [k: string]: ForbiddenTypes });\n\n        // Unwrap all chained promises\n        const response = await promise;\n        // Make sure responses do not include `VirtualClass` instances\n        const allowedResponse: Exclude<typeof response, ForbiddenResponses> = response;\n        // Suppress \"unused variable\" constraint\n        void allowedResponse;\n      } catch (err) {\n        // Do noting\n      }\n    })();\n  }\n\n  return promise as MethodResponse<T>;\n}\n\nexport function cancelApiProgress(progressCallback: ApiOnProgress) {\n  progressCallback.isCanceled = true;\n\n  const { messageId } = requestStatesByCallback.get(progressCallback) || {};\n  if (!messageId) {\n    return;\n  }\n\n  if (isMasterTab) {\n    cancelApiProgressMaster(messageId);\n  } else {\n    if (!channel) return;\n\n    channel.postMessage({\n      type: 'cancelApiProgress',\n      token: getCurrentTabId(),\n      messageId,\n    });\n  }\n}\n\nexport function cancelApiProgressMaster(messageId: string) {\n  postMessageOnTickEnd({\n    type: 'cancelProgress',\n    messageId,\n  });\n}\n\nfunction subscribeToWorker(onUpdate: OnApiUpdate) {\n  worker?.addEventListener('message', ({ data }: WorkerMessageEvent) => {\n    data?.payloads.forEach((payload) => {\n      if (payload.type === 'updates') {\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        let DEBUG_startAt: number | undefined;\n        if (DEBUG) {\n          DEBUG_startAt = performance.now();\n        }\n\n        payload.updates.forEach(onUpdate);\n\n        if (DEBUG) {\n          const duration = performance.now() - DEBUG_startAt!;\n          if (duration > 5) {\n            // eslint-disable-next-line no-console\n            console.warn(`[API] Slow updates processing: ${payload.updates.length} updates in ${duration} ms`);\n          }\n        }\n      } else if (payload.type === 'methodResponse') {\n        handleMethodResponse(payload);\n      } else if (payload.type === 'methodCallback') {\n        handleMethodCallback(payload);\n      } else if (payload.type === 'unhandledError') {\n        const message = payload.error?.message;\n        if (message && IGNORE_UNHANDLED_ERRORS.has(message)) return;\n        throw new Error(message);\n      } else if (payload.type === 'sendBeacon') {\n        navigator.sendBeacon(payload.url, payload.data);\n      } else if (payload.type === 'debugLog') {\n        logDebugMessage(payload.level, ...payload.args);\n      }\n    });\n  });\n}\n\nexport function handleMethodResponse(data: {\n  messageId: string;\n  response?: ThenArg<MethodResponse<keyof Methods>>;\n  error?: { message: string };\n}) {\n  const requestState = requestStates.get(data.messageId);\n  if (requestState) {\n    if (data.error) {\n      requestState.reject(data.error);\n    } else {\n      requestState.resolve(data.response);\n    }\n  }\n}\n\nexport function handleMethodCallback(data: {\n  messageId: string;\n  callbackArgs: any[];\n}) {\n  requestStates.get(data.messageId)?.callback?.(...data.callbackArgs);\n}\n\nfunction makeRequestToMaster(message: {\n  messageId?: string;\n  name: keyof Methods;\n  args: MethodArgs<keyof Methods>;\n  withCallback?: boolean;\n}) {\n  const messageId = generateUniqueId();\n  const payload = {\n    messageId,\n    ...message,\n  };\n\n  const requestState = { messageId } as RequestState;\n\n  // Re-wrap type because of `postMessage`\n  const promise: Promise<MethodResponse<keyof Methods>> = new Promise((resolve, reject) => {\n    Object.assign(requestState, { resolve, reject });\n  });\n\n  if ('args' in payload && 'name' in payload && typeof payload.args[1] === 'function') {\n    payload.withCallback = true;\n\n    const callback = payload.args.pop() as AnyToVoidFunction;\n    requestState.callback = callback;\n    requestStatesByCallback.set(callback, requestState);\n  }\n\n  requestStates.set(messageId, requestState);\n\n  promise\n    .catch(() => undefined)\n    .finally(() => {\n      requestStates.delete(messageId);\n\n      if (requestState.callback) {\n        requestStatesByCallback.delete(requestState.callback);\n      }\n    });\n\n  callApiOnMasterTab(payload);\n\n  return promise;\n}\n\nfunction makeRequest(message: OriginPayload) {\n  const messageId = generateUniqueId();\n  const payload: OriginPayload = {\n    messageId,\n    ...message,\n  };\n\n  const requestState = { messageId } as RequestState;\n\n  // Re-wrap type because of `postMessage`\n  const promise: Promise<MethodResponse<keyof Methods>> = new Promise((resolve, reject) => {\n    Object.assign(requestState, { resolve, reject });\n  });\n\n  if ('args' in payload && 'name' in payload && typeof payload.args[1] === 'function') {\n    payload.withCallback = true;\n\n    const callback = payload.args.pop() as AnyToVoidFunction;\n    requestState.callback = callback;\n    requestStatesByCallback.set(callback, requestState);\n  }\n\n  requestState.DEBUG_payload = payload;\n\n  requestStates.set(messageId, requestState);\n\n  promise\n    .catch(() => undefined)\n    .finally(() => {\n      requestStates.delete(messageId);\n\n      if (requestState.callback) {\n        requestStatesByCallback.delete(requestState.callback);\n      }\n    });\n\n  postMessageOnTickEnd(payload);\n\n  return promise;\n}\n\nconst startedAt = Date.now();\n\n// Workaround for iOS sometimes stops interacting with worker\nfunction setupIosHealthCheck() {\n  window.addEventListener('focus', () => {\n    void ensureWorkerPing();\n    // Sometimes a single check is not enough\n    setTimeout(() => ensureWorkerPing(), 1000);\n  });\n}\n\nasync function ensureWorkerPing() {\n  let isResolved = false;\n\n  try {\n    await Promise.race([\n      makeRequest({ type: 'ping' }),\n      pause(HEALTH_CHECK_TIMEOUT)\n        .then(() => (isResolved ? undefined : Promise.reject(new Error('HEALTH_CHECK_TIMEOUT')))),\n    ]);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n\n    if (Date.now() - startedAt >= HEALTH_CHECK_MIN_DELAY) {\n      worker?.terminate();\n      worker = undefined;\n      updateCallback({ '@type': 'requestReconnectApi' });\n    }\n  } finally {\n    isResolved = true;\n  }\n}\n","// We cache avatars as Data URI for faster initial load\n// and messages media as Blob for smaller size.\n\nexport enum ApiMediaFormat {\n  BlobUrl,\n  Progressive,\n  DownloadUrl,\n  Text,\n}\n\nexport type ApiParsedMedia = string | Blob | ArrayBuffer;\nexport type ApiPreparedMedia = string;\n","import type { ThreadId, WebPageMediaSize } from '../../types';\nimport type { ApiWebDocument } from './bots';\nimport type { ApiGroupCall, PhoneCallAction } from './calls';\nimport type { ApiPeerColor } from './chats';\nimport type {\n  ApiInputSavedStarGift,\n  ApiLabeledPrice,\n  ApiStarGiftRegular,\n  ApiStarGiftUnique,\n} from './payments';\nimport type {\n  ApiMessageStoryData, ApiStory, ApiWebPageStickerData, ApiWebPageStoryData,\n} from './stories';\n\nexport interface ApiDimensions {\n  width: number;\n  height: number;\n}\n\nexport interface ApiPhotoSize extends ApiDimensions {\n  type: 's' | 'm' | 'x' | 'y' | 'w';\n}\n\nexport interface ApiVideoSize extends ApiDimensions {\n  type: 'u' | 'v';\n  videoStartTs?: number;\n  size: number;\n}\n\nexport interface ApiThumbnail extends ApiDimensions {\n  dataUri: string;\n}\n\nexport interface ApiPhoto {\n  mediaType: 'photo';\n  id: string;\n  date: number;\n  thumbnail?: ApiThumbnail;\n  isVideo?: boolean;\n  sizes: ApiPhotoSize[];\n  videoSizes?: ApiVideoSize[];\n  blobUrl?: string;\n  isSpoiler?: boolean;\n}\n\nexport interface ApiSticker {\n  mediaType: 'sticker';\n  id: string;\n  stickerSetInfo: ApiStickerSetInfo;\n  emoji?: string;\n  isCustomEmoji?: boolean;\n  isLottie: boolean;\n  isVideo: boolean;\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  isPreloadedGlobally?: boolean;\n  hasEffect?: boolean;\n  isFree?: boolean;\n  shouldUseTextColor?: boolean;\n}\n\nexport interface ApiStickerSet {\n  isArchived?: true;\n  isEmoji?: true;\n  installedDate?: number;\n  id: string;\n  accessHash: string;\n  title: string;\n  hasThumbnail?: boolean;\n  hasStaticThumb?: boolean;\n  hasAnimatedThumb?: boolean;\n  hasVideoThumb?: boolean;\n  thumbCustomEmojiId?: string;\n  count: number;\n  stickers?: ApiSticker[];\n  packs?: Record<string, ApiSticker[]>;\n  covers?: ApiSticker[];\n  shortName: string;\n}\n\ntype ApiStickerSetInfoShortName = {\n  shortName: string;\n};\n\ntype ApiStickerSetInfoId = {\n  id: string;\n  accessHash: string;\n};\n\ntype ApiStickerSetInfoMissing = {\n  isMissing: true;\n};\n\nexport type ApiStickerSetInfo = ApiStickerSetInfoShortName | ApiStickerSetInfoId | ApiStickerSetInfoMissing;\n\nexport interface ApiVideo {\n  mediaType: 'video';\n  id: string;\n  mimeType: string;\n  duration: number;\n  fileName: string;\n  width?: number;\n  height?: number;\n  supportsStreaming?: boolean;\n  isRound?: boolean;\n  isGif?: boolean;\n  hasVideoPreview?: boolean;\n  isSpoiler?: boolean;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  blobUrl?: string;\n  previewBlobUrl?: string;\n  size: number;\n  noSound?: boolean;\n  waveform?: number[];\n}\n\nexport interface ApiAudio {\n  mediaType: 'audio';\n  id: string;\n  size: number;\n  mimeType: string;\n  fileName: string;\n  duration: number;\n  performer?: string;\n  title?: string;\n  thumbnailSizes?: ApiPhotoSize[];\n}\n\nexport interface ApiVoice {\n  mediaType: 'voice';\n  id: string;\n  duration: number;\n  waveform?: number[];\n  size: number;\n}\n\nexport interface ApiDocument {\n  mediaType: 'document';\n  id?: string;\n  fileName: string;\n  size: number;\n  timestamp?: number;\n  mimeType: string;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  previewBlobUrl?: string;\n  innerMediaType?: 'photo' | 'video';\n  mediaSize?: ApiDimensions;\n}\n\nexport interface ApiContact {\n  mediaType: 'contact';\n  firstName: string;\n  lastName: string;\n  phoneNumber: string;\n  userId: string;\n}\n\nexport type ApiPaidMedia = {\n  mediaType: 'paidMedia';\n  starsAmount: number;\n} & ({\n  isBought?: true;\n  extendedMedia: BoughtPaidMedia[];\n} | {\n  isBought?: undefined;\n  extendedMedia: ApiMediaExtendedPreview[];\n});\n\nexport interface ApiPollAnswer {\n  text: ApiFormattedText;\n  option: string;\n}\n\nexport interface ApiPollResult {\n  isChosen?: true;\n  isCorrect?: true;\n  option: string;\n  votersCount: number;\n}\n\nexport interface ApiPoll {\n  mediaType: 'poll';\n  id: string;\n  summary: {\n    closed?: true;\n    isPublic?: true;\n    multipleChoice?: true;\n    quiz?: true;\n    question: ApiFormattedText;\n    answers: ApiPollAnswer[];\n    closePeriod?: number;\n    closeDate?: number;\n  };\n  results: {\n    isMin?: true;\n    results?: ApiPollResult[];\n    totalVoters?: number;\n    recentVoterIds?: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n}\n\nexport interface ApiInvoice {\n  prices: ApiLabeledPrice[];\n  totalAmount: number;\n  currency: string;\n  isTest?: boolean;\n  isRecurring?: boolean;\n  subscriptionPeriod?: number;\n  termsUrl?: string;\n  maxTipAmount?: number;\n  suggestedTipAmounts?: number[];\n  isNameRequested?: boolean;\n  isPhoneRequested?: boolean;\n  isEmailRequested?: boolean;\n  isShippingAddressRequested?: boolean;\n  isFlexible?: boolean;\n  isPhoneSentToProvider?: boolean;\n  isEmailSentToProvider?: boolean;\n}\n\nexport interface ApiMediaInvoice {\n  mediaType: 'invoice';\n  title: string;\n  description: string;\n  photo?: ApiWebDocument;\n  isTest?: boolean;\n  receiptMessageId?: number;\n  currency: string;\n  amount: number;\n  extendedMedia?: ApiMediaExtendedPreview;\n}\n\nexport interface ApiMediaExtendedPreview {\n  mediaType: 'extendedMediaPreview';\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  duration?: number;\n}\n\nexport interface ApiPaymentCredentials {\n  id: string;\n  title: string;\n}\n\nexport interface ApiGeoPoint {\n  long: number;\n  lat: number;\n  accessHash: string;\n  accuracyRadius?: number;\n}\n\ninterface ApiGeo {\n  mediaType: 'geo';\n  geo: ApiGeoPoint;\n}\n\ninterface ApiVenue {\n  mediaType: 'venue';\n  geo: ApiGeoPoint;\n  title: string;\n  address: string;\n  provider: string;\n  venueId: string;\n  venueType: string;\n}\n\ninterface ApiGeoLive {\n  mediaType: 'geoLive';\n  geo: ApiGeoPoint;\n  heading?: number;\n  period: number;\n}\n\nexport type ApiLocation = ApiGeo | ApiVenue | ApiGeoLive;\n\nexport type ApiGame = {\n  mediaType: 'game';\n  title: string;\n  description: string;\n  photo?: ApiPhoto;\n  shortName: string;\n  id: string;\n  accessHash: string;\n  document?: ApiDocument;\n};\n\nexport type ApiGiveaway = {\n  mediaType: 'giveaway';\n  quantity: number;\n  months?: number;\n  stars?: number;\n  untilDate: number;\n  isOnlyForNewSubscribers?: true;\n  countries?: string[];\n  channelIds: string[];\n  prizeDescription?: string;\n};\n\nexport type ApiGiveawayResults = {\n  mediaType: 'giveawayResults';\n  months?: number;\n  stars?: number;\n  untilDate: number;\n  isRefunded?: true;\n  isOnlyForNewSubscribers?: true;\n  channelId: string;\n  prizeDescription?: string;\n  winnersCount?: number;\n  winnerIds: string[];\n  additionalPeersCount?: number;\n  launchMessageId: number;\n  unclaimedCount: number;\n};\n\nexport type ApiNewPoll = {\n  summary: ApiPoll['summary'];\n  quiz?: {\n    correctAnswers: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n};\n\nexport interface ApiMessageActionStarGift {\n  type: 'starGift';\n  isNameHidden: boolean;\n  isSaved: boolean;\n  isConverted?: true;\n  gift: ApiStarGiftRegular;\n  message?: ApiFormattedText;\n  starsToConvert?: number;\n  canUpgrade?: true;\n  isUpgraded?: true;\n  upgradeMsgId?: number;\n  alreadyPaidUpgradeStars?: number;\n  fromId?: string;\n  peerId?: string;\n  savedId?: string;\n  inputSavedGift?: ApiInputSavedStarGift;\n}\n\nexport interface ApiMessageActionStarGiftUnique {\n  type: 'starGiftUnique';\n  isUpgrade?: true;\n  isTransferred?: true;\n  isSaved?: true;\n  isRefunded?: true;\n  gift: ApiStarGiftUnique;\n  canExportAt?: number;\n  transferStars?: number;\n  fromId?: string;\n  peerId?: string;\n  savedId?: string;\n  inputSavedGift?: ApiInputSavedStarGift;\n}\n\nexport interface ApiAction {\n  mediaType: 'action';\n  text: string;\n  targetUserIds?: string[];\n  targetChatId?: string;\n  type:\n  | 'historyClear'\n  | 'contactSignUp'\n  | 'chatCreate'\n  | 'topicCreate'\n  | 'suggestProfilePhoto'\n  | 'updateProfilePhoto'\n  | 'joinedChannel'\n  | 'chatBoost'\n  | 'receipt'\n  | 'giftStars'\n  | 'giftPremium'\n  | 'giftCode'\n  | 'prizeStars'\n  | 'starGift'\n  | 'starGiftUnique'\n  | 'other';\n  photo?: ApiPhoto;\n  amount?: number;\n  stars?: number;\n  transactionId?: string;\n  currency?: string;\n  giftCryptoInfo?: {\n    currency: string;\n    amount: number;\n  };\n  starGift?: ApiMessageActionStarGift | ApiMessageActionStarGiftUnique;\n  translationValues: string[];\n  call?: Partial<ApiGroupCall>;\n  phoneCall?: PhoneCallAction;\n  score?: number;\n  months?: number;\n  topicEmojiIconId?: string;\n  isTopicAction?: boolean;\n  slug?: string;\n  isGiveaway?: boolean;\n  isUnclaimed?: boolean;\n  pluralValue?: number;\n  message?: ApiFormattedText;\n}\n\nexport interface ApiWebPage {\n  mediaType: 'webpage';\n  id: number;\n  url: string;\n  displayUrl: string;\n  type?: string;\n  siteName?: string;\n  title?: string;\n  description?: string;\n  photo?: ApiPhoto;\n  audio?: ApiAudio;\n  duration?: number;\n  document?: ApiDocument;\n  video?: ApiVideo;\n  story?: ApiWebPageStoryData;\n  gift?: ApiStarGiftUnique;\n  stickers?: ApiWebPageStickerData;\n  mediaSize?: WebPageMediaSize;\n  hasLargeMedia?: boolean;\n}\n\nexport type ApiReplyInfo = ApiMessageReplyInfo | ApiStoryReplyInfo;\n\nexport interface ApiMessageReplyInfo {\n  type: 'message';\n  replyToMsgId?: number;\n  replyToPeerId?: string;\n  replyFrom?: ApiMessageForwardInfo;\n  replyMedia?: MediaContent;\n  replyToTopId?: number;\n  isForumTopic?: true;\n  isQuote?: true;\n  quoteText?: ApiFormattedText;\n}\n\nexport interface ApiStoryReplyInfo {\n  type: 'story';\n  peerId: string;\n  storyId: number;\n}\n\nexport interface ApiInputMessageReplyInfo {\n  type: 'message';\n  replyToMsgId: number;\n  replyToTopId?: number;\n  replyToPeerId?: string;\n  quoteText?: ApiFormattedText;\n}\n\nexport interface ApiInputStoryReplyInfo {\n  type: 'story';\n  peerId: string;\n  storyId: number;\n}\n\nexport type ApiInputReplyInfo = ApiInputMessageReplyInfo | ApiInputStoryReplyInfo;\n\nexport interface ApiMessageForwardInfo {\n  date: number;\n  savedDate?: number;\n  isImported?: boolean;\n  isChannelPost: boolean;\n  channelPostId?: number;\n  isLinkedChannelPost?: boolean;\n  fromChatId?: string;\n  fromId?: string;\n  savedFromPeerId?: string;\n  isSavedOutgoing?: boolean;\n  fromMessageId?: number;\n  hiddenUserName?: string;\n  postAuthorTitle?: string;\n}\n\nexport interface ApiStoryForwardInfo {\n  fromPeerId?: string;\n  fromName?: string;\n  storyId?: number;\n  isModified?: boolean;\n}\n\nexport type ApiMessageEntityDefault = {\n  type: Exclude<\n  `${ApiMessageEntityTypes}`,\n  `${ApiMessageEntityTypes.Pre}` | `${ApiMessageEntityTypes.TextUrl}` | `${ApiMessageEntityTypes.MentionName}` |\n  `${ApiMessageEntityTypes.CustomEmoji}` | `${ApiMessageEntityTypes.Blockquote}`\n  >;\n  offset: number;\n  length: number;\n};\n\nexport type ApiMessageEntityPre = {\n  type: ApiMessageEntityTypes.Pre;\n  offset: number;\n  length: number;\n  language?: string;\n};\n\nexport type ApiMessageEntityTextUrl = {\n  type: ApiMessageEntityTypes.TextUrl;\n  offset: number;\n  length: number;\n  url: string;\n};\n\nexport type ApiMessageEntityMentionName = {\n  type: ApiMessageEntityTypes.MentionName;\n  offset: number;\n  length: number;\n  userId: string;\n};\n\nexport type ApiMessageEntityBlockquote = {\n  type: ApiMessageEntityTypes.Blockquote;\n  offset: number;\n  length: number;\n  collapsed?: true;\n};\n\nexport type ApiMessageEntityCustomEmoji = {\n  type: ApiMessageEntityTypes.CustomEmoji;\n  offset: number;\n  length: number;\n  documentId: string;\n};\n\nexport type ApiMessageEntity = ApiMessageEntityDefault | ApiMessageEntityPre | ApiMessageEntityTextUrl |\nApiMessageEntityMentionName | ApiMessageEntityCustomEmoji | ApiMessageEntityBlockquote;\n\nexport enum ApiMessageEntityTypes {\n  Bold = 'MessageEntityBold',\n  Blockquote = 'MessageEntityBlockquote',\n  BotCommand = 'MessageEntityBotCommand',\n  Cashtag = 'MessageEntityCashtag',\n  Code = 'MessageEntityCode',\n  Email = 'MessageEntityEmail',\n  Hashtag = 'MessageEntityHashtag',\n  Italic = 'MessageEntityItalic',\n  MentionName = 'MessageEntityMentionName',\n  Mention = 'MessageEntityMention',\n  Phone = 'MessageEntityPhone',\n  Pre = 'MessageEntityPre',\n  Strike = 'MessageEntityStrike',\n  TextUrl = 'MessageEntityTextUrl',\n  Url = 'MessageEntityUrl',\n  Underline = 'MessageEntityUnderline',\n  Spoiler = 'MessageEntitySpoiler',\n  CustomEmoji = 'MessageEntityCustomEmoji',\n  Unknown = 'MessageEntityUnknown',\n}\n\nexport interface ApiFormattedText {\n  text: string;\n  entities?: ApiMessageEntity[];\n}\n\nexport type MediaContent = {\n  text?: ApiFormattedText;\n  photo?: ApiPhoto;\n  video?: ApiVideo;\n  altVideos?: ApiVideo[];\n  document?: ApiDocument;\n  sticker?: ApiSticker;\n  contact?: ApiContact;\n  pollId?: string;\n  action?: ApiAction;\n  webPage?: ApiWebPage;\n  audio?: ApiAudio;\n  voice?: ApiVoice;\n  invoice?: ApiMediaInvoice;\n  location?: ApiLocation;\n  game?: ApiGame;\n  storyData?: ApiMessageStoryData;\n  giveaway?: ApiGiveaway;\n  giveawayResults?: ApiGiveawayResults;\n  paidMedia?: ApiPaidMedia;\n  isExpiredVoice?: boolean;\n  isExpiredRoundVideo?: boolean;\n  ttlSeconds?: number;\n};\nexport type MediaContainer = {\n  content: MediaContent;\n};\n\nexport type StatefulMediaContent = {\n  poll?: ApiPoll;\n  story?: ApiStory;\n};\n\nexport type BoughtPaidMedia = Pick<MediaContent, 'photo' | 'video'>;\n\nexport interface ApiMessage {\n  id: number;\n  chatId: string;\n  content: MediaContent;\n  date: number;\n  isOutgoing: boolean;\n  senderId?: string;\n  replyInfo?: ApiReplyInfo;\n  sendingState?: 'messageSendingStatePending' | 'messageSendingStateFailed';\n  forwardInfo?: ApiMessageForwardInfo;\n  isDeleting?: boolean;\n  previousLocalId?: number;\n  viewsCount?: number;\n  forwardsCount?: number;\n  isEdited?: boolean;\n  editDate?: number;\n  isMentioned?: boolean;\n  isMediaUnread?: boolean;\n  groupedId?: string;\n  isInAlbum?: boolean;\n  hasUnreadMention?: boolean;\n  inlineButtons?: ApiKeyboardButtons;\n  keyboardButtons?: ApiKeyboardButtons;\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n  viaBotId?: string;\n  viaBusinessBotId?: string;\n  postAuthorTitle?: string;\n  isScheduled?: boolean;\n  shouldHideKeyboardButtons?: boolean;\n  isHideKeyboardSelective?: boolean;\n  isFromScheduled?: boolean;\n  isSilent?: boolean;\n  isPinned?: boolean;\n  seenByDates?: Record<string, number>;\n  isProtected?: boolean;\n  isForwardingAllowed?: boolean;\n  transcriptionId?: string;\n  isTranscriptionError?: boolean;\n  emojiOnlyCount?: number;\n  reactors?: {\n    nextOffset?: string;\n    count: number;\n    reactions: ApiPeerReaction[];\n  };\n  reactions?: ApiReactions;\n  hasComments?: boolean;\n  readDate?: number;\n  savedPeerId?: string;\n  senderBoosts?: number;\n  factCheck?: ApiFactCheck;\n  effectId?: string;\n  isInvertedMedia?: true;\n  isVideoProcessingPending?: true;\n  areReactionsPossible?: true;\n  reportDeliveryUntilDate?: number;\n}\n\nexport interface ApiReactions {\n  canSeeList?: boolean;\n  areTags?: boolean;\n  results: ApiReactionCount[];\n  recentReactions?: ApiPeerReaction[];\n  topReactors?: ApiMessageReactor[];\n}\n\nexport interface ApiPeerReaction {\n  peerId: string;\n  reaction: ApiReaction;\n  isOwn?: boolean;\n  isBig?: boolean;\n  isUnread?: boolean;\n  addedDate: number;\n}\n\nexport interface ApiMessageReactor {\n  isTop?: true;\n  isMe?: true;\n  count: number;\n  isAnonymous?: true;\n  peerId?: string;\n}\n\nexport interface ApiReactionCount {\n  chosenOrder?: number;\n  count: number;\n  reaction: ApiReactionWithPaid;\n  localAmount?: number;\n  localIsPrivate?: boolean;\n  localPreviousChosenOrder?: number;\n}\n\nexport interface ApiAvailableReaction {\n  selectAnimation?: ApiDocument;\n  appearAnimation?: ApiDocument;\n  activateAnimation?: ApiDocument;\n  effectAnimation?: ApiDocument;\n  staticIcon?: ApiDocument;\n  centerIcon?: ApiDocument;\n  aroundAnimation?: ApiDocument;\n  reaction: ApiReactionEmoji;\n  title: string;\n  isInactive?: boolean;\n  isPremium?: boolean;\n}\n\nexport interface ApiAvailableEffect {\n  id: string;\n  emoticon: string;\n  staticIconId?: string;\n  effectAnimationId?: string;\n  effectStickerId: string;\n  isPremium?: boolean;\n}\n\ntype ApiChatReactionsAll = {\n  type: 'all';\n  areCustomAllowed?: true;\n};\n\ntype ApiChatReactionsSome = {\n  type: 'some';\n  allowed: ApiReaction[];\n};\n\nexport type ApiChatReactions = ApiChatReactionsAll | ApiChatReactionsSome;\n\nexport type ApiReactionEmoji = {\n  type: 'emoji';\n  emoticon: string;\n};\n\nexport type ApiReactionCustomEmoji = {\n  type: 'custom';\n  documentId: string;\n};\n\nexport type ApiReactionPaid = {\n  type: 'paid';\n};\n\nexport type ApiReaction = ApiReactionEmoji | ApiReactionCustomEmoji;\nexport type ApiReactionWithPaid = ApiReaction | ApiReactionPaid;\n\nexport type ApiReactionKey = `${string}-${string}` | 'paid' | 'unsupported';\n\nexport type ApiSavedReactionTag = {\n  reaction: ApiReaction;\n  title?: string;\n  count: number;\n};\n\ninterface ApiBaseThreadInfo {\n  chatId: string;\n  messagesCount: number;\n  lastMessageId?: number;\n  lastReadInboxMessageId?: number;\n  recentReplierIds?: string[];\n}\n\nexport interface ApiCommentsInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: true;\n  threadId?: never;\n  originChannelId: string;\n  originMessageId: number;\n}\n\nexport interface ApiMessageThreadInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: false;\n  threadId: ThreadId;\n  // For linked messages in discussion\n  fromChannelId?: string;\n  fromMessageId?: number;\n}\n\nexport type ApiThreadInfo = ApiCommentsInfo | ApiMessageThreadInfo;\n\nexport type ApiMessageReportResult = {\n  type: 'reported';\n} | {\n  type: 'comment';\n  isOptional?: boolean;\n  option: string;\n} | {\n  type: 'selectOption';\n  title: string;\n  options: {\n    text: string;\n    option: string;\n  }[];\n};\n\nexport type ApiMessageOutgoingStatus = 'read' | 'succeeded' | 'pending' | 'failed';\n\nexport type ApiSponsoredMessage = {\n  chatId: string;\n  randomId: string;\n  isRecommended?: true;\n  expiresAt: number;\n  sponsorInfo?: string;\n  additionalInfo?: string;\n  buttonText?: string;\n  canReport?: true;\n  title: string;\n  url: string;\n  photo?: ApiPhoto;\n  content: MediaContent;\n  peerColor?: ApiPeerColor;\n};\n\n// KeyboardButtons\n\ninterface ApiKeyboardButtonSimple {\n  type: 'unsupported' | 'buy' | 'command' | 'requestPhone' | 'game';\n  text: string;\n}\n\ninterface ApiKeyboardButtonReceipt {\n  type: 'receipt';\n  receiptMessageId: number;\n}\n\ninterface ApiKeyboardButtonUrl {\n  type: 'url';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonSimpleWebView {\n  type: 'simpleWebView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonWebView {\n  type: 'webView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonCallback {\n  type: 'callback';\n  text: string;\n  data: string;\n}\n\ninterface ApiKeyboardButtonRequestPoll {\n  type: 'requestPoll';\n  text: string;\n  isQuiz?: boolean;\n}\n\ninterface ApiKeyboardButtonSwitchBotInline {\n  type: 'switchBotInline';\n  text: string;\n  query: string;\n  isSamePeer?: boolean;\n}\n\ninterface ApiKeyboardButtonUserProfile {\n  type: 'userProfile';\n  text: string;\n  userId: string;\n}\n\ninterface ApiKeyboardButtonUrlAuth {\n  type: 'urlAuth';\n  text: string;\n  url: string;\n  buttonId: number;\n}\n\ninterface ApiKeyboardButtonCopy {\n  type: 'copy';\n  text: string;\n  copyText: string;\n}\n\nexport type ApiKeyboardButton = (\n  ApiKeyboardButtonSimple\n  | ApiKeyboardButtonReceipt\n  | ApiKeyboardButtonUrl\n  | ApiKeyboardButtonCallback\n  | ApiKeyboardButtonRequestPoll\n  | ApiKeyboardButtonSwitchBotInline\n  | ApiKeyboardButtonUserProfile\n  | ApiKeyboardButtonWebView\n  | ApiKeyboardButtonSimpleWebView\n  | ApiKeyboardButtonUrlAuth\n  | ApiKeyboardButtonCopy\n);\n\nexport type ApiKeyboardButtons = ApiKeyboardButton[][];\nexport type ApiReplyKeyboard = {\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n} & {\n  [K in 'inlineButtons' | 'keyboardButtons']?: ApiKeyboardButtons;\n};\n\nexport type ApiTranscription = {\n  text: string;\n  isPending?: boolean;\n  transcriptionId: string;\n};\n\nexport type ApiMessageSearchType = 'text' | 'media' | 'documents' | 'links' | 'audio' | 'voice' | 'profilePhoto';\nexport type ApiGlobalMessageSearchType = 'text' | 'channels' | 'media' | 'documents' | 'links' | 'audio' | 'voice';\nexport type ApiMessageSearchContext = 'all' | 'users' | 'groups' | 'channels';\n\nexport type ApiReportReason = 'spam' | 'violence' | 'pornography' | 'childAbuse'\n| 'copyright' | 'geoIrrelevant' | 'fake' | 'illegalDrugs' | 'personalDetails' | 'other';\n\nexport type ApiSendMessageAction = {\n  type: 'cancel' | 'typing' | 'recordAudio' | 'chooseSticker' | 'playingGame';\n};\n\nexport type ApiThemeParameters = {\n  bg_color: string;\n  text_color: string;\n  hint_color: string;\n  link_color: string;\n  button_color: string;\n  button_text_color: string;\n  secondary_bg_color: string;\n  header_bg_color: string;\n  accent_text_color: string;\n  section_bg_color: string;\n  section_header_text_color: string;\n  subtitle_text_color: string;\n  destructive_text_color: string;\n  section_separator_color: string;\n};\n\nexport type ApiBotApp = {\n  id: string;\n  accessHash: string;\n  title: string;\n  shortName: string;\n  description: string;\n  photo?: ApiPhoto;\n  document?: ApiDocument;\n};\n\nexport type ApiMessagesBotApp = ApiBotApp & {\n  isInactive?: boolean;\n  shouldRequestWriteAccess?: boolean;\n};\n\nexport type ApiQuickReply = {\n  id: number;\n  shortcut: string;\n  topMessageId: number;\n};\n\nexport type ApiFactCheck = {\n  shouldFetch?: true;\n  hash: string;\n  countryCode?: string;\n  text?: ApiFormattedText;\n};\n\nexport type ApiSponsoredMessageReportResult = {\n  type: 'reported' | 'hidden' | 'premiumRequired';\n} | {\n  type: 'selectOption';\n  title: string;\n  options: {\n    text: string;\n    option: string;\n  }[];\n};\n\nexport const MAIN_THREAD_ID = -1;\n\n// `Symbol` can not be transferred from worker\nexport const MESSAGE_DELETED = 'MESSAGE_DELETED';\n","import React, { memo, useState } from '../../lib/teact/teact';\n\nimport type { OwnProps as AnimatedStickerProps } from './AnimatedSticker';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useFlag from '../../hooks/useFlag';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\n\nimport AnimatedSticker from './AnimatedSticker';\n\nconst DEFAULT_SIZE = 150;\n\nexport type OwnProps =\n  Partial<AnimatedStickerProps>\n  & { noTransition?: boolean; nonInteractive?: boolean };\n\nfunction AnimatedIcon(props: OwnProps) {\n  const {\n    size = DEFAULT_SIZE,\n    play = true,\n    noLoop = true,\n    className,\n    noTransition,\n    nonInteractive,\n    onLoad,\n    onClick,\n    ...otherProps\n  } = props;\n  const [isAnimationLoaded, markAnimationLoaded] = useFlag(false);\n  const transitionClassNames = useMediaTransitionDeprecated(noTransition || isAnimationLoaded);\n\n  const handleLoad = useLastCallback(() => {\n    markAnimationLoaded();\n    onLoad?.();\n  });\n\n  const [playKey, setPlayKey] = useState(String(Math.random()));\n\n  const handleClick = useLastCallback(() => {\n    if (play === true) {\n      setPlayKey(String(Math.random()));\n    }\n\n    onClick?.();\n  });\n\n  return (\n    <AnimatedSticker\n      className={buildClassName(className, transitionClassNames)}\n      size={size}\n      play={play === true ? playKey : play}\n      noLoop={noLoop}\n      onClick={!nonInteractive ? handleClick : undefined}\n      onLoad={handleLoad}\n      /* eslint-disable-next-line react/jsx-props-no-spreading */\n      {...otherProps}\n    />\n  );\n}\n\nexport default memo(AnimatedIcon);\n","type RLottieClass = typeof import('./RLottie').default;\n\nlet promise: Promise<RLottieClass>;\nlet RLottie: RLottieClass;\n\n// Time for the main interface to completely load\nconst LOTTIE_LOAD_DELAY = 3000;\n\nexport async function ensureRLottie() {\n  if (!promise) {\n    promise = import('./RLottie').then((module) => module.default);\n    RLottie = await promise;\n  }\n\n  return promise;\n}\n\nexport function getRLottie() {\n  return RLottie;\n}\n\nsetTimeout(ensureRLottie, LOTTIE_LOAD_DELAY);\n","import type { RefObject } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, {\n  getIsHeavyAnimating,\n  memo,\n  useEffect,\n  useRef,\n  useState,\n  useUnmountCleanup,\n} from '../../lib/teact/teact';\n\nimport type RLottieInstance from '../../lib/rlottie/RLottie';\n\nimport { requestMeasure } from '../../lib/fasterdom/fasterdom';\nimport { ensureRLottie, getRLottie } from '../../lib/rlottie/RLottie.async';\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\nimport generateUniqueId from '../../util/generateUniqueId';\nimport { hexToRgb } from '../../util/switchTheme';\nimport { IS_ELECTRON } from '../../util/windowEnvironment';\n\nimport useColorFilter from '../../hooks/stickers/useColorFilter';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useFlag from '../../hooks/useFlag';\nimport useHeavyAnimation from '../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport usePriorityPlaybackCheck, { isPriorityPlaybackActive } from '../../hooks/usePriorityPlaybackCheck';\nimport useSharedIntersectionObserver from '../../hooks/useSharedIntersectionObserver';\nimport { useStateRef } from '../../hooks/useStateRef';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useThrottledCallback from '../../hooks/useThrottledCallback';\nimport useUniqueId from '../../hooks/useUniqueId';\nimport useBackgroundMode, { isBackgroundModeActive } from '../../hooks/window/useBackgroundMode';\n\nexport type OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  renderId?: string;\n  className?: string;\n  style?: string;\n  tgsUrl?: string;\n  play?: boolean | string;\n  playSegment?: [number, number];\n  speed?: number;\n  noLoop?: boolean;\n  size: number;\n  quality?: number;\n  color?: string;\n  isLowPriority?: boolean;\n  forceAlways?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  sharedCanvas?: HTMLCanvasElement;\n  sharedCanvasCoords?: { x: number; y: number };\n  onClick?: NoneToVoidFunction;\n  onLoad?: NoneToVoidFunction;\n  onEnded?: NoneToVoidFunction;\n  onLoop?: NoneToVoidFunction;\n};\n\nconst THROTTLE_MS = 150;\n\nconst AnimatedSticker: FC<OwnProps> = ({\n  ref,\n  renderId,\n  className,\n  style,\n  tgsUrl,\n  play,\n  playSegment,\n  speed,\n  noLoop,\n  size,\n  quality,\n  isLowPriority,\n  color,\n  forceAlways,\n  forceOnHeavyAnimation,\n  sharedCanvas,\n  sharedCanvasCoords,\n  onClick,\n  onLoad,\n  onEnded,\n  onLoop,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const viewId = useUniqueId();\n\n  const [animation, setAnimation] = useState<RLottieInstance>();\n  const animationRef = useRef<RLottieInstance>();\n  const isFirstRender = useRef(true);\n\n  const shouldUseColorFilter = !sharedCanvas && color;\n  const colorFilter = useColorFilter(shouldUseColorFilter ? color : undefined);\n\n  const playKey = play || (play === false ? false : playSegment);\n  const playRef = useStateRef(play);\n  const playSegmentRef = useStateRef(playSegment);\n\n  const rgbColor = useRef<[number, number, number] | undefined>();\n\n  const shouldForceOnHeavyAnimation = forceAlways || forceOnHeavyAnimation;\n  // Delay initialization until heavy animation ends\n  const [\n    canInitialize, markCanInitialize, unmarkCanInitialize,\n  ] = useFlag(!getIsHeavyAnimating() || shouldForceOnHeavyAnimation);\n  useHeavyAnimation(unmarkCanInitialize, markCanInitialize, shouldForceOnHeavyAnimation);\n  useEffect(() => {\n    if (shouldForceOnHeavyAnimation) markCanInitialize();\n  }, [shouldForceOnHeavyAnimation]);\n\n  useSyncEffect(() => {\n    if (color && !shouldUseColorFilter) {\n      const { r, g, b } = hexToRgb(color);\n      rgbColor.current = [r, g, b];\n    } else {\n      rgbColor.current = undefined;\n    }\n  }, [color, shouldUseColorFilter]);\n\n  const isUnmountedRef = useRef(false);\n  useUnmountCleanup(() => {\n    isUnmountedRef.current = true;\n  });\n\n  const init = useLastCallback(() => {\n    if (\n      animationRef.current\n      || isUnmountedRef.current\n      || !tgsUrl\n      || (sharedCanvas && (!sharedCanvasCoords || !sharedCanvas.offsetWidth || !sharedCanvas.offsetHeight))\n      || (getIsHeavyAnimating() && !shouldForceOnHeavyAnimation)\n    ) {\n      return;\n    }\n\n    const container = containerRef.current || sharedCanvas;\n    if (!container) {\n      return;\n    }\n\n    const newAnimation = getRLottie().init(\n      tgsUrl,\n      container,\n      renderId || generateUniqueId(),\n      {\n        size,\n        noLoop,\n        quality,\n        isLowPriority,\n        coords: sharedCanvasCoords,\n      },\n      viewId,\n      rgbColor.current,\n      onLoad,\n      onEnded,\n      onLoop,\n    );\n\n    if (speed) {\n      newAnimation.setSpeed(speed);\n    }\n\n    setAnimation(newAnimation);\n    animationRef.current = newAnimation;\n  });\n\n  useEffect(() => {\n    if (!canInitialize) return;\n    if (getRLottie()) {\n      init();\n    } else {\n      ensureRLottie().then(init);\n    }\n  }, [init, tgsUrl, sharedCanvas, sharedCanvasCoords, canInitialize]);\n\n  const throttledInit = useThrottledCallback(init, [init], THROTTLE_MS);\n  useSharedIntersectionObserver(sharedCanvas, throttledInit);\n\n  useEffect(() => {\n    if (!animation) return;\n\n    animation.setColor(rgbColor.current);\n  }, [color, animation]);\n\n  useUnmountCleanup(() => {\n    animationRef.current?.removeView(viewId);\n  });\n\n  const playAnimation = useLastCallback((shouldRestart = false) => {\n    if (\n      !animation\n      || !(playRef.current || playSegmentRef.current)\n      || isFrozen(forceAlways)\n    ) {\n      return;\n    }\n\n    if (playSegmentRef.current) {\n      animation.playSegment(playSegmentRef.current, shouldRestart, viewId);\n    } else {\n      animation.play(shouldRestart, viewId);\n    }\n  });\n\n  const playAnimationOnRaf = useLastCallback(() => {\n    requestMeasure(playAnimation);\n  });\n\n  const pauseAnimation = useLastCallback(() => {\n    if (animation?.isPlaying()) {\n      animation.pause(viewId);\n    }\n  });\n\n  useEffectWithPrevDeps(([prevNoLoop]) => {\n    if (prevNoLoop !== undefined && noLoop !== prevNoLoop) {\n      animation?.setNoLoop(noLoop);\n    }\n  }, [noLoop, animation]);\n\n  useEffectWithPrevDeps(([prevSharedCanvasCoords]) => {\n    if (prevSharedCanvasCoords !== undefined && sharedCanvasCoords !== prevSharedCanvasCoords) {\n      animation?.setSharedCanvasCoords(viewId, sharedCanvasCoords);\n    }\n  }, [sharedCanvasCoords, viewId, animation]);\n\n  useEffect(() => {\n    if (!animation) {\n      return;\n    }\n\n    if (playKey) {\n      if (!isFrozen(forceAlways, forceOnHeavyAnimation)) {\n        playAnimation(noLoop);\n      }\n    } else {\n      pauseAnimation();\n    }\n  }, [animation, playKey, noLoop, playAnimation, pauseAnimation, forceAlways, forceOnHeavyAnimation]);\n\n  useEffect(() => {\n    if (animation) {\n      if (isFirstRender.current) {\n        isFirstRender.current = false;\n      } else if (tgsUrl) {\n        animation.changeData(tgsUrl);\n        playAnimation();\n      }\n    }\n  }, [playAnimation, animation, tgsUrl]);\n\n  useHeavyAnimation(pauseAnimation, playAnimation, !playKey || shouldForceOnHeavyAnimation);\n  usePriorityPlaybackCheck(pauseAnimation, playAnimation, !playKey || forceAlways);\n  // Pausing frame may not happen in background,\n  // so we need to make sure it happens right after focusing,\n  // then we can play again.\n  useBackgroundMode(pauseAnimation, playAnimationOnRaf, !playKey || forceAlways);\n\n  if (sharedCanvas) {\n    return undefined;\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className={buildClassName('AnimatedSticker', className)}\n      style={buildStyle(\n        size !== undefined && `width: ${size}px; height: ${size}px;`,\n        onClick && !IS_ELECTRON && 'cursor: pointer',\n        colorFilter,\n        style,\n      )}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default memo(AnimatedSticker);\n\nfunction isFrozen(forceAlways = false, forceOnHeavyAnimation = false) {\n  if (forceAlways) return false;\n  return (!forceOnHeavyAnimation && getIsHeavyAnimating()) || isPriorityPlaybackActive() || isBackgroundModeActive();\n}\n","import React, {\n  type TeactNode,\n  useRef,\n} from '../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useCollapsibleLines from '../../hooks/element/useCollapsibleLines';\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport Icon from './icons/Icon';\n\nimport styles from './Blockquote.module.scss';\nimport { Utils } from '../../contest/text-editor/utils';\n\ntype OwnProps = {\n  collapsed?: boolean;\n  isToggleDisabled?: boolean;\n  isInEditMode?: boolean;\n  children: TeactNode;\n};\n\nconst MAX_LINES = 4;\n\nexport function checkBlockQuoteFirstLast(blockElement: HTMLElement) {\n  const gradientContainer = blockElement.querySelector(`.container`);\n  return { gradientContainer };\n}\n\nexport function getBlockQuoteInnerText(node: Node) {\n  if (!(node instanceof HTMLElement) || node.dataset.entityType !== ApiMessageEntityTypes.Blockquote) return;\n\n  const childEl = Array.from(node.childNodes).find(child => child instanceof HTMLQuoteElement);\n  if (childEl) {\n    return {\n      text: Utils.getTextContentWithBreaks(childEl, {\n        skipMarkdownMarker: false\n      })\n    };\n  }\n}\n\nconst Blockquote = ({ collapsed, isToggleDisabled, isInEditMode, children }: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLQuoteElement>(null);\n  const isDisabled = isInEditMode ? false : !collapsed;\n  const {\n    isCollapsed, isCollapsible, setIsCollapsed,\n  } = useCollapsibleLines(ref, MAX_LINES, undefined, isDisabled, isInEditMode);\n  const canExpand = !isToggleDisabled && isCollapsed;\n\n  const handleExpand = useLastCallback(() => {\n    setIsCollapsed(false);\n  });\n\n  const handleToggle = useLastCallback(() => {\n    setIsCollapsed((prev) => !prev);\n  });\n\n  return (\n    <span\n      className={buildClassName(\"Blockquote\", styles.root, isCollapsed && styles.collapsed,\n        isInEditMode && \"isInEditMode\")}\n      onClick={canExpand ? handleExpand : undefined}\n      // contentEditable={false}\n      data-entity-type={ApiMessageEntityTypes.Blockquote}\n      data-collapsed={isCollapsed}\n    >\n      <blockquote\n        className={styles.blockquote}\n        ref={ref}\n      // data-entity-type={ApiMessageEntityTypes.Blockquote}\n      // data-can-collapse={isCollapsed}\n      >\n        <div className={buildClassName('container', styles.gradientContainer)}\n          // contentEditable={isInEditMode}\n          >\n          {children}\n        </div>\n        {/* <button className='collapsed-button'>Expand</button> */}\n        {isCollapsible && (\n          <div\n            className={buildClassName(styles.collapseIcon, !isToggleDisabled && styles.clickable)}\n            onClick={!isToggleDisabled ? handleToggle : undefined}\n            aria-hidden\n            contentEditable={false}\n          >\n            <Icon name={isCollapsed ? 'down' : 'up'} />\n          </div>\n        )}\n      </blockquote>\n    </span>\n  );\n};\n\nexport default Blockquote;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"KU67Uur0\",\"collapsed\":\"y_uRZXtA\",\"blockquote\":\"m3sD7_cn\",\"gradientContainer\":\"JNVT2DU9\",\"collapseIcon\":\"pyX4NpPB\",\"clickable\":\"RmvXwV0W\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useRef, useState } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { selectIsAlwaysHighPriorityEmoji } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport safePlay from '../../util/safePlay';\n\nimport useDynamicColorListener from '../../hooks/stickers/useDynamicColorListener';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useCustomEmoji from './hooks/useCustomEmoji';\n\nimport StickerView from './StickerView';\n\nimport styles from './CustomEmoji.module.scss';\n\nimport blankImg from '../../assets/blank.png';\nimport { handleClickOnNonContentEditable } from '../../contest/text-editor';\n\ntype OwnProps = {\n  ref?: React.RefObject<HTMLDivElement>;\n  documentId: string;\n  className?: string;\n  style?: string;\n  size?: number;\n  isBig?: boolean;\n  noPlay?: boolean;\n  noVideoOnMobile?: boolean;\n  loopLimit?: number;\n  isSelectable?: boolean;\n  withSharedAnimation?: boolean;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  sharedCanvasHqRef?: React.RefObject<HTMLCanvasElement>;\n  withTranslucentThumb?: boolean;\n  shouldPreloadPreview?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  forceAlways?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onClick?: NoneToVoidFunction;\n  onAnimationEnd?: NoneToVoidFunction;\n  isInEditMode?: boolean;\n};\n\nconst STICKER_SIZE = 20;\n\nexport function getCustomEmojiInnerText(node: Node) {\n  if (!(node instanceof HTMLElement) || node.dataset.entityType !== ApiMessageEntityTypes.CustomEmoji) return;\n\n  return { text: node.dataset.alt };\n}\n\nconst CustomEmoji: FC<OwnProps> = ({\n  ref,\n  documentId,\n  className,\n  style,\n  size = STICKER_SIZE,\n  isBig,\n  noPlay,\n  noVideoOnMobile,\n  loopLimit,\n  isSelectable,\n  withSharedAnimation,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  withTranslucentThumb,\n  shouldPreloadPreview,\n  forceAlways,\n  forceOnHeavyAnimation,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onClick,\n  onAnimationEnd,\n  isInEditMode\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  // An alternative to `withGlobal` to avoid adding numerous global containers\n  const { customEmoji, canPlay } = useCustomEmoji(documentId);\n\n  const loopCountRef = useRef(0);\n  const [shouldPlay, setShouldPlay] = useState(true);\n\n  const hasCustomColor = customEmoji?.shouldUseTextColor;\n  const customColor = useDynamicColorListener(containerRef, !hasCustomColor);\n\n  const handleVideoEnded = useLastCallback((e) => {\n    if (!loopLimit) return;\n\n    loopCountRef.current += 1;\n\n    if (loopCountRef.current >= loopLimit) {\n      setShouldPlay(false);\n      e.currentTarget.currentTime = 0;\n    } else {\n      // Loop manually\n      safePlay(e.currentTarget);\n    }\n  });\n\n  const handleStickerLoop = useLastCallback(() => {\n    if (!loopLimit) return;\n\n    loopCountRef.current += 1;\n\n    if (loopCountRef.current >= loopLimit) {\n      setShouldPlay(false);\n    }\n  });\n\n  const isHq = customEmoji?.stickerSetInfo && selectIsAlwaysHighPriorityEmoji(getGlobal(), customEmoji.stickerSetInfo);\n\n  const emojiElement = () => (\n    <div\n      ref={containerRef}\n      className={buildClassName(\n        styles.root,\n        className,\n        'custom-emoji',\n        'emoji',\n      )}\n      onClick={onClick}\n      onAnimationEnd={onAnimationEnd}\n      contentEditable={\"false\"}\n      data-entity-type={ApiMessageEntityTypes.CustomEmoji}\n      data-document-id={documentId}\n      data-alt={customEmoji?.emoji}\n      style={style}\n    >\n      {isSelectable && (\n        <img\n          className={styles.highlightCatch}\n          src={blankImg}\n          alt={customEmoji?.emoji}\n          // data-entity-type={ApiMessageEntityTypes.CustomEmoji}\n          // data-document-id={documentId}\n          draggable={false}\n        />\n      )}\n      {!customEmoji ? (\n        <div className={buildClassName(styles.placeholder)} draggable={false} />\n      ) : (\n        <StickerView\n          containerRef={containerRef}\n          sticker={customEmoji}\n          isSmall={!isBig}\n          size={size}\n          noPlay={noPlay || !(shouldPlay && canPlay)}\n          noVideoOnMobile={noVideoOnMobile}\n          thumbClassName={styles.thumb}\n          fullMediaClassName={styles.media}\n          shouldLoop\n          loopLimit={loopLimit}\n          shouldPreloadPreview={shouldPreloadPreview || noPlay || !canPlay}\n          forceOnHeavyAnimation={forceOnHeavyAnimation}\n          forceAlways={forceAlways}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withSharedAnimation={withSharedAnimation}\n          sharedCanvasRef={isHq ? sharedCanvasHqRef : sharedCanvasRef}\n          withTranslucentThumb={withTranslucentThumb}\n          onVideoEnded={handleVideoEnded}\n          onAnimatedStickerLoop={handleStickerLoop}\n          customColor={customColor}\n        />\n      )}\n    </div>\n  );\n  return isInEditMode ? <span onClick={handleClickOnNonContentEditable}>{emojiElement()}</span> : emojiElement();\n};\n\nexport default memo(CustomEmoji);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"CEFe1FhH\",\"placeholder\":\"DKi1177s\",\"thumb\":\"O_TaDxWg\",\"media\":\"wqju02hR\",\"highlight-catch\":\"a8dMNkh3\",\"highlightCatch\":\"a8dMNkh3\"};","import React, { memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type {\n  ApiFormattedText, ApiMessage, ApiPoll, ApiTypeStory,\n} from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport {\n  extractMessageText,\n  getMessagePollId,\n  groupStatetefulContent,\n} from '../../global/helpers';\nimport {\n  getMessageSummaryDescription,\n  getMessageSummaryEmoji,\n  getMessageSummaryText,\n  TRUNCATED_SUMMARY_LENGTH,\n} from '../../global/helpers/messageSummary';\nimport { selectPeerStory, selectPollFromMessage } from '../../global/selectors';\nimport trimText from '../../util/trimText';\nimport renderText from './helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport MessageText from './MessageText';\n\ntype OwnProps = {\n  message: ApiMessage;\n  translatedText?: ApiFormattedText;\n  noEmoji?: boolean;\n  highlight?: string;\n  truncateLength?: number;\n  withTranslucentThumbs?: boolean;\n  inChatList?: boolean;\n  emojiSize?: number;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n};\n\ntype StateProps = {\n  poll?: ApiPoll;\n  story?: ApiTypeStory;\n};\n\nfunction MessageSummary({\n  message,\n  translatedText,\n  noEmoji = false,\n  highlight,\n  truncateLength = TRUNCATED_SUMMARY_LENGTH,\n  withTranslucentThumbs = false,\n  inChatList = false,\n  emojiSize,\n  poll,\n  story,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n}: OwnProps & StateProps) {\n  const lang = useOldLang();\n  const { text, entities } = extractMessageText(message, inChatList) || {};\n  const hasSpoilers = entities?.some((e) => e.type === ApiMessageEntityTypes.Spoiler);\n  const hasCustomEmoji = entities?.some((e) => e.type === ApiMessageEntityTypes.CustomEmoji);\n  const hasPoll = Boolean(getMessagePollId(message));\n\n  const statefulContent = groupStatetefulContent({ poll, story });\n\n  if ((!text || (!hasSpoilers && !hasCustomEmoji)) && !hasPoll) {\n    const summaryText = translatedText?.text\n      || getMessageSummaryText(lang, message, statefulContent, noEmoji, truncateLength);\n    const trimmedText = trimText(summaryText, truncateLength);\n\n    return (\n      <span>\n        {highlight ? (\n          renderText(trimmedText, ['emoji', 'highlight'], { highlight })\n        ) : (\n          renderText(trimmedText)\n        )}\n      </span>\n    );\n  }\n\n  function renderMessageText() {\n    return (\n      <MessageText\n        messageOrStory={message}\n        translatedText={translatedText}\n        highlight={highlight}\n        isSimple\n        observeIntersectionForLoading={observeIntersectionForLoading}\n        observeIntersectionForPlaying={observeIntersectionForPlaying}\n        withTranslucentThumbs={withTranslucentThumbs}\n        truncateLength={truncateLength}\n        inChatList={inChatList}\n        emojiSize={emojiSize}\n      />\n    );\n  }\n\n  const emoji = !noEmoji && getMessageSummaryEmoji(message);\n\n  return (\n    <>\n      {[\n        emoji ? renderText(`${emoji} `) : undefined,\n        getMessageSummaryDescription(lang, message, statefulContent, renderMessageText()),\n      ].flat().filter(Boolean)}\n    </>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { message }): StateProps => {\n    const poll = selectPollFromMessage(global, message);\n    const storyData = message.content.storyData;\n    const story = storyData && selectPeerStory(global, storyData.peerId, storyData.id);\n\n    return {\n      poll,\n      story,\n    };\n  },\n)(MessageSummary));\n","import React, {\n  memo, useMemo, useRef,\n} from '../../lib/teact/teact';\n\nimport type { ApiFormattedText, ApiMessage, ApiStory } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { CONTENT_NOT_SUPPORTED } from '../../config';\nimport { extractMessageText, stripCustomEmoji } from '../../global/helpers';\nimport trimText from '../../util/trimText';\nimport { renderTextWithEntities } from './helpers/renderTextWithEntities';\n\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useUniqueId from '../../hooks/useUniqueId';\n\ninterface OwnProps {\n  messageOrStory: ApiMessage | ApiStory;\n  translatedText?: ApiFormattedText;\n  isForAnimation?: boolean;\n  emojiSize?: number;\n  highlight?: string;\n  isSimple?: boolean;\n  truncateLength?: number;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  shouldRenderAsHtml?: boolean;\n  inChatList?: boolean;\n  forcePlayback?: boolean;\n  focusedQuote?: string;\n  isInSelectMode?: boolean;\n  canBeEmpty?: boolean;\n}\n\nconst MIN_CUSTOM_EMOJIS_FOR_SHARED_CANVAS = 3;\n\nfunction MessageText({\n  messageOrStory,\n  translatedText,\n  isForAnimation,\n  emojiSize,\n  highlight,\n  isSimple,\n  truncateLength,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  shouldRenderAsHtml,\n  inChatList,\n  forcePlayback,\n  focusedQuote,\n  isInSelectMode,\n  canBeEmpty,\n}: OwnProps) {\n  // eslint-disable-next-line no-null/no-null\n  const sharedCanvasRef = useRef<HTMLCanvasElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const sharedCanvasHqRef = useRef<HTMLCanvasElement>(null);\n\n  const textCacheBusterRef = useRef(0);\n\n  const formattedText = translatedText || extractMessageText(messageOrStory, inChatList);\n  const adaptedFormattedText = isForAnimation && formattedText ? stripCustomEmoji(formattedText) : formattedText;\n  const { text, entities } = adaptedFormattedText || {};\n\n  const containerId = useUniqueId();\n\n  useSyncEffect(() => {\n    textCacheBusterRef.current += 1;\n  }, [text, entities]);\n\n  const withSharedCanvas = useMemo(() => {\n    const hasSpoilers = entities?.some((e) => e.type === ApiMessageEntityTypes.Spoiler);\n    if (hasSpoilers) {\n      return false;\n    }\n\n    const customEmojisCount = entities?.filter((e) => e.type === ApiMessageEntityTypes.CustomEmoji).length || 0;\n    return customEmojisCount >= MIN_CUSTOM_EMOJIS_FOR_SHARED_CANVAS;\n  }, [entities]) || 0;\n\n  if (!text && !canBeEmpty) {\n    return <span className=\"content-unsupported\">{CONTENT_NOT_SUPPORTED}</span>;\n  }\n\n  return (\n    <>\n      {[\n        withSharedCanvas && <canvas ref={sharedCanvasRef} className=\"shared-canvas\" />,\n        withSharedCanvas && <canvas ref={sharedCanvasHqRef} className=\"shared-canvas\" />,\n        renderTextWithEntities({\n          text: trimText(text!, truncateLength),\n          entities,\n          highlight,\n          emojiSize,\n          shouldRenderAsHtml,\n          containerId,\n          isSimple,\n          isProtected,\n          observeIntersectionForLoading,\n          observeIntersectionForPlaying,\n          withTranslucentThumbs,\n          sharedCanvasRef,\n          sharedCanvasHqRef,\n          cacheBuster: textCacheBusterRef.current.toString(),\n          forcePlayback,\n          focusedQuote,\n          isInSelectMode,\n        }),\n      ].flat().filter(Boolean)}\n    </>\n  );\n}\n\nexport default memo(MessageText);\n","/* eslint-disable no-nested-ternary */\n/* eslint-disable no-bitwise */\n/* eslint-disable @typescript-eslint/naming-convention */\n\nconst utf16 = {\n  // The utf16-class is necessary to convert from javascripts internal character representation to unicode and back.\n  decode: (input) => {\n    const output = [];\n    let i = 0;\n    const len = input.length;\n    let value;\n    let extra;\n\n    while (i < len) {\n      value = input.charCodeAt(i++);\n      if ((value & 0xf800) === 0xd800) {\n        extra = input.charCodeAt(i++);\n        if ((value & 0xfc00) !== 0xd800 || (extra & 0xfc00) !== 0xdc00) {\n          throw new RangeError('UTF-16(decode): Illegal UTF-16 sequence');\n        }\n        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n      }\n      output.push(value);\n    }\n    return output;\n  },\n  encode: (input) => {\n    const output = [];\n    let i = 0;\n    const len = input.length;\n    let value;\n\n    while (i < len) {\n      value = input[i++];\n      if ((value & 0xf800) === 0xd800) {\n        throw new RangeError('UTF-16(encode): Illegal UTF-16 value');\n      }\n      if (value > 0xffff) {\n        value -= 0x10000;\n        output.push(String.fromCharCode(((value >>> 10) & 0x3ff) | 0xd800));\n        value = 0xdc00 | (value & 0x3ff);\n      }\n      output.push(String.fromCharCode(value));\n    }\n    return output.join('');\n  },\n};\n\n// Default parameters\nconst initial_n = 0x80;\nconst initial_bias = 72;\nconst delimiter = '\\x2D';\nconst base = 36;\nconst damp = 700;\nconst tmin = 1;\nconst tmax = 26;\nconst skew = 38;\nconst maxint = 0x7fffffff;\n\n// decode_digit(cp) returns the numeric value of a basic code\n// point (for use in representing integers) in the range 0 to\n// base-1, or base if cp is does not represent a value.\n\nfunction decode_digit(cp) {\n  return cp - 48 < 10 ? cp - 22 : cp - 65 < 26 ? cp - 65 : cp - 97 < 26 ? cp - 97 : base;\n}\n\n// ** Bias adaptation function **\nfunction adapt(delta, numpoints, firsttime) {\n  let k;\n  delta = firsttime ? Math.floor(delta / damp) : delta >> 1;\n  delta += Math.floor(delta / numpoints);\n\n  for (k = 0; delta > ((base - tmin) * tmax) >> 1; k += base) {\n    delta = Math.floor(delta / (base - tmin));\n  }\n  return Math.floor(k + ((base - tmin + 1) * delta) / (delta + skew));\n}\n\n// Main decode\nfunction decode(input, preserveCase) {\n  // Dont use utf16\n  const output = [];\n  const case_flags = [];\n  const input_length = input.length;\n\n  let n; let out; let i; let bias; let basic; let j; let ic; let oldi; let w; let k; let digit; let t; let len;\n\n  // Initialize the state:\n\n  n = initial_n;\n  i = 0;\n  bias = initial_bias;\n\n  // Handle the basic code points: Let basic be the number of input code\n  // points before the last delimiter, or 0 if there is none, then\n  // copy the first basic code points to the output.\n\n  basic = input.lastIndexOf(delimiter);\n  if (basic < 0) basic = 0;\n\n  for (j = 0; j < basic; ++j) {\n    if (preserveCase) case_flags[output.length] = input.charCodeAt(j) - 65 < 26;\n    if (input.charCodeAt(j) >= 0x80) {\n      throw new RangeError('Illegal input >= 0x80');\n    }\n    output.push(input.charCodeAt(j));\n  }\n\n  // Main decoding loop: Start just after the last delimiter if any\n  // basic code points were copied; start at the beginning otherwise.\n\n  for (ic = basic > 0 ? basic + 1 : 0; ic < input_length;) {\n    // ic is the index of the next character to be consumed,\n\n    // Decode a generalized variable-length integer into delta,\n    // which gets added to i. The overflow checking is easier\n    // if we increase i as we go, then subtract off its starting\n    // value at the end to obtain delta.\n    for (oldi = i, w = 1, k = base; ; k += base) {\n      if (ic >= input_length) {\n        throw RangeError('punycode_bad_input(1)');\n      }\n      digit = decode_digit(input.charCodeAt(ic++));\n\n      if (digit >= base) {\n        throw RangeError('punycode_bad_input(2)');\n      }\n      if (digit > Math.floor((maxint - i) / w)) {\n        throw RangeError('punycode_overflow(1)');\n      }\n      i += digit * w;\n      t = k <= bias ? tmin : k >= bias + tmax ? tmax : k - bias;\n      if (digit < t) {\n        break;\n      }\n      if (w > Math.floor(maxint / (base - t))) {\n        throw RangeError('punycode_overflow(2)');\n      }\n      w *= base - t;\n    }\n\n    out = output.length + 1;\n    bias = adapt(i - oldi, out, oldi === 0);\n\n    // i was supposed to wrap around from out to 0,\n    // incrementing n each time, so we'll fix that now:\n    if (Math.floor(i / out) > maxint - n) {\n      throw RangeError('punycode_overflow(3)');\n    }\n    n += Math.floor(i / out);\n    i %= out;\n\n    // Insert n at position i of the output:\n    // Case of last character determines uppercase flag:\n    if (preserveCase) {\n      case_flags.splice(i, 0, input.charCodeAt(ic - 1) - 65 < 26);\n    }\n\n    output.splice(i, 0, n);\n    i++;\n  }\n  if (preserveCase) {\n    for (i = 0, len = output.length; i < len; i++) {\n      if (case_flags[i]) {\n        output[i] = String.fromCharCode(output[i])\n          .toUpperCase()\n          .charCodeAt(0);\n      }\n    }\n  }\n  return utf16.encode(output);\n}\n\nfunction toUnicode(domain) {\n  const domain_array = domain.split('.');\n  const out = [];\n  for (let i = 0; i < domain_array.length; ++i) {\n    const s = domain_array[i];\n    out.push(s.match(/^xn--/) ? decode(s.slice(4)) : s);\n  }\n  return out.join('.');\n}\n\nexport default toUnicode;\n","import type { TeactNode } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport {\n  DEBUG,\n} from '../../config';\nimport convertPunycode from '../../lib/punycode';\nimport buildClassName from '../../util/buildClassName';\nimport { ensureProtocol } from '../../util/ensureProtocol';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\ntype OwnProps = {\n  url?: string;\n  type?: ApiMessageEntityTypes.Url | ApiMessageEntityTypes.TextUrl;\n  text: string;\n  className?: string;\n  children?: TeactNode;\n  isRtl?: boolean;\n};\n\nconst SafeLink = ({\n  url,\n  type,\n  text,\n  className,\n  children,\n  isRtl,\n}: OwnProps) => {\n  const { openUrl } = getActions();\n\n  const content = children || text;\n  const isRegularLink = url === text;\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n    if (!url) return true;\n\n    e.preventDefault();\n    openUrl({ url, shouldSkipModal: isRegularLink });\n\n    return false;\n  });\n\n  if (!url) {\n    return undefined;\n  }\n\n  const classNames = buildClassName(\n    className || 'text-entity-link',\n    isRegularLink && 'word-break-all',\n  );\n\n  return (\n    <a\n      href={ensureProtocol(url)}\n      title={getUnicodeUrl(url)}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className={classNames}\n      onClick={handleClick}\n      dir={isRtl ? 'rtl' : 'auto'}\n      data-entity-type={type}\n    >\n      {content}\n    </a>\n  );\n};\n\nfunction getUnicodeUrl(url?: string) {\n  if (!url) {\n    return undefined;\n  }\n\n  const href = ensureProtocol(url);\n  if (!href) {\n    return undefined;\n  }\n\n  try {\n    const parsedUrl = new URL(href);\n    const unicodeDomain = convertPunycode(parsedUrl.hostname);\n\n    try {\n      return decodeURI(parsedUrl.toString()).replace(parsedUrl.hostname, unicodeDomain);\n    } catch (err) { // URL contains invalid sequences, keep it as it is\n      return parsedUrl.toString().replace(parsedUrl.hostname, unicodeDomain);\n    }\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('SafeLink.getDecodedUrl error ', url, error);\n    }\n  }\n\n  return undefined;\n}\n\nexport default SafeLink;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"fWE9Tkfe\",\"progress\":\"F0JPgXgb\",\"button\":\"B94KQ3c0\",\"symbol\":\"wapdILU7\",\"sparkle\":\"AS3Scly3\"};","import React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\n\nimport styles from './Sparkles.module.scss';\n\ntype ButtonParameters = {\n  preset: 'button';\n};\n\ntype ProgressParameters = {\n  preset: 'progress';\n};\n\ntype PresetParameters = ButtonParameters | ProgressParameters;\n\ntype OwnProps = {\n  className?: string;\n} & PresetParameters;\n\nconst SYMBOL = '✦';\nconst ANIMATION_DURATION = 5;\n\n// Values are in percents\nconst BUTTON_POSITIONS = [{\n  x: 20,\n  y: 0,\n  size: 100,\n  durationShift: 10,\n}, {\n  x: 15,\n  y: 15,\n  size: 75,\n  durationShift: 70,\n}, {\n  x: 10,\n  y: 35,\n  size: 75,\n  durationShift: 90,\n}, {\n  x: 20,\n  y: 70,\n  size: 125,\n  durationShift: 30,\n}, {\n  x: 40,\n  y: 10,\n  size: 125,\n  durationShift: 0,\n}, {\n  x: 45,\n  y: 60,\n  size: 75,\n  durationShift: 60,\n}, {\n  x: 60,\n  y: -10,\n  size: 100,\n  durationShift: 20,\n}, {\n  x: 55,\n  y: 40,\n  size: 75,\n  durationShift: 60,\n}, {\n  x: 70,\n  y: 65,\n  size: 100,\n  durationShift: 90,\n}, {\n  x: 80,\n  y: 10,\n  size: 75,\n  durationShift: 30,\n}, {\n  x: 80,\n  y: 45,\n  size: 125,\n  durationShift: 0,\n}];\nconst PROGRESS_POSITIONS = generateRandomProgressPositions(100);\n\nconst Sparkles = ({\n  className,\n  ...presetSettings\n}: OwnProps) => {\n  if (presetSettings.preset === 'button') {\n    return (\n      <div className={buildClassName(styles.root, styles.button, className)}>\n        {BUTTON_POSITIONS.map((position) => {\n          const shiftX = Math.cos(Math.atan2(-50 + position.y, -50 + position.x)) * 100;\n          const shiftY = Math.sin(Math.atan2(-50 + position.y, -50 + position.x)) * 100;\n          return (\n            <div\n              className={styles.symbol}\n              style={buildStyle(\n                `top: ${position.y}%`,\n                `left: ${position.x}%`,\n                `--_duration-shift: ${(-position.durationShift / 100) * ANIMATION_DURATION}s`,\n                `--_shift-x: ${shiftX}%`,\n                `--_shift-y: ${shiftY}%`,\n                `scale: ${position.size}%`,\n              )}\n            >\n              {SYMBOL}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  if (presetSettings.preset === 'progress') {\n    return (\n      <div className={buildClassName(styles.root, styles.progress, className)}>\n        {PROGRESS_POSITIONS.map((position) => {\n          return (\n            <div\n              className={styles.symbol}\n              style={buildStyle(\n                `top: ${position.y}%`,\n                `left: ${position.x}%`,\n                `--_shift-x: ${position.velocityX}%`,\n                `--_shift-y: ${position.velocityY}%`,\n                `scale: ${position.scale}%`,\n                `--_duration-shift: ${(-position.durationShift / 100) * ANIMATION_DURATION}s`,\n              )}\n            >\n              {SYMBOL}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  return undefined;\n};\n\nfunction generateRandomProgressPositions(count: number) {\n  const positions = [];\n  for (let i = 0; i < count; i++) {\n    positions.push({\n      x: Math.random() * 100,\n      y: Math.random() * 100,\n      velocityX: (Math.random() * 5 + 15) * 100,\n      velocityY: (Math.random() * 10 - 5) * 100,\n      scale: (Math.random() * 0.5 + 0.5) * 100,\n      durationShift: Math.random() * 100,\n    });\n  }\n  return positions;\n}\n\nexport default memo(Sparkles);\n","// extracted by mini-css-extract-plugin\nexport default {\"thumb\":\"gYSfUe37\",\"thumb-opaque\":\"vbcXDDxa\",\"thumbOpaque\":\"vbcXDDxa\",\"no-transition\":\"AvU_FtMd\",\"noTransition\":\"AvU_FtMd\",\"media\":\"RrEzFxte\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useMemo, useRef } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { ApiSticker } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport { getStickerMediaHash } from '../../global/helpers';\nimport { selectIsAlwaysHighPriorityEmoji } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport * as mediaLoader from '../../util/mediaLoader';\nimport { IS_ANDROID, IS_IOS, IS_WEBM_SUPPORTED } from '../../util/windowEnvironment';\n\nimport useColorFilter from '../../hooks/stickers/useColorFilter';\nimport useCoordsInSharedCanvas from '../../hooks/useCoordsInSharedCanvas';\nimport useFlag from '../../hooks/useFlag';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport useMountAfterHeavyAnimation from '../../hooks/useMountAfterHeavyAnimation';\nimport useThumbnail from '../../hooks/useThumbnail';\nimport useUniqueId from '../../hooks/useUniqueId';\nimport useDevicePixelRatio from '../../hooks/window/useDevicePixelRatio';\n\nimport OptimizedVideo from '../ui/OptimizedVideo';\nimport AnimatedSticker from './AnimatedSticker';\n\nimport styles from './StickerView.module.scss';\n\ntype OwnProps = {\n  containerRef: React.RefObject<HTMLDivElement>;\n  sticker: ApiSticker;\n  thumbClassName?: string;\n  fullMediaHash?: string;\n  fullMediaClassName?: string;\n  isSmall?: boolean;\n  size?: number;\n  customColor?: string;\n  loopLimit?: number;\n  shouldLoop?: boolean;\n  shouldPreloadPreview?: boolean;\n  forceAlways?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  noLoad?: boolean;\n  noPlay?: boolean;\n  noVideoOnMobile?: boolean;\n  withSharedAnimation?: boolean;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  withTranslucentThumb?: boolean; // With shared canvas thumbs are opaque by default to provide better transition effect\n  onVideoEnded?: AnyToVoidFunction;\n  onAnimatedStickerLoop?: AnyToVoidFunction;\n};\n\nconst SHARED_PREFIX = 'shared';\nconst STICKER_SIZE = 24;\n\nconst StickerView: FC<OwnProps> = ({\n  containerRef,\n  sticker,\n  thumbClassName,\n  fullMediaHash,\n  fullMediaClassName,\n  isSmall,\n  size = STICKER_SIZE,\n  customColor,\n  loopLimit,\n  shouldLoop = false,\n  shouldPreloadPreview,\n  forceAlways,\n  forceOnHeavyAnimation,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  noLoad,\n  noPlay,\n  noVideoOnMobile,\n  withSharedAnimation,\n  withTranslucentThumb,\n  sharedCanvasRef,\n  onVideoEnded,\n  onAnimatedStickerLoop,\n}) => {\n  const {\n    id, isLottie, stickerSetInfo, emoji,\n  } = sticker;\n  const [isVideoBroken, markVideoBroken] = useFlag();\n  const isUnsupportedVideo = sticker.isVideo && (\n    !IS_WEBM_SUPPORTED\n    || (noVideoOnMobile && (IS_IOS || IS_ANDROID))\n  );\n  const isVideo = sticker.isVideo;\n  const isStatic = !isLottie && !isVideo;\n  const previewMediaHash = getStickerMediaHash(sticker, 'preview');\n\n  const dpr = useDevicePixelRatio();\n\n  const filterStyle = useColorFilter(customColor);\n\n  const isIntersectingForLoading = useIsIntersecting(containerRef, observeIntersectionForLoading);\n  const shouldLoad = isIntersectingForLoading && !noLoad;\n  const isIntersectingForPlaying = (\n    useIsIntersecting(containerRef, observeIntersectionForPlaying)\n    && isIntersectingForLoading\n  );\n  const shouldPlay = isIntersectingForPlaying && !noPlay;\n  const hasIntersectedForPlayingRef = useRef(isIntersectingForPlaying);\n  if (!hasIntersectedForPlayingRef.current && isIntersectingForPlaying) {\n    hasIntersectedForPlayingRef.current = true;\n  }\n\n  const cachedPreview = mediaLoader.getFromMemory(previewMediaHash);\n  const isReadyToMountFullMedia = useMountAfterHeavyAnimation(hasIntersectedForPlayingRef.current);\n  const shouldForcePreview = isUnsupportedVideo || (isStatic ? isSmall : noPlay);\n  const shouldLoadPreview = !customColor && !cachedPreview && (!isReadyToMountFullMedia || shouldForcePreview);\n  const previewMediaData = useMedia(previewMediaHash, !shouldLoadPreview);\n  const withPreview = shouldLoadPreview || cachedPreview;\n\n  const shouldSkipLoadingFullMedia = Boolean(shouldForcePreview || (\n    fullMediaHash === previewMediaHash && (cachedPreview || previewMediaData)\n  ));\n  const fullMediaData = useMedia(fullMediaHash || `sticker${id}`, !shouldLoad || shouldSkipLoadingFullMedia);\n  const shouldRenderFullMedia = isReadyToMountFullMedia && fullMediaData && !isVideoBroken;\n  const [isPlayerReady, markPlayerReady] = useFlag();\n  const isFullMediaReady = shouldRenderFullMedia && (isStatic || isPlayerReady);\n\n  const thumbDataUri = useThumbnail(sticker);\n  const thumbData = cachedPreview || previewMediaData || thumbDataUri;\n  const isThumbOpaque = sharedCanvasRef && !withTranslucentThumb;\n\n  const noCrossTransition = Boolean(isLottie && withPreview);\n  const thumbRef = useMediaTransition<HTMLImageElement>(thumbData && !isFullMediaReady, {\n    noCloseTransition: noCrossTransition,\n  });\n  const fullMediaRef = useMediaTransition<HTMLElement>(isFullMediaReady, {\n    noOpenTransition: noCrossTransition,\n  });\n\n  const coords = useCoordsInSharedCanvas(containerRef, sharedCanvasRef);\n\n  // Preload preview for Message Input and local message\n  useMedia(previewMediaHash, !shouldLoad || !shouldPreloadPreview);\n\n  const randomIdPrefix = useUniqueId();\n  const renderId = useMemo(() => ([\n    (withSharedAnimation ? SHARED_PREFIX : randomIdPrefix),\n    id,\n    size,\n    (withSharedAnimation ? customColor : undefined),\n    dpr,\n  ].filter(Boolean).join('_')\n  ), [id, size, customColor, dpr, withSharedAnimation, randomIdPrefix]);\n\n  return (\n    <>\n      <img\n        ref={thumbRef}\n        src={thumbData}\n        className={buildClassName(\n          styles.thumb,\n          noCrossTransition && styles.noTransition,\n          isThumbOpaque && styles.thumbOpaque,\n          thumbClassName,\n          'sticker-media',\n        )}\n        style={filterStyle}\n        alt=\"\"\n        draggable={false}\n      />\n      {shouldRenderFullMedia && (isLottie ? (\n        <AnimatedSticker\n          ref={fullMediaRef as React.RefObject<HTMLDivElement>}\n          key={renderId}\n          renderId={renderId}\n          size={size}\n          className={buildClassName(\n            styles.media,\n            (noCrossTransition || isThumbOpaque) && styles.noTransition,\n            fullMediaClassName,\n          )}\n          tgsUrl={fullMediaData}\n          play={shouldPlay}\n          noLoop={!shouldLoop}\n          forceOnHeavyAnimation={forceAlways || forceOnHeavyAnimation}\n          forceAlways={forceAlways}\n          isLowPriority={isSmall && !selectIsAlwaysHighPriorityEmoji(getGlobal(), stickerSetInfo)}\n          sharedCanvas={sharedCanvasRef?.current || undefined}\n          sharedCanvasCoords={coords}\n          onLoad={markPlayerReady}\n          onLoop={onAnimatedStickerLoop}\n          onEnded={onAnimatedStickerLoop}\n          color={customColor}\n        />\n      ) : isVideo ? (\n        <OptimizedVideo\n          ref={fullMediaRef as React.RefObject<HTMLVideoElement>}\n          canPlay={shouldPlay}\n          className={buildClassName(styles.media, fullMediaClassName, 'sticker-media')}\n          src={fullMediaData}\n          playsInline\n          muted\n          loop={shouldLoop && !loopLimit}\n          isPriority={forceAlways}\n          disablePictureInPicture\n          onReady={markPlayerReady}\n          onBroken={markVideoBroken}\n          onEnded={onVideoEnded}\n          style={filterStyle}\n        />\n      ) : (\n        <img\n          ref={fullMediaRef as React.RefObject<HTMLImageElement>}\n          className={buildClassName(styles.media, fullMediaClassName, 'sticker-media')}\n          src={fullMediaData}\n          alt={emoji}\n          style={filterStyle}\n          draggable={false}\n        />\n      ))}\n    </>\n  );\n};\n\nexport default memo(StickerView);\n","import { getIsHeavyAnimating, useEffect, useSignal } from '../lib/teact/teact';\n\nimport useDerivedState from './useDerivedState';\n\nexport default function useMountAfterHeavyAnimation(hasIntersected: boolean) {\n  const [getNoHeavyAnimation, setNoHeavyAnimation] = useSignal(false);\n\n  const $getIsHeavyAnimating = getIsHeavyAnimating;\n\n  // Animation is usually started right after the mount, so we use effect to check for it on the next frame\n  useEffect(() => {\n    if (!$getIsHeavyAnimating()) {\n      setNoHeavyAnimation(true);\n    }\n  }, [$getIsHeavyAnimating, setNoHeavyAnimation]);\n\n  return useDerivedState(() => (getNoHeavyAnimation() && hasIntersected), [getNoHeavyAnimation, hasIntersected]);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"A72KeAmh\",\"icon\":\"eLEPgwPj\",\"title\":\"ZQJO2BKn\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport { GENERAL_TOPIC_ID } from '../../config';\nimport buildClassName from '../../util/buildClassName';\nimport { getTopicDefaultIcon } from '../../util/forumColors';\nimport { getFirstLetters } from '../../util/textFormat';\nimport renderText from './helpers/renderText';\n\nimport Icon from './icons/Icon';\n\nimport styles from './TopicDefaultIcon.module.scss';\n\ntype OwnProps = {\n  className?: string;\n  letterClassName?: string;\n  topicId: number;\n  iconColor?: number;\n  title: string;\n  onClick?: NoneToVoidFunction;\n};\n\nconst TopicDefaultIcon: FC<OwnProps> = ({\n  className,\n  letterClassName,\n  topicId,\n  iconColor,\n  title,\n  onClick,\n}) => {\n  const iconSrc = getTopicDefaultIcon(iconColor);\n\n  if (topicId === GENERAL_TOPIC_ID) {\n    return (\n      <Icon\n        name=\"hashtag\"\n        className={buildClassName(styles.root, className, 'general-forum-icon')}\n        onClick={onClick}\n      />\n    );\n  }\n  return (\n    <div className={buildClassName(styles.root, className)} onClick={onClick}>\n      <img className={styles.icon} src={iconSrc} alt=\"\" draggable={false} />\n      <div className={buildClassName(styles.title, letterClassName, 'topic-icon-letter')}>\n        {renderText(getFirstLetters(title, 1))}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(TopicDefaultIcon);\n","const PRETTY_BY_ALIAS: Record<string, string | undefined> = {\n  js: 'JavaScript',\n  javascript: 'JavaScript',\n  ts: 'TypeScript',\n  typescript: 'TypeScript',\n  python: 'Python',\n  py: 'Python',\n  go: 'Go',\n  rust: 'Rust',\n  func: 'FunC',\n  c: 'C',\n  'c++': 'C++',\n  cpp: 'C++',\n  fortran: 'Fortran',\n  f90: 'Fortran',\n  f: 'Fortran',\n  java: 'Java',\n  sql: 'SQL',\n  swift: 'Swift',\n  'objective-c': 'Objective-C',\n  kotlin: 'Kotlin',\n  ruby: 'Ruby',\n  rb: 'Ruby',\n  php: 'PHP',\n  perl: 'Perl',\n  bash: 'Bash',\n  sh: 'Shell',\n  markdown: 'Markdown',\n  'c#': 'C#',\n  cs: 'C#',\n  json: 'JSON',\n  yaml: 'YAML',\n  yml: 'YAML',\n  solidity: 'Solidity',\n  sol: 'Solidity',\n  tl: 'TL',\n};\n\nexport const ALL_SUPPORTED_LANGUAGES = [...new Set(Object.keys(PRETTY_BY_ALIAS))];\n\nexport function getPrettyCodeLanguageName(codeLanguage: string) {\n  const prettyLangName = PRETTY_BY_ALIAS[codeLanguage.toLowerCase()];\n  return prettyLangName ?? codeLanguage;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"overlay\":\"pMUccFN9\",\"copy\":\"auCNtLQ4\",\"wrap\":\"a44ZN3hD\",\"wrapOn\":\"jq1KLfVD\",\"content\":\"L95Dh7wN\",\"hidden\":\"zctwFUQ8\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { areLinesWrapping } from '../helpers/renderText';\n\nimport useOldLang from '../../../hooks/useOldLang';\nimport useWindowSize from '../../../hooks/window/useWindowSize';\n\nimport Icon from '../icons/Icon';\n\nimport styles from './CodeOverlay.module.scss';\n\nexport type OwnProps = {\n  className?: string;\n  text: string;\n  noCopy?: boolean;\n  onWordWrapToggle?: (wrap: boolean) => void;\n};\n\nconst CodeOverlay: FC<OwnProps> = ({\n  text, className, noCopy, onWordWrapToggle,\n}) => {\n  const { showNotification } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const windowSize = useWindowSize();\n  const lang = useOldLang();\n  const [isWordWrap, setIsWordWrap] = useState(true);\n  const [withWordWrapButton, setWithWordWrapButton] = useState(false);\n\n  const checkWordWrap = useCallback(() => {\n    const isWrap = areLinesWrapping(text, ref.current!.parentElement!);\n    setWithWordWrapButton(isWrap);\n  }, [text]);\n\n  useEffect(() => {\n    if (isWordWrap) {\n      checkWordWrap();\n    }\n  }, [checkWordWrap, isWordWrap, text, windowSize]);\n\n  const handleCopy = useCallback(() => {\n    copyTextToClipboard(text);\n    showNotification({\n      message: lang('TextCopied'),\n    });\n  }, [lang, showNotification, text]);\n\n  const handleWordWrapClick = useCallback(() => {\n    setIsWordWrap(!isWordWrap);\n    onWordWrapToggle?.(!isWordWrap);\n  }, [isWordWrap, onWordWrapToggle]);\n\n  const contentClass = buildClassName(styles.content, !withWordWrapButton && noCopy && styles.hidden);\n  const overlayClass = buildClassName(styles.overlay, className);\n  const wrapClass = buildClassName(styles.wrap, isWordWrap && styles.wrapOn);\n\n  return (\n    <div className={overlayClass} ref={ref}>\n      <div className={contentClass}>\n        {withWordWrapButton && (\n          <div className={wrapClass} onClick={handleWordWrapClick} title=\"Word Wrap\">\n            <Icon name=\"word-wrap\" />\n          </div>\n        )}\n        {!noCopy && (\n          <div className={styles.copy} onClick={handleCopy} title={lang('Copy')}>\n            <Icon name=\"copy\" />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(CodeOverlay);\n","import type { FC, TeactNode } from '../../../lib/teact/teact';\nimport React, { memo, useCallback, useEffect, useRef, useState } from '../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { getPrettyCodeLanguageName } from '../../../util/prettyCodeLanguageNames';\n\nimport useAsync from '../../../hooks/useAsync';\n\nimport CodeOverlay from './CodeOverlay';\n\nimport './CodeBlock.scss';\nimport { BlockMarkdownMarkerRenderer } from '../../../contest/text-editor';\nimport jsxToHtml from '../../../util/element/jsxToHtml';\nimport useDidMountEffect from '../../../hooks/useDidMountEffect';\nimport { Utils } from '../../../contest/text-editor/utils';\n\nexport type OwnProps = {\n  isInEditMode?: boolean;\n  text: string;\n  language?: string;\n  noCopy?: boolean;\n};\n\nconst CONSTANTS = {\n  CODE_HEADER: 'code-header',\n  CODE_CONTENT: 'code-content',\n  CODE_FOOTER: 'code-footer'\n}\n\nexport function checkCodeBlockHeaderFooter(blockElement: HTMLElement, currentNode: Node) {\n  const header = blockElement.querySelector(`.${CONSTANTS.CODE_HEADER}`);\n  const footer = blockElement.querySelector(`.${CONSTANTS.CODE_FOOTER}`);\n  const codeContent = blockElement.querySelector(`.${CONSTANTS.CODE_CONTENT}`);\n\n  const isInHeader = header && header.contains(currentNode);\n  const isInFooter = footer && footer.contains(currentNode);\n  return { header, footer, isInHeader, isInFooter, codeContent };\n}\n\nexport function extractCodeBlockData(node: Node) {\n  if (!(node instanceof HTMLElement) || node.dataset.entityType !== ApiMessageEntityTypes.Pre) return;\n\n  const codeContent = node.querySelector(`.${CONSTANTS.CODE_CONTENT}`);\n  const headerTextContent = node.querySelector(`.${CONSTANTS.CODE_HEADER}`)?.textContent || \"\";\n  const language = node.dataset.language || \"\";\n  return {\n    startMarker: headerTextContent.replace(language, \"\"),\n    language,\n    codeContent: codeContent ? Utils.getTextContentWithBreaks(codeContent) : \"\",\n    endMarker: node.querySelector(`.${CONSTANTS.CODE_FOOTER}`)?.textContent,\n  };\n}\n\nconst CodeBlock: FC<OwnProps> = ({ isInEditMode, text, language, noCopy }) => {\n  const [isWordWrap, setWordWrap] = useState(true);\n  const [currentLanguage, setCurrentLanguage] = useState(language || '');\n  const [codeText, setCodeText] = useState(text);\n  const [highlightedLayer, setHighlightedLayer] = useState<TeactNode>('');\n  const editableRef = useRef<HTMLPreElement>(null);\n  const highlightedRef = useRef<HTMLPreElement>(null);\n\n  const { result: highlighted } = useAsync(() => {\n    if (isInEditMode) return Promise.resolve(undefined);\n    if (!currentLanguage) return Promise.resolve(undefined);\n    return import('../../../util/highlightCode')\n      .then((lib) => lib.default(codeText, currentLanguage));\n  }, [currentLanguage, codeText, isInEditMode]);\n\n  useEffect(() => {\n    if (!isInEditMode) return;\n    import('../../../util/highlightCode')\n      .then((lib) => lib.default(codeText, currentLanguage))\n      .then((result) => {\n        const combinedInnerHTML = result\n          ? jsxToHtml(<>{result}</>).map(el => el.innerHTML).join('')\n          : codeText;\n        setHighlightedLayer(combinedInnerHTML);\n      });\n  }, [currentLanguage, codeText, isInEditMode]);\n\n  // ? When message updates\n  useDidMountEffect(() => {\n    setCurrentLanguage(language || '');\n    setCodeText(text);\n  }, [language, text]);\n\n  const handleWordWrapToggle = useCallback((wrap) => {\n    setWordWrap(wrap);\n  }, []);\n\n  const handleLanguageChange = (event: React.ChangeEvent<HTMLDivElement>) => {\n    const textContent = event.currentTarget.textContent || \"\";\n    const match = textContent.match(/^`{1,3}(.+)?/);\n    const lang = match?.[1] || \"\";\n    setCurrentLanguage(lang);\n  };\n\n  const handleTextChange = (event: React.FormEvent<HTMLPreElement>) => {\n    setCodeText(event.currentTarget.innerText || '');\n  };\n\n  const blockClass = buildClassName(\n    CONSTANTS.CODE_CONTENT,\n    'code-block',\n    !isWordWrap && 'no-word-wrap',\n  );\n\n  const handleScroll = () => {\n    if (editableRef.current && highlightedRef.current) {\n      highlightedRef.current.scrollTop = editableRef.current.scrollTop;\n      highlightedRef.current.scrollLeft = editableRef.current.scrollLeft;\n    }\n  };\n\n  return (\n    <div className={buildClassName(\"CodeBlock\", isInEditMode && \"isInEditMode\")}\n      data-entity-type={ApiMessageEntityTypes.Pre}\n      data-language={currentLanguage}\n      contentEditable={false}\n      ref={(ref) => {\n        ref?.setAttribute('spellcheck', 'false');\n      }}\n    >\n      {(isInEditMode || currentLanguage) && (\n        <div className={buildClassName(CONSTANTS.CODE_HEADER,\n          isInEditMode && currentLanguage === '' ? 'lang-is-empty' : undefined)}\n          contentEditable={isInEditMode}\n          onChange={handleLanguageChange}>\n          <span>\n            <BlockMarkdownMarkerRenderer\n              entityType={ApiMessageEntityTypes.Pre}\n              disableRendering={!isInEditMode}\n              contentEditable={false}\n            />\n          </span>\n          {isInEditMode && <span>{language}</span>}\n          {!isInEditMode && <p className=\"code-title\">{getPrettyCodeLanguageName(currentLanguage)}</p>}\n          {/* {isInEditMode && !currentLanguage && <p className=\"code-lang-placeholder\">enter code lang</p>} */}\n        </div>\n      )}\n      <div className='code-container'>\n        {isInEditMode && <pre\n          ref={highlightedRef}\n          className=\"code-block highlighted-layer\"\n          aria-hidden=\"true\"\n          dangerouslySetInnerHTML={{\n            __html: highlightedLayer\n          }}\n        />}\n        <pre\n          className={blockClass}\n          contentEditable={isInEditMode}\n          onInput={isInEditMode ? handleTextChange : undefined}\n          onScroll={isInEditMode ? handleScroll : undefined}\n        >\n          {isInEditMode || !highlighted ? text : highlighted}\n          {!isInEditMode && <CodeOverlay\n            text={codeText}\n            className=\"code-overlay\"\n            onWordWrapToggle={handleWordWrapToggle}\n            noCopy={noCopy}\n          />}\n        </pre>\n      </div>\n      {isInEditMode && <div\n        className={CONSTANTS.CODE_FOOTER}\n        contentEditable={true}>\n        <BlockMarkdownMarkerRenderer\n          entityType={ApiMessageEntityTypes.Pre}\n          contentEditable={false}\n        />\n      </div>}\n\n    </div>\n  );\n};\n\nexport default memo(CodeBlock);\n","import { useEffect, useRef } from \"../lib/teact/teact\";\n\nconst useDidMountEffect = (func: () => void, deps: any[]) => {\n    const didMount = useRef(false);\n\n    useEffect(() => {\n        if (didMount.current) {\n            func();\n        } else {\n            didMount.current = true;\n        }\n    }, deps);\n};\n\nexport default useDidMountEffect;\n","import QrPlane from '../../../assets/tgs/auth/QrPlane.tgs';\nimport CameraFlip from '../../../assets/tgs/calls/CameraFlip.tgs';\nimport HandFilled from '../../../assets/tgs/calls/HandFilled.tgs';\nimport HandOutline from '../../../assets/tgs/calls/HandOutline.tgs';\nimport Speaker from '../../../assets/tgs/calls/Speaker.tgs';\nimport VoiceAllowTalk from '../../../assets/tgs/calls/VoiceAllowTalk.tgs';\nimport VoiceMini from '../../../assets/tgs/calls/VoiceMini.tgs';\nimport VoiceMuted from '../../../assets/tgs/calls/VoiceMuted.tgs';\nimport VoiceOutlined from '../../../assets/tgs/calls/VoiceOutlined.tgs';\nimport Flame from '../../../assets/tgs/general/Flame.tgs';\nimport Fragment from '../../../assets/tgs/general/Fragment.tgs';\nimport Mention from '../../../assets/tgs/general/Mention.tgs';\nimport PartyPopper from '../../../assets/tgs/general/PartyPopper.tgs';\nimport Invite from '../../../assets/tgs/invites/Invite.tgs';\nimport JoinRequest from '../../../assets/tgs/invites/Requests.tgs';\nimport LastSeen from '../../../assets/tgs/LastSeen.tgs';\nimport MonkeyClose from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyClose.tgs';\nimport MonkeyIdle from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyIdle.tgs';\nimport MonkeyPeek from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyPeek.tgs';\nimport MonkeyTracking from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyTracking.tgs';\nimport ReadTime from '../../../assets/tgs/ReadTime.tgs';\nimport Report from '../../../assets/tgs/Report.tgs';\nimport Congratulations from '../../../assets/tgs/settings/Congratulations.tgs';\nimport DiscussionGroups from '../../../assets/tgs/settings/DiscussionGroupsDucks.tgs';\nimport Experimental from '../../../assets/tgs/settings/Experimental.tgs';\nimport FoldersAll from '../../../assets/tgs/settings/FoldersAll.tgs';\nimport FoldersNew from '../../../assets/tgs/settings/FoldersNew.tgs';\nimport FoldersShare from '../../../assets/tgs/settings/FoldersShare.tgs';\nimport Lock from '../../../assets/tgs/settings/Lock.tgs';\nimport StarReaction from '../../../assets/tgs/stars/StarReaction.tgs';\nimport StarReactionEffect from '../../../assets/tgs/stars/StarReactionEffect.tgs';\nimport Unlock from '../../../assets/tgs/Unlock.tgs';\n\nexport const LOCAL_TGS_URLS = {\n  MonkeyIdle,\n  MonkeyTracking,\n  MonkeyClose,\n  MonkeyPeek,\n  FoldersAll,\n  FoldersNew,\n  FoldersShare,\n  DiscussionGroups,\n  Lock,\n  CameraFlip,\n  HandFilled,\n  HandOutline,\n  Speaker,\n  VoiceAllowTalk,\n  VoiceMini,\n  VoiceMuted,\n  VoiceOutlined,\n  JoinRequest,\n  Invite,\n  QrPlane,\n  Congratulations,\n  Experimental,\n  PartyPopper,\n  Flame,\n  ReadTime,\n  Unlock,\n  LastSeen,\n  Mention,\n  Fragment,\n  StarReactionEffect,\n  StarReaction,\n  Report,\n};\n","import type { ApiDocument } from '../../../api/types';\n\nconst ONE_GIGABYTE = 1024 * 1024 * 1024;\nconst ONE_MEGABYTE = 1024 * 1024;\n\nexport function getFileSizeString(bytes: number) {\n  if (bytes > (ONE_GIGABYTE / 2)) {\n    return `${(bytes / ONE_GIGABYTE).toFixed(1)} GB`;\n  }\n  if (bytes > (ONE_MEGABYTE / 2)) {\n    return `${(bytes / ONE_MEGABYTE).toFixed(1)} MB`;\n  }\n  return `${(bytes / (1024)).toFixed(1)} KB`;\n}\n\nexport function getDocumentExtension(document: ApiDocument) {\n  const { fileName, mimeType } = document;\n\n  return getFileExtension(fileName, mimeType);\n}\n\nexport function getFileExtension(fileName: string, mimeType: string) {\n  if (fileName && fileName.indexOf('.') !== -1) {\n    return fileName.split('.').pop();\n  } else {\n    return mimeType.split('/').pop();\n  }\n}\n\nexport function getColorFromExtension(extension: string) {\n  switch (extension) {\n    case 'apk':\n    case 'xls':\n    case 'xlsx':\n    case 'ods':\n      return 'green';\n    case 'zip':\n    case 'rar':\n    case '7z':\n    case 'tar':\n    case 'gz':\n    case 'bz2':\n    case 'liz':\n    case 'lz4':\n    case 'lz5':\n    case 'xz':\n    case 'zst':\n    case 'wim':\n    case 'ppt':\n    case 'pptx':\n    case 'odp':\n      return 'orange';\n    case 'pdf':\n    case 'xps':\n      return 'red';\n    default:\n      return 'default';\n  }\n}\n\nexport function getDocumentHasPreview(document: ApiDocument) {\n  return Boolean(document.previewBlobUrl || document.thumbnail);\n}\n","import type {\n  ApiDimensions, ApiMediaExtendedPreview, ApiPhoto, ApiSticker, ApiVideo,\n} from '../../../api/types';\n\nimport { STICKER_SIZE_INLINE_DESKTOP_FACTOR, STICKER_SIZE_INLINE_MOBILE_FACTOR } from '../../../config';\nimport { getPhotoInlineDimensions, getVideoDimensions } from '../../../global/helpers';\nimport { IS_TOUCH_ENV } from '../../../util/windowEnvironment';\nimport windowSize from '../../../util/windowSize';\n\nexport const MEDIA_VIEWER_MEDIA_QUERY = '(max-height: 640px)';\nexport const REM = parseInt(getComputedStyle(document.documentElement).fontSize, 10);\nexport const ROUND_VIDEO_DIMENSIONS_PX = 240;\nexport const GIF_MIN_WIDTH = 300;\nexport const AVATAR_FULL_DIMENSIONS = { width: 640, height: 640 };\nexport const VIDEO_AVATAR_FULL_DIMENSIONS = { width: 800, height: 800 };\nexport const LIKE_STICKER_ID = '4986041492570112461';\n\nconst DEFAULT_MEDIA_DIMENSIONS: ApiDimensions = { width: 100, height: 100 };\nconst MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM = 4.5;\nconst MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM = 7;\nconst MESSAGE_MAX_WIDTH_REM = 29;\nconst MESSAGE_OWN_MAX_WIDTH_REM = 30;\n\nlet cachedMaxWidthOwn: number | undefined;\nlet cachedMaxWidth: number | undefined;\nlet cachedMaxWidthNoAvatar: number | undefined;\n\nfunction getMaxMessageWidthRem(fromOwnMessage?: boolean, noAvatars?: boolean, isMobile?: boolean) {\n  const regularMaxWidth = fromOwnMessage ? MESSAGE_OWN_MAX_WIDTH_REM : MESSAGE_MAX_WIDTH_REM;\n  if (!isMobile) {\n    return regularMaxWidth;\n  }\n\n  const { width: windowWidth } = windowSize.get();\n\n  // @optimization Limitation: changing device screen width not supported\n  if (!cachedMaxWidthOwn) {\n    cachedMaxWidthOwn = Math.min(\n      MESSAGE_OWN_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidth) {\n    cachedMaxWidth = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidthNoAvatar) {\n    cachedMaxWidthNoAvatar = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n\n  return fromOwnMessage\n    ? cachedMaxWidthOwn\n    : (noAvatars ? cachedMaxWidthNoAvatar : cachedMaxWidth);\n}\n\nexport function getAvailableWidth(\n  fromOwnMessage?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const extraPaddingRem = isWebPageMedia ? 1.625 : 0;\n  const availableWidthRem = getMaxMessageWidthRem(fromOwnMessage, noAvatars, isMobile) - extraPaddingRem;\n\n  return availableWidthRem * REM;\n}\n\nfunction getAvailableHeight(isGif?: boolean, aspectRatio?: number) {\n  if (\n    isGif && aspectRatio\n    && aspectRatio >= 0.75 && aspectRatio <= 1.25\n  ) {\n    return 20 * REM;\n  }\n\n  return 27 * REM;\n}\n\nexport function calculateDimensionsForMessageMedia({\n  width,\n  height,\n  fromOwnMessage,\n  isWebPageMedia,\n  isGif,\n  noAvatars,\n  isMobile,\n}: {\n  width: number;\n  height: number;\n  fromOwnMessage?: boolean;\n  asForwarded?: boolean;\n  isWebPageMedia?: boolean;\n  isGif?: boolean;\n  noAvatars?: boolean;\n  isMobile?: boolean;\n}): ApiDimensions {\n  const aspectRatio = height / width;\n  const availableWidth = getAvailableWidth(fromOwnMessage, isWebPageMedia, noAvatars, isMobile);\n  const availableHeight = getAvailableHeight(isGif, aspectRatio);\n  const mediaWidth = isGif ? Math.max(GIF_MIN_WIDTH, width) : width;\n  const mediaHeight = isGif ? height * (mediaWidth / width) : height;\n\n  return calculateDimensions(availableWidth, availableHeight, mediaWidth, mediaHeight);\n}\n\nexport function getMediaViewerAvailableDimensions(withFooter: boolean, isVideo: boolean): ApiDimensions {\n  const mql = window.matchMedia(MEDIA_VIEWER_MEDIA_QUERY);\n  const { width: windowWidth, height: windowHeight } = windowSize.get();\n  let occupiedHeightRem = isVideo && mql.matches ? 10 : 8.25;\n  if (withFooter && !IS_TOUCH_ENV) {\n    occupiedHeightRem = mql.matches ? 10 : 12.5;\n  }\n  return {\n    width: windowWidth,\n    height: windowHeight - occupiedHeightRem * REM,\n  };\n}\n\nexport function calculateInlineImageDimensions(\n  photo: ApiPhoto,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width, height } = getPhotoInlineDimensions(photo) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function calculateVideoDimensions(\n  video: ApiVideo,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width, height } = getVideoDimensions(video) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    isGif: video.isGif,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function calculateExtendedPreviewDimensions(\n  preview: ApiMediaExtendedPreview,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width = DEFAULT_MEDIA_DIMENSIONS.width, height = DEFAULT_MEDIA_DIMENSIONS.height } = preview;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function getPictogramDimensions(): ApiDimensions {\n  return {\n    width: 2 * REM,\n    height: 2 * REM,\n  };\n}\n\nexport function getDocumentThumbnailDimensions(smaller?: boolean): ApiDimensions {\n  if (smaller) {\n    return {\n      width: 3 * REM,\n      height: 3 * REM,\n    };\n  }\n\n  return {\n    width: 3.375 * REM,\n    height: 3.375 * REM,\n  };\n}\n\nexport function getStickerDimensions(sticker: ApiSticker, isMobile?: boolean): ApiDimensions {\n  const { width } = sticker;\n  let { height } = sticker;\n\n  // For some reason this sticker has some weird `height` value\n  if (sticker.id === LIKE_STICKER_ID) {\n    height = width;\n  }\n\n  const aspectRatio = (height && width) && height / width;\n  const baseWidth = REM * (\n    isMobile\n      ? STICKER_SIZE_INLINE_MOBILE_FACTOR\n      : STICKER_SIZE_INLINE_DESKTOP_FACTOR\n  );\n  const calculatedHeight = aspectRatio ? baseWidth * aspectRatio : baseWidth;\n\n  if (aspectRatio && calculatedHeight > baseWidth) {\n    return {\n      width: Math.round(baseWidth / aspectRatio),\n      height: baseWidth,\n    };\n  }\n\n  return {\n    width: baseWidth,\n    height: calculatedHeight,\n  };\n}\n\nexport function calculateMediaViewerDimensions(\n  { width, height }: ApiDimensions, withFooter: boolean, isVideo: boolean = false,\n): ApiDimensions {\n  const { width: availableWidth, height: availableHeight } = getMediaViewerAvailableDimensions(withFooter, isVideo);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function calculateDimensions(\n  availableWidth: number,\n  availableHeight: number,\n  mediaWidth: number,\n  mediaHeight: number,\n): ApiDimensions {\n  const aspectRatio = mediaHeight / mediaWidth;\n  const calculatedWidth = Math.min(mediaWidth, availableWidth);\n  const calculatedHeight = Math.round(calculatedWidth * aspectRatio);\n\n  if (calculatedHeight > availableHeight) {\n    return {\n      width: Math.round(availableHeight / aspectRatio),\n      height: availableHeight,\n    };\n  }\n\n  return {\n    width: calculatedWidth,\n    height: Math.round(calculatedWidth * aspectRatio),\n  };\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Link from '../ui/Link';\n\ntype OwnProps = {\n  className?: string;\n  chatId?: string;\n  children: React.ReactNode;\n};\n\nconst ChatLink: FC<OwnProps> = ({\n  className, chatId, children,\n}) => {\n  const { openChat } = getActions();\n\n  const handleClick = useCallback(() => {\n    if (chatId) {\n      openChat({ id: chatId });\n    }\n  }, [chatId, openChat]);\n\n  if (!chatId) {\n    return children;\n  }\n\n  return (\n    <Link className={buildClassName('ChatLink', className)} onClick={handleClick}>{children}</Link>\n  );\n};\n\nexport default memo(ChatLink);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useCallback } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiGroupCall } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Link from '../ui/Link';\n\ntype OwnProps = {\n  className?: string;\n  groupCall?: Partial<ApiGroupCall>;\n  children: React.ReactNode;\n};\n\nconst GroupCallLink: FC<OwnProps> = ({\n  className, groupCall, children,\n}) => {\n  const { requestMasterAndJoinGroupCall } = getActions();\n\n  const handleClick = useCallback(() => {\n    if (groupCall) {\n      requestMasterAndJoinGroupCall({ id: groupCall.id, accessHash: groupCall.accessHash });\n    }\n  }, [groupCall, requestMasterAndJoinGroupCall]);\n\n  if (!groupCall) {\n    return children;\n  }\n\n  return (\n    <Link className={buildClassName('GroupCallLink', className)} onClick={handleClick}>{children}</Link>\n  );\n};\n\nexport default GroupCallLink;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useCallback } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiMessage } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Link from '../ui/Link';\n\ntype OwnProps = {\n  className?: string;\n  message?: ApiMessage;\n  children: React.ReactNode;\n};\n\nconst MessageLink: FC<OwnProps> = ({\n  className, message, children,\n}) => {\n  const { focusMessage } = getActions();\n\n  const handleMessageClick = useCallback((): void => {\n    if (message) {\n      focusMessage({ chatId: message.chatId, messageId: message.id });\n    }\n  }, [focusMessage, message]);\n\n  if (!message) {\n    return children;\n  }\n\n  return (\n    <Link className={buildClassName('MessageLink', className)} onClick={handleMessageClick}>{children}</Link>\n  );\n};\n\nexport default MessageLink;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useCallback } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiPeer } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Link from '../ui/Link';\n\ntype OwnProps = {\n  className?: string;\n  sender?: ApiPeer;\n  children: React.ReactNode;\n};\n\nconst UserLink: FC<OwnProps> = ({\n  className, sender, children,\n}) => {\n  const { openChat } = getActions();\n\n  const handleClick = useCallback(() => {\n    if (sender) {\n      openChat({ id: sender.id });\n    }\n  }, [sender, openChat]);\n\n  if (!sender) {\n    return children;\n  }\n\n  return (\n    <Link className={buildClassName('UserLink', className)} onClick={handleClick}>{children}</Link>\n  );\n};\n\nexport default UserLink;\n","import React from '../../../lib/teact/teact';\n\nimport type {\n  ApiChat, ApiGroupCall, ApiMessage, ApiTopic, ApiUser,\n} from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { OldLangFn } from '../../../hooks/useOldLang';\nimport type { TextPart } from '../../../types';\n\nimport { SERVICE_NOTIFICATIONS_USER_ID, STARS_CURRENCY_CODE } from '../../../config';\nimport {\n  getChatTitle,\n  getExpiredMessageDescription,\n  getUserFullName,\n  isExpiredMessage,\n} from '../../../global/helpers';\nimport { getMessageSummaryText } from '../../../global/helpers/messageSummary';\nimport { formatCurrencyAsString } from '../../../util/formatCurrency';\nimport trimText from '../../../util/trimText';\nimport renderText from './renderText';\n\nimport ChatLink from '../ChatLink';\nimport CustomEmoji from '../CustomEmoji';\nimport GroupCallLink from '../GroupCallLink';\nimport MessageLink from '../MessageLink';\nimport MessageSummary from '../MessageSummary';\nimport TopicDefaultIcon from '../TopicDefaultIcon';\nimport UserLink from '../UserLink';\n\ninterface RenderOptions {\n  asPlainText?: boolean;\n  isEmbedded?: boolean;\n}\n\nconst MAX_LENGTH = 32;\nconst NBSP = '\\u00A0';\n\nexport function renderActionMessageText(\n  oldLang: OldLangFn,\n  message: ApiMessage,\n  actionOriginUser?: ApiUser,\n  actionOriginChat?: ApiChat,\n  targetUsers?: ApiUser[],\n  targetMessage?: ApiMessage,\n  targetChatId?: string,\n  topic?: ApiTopic,\n  options: RenderOptions = {},\n  observeIntersectionForLoading?: ObserveFn,\n  observeIntersectionForPlaying?: ObserveFn,\n) {\n  if (isExpiredMessage(message)) {\n    return getExpiredMessageDescription(oldLang, message);\n  }\n\n  if (!message.content?.action) {\n    return [];\n  }\n\n  const {\n    text, translationValues, amount, currency, call, score, topicEmojiIconId, giftCryptoInfo, pluralValue,\n  } = message.content.action;\n\n  const noLinks = options.asPlainText || options.isEmbedded;\n\n  const content: TextPart[] = [];\n  const translationKey = text === 'Chat.Service.Group.UpdatedPinnedMessage1' && !targetMessage\n    ? 'Message.PinnedGenericMessage'\n    : text;\n\n  let unprocessed = oldLang(\n    translationKey, translationValues?.length ? translationValues : undefined, undefined, pluralValue,\n  );\n  if (translationKey.includes('ScoredInGame')) { // Translation hack for games\n    unprocessed = unprocessed.replace('un1', '%action_origin%').replace('un2', '%message%');\n  }\n  if (translationKey === 'ActionGiftOutbound') { // Translation hack for Premium Gift\n    unprocessed = unprocessed.replace('un2', '%gift_payment_amount%').replace(/\\*\\*/g, '');\n  }\n  if (translationKey === 'ActionGiftInbound') { // Translation hack for Premium Gift\n    unprocessed = unprocessed\n      .replace('un1', '%action_origin%')\n      .replace('un2', '%gift_payment_amount%')\n      .replace(/\\*\\*/g, '');\n  }\n  if (translationKey === 'ActionRefunded') {\n    unprocessed = unprocessed\n      .replace('un1', '%action_origin%')\n      .replace('%1$s', '%gift_payment_amount%');\n  }\n  if (translationKey === 'ActionRequestedPeer') {\n    unprocessed = unprocessed\n      .replace('un1', '%star_target_user%')\n      .replace('un2', '%action_origin%')\n      .replace(/\\*\\*/g, '');\n  }\n  if (translationKey.startsWith('Notification.StarsGift.Upgrade')) {\n    unprocessed = unprocessed\n      .replace('%@', '%action_origin_chat%');\n  }\n  if (translationKey.startsWith('ActionUniqueGiftTransfer')) {\n    unprocessed = unprocessed\n      .replace('un1', '%action_origin%')\n      .replace(/\\*\\*/g, '');\n  }\n  if (translationKey === 'BoostingReceivedPrizeFrom') {\n    unprocessed = unprocessed\n      .replace('**%s**', '%target_chat%')\n      .replace(/\\*\\*/g, '');\n  }\n  let processed: TextPart[];\n\n  if (unprocessed.includes('%star_target_user%')) {\n    processed = processPlaceholder(\n      unprocessed,\n      '%star_target_user%',\n      targetUsers\n        ? targetUsers.map((user) => renderUserContent(user, noLinks)).filter(Boolean)\n        : 'User',\n    );\n\n    unprocessed = processed.pop() as string;\n    content.push(...processed);\n  }\n\n  processed = processPlaceholder(\n    unprocessed,\n    '%action_origin%',\n    actionOriginUser ? (\n      actionOriginUser.id === SERVICE_NOTIFICATIONS_USER_ID\n        ? oldLang('StarsTransactionUnknown')\n        : renderUserContent(actionOriginUser, noLinks) || NBSP\n    ) : actionOriginChat ? (\n      renderChatContent(oldLang, actionOriginChat, noLinks) || NBSP\n    ) : 'User',\n    '',\n  );\n\n  unprocessed = processed.pop() as string;\n  content.push(...processed);\n\n  processed = processPlaceholder(\n    unprocessed,\n    '%action_origin_chat%',\n    actionOriginChat ? (\n      renderChatContent(oldLang, actionOriginChat, noLinks) || NBSP\n    ) : 'Chat',\n    '',\n  );\n\n  unprocessed = processed.pop() as string;\n  content.push(...processed);\n\n  if (unprocessed.includes('%payment_amount%')) {\n    processed = processPlaceholder(\n      unprocessed,\n      '%payment_amount%',\n      formatCurrencyAsString(amount!, currency!, oldLang.code),\n    );\n    unprocessed = processed.pop() as string;\n    content.push(...processed);\n  }\n\n  if (unprocessed.includes('%action_topic%')) {\n    const topicEmoji = topic?.iconEmojiId\n      ? <CustomEmoji documentId={topic.iconEmojiId} isSelectable />\n      : '';\n    const topicString = topic ? `${topic.title}` : 'a topic';\n    processed = processPlaceholder(\n      unprocessed,\n      '%action_topic%',\n      [topicEmoji, topicString],\n      '',\n    );\n    unprocessed = processed.pop() as string;\n    content.push(...processed);\n  }\n\n  if (unprocessed.includes('%action_topic_icon%')) {\n    const topicIcon = topicEmojiIconId || topic?.iconEmojiId;\n    const hasIcon = topicIcon && topicIcon !== '0';\n    processed = processPlaceholder(\n      unprocessed,\n      '%action_topic_icon%',\n      hasIcon ? <CustomEmoji documentId={topicIcon!} isSelectable />\n        : topic ? <TopicDefaultIcon topicId={topic!.id} title={topic!.title} /> : '...',\n    );\n    unprocessed = processed.pop() as string;\n    content.push(...processed);\n  }\n\n  if (unprocessed.includes('%gift_payment_amount%')) {\n    let priceText;\n\n    if (currency && currency === STARS_CURRENCY_CODE) {\n      priceText = oldLang('ActionGiftStarsTitle', amount!);\n    } else {\n      const price = formatCurrencyAsString(amount!, currency!, oldLang.code);\n\n      if (giftCryptoInfo) {\n        const cryptoPrice = formatCurrencyAsString(giftCryptoInfo.amount, giftCryptoInfo.currency, oldLang.code);\n        priceText = `${cryptoPrice} (${price})`;\n      } else {\n        priceText = price;\n      }\n    }\n\n    processed = processPlaceholder(\n      unprocessed,\n      '%gift_payment_amount%',\n      priceText,\n    );\n    unprocessed = processed.pop() as string;\n    content.push(...processed);\n  }\n\n  if (unprocessed.includes('%amount%')) {\n    processed = processPlaceholder(\n      unprocessed,\n      '%amount%',\n      amount,\n    );\n    unprocessed = processed.pop() as string;\n    content.push(...processed);\n  }\n\n  if (unprocessed.includes('%score%')) {\n    processed = processPlaceholder(\n      unprocessed,\n      '%score%',\n      score!.toString(),\n    );\n    unprocessed = processed.pop() as string;\n    content.push(...processed);\n  }\n\n  processed = processPlaceholder(\n    unprocessed,\n    '%target_user%',\n    targetUsers\n      ? targetUsers.map((user) => renderUserContent(user, noLinks)).filter(Boolean)\n      : 'User',\n    '',\n  );\n\n  unprocessed = processed.pop() as string;\n  content.push(...processed);\n\n  processed = processPlaceholder(\n    unprocessed,\n    '%message%',\n    targetMessage\n      ? renderMessageContent(\n        oldLang, targetMessage, options, observeIntersectionForLoading, observeIntersectionForPlaying,\n      )\n      : 'a message',\n  );\n  unprocessed = processed.pop() as string;\n  content.push(...processed);\n\n  processed = processPlaceholder(\n    unprocessed,\n    '%product%',\n    targetMessage\n      ? renderProductContent(targetMessage)\n      : 'a product',\n  );\n  unprocessed = processed.pop() as string;\n  content.push(...processed);\n\n  processed = processPlaceholder(\n    unprocessed,\n    '%target_chat%',\n    targetChatId\n      ? renderMigratedContent(targetChatId, noLinks)\n      : 'another chat',\n    '',\n  );\n  processed.forEach((part) => {\n    content.push(...renderText(part));\n  });\n\n  if (options.asPlainText) {\n    return content.join('').trim();\n  }\n\n  if (call) {\n    return renderGroupCallContent(call, content);\n  }\n\n  return content;\n}\n\nfunction renderProductContent(message: ApiMessage) {\n  return message.content && message.content.invoice\n    ? message.content.invoice.title\n    : 'a product';\n}\n\nfunction renderMessageContent(\n  lang: OldLangFn,\n  message: ApiMessage,\n  options: RenderOptions = {},\n  observeIntersectionForLoading?: ObserveFn,\n  observeIntersectionForPlaying?: ObserveFn,\n) {\n  const { asPlainText, isEmbedded } = options;\n\n  if (asPlainText) {\n    return getMessageSummaryText(lang, message, undefined, undefined, MAX_LENGTH);\n  }\n\n  const messageSummary = (\n    <MessageSummary\n      message={message}\n      truncateLength={MAX_LENGTH}\n      observeIntersectionForLoading={observeIntersectionForLoading}\n      observeIntersectionForPlaying={observeIntersectionForPlaying}\n      withTranslucentThumbs\n    />\n  );\n\n  if (isEmbedded) {\n    return messageSummary;\n  }\n\n  return (\n    <MessageLink className=\"action-link\" message={message}>{messageSummary}</MessageLink>\n  );\n}\n\nfunction renderGroupCallContent(groupCall: Partial<ApiGroupCall>, text: TextPart[]): string | TextPart | undefined {\n  return (\n    <GroupCallLink groupCall={groupCall}>\n      {text}\n    </GroupCallLink>\n  );\n}\n\nfunction renderUserContent(sender: ApiUser, noLinks?: boolean): string | TextPart | undefined {\n  const text = trimText(getUserFullName(sender), MAX_LENGTH);\n\n  if (noLinks) {\n    return renderText(text!);\n  }\n\n  return <UserLink className=\"action-link\" sender={sender}>{sender && renderText(text!)}</UserLink>;\n}\n\nfunction renderChatContent(lang: OldLangFn, chat: ApiChat, noLinks?: boolean): string | TextPart | undefined {\n  const text = trimText(getChatTitle(lang, chat), MAX_LENGTH);\n\n  if (noLinks) {\n    return renderText(text!);\n  }\n\n  return <ChatLink className=\"action-link\" chatId={chat.id}>{chat && renderText(text!)}</ChatLink>;\n}\n\nfunction renderMigratedContent(chatId: string, noLinks?: boolean): string | TextPart | undefined {\n  const text = 'another chat';\n\n  if (noLinks) {\n    return text;\n  }\n\n  return <ChatLink className=\"action-link underlined-link\" chatId={chatId}>{text}</ChatLink>;\n}\n\nfunction processPlaceholder(\n  text: string, placeholder: string, replaceValue?: TextPart | TextPart[], separator = ',',\n): TextPart[] {\n  const placeholderPosition = text.indexOf(placeholder);\n  if (placeholderPosition < 0 || !replaceValue) {\n    return [text];\n  }\n\n  const content: TextPart[] = [];\n  content.push(text.substring(0, placeholderPosition));\n  if (Array.isArray(replaceValue)) {\n    replaceValue.forEach((value, index) => {\n      content.push(value);\n      if (index + 1 < replaceValue.length) {\n        content.push(`${separator} `);\n      }\n    });\n  } else {\n    content.push(replaceValue);\n  }\n  content.push(text.substring(placeholderPosition + placeholder.length));\n\n  return content.flat();\n}\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { TextPart } from '../../../types';\n\nimport {\n  BASE_URL, IS_PACKAGED_ELECTRON, RE_LINK_TEMPLATE, RE_MENTION_TEMPLATE,\n} from '../../../config';\nimport EMOJI_REGEX from '../../../lib/twemojiRegex';\nimport buildClassName from '../../../util/buildClassName';\nimport { isDeepLink } from '../../../util/deepLinkParser';\nimport {\n  handleEmojiLoad,\n  LOADED_EMOJIS,\n  nativeToUnifiedExtendedWithCache,\n} from '../../../util/emoji/emoji';\nimport fixNonStandardEmoji from '../../../util/emoji/fixNonStandardEmoji';\nimport { compact } from '../../../util/iteratees';\nimport { IS_EMOJI_SUPPORTED } from '../../../util/windowEnvironment';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport SafeLink from '../SafeLink';\n\nexport type TextFilter = (\n  'escape_html' | 'hq_emoji' | 'emoji' | 'emoji_html' | 'br' | 'br_html' | 'highlight' | 'links' |\n  'simple_markdown' | 'simple_markdown_html' | 'quote' | 'tg_links'\n  );\n\nconst SIMPLE_MARKDOWN_REGEX = /(\\*\\*|__).+?\\1/g;\n\nexport default function renderText(\n  part: TextPart,\n  filters: Array<TextFilter> = ['emoji'],\n  params?: { highlight?: string; quote?: string; markdownPostProcessor?: (part: string) => TeactNode },\n): TeactNode[] {\n  if (typeof part !== 'string') {\n    return [part];\n  }\n\n  return compact(filters.reduce((text, filter) => {\n    switch (filter) {\n      case 'escape_html':\n        return escapeHtml(text);\n\n      case 'hq_emoji':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'big', 'jsx');\n\n      case 'emoji':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'small', 'jsx');\n\n      case 'emoji_html':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'small', 'html');\n\n      case 'br':\n        return addLineBreaks(text, 'jsx');\n\n      case 'br_html':\n        return addLineBreaks(text, 'html');\n\n      case 'highlight':\n        return addHighlight(text, params!.highlight);\n\n      case 'quote':\n        return addHighlight(text, params!.quote, true);\n\n      case 'links':\n        return addLinks(text);\n\n      case 'tg_links':\n        return addLinks(text, true);\n\n      case 'simple_markdown':\n        return replaceSimpleMarkdown(text, 'jsx', params?.markdownPostProcessor);\n\n      case 'simple_markdown_html':\n        return replaceSimpleMarkdown(text, 'html');\n    }\n\n    return text;\n  }, [part] as TextPart[]));\n}\n\nfunction escapeHtml(textParts: TextPart[]): TextPart[] {\n  const divEl = document.createElement('div');\n  return textParts.reduce((result: TextPart[], part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    divEl.innerText = part;\n    result.push(divEl.innerHTML);\n\n    return result;\n  }, []);\n}\n\nfunction replaceEmojis(textParts: TextPart[], size: 'big' | 'small', type: 'jsx' | 'html'): TextPart[] {\n  if (IS_EMOJI_SUPPORTED) {\n    return textParts;\n  }\n\n  return textParts.reduce((result: TextPart[], part: TextPart) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    part = fixNonStandardEmoji(part);\n    const parts = part.split(EMOJI_REGEX);\n    const emojis: string[] = part.match(EMOJI_REGEX) || [];\n    result.push(parts[0]);\n\n    return emojis.reduce((emojiResult: TextPart[], emoji, i) => {\n      const code = nativeToUnifiedExtendedWithCache(emoji);\n      if (!code) {\n        emojiResult.push(emoji);\n      } else {\n        const baseSrcUrl = IS_PACKAGED_ELECTRON ? BASE_URL : '.';\n        const src = `${baseSrcUrl}/img-apple-${size === 'big' ? '160' : '64'}/${code}.png`;\n        const className = buildClassName(\n          'emoji',\n          size === 'small' && 'emoji-small',\n        );\n\n        if (type === 'jsx') {\n          const isLoaded = LOADED_EMOJIS.has(src);\n\n          emojiResult.push(\n            <img\n              src={src}\n              className={`${className}${!isLoaded ? ' opacity-transition slow shown' : ''}`}\n              alt={emoji}\n              data-path={src}\n              draggable={false}\n              onLoad={!isLoaded ? handleEmojiLoad : undefined}\n              data-is-emoji={true}\n            />,\n          );\n        }\n        if (type === 'html') {\n          emojiResult.push(\n            `<img\\\n            draggable=\"false\"\\\n            class=\"${className}\"\\\n            src=\"${src}\"\\\n            alt=\"${emoji}\"\\\n            data-is-emoji=\"true\"\\\n          />`,\n          );\n        }\n      }\n\n      const index = i * 2 + 2;\n      if (parts[index]) {\n        emojiResult.push(parts[index]);\n      }\n\n      return emojiResult;\n    }, result);\n  }, [] as TextPart[]);\n}\n\nfunction addLineBreaks(textParts: TextPart[], type: 'jsx' | 'html'): TextPart[] {\n  return textParts.reduce((result: TextPart[], part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const splittenParts = part\n      .split(/\\r\\n|\\r|\\n/g)\n      .reduce((parts: TextPart[], line: string, i, source) => {\n        // This adds non-breaking space if line was indented with spaces, to preserve the indentation\n        const trimmedLine = line.trimLeft();\n        const indentLength = line.length - trimmedLine.length;\n        parts.push(String.fromCharCode(160).repeat(indentLength) + trimmedLine);\n\n        if (i !== source.length - 1) {\n          parts.push(\n            type === 'jsx' ? <br /> : '<br />',\n          );\n        }\n\n        return parts;\n      }, []);\n\n    return [...result, ...splittenParts];\n  }, []);\n}\n\nfunction addHighlight(textParts: TextPart[], highlight: string | undefined, isQuote?: true): TextPart[] {\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string' || !highlight) {\n      result.push(part);\n      return result;\n    }\n\n    const lowerCaseText = part.toLowerCase();\n    const queryPosition = lowerCaseText.indexOf(highlight.toLowerCase());\n    if (queryPosition < 0) {\n      result.push(part);\n      return result;\n    }\n\n    const newParts: TextPart[] = [];\n    newParts.push(part.substring(0, queryPosition));\n    newParts.push(\n      <span className={buildClassName('matching-text-highlight', isQuote && 'is-quote')}>\n        {part.substring(queryPosition, queryPosition + highlight.length)}\n      </span>,\n    );\n    newParts.push(part.substring(queryPosition + highlight.length));\n    return [...result, ...newParts];\n  }, []);\n}\n\nconst RE_LINK = new RegExp(`${RE_LINK_TEMPLATE}|${RE_MENTION_TEMPLATE}`, 'ig');\n\nfunction addLinks(textParts: TextPart[], allowOnlyTgLinks?: boolean): TextPart[] {\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const links = part.match(RE_LINK);\n    if (!links || !links.length) {\n      result.push(part);\n      return result;\n    }\n\n    const content: TextPart[] = [];\n\n    let nextLink = links.shift();\n    let lastIndex = 0;\n    while (nextLink) {\n      const index = part.indexOf(nextLink, lastIndex);\n      content.push(part.substring(lastIndex, index));\n      if (nextLink.startsWith('@')) {\n        content.push(\n          <MentionLink username={nextLink}>\n            {nextLink}\n          </MentionLink>,\n        );\n      } else {\n        if (nextLink.endsWith('?')) {\n          nextLink = nextLink.slice(0, nextLink.length - 1);\n        }\n\n        if (!allowOnlyTgLinks || isDeepLink(nextLink)) {\n          content.push(\n            <SafeLink text={nextLink} url={nextLink} />,\n          );\n        } else {\n          content.push(nextLink);\n        }\n      }\n      lastIndex = index + nextLink.length;\n      nextLink = links.shift();\n    }\n    content.push(part.substring(lastIndex));\n\n    return [...result, ...content];\n  }, []);\n}\n\nfunction replaceSimpleMarkdown(\n  textParts: TextPart[], type: 'jsx' | 'html', postProcessor?: (part: string) => TeactNode,\n): TextPart[] {\n  // Currently supported only for JSX. If needed, add typings to support HTML as well.\n  const postProcess = postProcessor || ((part: string) => part);\n\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const parts = part.split(SIMPLE_MARKDOWN_REGEX);\n    const entities: string[] = part.match(SIMPLE_MARKDOWN_REGEX) || [];\n    result.push(postProcess(parts[0]));\n\n    return entities.reduce((entityResult: TextPart[], entity, i) => {\n      if (type === 'jsx') {\n        entityResult.push(\n          entity.startsWith('**')\n            ? <b>{postProcess(entity.replace(/\\*\\*/g, ''))}</b>\n            : <i>{postProcess(entity.replace(/__/g, ''))}</i>,\n        );\n      } else {\n        entityResult.push(\n          entity.startsWith('**')\n            ? `<b>${entity.replace(/\\*\\*/g, '')}</b>`\n            : `<i>${entity.replace(/__/g, '')}</i>`,\n        );\n      }\n\n      const index = i * 2 + 2;\n      if (parts[index]) {\n        entityResult.push(postProcess(parts[index]));\n      }\n\n      return entityResult;\n    }, result);\n  }, []);\n}\n\nexport function areLinesWrapping(text: string, element: HTMLElement) {\n  const lines = (text.trim().match(/\\n/g) || '').length + 1;\n  const { lineHeight } = getComputedStyle(element);\n  const lineHeightParsed = parseFloat(lineHeight.split('px')[0]);\n\n  return element.clientHeight >= (lines + 1) * lineHeightParsed;\n}\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport React, { memo, useEffect, useRef } from '../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { createClassNameBuilder } from '../../../util/buildClassName';\nimport stopEvent from '../../../util/stopEvent';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport './Spoiler.scss';\n\ntype OwnProps = {\n  children?: TeactNode;\n  containerId?: string;\n  isInEditMode?: boolean;\n};\n\nconst revealByContainerId: Map<string, VoidFunction[]> = new Map();\n\nconst buildClassName = createClassNameBuilder('Spoiler');\n\nconst Spoiler = ({\n  children,\n  containerId,\n  isInEditMode\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const contentRef = useRef<HTMLDivElement>(null);\n\n  const [isRevealed, revealSpoiler] = useFlag();\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (!containerId) return;\n\n    if (!isRevealed) {\n      stopEvent(e);\n    }\n\n    revealByContainerId.get(containerId)?.forEach((reveal) => reveal());\n  });\n\n  useEffect(() => {\n    if (!containerId) {\n      return undefined;\n    }\n\n    if (revealByContainerId.has(containerId)) {\n      revealByContainerId.get(containerId)!.push(revealSpoiler);\n    } else {\n      revealByContainerId.set(containerId, [revealSpoiler]);\n    }\n\n    return () => {\n      revealByContainerId.delete(containerId);\n    };\n  }, [containerId]);\n\n  return (\n    <span\n      className={buildClassName(\n        '&',\n        !isRevealed && 'concealed',\n        !isRevealed && Boolean(containerId) && 'animated',\n        isInEditMode && 'isInEditMode',\n      )}\n      onClick={containerId && !isRevealed ? handleClick : undefined}\n      data-entity-type={ApiMessageEntityTypes.Spoiler}\n    >\n      <span className={buildClassName('content')} ref={contentRef}>\n        {children}\n      </span>\n    </span>\n  );\n};\n\nexport default memo(Spoiler);\n","import React from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiFormattedText, ApiMessageEntity } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { TextPart } from '../../../types';\nimport type { TextFilter } from './renderText';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { oldTranslate } from '../../../util/oldLangProvider';\nimport { buildCustomEmojiHtmlFromEntity } from '../../middle/composer/helpers/customEmoji';\nimport renderText from './renderText';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport Blockquote from '../Blockquote';\nimport CodeBlock from '../code/CodeBlock';\nimport CustomEmoji from '../CustomEmoji';\nimport SafeLink from '../SafeLink';\nimport Spoiler from '../spoiler/Spoiler';\nimport { MarkdownMarkerRenderer } from '../../../contest/text-editor';\n\ninterface IOrganizedEntity {\n  entity: ApiMessageEntity;\n  organizedIndexes: Set<number>;\n  nestedEntities: IOrganizedEntity[];\n}\ntype RenderTextParams = Parameters<typeof renderText>[2];\n\nconst HQ_EMOJI_THRESHOLD = 64;\n\nexport function renderTextWithEntities({\n  text,\n  entities,\n  highlight,\n  emojiSize,\n  shouldRenderAsHtml,\n  containerId,\n  isSimple,\n  isProtected,\n  noLineBreaks,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  cacheBuster,\n  forcePlayback,\n  noCustomEmojiPlayback,\n  focusedQuote,\n  isInSelectMode,\n  isInEditMode\n}: {\n  text: string;\n  entities?: ApiMessageEntity[];\n  highlight?: string;\n  emojiSize?: number;\n  shouldRenderAsHtml?: boolean;\n  containerId?: string;\n  isSimple?: boolean;\n  isProtected?: boolean;\n  noLineBreaks?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  sharedCanvasHqRef?: React.RefObject<HTMLCanvasElement>;\n  cacheBuster?: string;\n  forcePlayback?: boolean;\n  noCustomEmojiPlayback?: boolean;\n  focusedQuote?: string;\n  isInSelectMode?: boolean;\n  isInEditMode?: boolean;\n}) {\n  if (!entities?.length) {\n    return renderMessagePart({\n      content: text,\n      highlight,\n      focusedQuote,\n      emojiSize,\n      shouldRenderAsHtml,\n      isSimple,\n      noLineBreaks,\n    });\n  }\n\n  const result: TextPart[] = [];\n  let deleteLineBreakAfterPre = false;\n\n  const organizedEntities = organizeEntities(entities);\n\n  // Recursive function to render regular and nested entities\n  function renderEntity(\n    textPartStart: number,\n    textPartEnd: number,\n    organizedEntity: IOrganizedEntity,\n    isLastEntity: boolean,\n  ) {\n    const renderResult: TextPart[] = [];\n    const { entity, nestedEntities } = organizedEntity;\n    const { offset, length, type } = entity;\n\n    // Render text before the entity\n    let textBefore = text.substring(textPartStart, offset);\n    const textBeforeLength = textBefore.length;\n    if (textBefore) {\n      if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n        textBefore = textBefore.substr(1);\n        deleteLineBreakAfterPre = false;\n      }\n      if (textBefore) {\n        renderResult.push(...renderMessagePart({\n          content: textBefore,\n          highlight,\n          focusedQuote,\n          emojiSize,\n          shouldRenderAsHtml,\n          isSimple,\n          noLineBreaks,\n        }) as TextPart[]);\n      }\n    }\n\n    const entityStartIndex = textPartStart + textBeforeLength;\n    const entityEndIndex = entityStartIndex + length;\n\n    let entityContent: TextPart = text.substring(offset, offset + length);\n    const nestedEntityContent: TextPart[] = [];\n\n    if (deleteLineBreakAfterPre && entityContent.length > 0 && entityContent[0] === '\\n') {\n      entityContent = entityContent.substr(1);\n      deleteLineBreakAfterPre = false;\n    }\n\n    if (type === ApiMessageEntityTypes.Pre) {\n      deleteLineBreakAfterPre = true;\n    }\n\n    // Render nested entities, if any\n    if (nestedEntities.length) {\n      let nestedIndex = entityStartIndex;\n\n      nestedEntities.forEach((nestedEntity, nestedEntityIndex) => {\n        const {\n          renderResult: nestedResult,\n          entityEndIndex: nestedEntityEndIndex,\n        } = renderEntity(\n          nestedIndex,\n          entityEndIndex,\n          nestedEntity,\n          nestedEntityIndex === nestedEntities.length - 1,\n        );\n\n        nestedEntityContent.push(...nestedResult);\n        nestedIndex = nestedEntityEndIndex;\n      });\n    }\n\n    // Render the entity itself\n    const newEntity = shouldRenderAsHtml\n      ? processEntityAsHtml(entity, entityContent, nestedEntityContent)\n      : processEntity({\n        entity,\n        entityContent,\n        nestedEntityContent,\n        highlight,\n        focusedQuote,\n        containerId,\n        isSimple,\n        noLineBreaks,\n        isProtected,\n        observeIntersectionForLoading,\n        observeIntersectionForPlaying,\n        withTranslucentThumbs,\n        emojiSize,\n        sharedCanvasRef,\n        sharedCanvasHqRef,\n        cacheBuster,\n        forcePlayback,\n        noCustomEmojiPlayback,\n        isInSelectMode,\n        isInEditMode\n      });\n\n    if (Array.isArray(newEntity)) {\n      renderResult.push(...newEntity);\n    } else {\n      renderResult.push(newEntity);\n    }\n\n    // Render text after the entity, if it is the last entity in the text,\n    // or the last nested entity inside of another entity\n    if (isLastEntity && entityEndIndex < textPartEnd) {\n      let textAfter = text.substring(entityEndIndex, textPartEnd);\n      if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n        textAfter = textAfter.substring(1);\n      }\n      if (textAfter) {\n        renderResult.push(...renderMessagePart({\n          content: textAfter,\n          highlight,\n          focusedQuote,\n          emojiSize,\n          shouldRenderAsHtml,\n          isSimple,\n          noLineBreaks,\n        }) as TextPart[]);\n      }\n    }\n\n    return {\n      renderResult,\n      entityEndIndex,\n    };\n  }\n\n  // Process highest-level entities\n  let index = 0;\n\n  organizedEntities.forEach((entity, arrayIndex) => {\n    const { renderResult, entityEndIndex } = renderEntity(\n      index,\n      text.length,\n      entity,\n      arrayIndex === organizedEntities.length - 1,\n    );\n\n    result.push(...renderResult);\n    index = entityEndIndex;\n  });\n\n  return result;\n}\n\nexport function getTextWithEntitiesAsHtml(formattedText?: ApiFormattedText) {\n  const { text, entities } = formattedText || {};\n  if (!text) {\n    return '';\n  }\n\n  const result = renderTextWithEntities({\n    text,\n    entities,\n    shouldRenderAsHtml: true,\n  });\n\n  if (Array.isArray(result)) {\n    return result.join('');\n  }\n\n  return result;\n}\n\nfunction renderMessagePart({\n  content,\n  highlight,\n  focusedQuote,\n  emojiSize,\n  shouldRenderAsHtml,\n  isSimple,\n  noLineBreaks,\n}: {\n  content: TextPart | TextPart[];\n  highlight?: string;\n  focusedQuote?: string;\n  emojiSize?: number;\n  shouldRenderAsHtml?: boolean;\n  isSimple?: boolean;\n  noLineBreaks?: boolean;\n}) {\n  if (Array.isArray(content)) {\n    const result: TextPart[] = [];\n\n    content.forEach((c) => {\n      result.push(...renderMessagePart({\n        content: c,\n        highlight,\n        focusedQuote,\n        emojiSize,\n        shouldRenderAsHtml,\n        isSimple,\n        noLineBreaks,\n      }));\n    });\n\n    return result;\n  }\n\n  if (shouldRenderAsHtml) {\n    return renderText(content, ['escape_html', 'emoji_html', 'br_html']);\n  }\n\n  const emojiFilter = emojiSize && emojiSize > HQ_EMOJI_THRESHOLD ? 'hq_emoji' : 'emoji';\n\n  const filters: TextFilter[] = [emojiFilter];\n  const params: RenderTextParams = {};\n  if (!isSimple && !noLineBreaks) {\n    filters.push('br');\n  }\n\n  if (highlight) {\n    filters.push('highlight');\n    params.highlight = highlight;\n  }\n  if (focusedQuote) {\n    filters.push('quote');\n    params.quote = focusedQuote;\n  }\n\n  return renderText(content, filters, params);\n}\n\n// Organize entities in a tree-like structure to better represent how the text will be displayed\nfunction organizeEntities(entities: ApiMessageEntity[]) {\n  const organizedEntityIndexes: Set<number> = new Set();\n  const organizedEntities: IOrganizedEntity[] = [];\n\n  entities.forEach((entity, index) => {\n    if (organizedEntityIndexes.has(index)) {\n      return;\n    }\n\n    const organizedEntity = organizeEntity(entity, index, entities, organizedEntityIndexes);\n    if (organizedEntity) {\n      organizedEntity.organizedIndexes.forEach((organizedIndex) => {\n        organizedEntityIndexes.add(organizedIndex);\n      });\n\n      organizedEntities.push(organizedEntity);\n    }\n  });\n\n  return organizedEntities;\n}\n\nfunction organizeEntity(\n  entity: ApiMessageEntity,\n  index: number,\n  entities: ApiMessageEntity[],\n  organizedEntityIndexes: Set<number>,\n): IOrganizedEntity | undefined {\n  const { offset, length } = entity;\n  const organizedIndexes = new Set([index]);\n\n  if (organizedEntityIndexes.has(index)) {\n    return undefined;\n  }\n\n  // Determine any nested entities inside current entity\n  const nestedEntities: IOrganizedEntity[] = [];\n  const parsedNestedEntities = entities\n    .filter((e, i) => i > index && e.offset >= offset && e.offset < offset + length)\n    .map((e) => organizeEntity(e, entities.indexOf(e), entities, organizedEntityIndexes))\n    .filter(Boolean);\n\n  parsedNestedEntities.forEach((parsedEntity) => {\n    let isChanged = false;\n\n    parsedEntity.organizedIndexes.forEach((organizedIndex) => {\n      if (!isChanged && !organizedIndexes.has(organizedIndex)) {\n        isChanged = true;\n      }\n\n      organizedIndexes.add(organizedIndex);\n    });\n\n    if (isChanged) {\n      nestedEntities.push(parsedEntity);\n    }\n  });\n\n  return {\n    entity,\n    organizedIndexes,\n    nestedEntities,\n  };\n}\n\nexport function processEntity({\n  entity,\n  entityContent,\n  nestedEntityContent,\n  highlight,\n  focusedQuote,\n  containerId,\n  isSimple,\n  noLineBreaks,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  emojiSize,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  cacheBuster,\n  forcePlayback,\n  noCustomEmojiPlayback,\n  isInSelectMode,\n  isInEditMode\n}: {\n  entity: ApiMessageEntity;\n  entityContent: TextPart;\n  nestedEntityContent: TextPart[];\n  highlight?: string;\n  focusedQuote?: string;\n  containerId?: string;\n  isSimple?: boolean;\n  noLineBreaks?: boolean;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  emojiSize?: number;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  sharedCanvasHqRef?: React.RefObject<HTMLCanvasElement>;\n  cacheBuster?: string;\n  forcePlayback?: boolean;\n  noCustomEmojiPlayback?: boolean;\n  isInSelectMode?: boolean;\n  isInEditMode?: boolean;\n}) {\n  const entityText = typeof entityContent === 'string' && entityContent;\n  const renderedContent = nestedEntityContent.length ? nestedEntityContent : entityContent;\n\n  function renderNestedMessagePart() {\n    return <MarkdownMarkerRenderer disableRendering={!isInEditMode} entityType={entity.type}>\n      {renderMessagePart({\n        content: renderedContent,\n        highlight,\n        focusedQuote,\n        emojiSize,\n        isSimple,\n        noLineBreaks,\n      })}\n    </MarkdownMarkerRenderer>\n  }\n\n  if (entityText === false) {\n    return renderNestedMessagePart();\n  }\n\n  if (isSimple) {\n    const text = renderNestedMessagePart();\n    if (entity.type === ApiMessageEntityTypes.Spoiler) {\n      return <Spoiler>{text}</Spoiler>;\n    }\n\n    if (entity.type === ApiMessageEntityTypes.CustomEmoji) {\n      return (\n        <CustomEmoji\n          key={cacheBuster ? `${cacheBuster}-${entity.offset}` : undefined}\n          documentId={entity.documentId}\n          size={emojiSize}\n          isSelectable\n          withSharedAnimation\n          sharedCanvasRef={sharedCanvasRef}\n          sharedCanvasHqRef={sharedCanvasHqRef}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withTranslucentThumb={withTranslucentThumbs}\n          forceAlways={forcePlayback}\n          noPlay={noCustomEmojiPlayback}\n          isInEditMode={isInEditMode}\n        />\n      );\n    }\n    return text;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return <strong data-entity-type={entity.type}>{renderNestedMessagePart()}</strong>;\n    case ApiMessageEntityTypes.Blockquote:\n      return (\n        <Blockquote collapsed={entity.collapsed} isToggleDisabled={isInSelectMode} isInEditMode={isInEditMode}>\n          {renderNestedMessagePart()}\n        </Blockquote>\n      );\n    case ApiMessageEntityTypes.BotCommand:\n      return (\n        <a\n          onClick={handleBotCommandClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Hashtag: {\n      const [tag, username] = entityContent.split('@');\n      return (\n        <a\n          onClick={() => handleHashtagClick(tag, username)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    }\n    case ApiMessageEntityTypes.Cashtag: {\n      const [tag, username] = entityContent.split('@');\n      return (\n        <a\n          onClick={() => handleHashtagClick(tag, username)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    }\n    case ApiMessageEntityTypes.Code:\n      return (\n        <code\n          className={buildClassName('text-entity-code', !isInEditMode && 'clickable')}\n          onClick={isInEditMode ? undefined : handleCodeClick}\n          role=\"textbox\"\n          tabIndex={0}\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </code>\n      );\n    case ApiMessageEntityTypes.Email:\n      return (\n        <a\n          href={`mailto:${entityText}`}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Italic:\n      return <em data-entity-type={entity.type}>{renderNestedMessagePart()}</em>;\n    case ApiMessageEntityTypes.MentionName:\n      return (\n        <MentionLink userId={entity.userId}>\n          {renderNestedMessagePart()}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Mention:\n      return (\n        <MentionLink username={entityText}>\n          {renderNestedMessagePart()}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Phone:\n      return (\n        <a\n          href={`tel:${entityText}`}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Pre:\n      return <CodeBlock text={entityText} language={entity.language} noCopy={isProtected} isInEditMode={isInEditMode} />;\n    case ApiMessageEntityTypes.Strike:\n      return <del data-entity-type={entity.type}>{renderNestedMessagePart()}</del>;\n    case ApiMessageEntityTypes.TextUrl:\n    case ApiMessageEntityTypes.Url:\n      return (\n        <SafeLink\n          url={getLinkUrl(entityText, entity)}\n          type={entity.type as any}\n          text={entityText}\n        >\n          {renderNestedMessagePart()}\n        </SafeLink>\n      );\n    case ApiMessageEntityTypes.Underline:\n      return <ins data-entity-type={entity.type}>{renderNestedMessagePart()}</ins>;\n    case ApiMessageEntityTypes.Spoiler:\n      return <Spoiler containerId={containerId} isInEditMode={isInEditMode}>{renderNestedMessagePart()}</Spoiler>;\n    case ApiMessageEntityTypes.CustomEmoji:\n      return (\n        <CustomEmoji\n          key={cacheBuster ? `${cacheBuster}-${entity.offset}` : undefined}\n          documentId={entity.documentId}\n          size={emojiSize}\n          isSelectable\n          withSharedAnimation\n          sharedCanvasRef={sharedCanvasRef}\n          sharedCanvasHqRef={sharedCanvasHqRef}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withTranslucentThumb={withTranslucentThumbs}\n          forceAlways={forcePlayback}\n          noPlay={noCustomEmojiPlayback}\n          isInEditMode={isInEditMode}\n        />\n      );\n    default:\n      return renderNestedMessagePart();\n  }\n}\n\nfunction processEntityAsHtml(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const rawEntityText = typeof entityContent === 'string' ? entityContent : undefined;\n\n  // Prevent adding newlines when editing\n  const content = entity.type === ApiMessageEntityTypes.Pre ? (entityContent as string).trimEnd() : entityContent;\n\n  const renderedContent = nestedEntityContent.length\n    ? nestedEntityContent.join('')\n    : renderText(content, ['escape_html', 'emoji_html', 'br_html']).join('');\n\n  if (!rawEntityText) {\n    return renderedContent;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return `<b>${renderedContent}</b>`;\n    case ApiMessageEntityTypes.Italic:\n      return `<i>${renderedContent}</i>`;\n    case ApiMessageEntityTypes.Underline:\n      return `<u>${renderedContent}</u>`;\n    case ApiMessageEntityTypes.Code:\n      return `<code class=\"text-entity-code\">${renderedContent}</code>`;\n    case ApiMessageEntityTypes.Pre:\n      return `\\`\\`\\`${renderText(entity.language || '', ['escape_html'])}<br/>${renderedContent}<br/>\\`\\`\\`<br/>`;\n    case ApiMessageEntityTypes.Strike:\n      return `<del>${renderedContent}</del>`;\n    case ApiMessageEntityTypes.MentionName:\n      return `<a\n        class=\"text-entity-link\"\n        data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n        data-user-id=\"${entity.userId}\"\n        contenteditable=\"false\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Url:\n    case ApiMessageEntityTypes.TextUrl:\n      return `<a\n        class=\"text-entity-link\"\n        href=${getLinkUrl(rawEntityText, entity)}\n        data-entity-type=\"${entity.type}\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Spoiler:\n      return `<span\n        class=\"spoiler\"\n        data-entity-type=\"${ApiMessageEntityTypes.Spoiler}\"\n        >${renderedContent}</span>`;\n    case ApiMessageEntityTypes.CustomEmoji:\n      return buildCustomEmojiHtmlFromEntity(rawEntityText, entity);\n    case ApiMessageEntityTypes.Blockquote:\n      return `<blockquote\n        class=\"blockquote\"\n        data-entity-type=\"${ApiMessageEntityTypes.Blockquote}\"\n        >${renderedContent}</blockquote>`;\n    default:\n      return renderedContent;\n  }\n}\n\nfunction getLinkUrl(entityContent: string, entity: ApiMessageEntity) {\n  const { type } = entity;\n  return type === ApiMessageEntityTypes.TextUrl && entity.url ? entity.url : entityContent;\n}\n\nfunction handleBotCommandClick(e: React.MouseEvent<HTMLAnchorElement>) {\n  getActions().sendBotCommand({ command: e.currentTarget.innerText });\n}\n\nfunction handleHashtagClick(hashtag?: string, username?: string) {\n  if (!hashtag) return;\n  if (username) {\n    getActions().openChatByUsername({\n      username,\n      onChatChanged: {\n        action: 'searchHashtag',\n        payload: { hashtag },\n      },\n    });\n    return;\n  }\n  getActions().searchHashtag({ hashtag });\n}\n\nfunction handleCodeClick(e: React.MouseEvent<HTMLElement>) {\n  copyTextToClipboard(e.currentTarget.innerText);\n  getActions().showNotification({\n    message: oldTranslate('TextCopied'),\n  });\n}\n","import { getActions, getGlobal } from '../global';\n\nimport { addCustomEmojiInputRenderCallback } from '../util/emoji/customEmojiManager';\nimport { throttle } from '../util/schedulers';\n\nlet LOAD_QUEUE = new Set<string>();\nconst RENDER_HISTORY = new Set<string>();\nconst THROTTLE = 200;\nconst LIMIT_PER_REQUEST = 100;\n\nconst loadFromQueue = throttle(() => {\n  const queue = [...LOAD_QUEUE];\n\n  const queueToLoad = queue.slice(0, LIMIT_PER_REQUEST);\n  const otherQueue = queue.slice(LIMIT_PER_REQUEST + 1);\n\n  getActions().loadCustomEmojis({\n    ids: queueToLoad,\n  });\n\n  LOAD_QUEUE = new Set(otherQueue);\n\n  // Schedule next load\n  if (LOAD_QUEUE.size) {\n    loadFromQueue();\n  }\n}, THROTTLE, false);\n\nconst updateLastRendered = throttle(() => {\n  getActions().updateLastRenderedCustomEmojis({\n    ids: [...RENDER_HISTORY].reverse(),\n  });\n\n  RENDER_HISTORY.clear();\n}, THROTTLE, false);\n\nfunction notifyCustomEmojiRender(emojiId: string) {\n  RENDER_HISTORY.add(emojiId);\n  updateLastRendered();\n}\n\naddCustomEmojiInputRenderCallback(notifyCustomEmojiRender);\n\nexport default function useEnsureCustomEmoji(id?: string) {\n  if (!id) return;\n  notifyCustomEmojiRender(id);\n\n  if (getGlobal().customEmojis.byId[id]) {\n    return;\n  }\n\n  LOAD_QUEUE.add(id);\n  loadFromQueue();\n}\n","import { useEffect, useState } from '../../../lib/teact/teact';\nimport { getGlobal } from '../../../global';\n\nimport type { ApiSticker } from '../../../api/types';\nimport type { GlobalState } from '../../../global/types';\n\nimport { selectCanPlayAnimatedEmojis } from '../../../global/selectors';\nimport { addCustomEmojiCallback, removeCustomEmojiCallback } from '../../../util/emoji/customEmojiManager';\n\nimport useEnsureCustomEmoji from '../../../hooks/useEnsureCustomEmoji';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nexport default function useCustomEmoji(documentId?: string) {\n  const [customEmoji, setCustomEmoji] = useState<ApiSticker | undefined>(\n    documentId ? getGlobal().customEmojis.byId[documentId] : undefined,\n  );\n  const [canPlay, setCanPlay] = useState(selectCanPlayAnimatedEmojis(getGlobal()));\n\n  useEnsureCustomEmoji(documentId);\n\n  const handleGlobalChange = useLastCallback((customEmojis?: GlobalState['customEmojis']) => {\n    if (!documentId) return;\n\n    const newGlobal = getGlobal();\n    setCustomEmoji((customEmojis ?? newGlobal.customEmojis).byId[documentId]);\n    setCanPlay(selectCanPlayAnimatedEmojis(newGlobal));\n  });\n\n  useEffect(handleGlobalChange, [documentId, handleGlobalChange]);\n\n  useEffect(() => {\n    if (!documentId) return undefined;\n\n    addCustomEmojiCallback(handleGlobalChange, documentId);\n\n    return () => {\n      removeCustomEmojiCallback(handleGlobalChange);\n    };\n  }, [customEmoji, documentId, handleGlobalChange]);\n\n  return { customEmoji, canPlay };\n}\n","import type { AriaRole } from 'react';\nimport React from '../../../lib/teact/teact';\n\nimport type { IconName } from '../../../types/icons';\n\nimport buildClassName from '../../../util/buildClassName';\n\ntype OwnProps = {\n  name: IconName;\n  className?: string;\n  style?: string;\n  role?: AriaRole;\n  ariaLabel?: string;\n  character?: string;\n  ref?: React.RefObject<HTMLElement>;\n  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;\n};\n\nconst Icon = ({\n  name,\n  ref,\n  className,\n  style,\n  role,\n  ariaLabel,\n  character,\n  onClick,\n}: OwnProps) => {\n  return (\n    <i\n      ref={ref}\n      className={buildClassName(`icon icon-${name}`, className)}\n      style={style}\n      aria-hidden={!ariaLabel}\n      aria-label={ariaLabel}\n      data-char={character}\n      role={role}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default Icon;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"qEhgJEpm\",\"middle\":\"GjxPnwZR\",\"big\":\"HRLrnZvQ\",\"adaptive\":\"ebO2WJkv\",\"svg\":\"lbK6aMGA\",\"clickable\":\"hqg1cKl7\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\n\nimport useUniqueId from '../../../hooks/useUniqueId';\n\nimport styles from './StarIcon.module.scss';\n\ntype OwnProps = {\n  type?: 'gold' | 'premium' | 'regular';\n  size?: 'small' | 'middle' | 'big' | 'adaptive';\n  className?: string;\n  style?: string;\n  onClick?: VoidFunction;\n};\n\n/* eslint-disable max-len */\nconst STAR_PATH = 'M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z';\n/* eslint-enable max-len */\n\nconst StarIcon: FC<OwnProps> = ({\n  type = 'regular',\n  size = 'small',\n  className,\n  style,\n  onClick,\n}) => {\n  const randomId = useUniqueId();\n  const validSvgRandomId = `svg-${randomId}`; // ID must start with a letter\n\n  const renderIcon = () => {\n    switch (type) {\n      case 'gold':\n        return <GoldStarIcon randomId={validSvgRandomId} />;\n      case 'premium':\n        return <PremiumStarIcon randomId={validSvgRandomId} />;\n      default:\n        return <RegularStarIcon />;\n    }\n  };\n\n  return (\n    <i\n      onClick={onClick}\n      className={buildClassName(\n        'StarIcon',\n        styles.root,\n        className,\n        onClick && styles.clickable,\n        styles[size],\n      )}\n      style={style}\n    >\n      {renderIcon()}\n    </i>\n  );\n};\n\nfunction GoldStarIcon({ randomId }: { randomId: string }) {\n  const mask1Id = `${randomId}-mask1`;\n  const mask2Id = `${randomId}-mask2`;\n  const gradient1Id = `${randomId}-gradient1`;\n  const gradient2Id = `${randomId}-gradient2`;\n  const gradient3Id = `${randomId}-gradient3`;\n\n  return (\n    <svg className={styles.svg} width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n      <g clip-path=\"url(#clip0_4913_7387)\">\n        <mask id={mask1Id} style=\"mask-type:luminance\" maskUnits=\"userSpaceOnUse\" x=\"-2\" y=\"-2\" width=\"24\" height=\"24\">\n          <path d=\"M21.416 -1.42493H-1.08398V21.0751H21.416V-1.42493Z\" fill=\"white\" />\n        </mask>\n        <g mask={`url(#${mask1Id})`}>\n          <mask\n            id={mask2Id}\n            style=\"mask-type:luminance\"\n            maskUnits=\"userSpaceOnUse\"\n            x=\"-2\"\n            y=\"-2\"\n            width=\"24\"\n            height=\"24\"\n          >\n            <path d=\"M-1.08398 -1.42493H21.416V21.0751H-1.08398V-1.42493Z\" fill=\"white\" />\n          </mask>\n          <g mask={`url(#${mask2Id})`}>\n            <path d=\"M7.26843 6.25162L9.28943 2.22541C9.52311 1.76121 10.0884 1.5749 10.5494 1.80857C10.7294 1.90015 10.8747 2.04857 10.9662 2.23172L12.8767 6.11583C13.0314 6.43477 13.3378 6.64951 13.6883 6.69056L17.6829 7.17055C18.2261 7.23686 18.6145 7.73264 18.5513 8.27894C18.5229 8.50314 18.4218 8.71156 18.2608 8.86945L15.0998 11.9862C14.9703 12.1125 14.9103 12.2894 14.9324 12.4694L15.4598 16.6756C15.5356 17.2787 15.1093 17.8282 14.5093 17.904C14.2819 17.9324 14.0546 17.8913 13.8525 17.7808L10.5147 15.9556C10.2715 15.823 9.98099 15.8198 9.73784 15.9461L6.27687 17.7208C5.79057 17.9703 5.1969 17.7745 4.94743 17.285C4.8527 17.1019 4.82112 16.8966 4.84954 16.6945L5.12427 14.7619C5.26006 13.8177 5.84425 12.9967 6.69055 12.5641L10.5305 10.6031C10.6315 10.5526 10.6726 10.4263 10.622 10.322C10.581 10.2431 10.4957 10.1957 10.4073 10.2084L5.70847 10.8841C4.99164 10.9852 4.26535 10.7831 3.7001 10.322L2.13698 9.04629C1.69173 8.68314 1.6191 8.02 1.98225 7.57159C2.15277 7.36317 2.39592 7.22739 2.66118 7.19265L6.6716 6.67793C6.92739 6.64319 7.15159 6.4853 7.26843 6.25162Z\" fill={`url(#${gradient1Id})`} />\n            <path d=\"M10.8242 2.9422C10.4168 2.85062 9.98417 3.0464 9.78839 3.43797L7.76423 7.46419C7.64739 7.69787 7.42634 7.85576 7.1674 7.89049L3.15698 8.40837C2.89804 8.44311 2.6612 8.56942 2.49384 8.76837L3.97801 9.98097C4.44537 10.3631 5.05167 10.5304 5.64849 10.4452L10.3442 9.77255C10.6221 9.73466 10.8936 9.8736 11.0168 10.1231C11.1778 10.442 11.0515 10.8336 10.7326 10.9978L9.50734 11.623L10.9031 11.4209C10.9915 11.4083 11.0799 11.4557 11.1178 11.5346C11.1715 11.6388 11.1273 11.7651 11.0263 11.8157L7.18635 13.7767C6.34006 14.2093 5.75586 15.0303 5.62007 15.9745L5.44008 17.2282C5.60428 17.3924 5.86322 17.4366 6.07796 17.326L9.53261 15.5514C9.90839 15.3587 10.3536 15.365 10.7231 15.5671L14.0609 17.3924C14.1809 17.4587 14.3199 17.4839 14.4556 17.4682C14.8093 17.4239 15.0651 17.0955 15.0209 16.7324L14.4967 12.523C14.4588 12.2072 14.5662 11.8946 14.7904 11.6736L17.9513 8.55679C18.005 8.50311 18.0461 8.43995 18.0745 8.37048L14.1841 7.90312C13.8336 7.86207 13.5304 7.64418 13.3725 7.3284L13.2209 7.01578C12.902 6.87683 12.6399 6.63052 12.482 6.31159L10.8242 2.9422Z\" fill={`url(#${gradient2Id})`} />\n            <path d=\"M10.7484 1.41397C10.0663 1.06977 9.23893 1.3445 8.89789 2.02659L6.87373 6.05596C6.8232 6.15701 6.72531 6.22649 6.61478 6.23912L2.60436 6.757C2.22542 6.80437 1.87806 7.00015 1.63807 7.29699C1.12334 7.93486 1.22124 8.86958 1.85596 9.38746L3.42223 10.6664C4.08222 11.2032 4.93167 11.44 5.77165 11.32L9.09051 10.8432L6.48847 12.1727C5.51271 12.6716 4.84325 13.6126 4.68852 14.6989L4.41063 16.6315C4.36958 16.9252 4.41695 17.222 4.55273 17.4873C4.90956 18.1915 5.77481 18.4725 6.479 18.1125L9.93681 16.3378C10.0505 16.2778 10.1863 16.281 10.3 16.3441L13.6378 18.1662C13.9188 18.3209 14.2441 18.3841 14.563 18.343C15.4061 18.2357 15.9998 17.462 15.8956 16.622L15.3714 12.4126C15.3651 12.3716 15.3809 12.3274 15.4093 12.299L18.5703 9.1822C18.8008 8.95168 18.9492 8.65169 18.9871 8.32959C19.0787 7.5433 18.5229 6.82963 17.7366 6.73489L13.7388 6.25491C13.5399 6.2328 13.363 6.10649 13.2715 5.92334L11.3641 2.03606C11.2315 1.76765 11.0136 1.54976 10.7484 1.41397ZM9.68418 2.42132C9.80734 2.17501 10.1073 2.07712 10.3505 2.20027C10.4452 2.24764 10.5242 2.32974 10.5715 2.42763L12.482 6.31175C12.7031 6.76332 13.1357 7.06962 13.6346 7.12962L17.6324 7.60961C17.9324 7.64435 18.1471 7.91908 18.1124 8.22538C18.0966 8.3517 18.0398 8.46854 17.9513 8.55695L14.7904 11.6737C14.5662 11.8948 14.4588 12.2074 14.4967 12.5232L15.0209 16.7325C15.0651 17.0957 14.8093 17.4241 14.4556 17.4683C14.3199 17.4841 14.1809 17.4588 14.0609 17.3925L10.7231 15.5673C10.3536 15.3652 9.90839 15.362 9.53261 15.5547L6.0748 17.3294C5.80638 17.4652 5.47797 17.3578 5.33903 17.0862C5.2885 16.9852 5.26956 16.8683 5.28534 16.7546L5.56007 14.8252C5.67376 14.0231 6.17269 13.3253 6.88952 12.959L10.7294 10.9979C11.0515 10.8337 11.1778 10.4422 11.0168 10.1232C10.8905 9.87376 10.6221 9.73482 10.3442 9.77271L5.64534 10.4453C5.04851 10.5306 4.44537 10.3632 3.97801 9.98113L2.41489 8.70221C2.15595 8.49064 2.1149 8.10854 2.32647 7.8496C2.42436 7.72961 2.56331 7.65066 2.71488 7.63171L6.72531 7.11383C7.12951 7.06331 7.48003 6.81384 7.66318 6.45069L9.68418 2.42132Z\" fill={`url(#${gradient3Id})`} />\n          </g>\n        </g>\n      </g>\n      <defs>\n        <linearGradient\n          id={gradient1Id}\n          x1=\"10.1547\"\n          y1=\"1.70752\"\n          x2=\"10.1547\"\n          y2=\"17.9134\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#FFF0C2\" />\n          <stop offset=\"1\" stop-color=\"#FFEBBA\" />\n        </linearGradient>\n        <linearGradient\n          id={gradient2Id}\n          x1=\"10.2842\"\n          y1=\"2.92009\"\n          x2=\"14.7304\"\n          y2=\"17.4713\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#FFD147\" />\n          <stop offset=\"1\" stop-color=\"#FFB526\" />\n        </linearGradient>\n        <linearGradient\n          id={gradient3Id}\n          x1=\"10.1547\"\n          y1=\"1.26556\"\n          x2=\"14.0546\"\n          y2=\"18.3525\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#E58F0D\" />\n          <stop offset=\"1\" stop-color=\"#EB7814\" />\n        </linearGradient>\n        <clipPath id=\"clip0_4913_7387\">\n          <rect width=\"20\" height=\"20\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nfunction PremiumStarIcon({ randomId }: { randomId: string }) {\n  return (\n    <svg className={styles.svg} width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\">\n      <defs>\n        <linearGradient id={randomId} x1=\"3\" y1=\"63.5001\" x2=\"84.1475\" y2=\"-1.32262\" gradientUnits=\"userSpaceOnUse\">\n          <stop stop-color=\"#6B93FF\" />\n          <stop offset=\"0.439058\" stop-color=\"#976FFF\" />\n          <stop offset=\"1\" stop-color=\"#E46ACE\" />\n        </linearGradient>\n      </defs>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d={STAR_PATH} fill={`url(#${randomId})`} />\n    </svg>\n  );\n}\n\nfunction RegularStarIcon() {\n  return (\n    <svg className={styles.svg} width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\">\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d={STAR_PATH} fill=\"var(--color-fill)\" />\n    </svg>\n  );\n}\n\nexport default memo(StarIcon);\n","import { getGlobal } from '../../../../global';\n\nimport type { ApiMessageEntityCustomEmoji, ApiSticker } from '../../../../api/types';\nimport { ApiMessageEntityTypes } from '../../../../api/types';\n\nimport { EMOJI_SIZES } from '../../../../config';\nimport buildClassName from '../../../../util/buildClassName';\nimport { getInputCustomEmojiParams } from '../../../../util/emoji/customEmojiManager';\nimport { REM } from '../../../common/helpers/mediaDimensions';\n\nexport const INPUT_CUSTOM_EMOJI_SELECTOR = 'img[data-document-id]';\n\nexport function buildCustomEmojiHtml(emoji: ApiSticker) {\n  const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(emoji);\n\n  const className = buildClassName(\n    'custom-emoji', 'emoji', 'emoji-small', isPlaceholder && 'placeholder', emoji.shouldUseTextColor && 'colorable',\n  );\n\n  return `<img\n    class=\"${className}\"\n    draggable=\"false\"\n    alt=\"${emoji.emoji}\"\n    data-document-id=\"${emoji.id}\"\n    ${uniqueId ? `data-unique-id=\"${uniqueId}\"` : ''}\n    data-entity-type=\"${ApiMessageEntityTypes.CustomEmoji}\"\n    src=\"${src}\"\n  />`;\n}\n\nexport function buildCustomEmojiHtmlFromEntity(rawText: string, entity: ApiMessageEntityCustomEmoji) {\n  const customEmoji = getGlobal().customEmojis.byId[entity.documentId];\n  const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(customEmoji);\n\n  const className = buildClassName(\n    'custom-emoji',\n    'emoji',\n    'emoji-small',\n    isPlaceholder && 'placeholder',\n    customEmoji?.shouldUseTextColor && 'colorable',\n  );\n\n  return `<img\n    class=\"${className}\"\n    draggable=\"false\"\n    alt=\"${rawText}\"\n    data-document-id=\"${entity.documentId}\"\n    ${uniqueId ? `data-unique-id=\"${uniqueId}\"` : ''}\n    data-entity-type=\"${ApiMessageEntityTypes.CustomEmoji}\"\n    src=\"${src}\"\n  />`;\n}\n\nexport function getCustomEmojiSize(maxEmojisInLine?: number): number | undefined {\n  if (!maxEmojisInLine) return undefined;\n\n  // Should be the same as in _message-content.scss\n  if (maxEmojisInLine > EMOJI_SIZES) return 2.25 * REM;\n  if (maxEmojisInLine === 1) return 7 * REM;\n  return Math.min(7.5 - (maxEmojisInLine * 0.75), 5.625) * REM;\n}\n","import type React from '../../../lib/teact/teact';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { IS_IOS } from '../../../util/windowEnvironment';\n\nexport function preventMessageInputBlur(e: React.MouseEvent<HTMLElement>, withBubbling = false) {\n  if (\n    IS_IOS\n    || !document.activeElement\n    || document.activeElement.id !== EDITABLE_INPUT_ID\n    || (!withBubbling && e.target !== e.currentTarget)\n  ) {\n    return;\n  }\n\n  e.preventDefault();\n}\n\nexport function preventMessageInputBlurWithBubbling(e: React.MouseEvent<HTMLElement>) {\n  preventMessageInputBlur(e, true);\n}\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiPeer } from '../../../api/types';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { selectUser } from '../../../global/selectors';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\n\ntype OwnProps = {\n  userId?: string;\n  username?: string;\n  children: TeactNode;\n};\n\ntype StateProps = {\n  userOrChat?: ApiPeer;\n};\n\nconst MentionLink = ({\n  userId,\n  username,\n  userOrChat,\n  children,\n}: OwnProps & StateProps) => {\n  const {\n    openChat,\n    openChatByUsername,\n    closeStoryViewer,\n    setShouldCloseRightColumn,\n  } = getActions();\n\n  const { isMobile } = useAppLayout();\n\n  const handleClick = () => {\n    if (isMobile) {\n      setShouldCloseRightColumn({\n        value: true,\n      });\n    }\n\n    if (userOrChat) {\n      openChat({ id: userOrChat.id });\n    } else if (username) {\n      closeStoryViewer();\n      openChatByUsername({ username: username.substring(1) });\n    }\n  };\n\n  return (\n    <a\n      onClick={handleClick}\n      className=\"text-entity-link\"\n      dir=\"auto\"\n      data-entity-type={userId ? ApiMessageEntityTypes.MentionName : ApiMessageEntityTypes.Mention}\n    >\n      {children}\n    </a>\n  );\n};\n\nexport default withGlobal<OwnProps>(\n  (global, { userId }): StateProps => {\n    return {\n      userOrChat: userId ? selectUser(global, userId) : undefined,\n    };\n  },\n)(MentionLink);\n","import type { MouseEvent as ReactMouseEvent, RefObject } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { useRef, useState } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\nimport { IS_TOUCH_ENV, MouseButton } from '../../util/windowEnvironment';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Sparkles from '../common/Sparkles';\nimport RippleEffect from './RippleEffect';\nimport Spinner from './Spinner';\n\nimport './Button.scss';\n\nexport type OwnProps = {\n  ref?: RefObject<HTMLButtonElement | HTMLAnchorElement>;\n  type?: 'button' | 'submit' | 'reset';\n  children: React.ReactNode;\n  size?: 'default' | 'smaller' | 'tiny';\n  color?: (\n    'primary' | 'secondary' | 'gray' | 'danger' | 'translucent' | 'translucent-white' | 'translucent-black'\n    | 'translucent-bordered' | 'dark' | 'green' | 'adaptive' | 'stars'\n  );\n  backgroundImage?: string;\n  id?: string;\n  className?: string;\n  round?: boolean;\n  pill?: boolean;\n  badge?: boolean;\n  fluid?: boolean;\n  isText?: boolean;\n  isLoading?: boolean;\n  ariaLabel?: string;\n  ariaControls?: string;\n  hasPopup?: boolean;\n  href?: string;\n  download?: string;\n  disabled?: boolean;\n  nonInteractive?: boolean;\n  allowDisabledClick?: boolean;\n  noFastClick?: boolean;\n  ripple?: boolean;\n  faded?: boolean;\n  tabIndex?: number;\n  isRtl?: boolean;\n  isShiny?: boolean;\n  isRectangular?: boolean;\n  withPremiumGradient?: boolean;\n  withSparkleEffect?: boolean;\n  noPreventDefault?: boolean;\n  noForcedUpperCase?: boolean;\n  shouldStopPropagation?: boolean;\n  style?: string;\n  onClick?: (e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  onContextMenu?: (e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  onMouseDown?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseUp?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseEnter?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseLeave?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onTransitionEnd?: NoneToVoidFunction;\n};\n\n// Longest animation duration;\nconst CLICKED_TIMEOUT = 400;\n\nconst Button: FC<OwnProps> = ({\n  ref,\n  type = 'button',\n  id,\n  onClick,\n  onContextMenu,\n  onMouseDown,\n  onMouseUp,\n  onMouseEnter,\n  onMouseLeave,\n  onFocus,\n  children,\n  size = 'default',\n  color = 'primary',\n  backgroundImage,\n  className,\n  round,\n  pill,\n  badge,\n  fluid,\n  isText,\n  isLoading,\n  isShiny,\n  withPremiumGradient,\n  withSparkleEffect,\n  onTransitionEnd,\n  ariaLabel,\n  ariaControls,\n  hasPopup,\n  href,\n  download,\n  disabled,\n  nonInteractive,\n  allowDisabledClick,\n  noFastClick = color === 'danger',\n  ripple,\n  faded,\n  tabIndex,\n  isRtl,\n  isRectangular,\n  noPreventDefault,\n  shouldStopPropagation,\n  noForcedUpperCase,\n  style,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let elementRef = useRef<HTMLButtonElement | HTMLAnchorElement>(null);\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const lang = useOldLang();\n\n  const [isClicked, setIsClicked] = useState(false);\n\n  const isNotInteractive = disabled || nonInteractive;\n\n  const fullClassName = buildClassName(\n    'Button',\n    className,\n    size,\n    color,\n    round && 'round',\n    pill && 'pill',\n    fluid && 'fluid',\n    badge && 'badge',\n    isNotInteractive && 'disabled',\n    nonInteractive && 'non-interactive',\n    allowDisabledClick && 'click-allowed',\n    isText && 'text',\n    isLoading && 'loading',\n    ripple && 'has-ripple',\n    faded && 'faded',\n    isClicked && 'clicked',\n    backgroundImage && 'with-image',\n    isShiny && 'shiny',\n    withPremiumGradient && 'premium',\n    isRectangular && 'rectangular',\n    noForcedUpperCase && 'no-upper-case',\n  );\n\n  const handleClick = useLastCallback((e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => {\n    if ((allowDisabledClick || !isNotInteractive) && onClick) {\n      onClick(e);\n    }\n\n    if (shouldStopPropagation) e.stopPropagation();\n\n    setIsClicked(true);\n    setTimeout(() => {\n      setIsClicked(false);\n    }, CLICKED_TIMEOUT);\n  });\n\n  const handleMouseDown = useLastCallback((e: ReactMouseEvent<HTMLButtonElement>) => {\n    if (!noPreventDefault) e.preventDefault();\n\n    if ((allowDisabledClick || !isNotInteractive) && onMouseDown) {\n      onMouseDown(e);\n    }\n\n    if (!IS_TOUCH_ENV && e.button === MouseButton.Main && !noFastClick) {\n      handleClick(e);\n    }\n  });\n\n  const content = (\n    <>\n      {withSparkleEffect && <Sparkles preset=\"button\" />}\n      {isLoading ? (\n        <div>\n          <span dir={isRtl ? 'auto' : undefined}>{lang('Cache.ClearProgress')}</span>\n          <Spinner color={isText ? 'blue' : 'white'} />\n        </div>\n      ) : children}\n      {!isNotInteractive && ripple && (\n        <RippleEffect />\n      )}\n    </>\n  );\n\n  if (href) {\n    return (\n      <a\n        ref={elementRef as RefObject<HTMLAnchorElement>}\n        id={id}\n        className={fullClassName}\n        href={href}\n        title={ariaLabel}\n        download={download}\n        tabIndex={tabIndex}\n        dir={isRtl ? 'rtl' : undefined}\n        aria-label={ariaLabel}\n        aria-controls={ariaControls}\n        style={style}\n        onTransitionEnd={onTransitionEnd}\n        target=\"_blank\"\n        rel=\"noreferrer\"\n      >\n        {content}\n      </a>\n    );\n  }\n\n  return (\n    <button\n      ref={elementRef as RefObject<HTMLButtonElement>}\n      id={id}\n      type={type}\n      className={fullClassName}\n      onClick={IS_TOUCH_ENV || noFastClick ? handleClick : undefined}\n      onContextMenu={onContextMenu}\n      onMouseDown={handleMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter && !isNotInteractive ? onMouseEnter : undefined}\n      onMouseLeave={onMouseLeave && !isNotInteractive ? onMouseLeave : undefined}\n      onTransitionEnd={onTransitionEnd}\n      onFocus={onFocus && !isNotInteractive ? onFocus : undefined}\n      aria-label={ariaLabel}\n      aria-controls={ariaControls}\n      aria-haspopup={hasPopup}\n      title={ariaLabel}\n      tabIndex={tabIndex}\n      dir={isRtl ? 'rtl' : undefined}\n      style={buildStyle(style, backgroundImage && `background-image: url(${backgroundImage})`) || undefined}\n    >\n      {content}\n    </button>\n  );\n};\n\nexport default Button;\n","import type { ChangeEvent } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, {\n  memo,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport type { IconName } from '../../types/icons';\nimport type { IRadioOption } from './CheckboxGroup';\n\nimport buildClassName from '../../util/buildClassName';\nimport renderText from '../common/helpers/renderText';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from '../common/icons/Icon';\nimport Button from './Button';\nimport Spinner from './Spinner';\n\nimport './Checkbox.scss';\n\ntype OwnProps = {\n  id?: string;\n  name?: string;\n  value?: string;\n  label?: TeactNode;\n  labelText?: TeactNode;\n  subLabel?: string;\n  checked?: boolean;\n  rightIcon?: IconName;\n  disabled?: boolean;\n  tabIndex?: number;\n  withIcon?: boolean;\n  blocking?: boolean;\n  permissionGroup?: boolean;\n  isLoading?: boolean;\n  withCheckedCallback?: boolean;\n  onlyInput?: boolean;\n  isRound?: boolean;\n  className?: string;\n  onChange?: (e: ChangeEvent<HTMLInputElement>, nestedOptionList?: IRadioOption) => void;\n  onCheck?: (isChecked: boolean) => void;\n  onClickLabel?: (e: React.MouseEvent, value?: string) => void;\n  nestedCheckbox?: boolean;\n  nestedCheckboxCount?: number | undefined;\n  nestedOptionList?: IRadioOption;\n  leftElement?: TeactNode;\n  values?: string[];\n};\n\nconst Checkbox: FC<OwnProps> = ({\n  id,\n  name,\n  value,\n  label,\n  labelText,\n  subLabel,\n  checked,\n  tabIndex,\n  disabled,\n  withIcon,\n  blocking,\n  permissionGroup,\n  isLoading,\n  className,\n  rightIcon,\n  onlyInput,\n  isRound,\n  nestedCheckbox,\n  nestedCheckboxCount,\n  nestedOptionList,\n  leftElement,\n  values = [],\n  onChange,\n  onCheck,\n  onClickLabel,\n}) => {\n  const lang = useOldLang();\n  // eslint-disable-next-line no-null/no-null\n  const labelRef = useRef<HTMLLabelElement>(null);\n  const [showNested, setShowNested] = useState(false);\n\n  const handleChange = useLastCallback((event: ChangeEvent<HTMLInputElement>) => {\n    if (disabled) {\n      return;\n    }\n\n    if (onChange) {\n      onChange(event, nestedOptionList);\n    }\n\n    if (onCheck) {\n      onCheck(event.currentTarget.checked);\n    }\n  });\n\n  const toggleNested = useLastCallback(() => {\n    setShowNested(!showNested);\n  });\n\n  function handleClick(event: React.MouseEvent) {\n    if (event.target !== labelRef.current) {\n      onClickLabel?.(event, value);\n    }\n  }\n\n  function handleInputClick(event: React.MouseEvent) {\n    event.stopPropagation();\n  }\n\n  const labelClassName = buildClassName(\n    'Checkbox',\n    disabled && 'disabled',\n    withIcon && 'withIcon',\n    isLoading && 'loading',\n    blocking && 'blocking',\n    nestedCheckbox && 'nested',\n    subLabel && 'withSubLabel',\n    permissionGroup && 'permission-group',\n    Boolean(leftElement) && 'avatar',\n    onlyInput && 'onlyInput',\n    isRound && 'round',\n    Boolean(rightIcon) && 'withNestedList',\n    className,\n  );\n\n  return (\n    <>\n      {/* eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions */}\n      <label\n        className={labelClassName}\n        dir={lang.isRtl ? 'rtl' : undefined}\n        onClick={onClickLabel ? handleClick : undefined}\n        ref={labelRef}\n      >\n        <input\n          type=\"checkbox\"\n          id={id}\n          name={name}\n          value={value}\n          checked={checked}\n          disabled={disabled}\n          tabIndex={tabIndex}\n          onChange={handleChange}\n          onClick={onClickLabel ? handleInputClick : undefined}\n        />\n        <div className={buildClassName(\n          'Checkbox-main',\n          Boolean(leftElement) && 'Nested-avatar-list',\n        )}\n        >\n          <span className=\"label\" dir=\"auto\">\n            {leftElement}\n            {typeof label === 'string' ? renderText(label) : label}\n            {labelText && <span className=\"ml-1\">{renderText(labelText)}</span>}\n          </span>\n          {subLabel && <span className=\"subLabel\" dir=\"auto\">{renderText(subLabel)}</span>}\n          {rightIcon && <Icon name={rightIcon} className=\"right-icon\" />}\n        </div>\n        {nestedCheckbox && (\n          <span className=\"nestedButton\" dir=\"auto\">\n            <Button className=\"button\" color=\"translucent\" size=\"smaller\" onClick={toggleNested}>\n              <Icon name=\"group-filled\" className=\"group-icon\" />\n              {nestedCheckboxCount}\n              <Icon name={showNested ? 'up' : 'down'} />\n            </Button>\n          </span>\n        )}\n        {isLoading && <Spinner />}\n      </label>\n      {nestedCheckbox && (\n        <div\n          className={buildClassName('nested-checkbox-group', showNested && 'nested-checkbox-group-open')}\n        >\n          {nestedOptionList?.nestedOptions?.map((nestedOption) => (\n            <Checkbox\n              key={nestedOption.value}\n              leftElement={leftElement}\n              onChange={handleChange}\n              checked={values.indexOf(nestedOption.value) !== -1}\n              values={values}\n              /* eslint-disable-next-line react/jsx-props-no-spreading */\n              {...nestedOption}\n            />\n          ))}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default memo(Checkbox);\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  useCallback, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport Icon from '../common/icons/Icon';\nimport Button from './Button';\nimport Menu from './Menu';\n\nimport './DropdownMenu.scss';\n\ntype OwnProps = {\n  className?: string;\n  trigger?: FC<{ onTrigger: () => void; isOpen?: boolean }>;\n  transformOriginX?: number;\n  transformOriginY?: number;\n  positionX?: 'left' | 'right';\n  positionY?: 'top' | 'bottom';\n  footer?: string;\n  forceOpen?: boolean;\n  onOpen?: NoneToVoidFunction;\n  onClose?: NoneToVoidFunction;\n  onHide?: NoneToVoidFunction;\n  onTransitionEnd?: NoneToVoidFunction;\n  onMouseEnterBackdrop?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  children: React.ReactNode;\n};\n\nconst DropdownMenu: FC<OwnProps> = ({\n  trigger,\n  className,\n  children,\n  transformOriginX,\n  transformOriginY,\n  positionX = 'left',\n  positionY = 'top',\n  footer,\n  forceOpen,\n  onOpen,\n  onClose,\n  onTransitionEnd,\n  onMouseEnterBackdrop,\n  onHide,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const menuRef = useRef<HTMLDivElement>(null);\n  const [isOpen, setIsOpen] = useState(false);\n\n  const toggleIsOpen = () => {\n    setIsOpen(!isOpen);\n\n    if (isOpen) {\n      onClose?.();\n    } else {\n      onOpen?.();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<any>) => {\n    const menu = menuRef.current;\n\n    if (!isOpen || e.keyCode !== 40 || !menu) {\n      return;\n    }\n\n    const focusedElement = document.activeElement;\n    const elementChildren = Array.from(menu.children);\n\n    if (!focusedElement || elementChildren.indexOf(focusedElement) === -1) {\n      (elementChildren[0] as HTMLElement).focus();\n    }\n  };\n\n  const handleClose = useCallback(() => {\n    setIsOpen(false);\n    onClose?.();\n  }, [onClose]);\n\n  const triggerComponent: FC<{ onTrigger: () => void; isOpen?: boolean }> = useMemo(() => {\n    if (trigger) return trigger;\n\n    return ({ onTrigger, isOpen: isMenuOpen }) => (\n      <Button\n        round\n        size=\"smaller\"\n        color=\"translucent\"\n        className={isMenuOpen ? 'active' : ''}\n        onClick={onTrigger}\n        ariaLabel=\"More actions\"\n      >\n        <Icon name=\"more\" />\n      </Button>\n    );\n  }, [trigger]);\n\n  return (\n    <div\n      className={`DropdownMenu ${className || ''}`}\n      onKeyDown={handleKeyDown}\n      onTransitionEnd={onTransitionEnd}\n    >\n      {triggerComponent({ onTrigger: toggleIsOpen, isOpen })}\n\n      <Menu\n        ref={menuRef}\n        isOpen={isOpen || Boolean(forceOpen)}\n        className={className || ''}\n        transformOriginX={transformOriginX}\n        transformOriginY={transformOriginY}\n        positionX={positionX}\n        positionY={positionY}\n        footer={footer}\n        autoClose\n        onClose={handleClose}\n        onCloseAnimationEnd={onHide}\n        onMouseEnterBackdrop={onMouseEnterBackdrop}\n      >\n        {children}\n      </Menu>\n    </div>\n  );\n};\n\nexport default DropdownMenu;\n","import type {\n  ChangeEvent, FormEvent, RefObject,\n} from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useOldLang from '../../hooks/useOldLang';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLInputElement>;\n  id?: string;\n  className?: string;\n  value?: string;\n  label?: string;\n  error?: string;\n  success?: string;\n  disabled?: boolean;\n  readOnly?: boolean;\n  placeholder?: string;\n  autoComplete?: string;\n  maxLength?: number;\n  tabIndex?: number;\n  teactExperimentControlled?: boolean;\n  inputMode?: 'text' | 'none' | 'tel' | 'url' | 'email' | 'numeric' | 'decimal' | 'search';\n  onChange?: (e: ChangeEvent<HTMLInputElement>) => void;\n  onInput?: (e: FormEvent<HTMLInputElement>) => void;\n  onKeyPress?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onKeyDown?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onBlur?: (e: React.FocusEvent<HTMLInputElement>) => void;\n  onPaste?: (e: React.ClipboardEvent<HTMLInputElement>) => void;\n};\n\nconst InputText: FC<OwnProps> = ({\n  ref,\n  id,\n  className,\n  value,\n  label,\n  error,\n  success,\n  disabled,\n  readOnly,\n  placeholder,\n  autoComplete,\n  inputMode,\n  maxLength,\n  tabIndex,\n  teactExperimentControlled,\n  onChange,\n  onInput,\n  onKeyPress,\n  onKeyDown,\n  onBlur,\n  onPaste,\n}) => {\n  const lang = useOldLang();\n  const labelText = error || success || label;\n  const fullClassName = buildClassName(\n    'input-group',\n    value && 'touched',\n    error ? 'error' : success && 'success',\n    disabled && 'disabled',\n    readOnly && 'disabled',\n    labelText && 'with-label',\n    className,\n  );\n\n  return (\n    <div className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      <input\n        ref={ref}\n        className=\"form-control\"\n        type=\"text\"\n        id={id}\n        dir=\"auto\"\n        value={value || ''}\n        tabIndex={tabIndex}\n        placeholder={placeholder}\n        maxLength={maxLength}\n        autoComplete={autoComplete}\n        inputMode={inputMode}\n        disabled={disabled}\n        readOnly={readOnly}\n        onChange={onChange}\n        onInput={onInput}\n        onKeyPress={onKeyPress}\n        onKeyDown={onKeyDown}\n        onBlur={onBlur}\n        onPaste={onPaste}\n        aria-label={labelText}\n        teactExperimentControlled={teactExperimentControlled}\n      />\n      {labelText && (\n        <label htmlFor={id}>{labelText}</label>\n      )}\n    </div>\n  );\n};\n\nexport default memo(InputText);\n","// extracted by mini-css-extract-plugin\nexport default {\"link\":\"swBnOk1h\",\"isPrimary\":\"Jz1SC8nz\"};","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport styles from './Link.module.scss';\n\ntype OwnProps = {\n  children: React.ReactNode;\n  className?: string;\n  isRtl?: boolean;\n  isPrimary?: boolean;\n  onClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst Link: FC<OwnProps> = ({\n  children, isPrimary, className, isRtl, onClick,\n}) => {\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLAnchorElement>) => {\n    e.preventDefault();\n    onClick!(e);\n  });\n\n  return (\n    <a\n      href=\"#\"\n      className={buildClassName('Link', styles.link, className, isPrimary && styles.isPrimary)}\n      dir={isRtl ? 'rtl' : 'auto'}\n      onClick={onClick ? handleClick : undefined}\n    >\n      {children}\n    </a>\n  );\n};\n\nexport default Link;\n","import React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Spinner from './Spinner';\n\nimport './Loading.scss';\n\ntype OwnProps = {\n  color?: 'blue' | 'white' | 'black' | 'yellow';\n  backgroundColor?: 'light' | 'dark';\n  className?: string;\n  onClick?: NoneToVoidFunction;\n};\n\nconst Loading = ({\n  color = 'blue', backgroundColor, className, onClick,\n}: OwnProps) => {\n  return (\n    <div className={buildClassName('Loading', onClick && 'interactive', className)} onClick={onClick}>\n      <Spinner color={color} backgroundColor={backgroundColor} />\n    </div>\n  );\n};\n\nexport default memo(Loading);\n","import type React from '../lib/teact/teact';\nimport { useLayoutEffect } from '../lib/teact/teact';\nimport { addExtraClass, setExtraStyles } from '../lib/teact/teact-dom';\n\nimport type { IAnchorPosition } from '../types';\n\nimport { requestForcedReflow } from '../lib/fasterdom/fasterdom';\nimport { useStateRef } from './useStateRef';\n\ninterface StaticPositionOptions {\n  anchor?: IAnchorPosition;\n  positionX?: 'left' | 'right';\n  positionY?: 'top' | 'bottom';\n  transformOriginX?: number;\n  transformOriginY?: number;\n  style?: string;\n  bubbleStyle?: string;\n}\n\ninterface DynamicPositionOptions {\n  anchor: IAnchorPosition;\n  getTriggerElement: () => HTMLElement | null;\n  getRootElement: () => HTMLElement | null;\n  getMenuElement: () => HTMLElement | null;\n  getLayout?: () => Layout;\n  withMaxHeight?: boolean;\n}\n\nexport type MenuPositionOptions =\n  StaticPositionOptions\n  | DynamicPositionOptions;\n\nexport interface Layout {\n  extraPaddingX?: number;\n  extraTopPadding?: number;\n  extraMarginTop?: number;\n  menuElMinWidth?: number;\n  deltaX?: number;\n  topShiftY?: number;\n  shouldAvoidNegativePosition?: boolean;\n  withPortal?: boolean;\n  isDense?: boolean; //  Allows you to place the menu as close to the edges of the area as possible\n}\n\nconst MENU_POSITION_VISUAL_COMFORT_SPACE_PX = 16;\nconst MENU_POSITION_BOTTOM_MARGIN = 12;\nconst EMPTY_RECT = {\n  width: 0, left: 0, height: 0, top: 0,\n};\n\nexport default function useMenuPosition(\n  isOpen: boolean,\n  containerRef: React.RefObject<HTMLDivElement>,\n  bubbleRef: React.RefObject<HTMLDivElement>,\n  options: MenuPositionOptions,\n) {\n  const optionsRef = useStateRef(options);\n\n  useLayoutEffect(() => {\n    if (!isOpen) return;\n\n    const options2 = optionsRef.current;\n\n    if (!('getTriggerElement' in options2)) {\n      applyStaticOptions(containerRef, bubbleRef, options2);\n    } else {\n      requestForcedReflow(() => {\n        const staticOptions = processDynamically(containerRef, bubbleRef, options2);\n\n        return () => {\n          applyStaticOptions(containerRef, bubbleRef, staticOptions);\n        };\n      });\n    }\n  }, [isOpen, containerRef, bubbleRef, optionsRef]);\n}\n\nfunction applyStaticOptions(\n  containerRef: React.RefObject<HTMLDivElement>,\n  bubbleRef: React.RefObject<HTMLDivElement>,\n  {\n    positionX = 'left',\n    positionY = 'top',\n    transformOriginX,\n    transformOriginY,\n    style,\n    bubbleStyle,\n  }: StaticPositionOptions,\n) {\n  const containerEl = containerRef.current!;\n  const bubbleEl = bubbleRef.current!;\n\n  if (style) {\n    containerEl.style.cssText = style;\n  }\n\n  if (bubbleStyle) {\n    bubbleEl.style.cssText = bubbleStyle;\n  }\n\n  if (positionX) {\n    addExtraClass(bubbleEl, positionX);\n  }\n\n  if (positionY) {\n    addExtraClass(bubbleEl, positionY);\n  }\n\n  setExtraStyles(bubbleEl, {\n    transformOrigin: [\n      transformOriginX ? `${transformOriginX}px` : positionX,\n      transformOriginY ? `${transformOriginY}px` : positionY,\n    ].join(' '),\n  });\n}\n\nfunction processDynamically(\n  containerRef: React.RefObject<HTMLDivElement>,\n  bubbleRef: React.RefObject<HTMLDivElement>,\n  {\n    anchor,\n    getRootElement,\n    getMenuElement,\n    getTriggerElement,\n    getLayout,\n    withMaxHeight,\n  }: DynamicPositionOptions,\n) {\n  const triggerEl = getTriggerElement()!;\n\n  let { x, y } = anchor;\n  const anchorX = x;\n  const anchorY = y;\n\n  const menuEl = getMenuElement();\n  const rootEl = getRootElement();\n\n  const {\n    extraPaddingX = 0,\n    extraTopPadding = 0,\n    extraMarginTop = 0,\n    topShiftY = 0,\n    menuElMinWidth = 0,\n    deltaX = 0,\n    shouldAvoidNegativePosition = false,\n    withPortal = false,\n    isDense = false,\n  } = getLayout?.() || {};\n\n  const marginTop = menuEl ? parseInt(getComputedStyle(menuEl).marginTop, 10) + extraMarginTop : undefined;\n  const { offsetWidth: menuElWidth, offsetHeight: menuElHeight } = menuEl || { offsetWidth: 0, offsetHeight: 0 };\n  const menuRect = menuEl ? {\n    width: Math.max(menuElWidth, menuElMinWidth),\n    height: menuElHeight + marginTop!,\n  } : EMPTY_RECT;\n\n  const rootRect = rootEl ? rootEl.getBoundingClientRect() : EMPTY_RECT;\n\n  let positionX: 'left' | 'right';\n  let positionY: 'top' | 'bottom';\n  if (isDense || (x + menuRect.width + extraPaddingX < rootRect.width + rootRect.left)) {\n    x += 3;\n    positionX = 'left';\n  } else if (x - menuRect.width - rootRect.left > 0) {\n    positionX = 'right';\n    x -= 3;\n  } else {\n    positionX = 'left';\n    x = 16;\n  }\n\n  x += deltaX;\n\n  const yWithTopShift = y + topShiftY;\n\n  if (isDense || (yWithTopShift + menuRect.height < rootRect.height + rootRect.top)) {\n    positionY = 'top';\n    y = yWithTopShift;\n  } else {\n    positionY = 'bottom';\n\n    if (y - menuRect.height < rootRect.top + extraTopPadding) {\n      y = rootRect.top + rootRect.height;\n    }\n  }\n\n  const triggerRect = triggerEl.getBoundingClientRect();\n\n  const addedYForPortalPositioning = (withPortal ? triggerRect.top : 0);\n  const addedXForPortalPositioning = (withPortal ? triggerRect.left : 0);\n\n  const leftWithPossibleNegative = Math.min(\n    x - triggerRect.left,\n    rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX,\n  );\n  let left = (positionX === 'left'\n    ? (withPortal || shouldAvoidNegativePosition\n      ? Math.max(MENU_POSITION_VISUAL_COMFORT_SPACE_PX, leftWithPossibleNegative)\n      : leftWithPossibleNegative)\n    : (x - triggerRect.left)) + addedXForPortalPositioning;\n  let top = y - triggerRect.top + addedYForPortalPositioning;\n\n  if (isDense) {\n    left = Math.min(left, rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n    top = Math.min(top, rootRect.height - menuRect.height - MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n  }\n\n  // Avoid hiding external parts of menus on mobile devices behind the edges of the screen (ReactionSelector for example)\n  const addedXForMenuPositioning = menuElMinWidth ? Math.max(0, (menuElMinWidth - menuElWidth) / 2) : 0;\n  if (left - addedXForMenuPositioning < 0 && shouldAvoidNegativePosition) {\n    left = addedXForMenuPositioning + MENU_POSITION_VISUAL_COMFORT_SPACE_PX;\n  }\n\n  const offsetX = (anchorX + addedXForPortalPositioning - triggerRect.left) - left;\n  const offsetY = (anchorY + addedYForPortalPositioning - triggerRect.top) - top - (marginTop || 0);\n  const transformOriginX = positionX === 'left' ? offsetX : menuRect.width + offsetX;\n  const transformOriginY = positionY === 'bottom' ? menuRect.height + offsetY : offsetY;\n\n  const style = `left: ${left}px; top: ${top}px`;\n\n  let bubbleStyle;\n  if (withMaxHeight) {\n    const menuMaxHeight = rootRect.height - MENU_POSITION_BOTTOM_MARGIN - (marginTop || 0);\n    bubbleStyle = `max-height: ${menuMaxHeight}px;`;\n  }\n\n  return {\n    positionX,\n    positionY,\n    transformOriginX,\n    transformOriginY,\n    style,\n    bubbleStyle,\n  };\n}\n","import React, {\n  beginHeavyAnimation,\n  type FC, memo, useEffect, useRef,\n} from '../../lib/teact/teact';\n\nimport type { MenuPositionOptions } from '../../hooks/useMenuPosition';\n\nimport buildClassName from '../../util/buildClassName';\nimport captureEscKeyListener from '../../util/captureEscKeyListener';\nimport { IS_BACKDROP_BLUR_SUPPORTED } from '../../util/windowEnvironment';\nimport { preventMessageInputBlurWithBubbling } from '../middle/helpers/preventMessageInputBlur';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useHistoryBack from '../../hooks/useHistoryBack';\nimport useKeyboardListNavigation from '../../hooks/useKeyboardListNavigation';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMenuPosition from '../../hooks/useMenuPosition';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useVirtualBackdrop from '../../hooks/useVirtualBackdrop';\n\nimport Portal from './Portal';\n\nimport './Menu.scss';\n\nexport type { MenuPositionOptions } from '../../hooks/useMenuPosition';\n\ntype OwnProps =\n  {\n    ref?: React.RefObject<HTMLDivElement>;\n    isOpen: boolean;\n    shouldCloseFast?: boolean;\n    id?: string;\n    className?: string;\n    bubbleClassName?: string;\n    ariaLabelledBy?: string;\n    autoClose?: boolean;\n    footer?: string;\n    noCloseOnBackdrop?: boolean;\n    backdropExcludedSelector?: string;\n    noCompact?: boolean;\n    onKeyDown?: (e: React.KeyboardEvent<any>) => void;\n    onCloseAnimationEnd?: () => void;\n    onClose: () => void;\n    onMouseEnter?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    onMouseEnterBackdrop?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    onMouseLeave?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    withPortal?: boolean;\n    children?: React.ReactNode;\n  }\n  & MenuPositionOptions;\n\nconst ANIMATION_DURATION = 200;\n\nconst Menu: FC<OwnProps> = ({\n  ref: externalRef,\n  shouldCloseFast,\n  isOpen,\n  id,\n  className,\n  bubbleClassName,\n  ariaLabelledBy,\n  children,\n  autoClose = false,\n  footer,\n  noCloseOnBackdrop = false,\n  backdropExcludedSelector,\n  noCompact,\n  onCloseAnimationEnd,\n  onClose,\n  onMouseEnter,\n  onMouseLeave,\n  withPortal,\n  onMouseEnterBackdrop,\n  ...positionOptions\n}) => {\n  const { isTouchScreen } = useAppLayout();\n\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const { ref: bubbleRef } = useShowTransition({\n    isOpen,\n    ref: externalRef,\n    onCloseAnimationEnd,\n  });\n\n  useMenuPosition(isOpen, containerRef, bubbleRef, positionOptions);\n\n  useEffect(\n    () => (isOpen ? captureEscKeyListener(onClose) : undefined),\n    [isOpen, onClose],\n  );\n\n  useHistoryBack({\n    isActive: isOpen,\n    onBack: onClose,\n    shouldBeReplaced: true,\n  });\n\n  useEffectWithPrevDeps(([prevIsOpen]) => {\n    if (isOpen || (!isOpen && prevIsOpen === true)) {\n      beginHeavyAnimation(ANIMATION_DURATION);\n    }\n  }, [isOpen]);\n\n  const handleKeyDown = useKeyboardListNavigation(bubbleRef, isOpen, autoClose ? onClose : undefined, undefined, true);\n\n  useVirtualBackdrop(\n    isOpen,\n    containerRef,\n    noCloseOnBackdrop ? undefined : onClose,\n    undefined,\n    backdropExcludedSelector,\n  );\n\n  const bubbleFullClassName = buildClassName(\n    'bubble menu-container custom-scroll',\n    footer && 'with-footer',\n    bubbleClassName,\n    shouldCloseFast && 'close-fast',\n  );\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n    if (autoClose) {\n      onClose();\n    }\n  });\n\n  const menu = (\n    <div\n      ref={containerRef}\n      id={id}\n      className={buildClassName(\n        'Menu',\n        !noCompact && !isTouchScreen && 'compact',\n        !IS_BACKDROP_BLUR_SUPPORTED && 'no-blur',\n        withPortal && 'in-portal',\n        className,\n      )}\n      aria-labelledby={ariaLabelledBy}\n      role={ariaLabelledBy ? 'menu' : undefined}\n      onKeyDown={isOpen ? handleKeyDown : undefined}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={isOpen ? onMouseLeave : undefined}\n    >\n      {isOpen && (\n        // This only prevents click events triggering on underlying elements\n        <div\n          className=\"backdrop\"\n          onMouseDown={preventMessageInputBlurWithBubbling}\n          onMouseEnter={onMouseEnterBackdrop}\n        />\n      )}\n      <div\n        role=\"presentation\"\n        ref={bubbleRef}\n        className={bubbleFullClassName}\n        onClick={handleClick}\n      >\n        {children}\n        {footer && <div className=\"footer\">{footer}</div>}\n      </div>\n    </div>\n  );\n\n  if (withPortal) {\n    return <Portal>{menu}</Portal>;\n  }\n\n  return menu;\n};\n\nexport default memo(Menu);\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { IconName } from '../../types/icons';\n\nimport { IS_TEST } from '../../config';\nimport buildClassName from '../../util/buildClassName';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from '../common/icons/Icon';\n\nimport './MenuItem.scss';\n\nexport type MenuItemProps = {\n  customIcon?: React.ReactNode;\n  className?: string;\n  children: React.ReactNode;\n  onClick?: (e: React.SyntheticEvent<HTMLDivElement | HTMLAnchorElement>, arg?: number) => void;\n  clickArg?: number;\n  onContextMenu?: (e: React.UIEvent) => void;\n  href?: string;\n  download?: string;\n  disabled?: boolean;\n  destructive?: boolean;\n  ariaLabel?: string;\n  withWrap?: boolean;\n  withPreventDefaultOnMouseDown?: boolean;\n} & ({\n  icon: 'A' | 'K';\n  isCharIcon: true;\n} | {\n  icon?: IconName;\n  isCharIcon?: false;\n});\n\nconst MenuItem: FC<MenuItemProps> = (props) => {\n  const {\n    icon,\n    isCharIcon,\n    customIcon,\n    className,\n    children,\n    onClick,\n    href,\n    download,\n    disabled,\n    destructive,\n    ariaLabel,\n    withWrap,\n    onContextMenu,\n    clickArg,\n    withPreventDefaultOnMouseDown,\n  } = props;\n\n  const lang = useOldLang();\n  const { isTouchScreen } = useAppLayout();\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    if (disabled || !onClick) {\n      e.preventDefault();\n      return;\n    }\n    onClick(e, clickArg);\n  });\n\n  const handleKeyDown = useLastCallback((e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.keyCode !== 13 && e.keyCode !== 32) {\n      return;\n    }\n\n    if (disabled || !onClick) {\n      e.preventDefault();\n\n      return;\n    }\n    onClick(e, clickArg);\n  });\n  const handleMouseDown = useLastCallback((e: React.SyntheticEvent<HTMLDivElement | HTMLAnchorElement>) => {\n    if (withPreventDefaultOnMouseDown) {\n      e.preventDefault();\n    }\n  });\n\n  const fullClassName = buildClassName(\n    'MenuItem',\n    className,\n    disabled && 'disabled',\n    destructive && 'destructive',\n    !isTouchScreen && 'compact',\n    withWrap && 'wrap',\n  );\n\n  const content = (\n    <>\n      {!customIcon && icon && (\n        <Icon name={isCharIcon ? 'char' : icon} character={isCharIcon ? icon : undefined} />\n      )}\n      {customIcon}\n      {children}\n    </>\n  );\n\n  if (href) {\n    return (\n      <a\n        tabIndex={0}\n        className={fullClassName}\n        href={href}\n        download={download}\n        aria-label={ariaLabel}\n        title={ariaLabel}\n        target={href.startsWith(window.location.origin) || IS_TEST ? '_self' : '_blank'}\n        rel=\"noopener noreferrer\"\n        dir={lang.isRtl ? 'rtl' : undefined}\n        onClick={onClick}\n        onMouseDown={handleMouseDown}\n      >\n        {content}\n      </a>\n    );\n  }\n\n  return (\n    <div\n      role=\"menuitem\"\n      tabIndex={0}\n      className={fullClassName}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      onMouseDown={handleMouseDown}\n      onContextMenu={onContextMenu}\n      aria-label={ariaLabel}\n      title={ariaLabel}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {content}\n    </div>\n  );\n};\n\nexport default MenuItem;\n","import { getIsHeavyAnimating, useEffect, useRef } from '../../../../lib/teact/teact';\n\nimport { requestMeasure } from '../../../../lib/fasterdom/fasterdom';\n\nimport useHeavyAnimation from '../../../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport usePriorityPlaybackCheck, { isPriorityPlaybackActive } from '../../../../hooks/usePriorityPlaybackCheck';\nimport useBackgroundMode, { isBackgroundModeActive } from '../../../../hooks/window/useBackgroundMode';\n\nexport default function useVideoAutoPause(\n  playerRef: { current: HTMLVideoElement | null }, canPlay: boolean, isPriority?: boolean,\n) {\n  const canPlayRef = useRef();\n  canPlayRef.current = canPlay;\n\n  const { play, pause } = usePlayPause(playerRef);\n\n  const unfreezePlaying = useLastCallback(() => {\n    if (canPlayRef.current && (isPriority || !isFrozen())) {\n      play();\n    }\n  });\n\n  const unfreezePlayingOnRaf = useLastCallback(() => {\n    requestMeasure(unfreezePlaying);\n  });\n\n  useBackgroundMode(pause, unfreezePlayingOnRaf, !canPlay || isPriority);\n  useHeavyAnimation(pause, unfreezePlaying, !canPlay || isPriority);\n  usePriorityPlaybackCheck(pause, unfreezePlaying, !canPlay || isPriority);\n\n  const handlePlaying = useLastCallback(() => {\n    if (!canPlayRef.current || (!isPriority && isFrozen())) {\n      pause();\n    }\n  });\n\n  useEffect(() => {\n    if (canPlay) {\n      if (isPriority || !isFrozen()) {\n        play();\n      }\n    } else {\n      pause();\n    }\n  }, [canPlay, play, pause, isPriority]);\n\n  return { handlePlaying };\n}\n\nfunction usePlayPause(mediaRef: React.RefObject<HTMLMediaElement>) {\n  const shouldPauseRef = useRef(false);\n  const isLoadingPlayRef = useRef(false);\n\n  const play = useLastCallback(() => {\n    shouldPauseRef.current = false;\n    if (mediaRef.current && !isLoadingPlayRef.current && document.body.contains(mediaRef.current)) {\n      isLoadingPlayRef.current = true;\n      mediaRef.current.play().then(() => {\n        isLoadingPlayRef.current = false;\n        if (shouldPauseRef.current) {\n          mediaRef.current?.pause();\n          shouldPauseRef.current = false;\n        }\n      }).catch((e) => {\n        // eslint-disable-next-line no-console\n        console.warn(e);\n      });\n    }\n  });\n\n  const pause = useLastCallback(() => {\n    if (isLoadingPlayRef.current) {\n      shouldPauseRef.current = true;\n    } else {\n      mediaRef.current?.pause();\n    }\n  });\n\n  return { play, pause };\n}\n\nfunction isFrozen() {\n  return getIsHeavyAnimating() || isPriorityPlaybackActive() || isBackgroundModeActive();\n}\n","import React, { memo, useMemo, useRef } from '../../lib/teact/teact';\n\nimport useBuffering from '../../hooks/useBuffering';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useVideoCleanup from '../../hooks/useVideoCleanup';\nimport useVideoAutoPause from '../middle/message/hooks/useVideoAutoPause';\n\ntype VideoProps = React.DetailedHTMLProps<React.VideoHTMLAttributes<HTMLVideoElement>, HTMLVideoElement>;\n\ntype OwnProps =\n  {\n    ref?: React.RefObject<HTMLVideoElement>;\n    isPriority?: boolean;\n    canPlay: boolean;\n    children?: React.ReactNode;\n    onReady?: NoneToVoidFunction;\n    onBroken?: NoneToVoidFunction;\n  }\n  & VideoProps;\n\nfunction OptimizedVideo({\n  ref,\n  isPriority,\n  canPlay,\n  children,\n  onReady,\n  onBroken,\n  onTimeUpdate,\n  ...restProps\n}: OwnProps) {\n  // eslint-disable-next-line no-null/no-null\n  const localRef = useRef<HTMLVideoElement>(null);\n  if (!ref) {\n    ref = localRef;\n  }\n\n  const { handlePlaying: handlePlayingForAutoPause } = useVideoAutoPause(ref, canPlay, isPriority);\n\n  const isReadyRef = useRef(false);\n  const handleReady = useLastCallback(() => {\n    if (!isReadyRef.current) {\n      onReady?.();\n      isReadyRef.current = true;\n    }\n  });\n\n  // This is only needed for browsers not allowing autoplay\n  const { isBuffered, bufferingHandlers } = useBuffering(true, onTimeUpdate, onBroken);\n  const { onPlaying: handlePlayingForBuffering, ...otherBufferingHandlers } = bufferingHandlers;\n  useSyncEffect(([prevIsBuffered]) => {\n    if (prevIsBuffered === undefined) {\n      return;\n    }\n\n    handleReady();\n  }, [isBuffered, handleReady]);\n\n  const handlePlaying = useLastCallback((e) => {\n    handlePlayingForAutoPause();\n    handlePlayingForBuffering(e);\n    handleReady();\n    restProps.onPlaying?.(e);\n  });\n\n  const mergedOtherBufferingHandlers = useMemo(() => {\n    const mergedHandlers: Record<string, AnyFunction> = {};\n    Object.keys(otherBufferingHandlers).forEach((keyString) => {\n      const key = keyString as keyof typeof otherBufferingHandlers;\n      mergedHandlers[key] = (event: Event) => {\n        restProps[key as keyof typeof restProps]?.(event);\n        otherBufferingHandlers[key]?.(event);\n      };\n    });\n\n    return mergedHandlers;\n  }, [otherBufferingHandlers, restProps]);\n\n  useVideoCleanup(ref, mergedOtherBufferingHandlers);\n\n  return (\n    // eslint-disable-next-line react/jsx-props-no-spreading\n    <video ref={ref} autoPlay {...restProps} {...mergedOtherBufferingHandlers} onPlaying={handlePlaying}>\n      {children}\n    </video>\n  );\n}\n\nexport default memo(OptimizedVideo);\n","import type { FC, VirtualElement } from '../../lib/teact/teact';\nimport { useLayoutEffect, useRef } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\ntype OwnProps = {\n  containerSelector?: string;\n  className?: string;\n  children: VirtualElement;\n};\n\nconst Portal: FC<OwnProps> = ({ containerSelector, className, children }) => {\n  const elementRef = useRef<HTMLDivElement>();\n  if (!elementRef.current) {\n    elementRef.current = document.createElement('div');\n  }\n\n  useLayoutEffect(() => {\n    const container = document.querySelector<HTMLDivElement>(containerSelector || '#portals');\n    if (!container) {\n      return undefined;\n    }\n\n    const element = elementRef.current!;\n    if (className) {\n      element.classList.add(className);\n    }\n\n    container.appendChild(element);\n\n    return () => {\n      TeactDOM.render(undefined, element);\n      container.removeChild(element);\n    };\n  }, [className, containerSelector]);\n\n  return TeactDOM.render(children, elementRef.current);\n};\n\nexport default Portal;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useMemo, useState } from '../../lib/teact/teact';\n\nimport { debounce } from '../../util/schedulers';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport './RippleEffect.scss';\n\ninterface Ripple {\n  x: number;\n  y: number;\n  size: number;\n}\n\nconst ANIMATION_DURATION_MS = 700;\n\nconst RippleEffect: FC = () => {\n  const [ripples, setRipples] = useState<Ripple[]>([]);\n\n  const cleanUpDebounced = useMemo(() => {\n    return debounce(() => {\n      setRipples([]);\n    }, ANIMATION_DURATION_MS, false);\n  }, []);\n\n  const handleMouseDown = useLastCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (e.button !== 0) {\n      return;\n    }\n\n    const container = e.currentTarget;\n    const position = container.getBoundingClientRect();\n    const rippleSize = container.offsetWidth / 2;\n\n    setRipples([\n      ...ripples,\n      {\n        x: e.clientX - position.x - (rippleSize / 2),\n        y: e.clientY - position.y - (rippleSize / 2),\n        size: rippleSize,\n      },\n    ]);\n\n    cleanUpDebounced();\n  });\n\n  return (\n    <div className=\"ripple-container\" onMouseDown={handleMouseDown}>\n      {ripples.map(({ x, y, size }) => (\n        <div\n          className=\"ripple-wave\"\n          style={`left: ${x}px; top: ${y}px; width: ${size}px; height: ${size}px;`}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(RippleEffect);\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './Spinner.scss';\n\nconst Spinner: FC<{\n  color?: 'blue' | 'white' | 'black' | 'green' | 'gray' | 'yellow';\n  backgroundColor?: 'light' | 'dark';\n  className?: string;\n}> = ({\n  color = 'blue',\n  backgroundColor,\n  className,\n}) => {\n  return (\n    <div className={buildClassName(\n      'Spinner', className, color, backgroundColor && 'with-background', backgroundColor && `bg-${backgroundColor}`,\n    )}\n    >\n      <div className=\"Spinner__inner\" />\n    </div>\n  );\n};\n\nexport default Spinner;\n","import type { RefObject } from 'react';\nimport React, {\n  beginHeavyAnimation, useEffect, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport {\n  addExtraClass, removeExtraClass, setExtraStyles, toggleExtraClass,\n} from '../../lib/teact/teact-dom';\nimport { getGlobal } from '../../global';\n\nimport { requestForcedReflow, requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { selectCanAnimateInterface } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { waitForAnimationEnd, waitForTransitionEnd } from '../../util/cssAnimationEndListeners';\nimport forceReflow from '../../util/forceReflow';\nimport { omit } from '../../util/iteratees';\nimport { allowSwipeControlForTransition } from '../../util/swipeController';\n\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport usePreviousDeprecated from '../../hooks/usePreviousDeprecated';\n\nimport './Transition.scss';\n\ntype AnimationName = (\n  'none' | 'slide' | 'slideRtl' | 'slideFade' | 'zoomFade' | 'zoomBounceSemiFade' | 'slideLayers'\n  | 'fade' | 'pushSlide' | 'reveal' | 'slideOptimized' | 'slideOptimizedRtl' | 'semiFade'\n  | 'slideVertical' | 'slideVerticalFade' | 'slideFadeAndroid'\n  );\nexport type ChildrenFn = (isActive: boolean, isFrom: boolean, currentKey: number, activeKey: number) => React.ReactNode;\nexport type TransitionProps = {\n  ref?: RefObject<HTMLDivElement>;\n  activeKey: number;\n  nextKey?: number;\n  name: AnimationName;\n  direction?: 'auto' | 'inverse' | 1 | -1;\n  renderCount?: number;\n  shouldRestoreHeight?: boolean;\n  shouldCleanup?: boolean;\n  cleanupExceptionKey?: number;\n  cleanupOnlyKey?: number;\n  // Used by async components which are usually remounted during first animation\n  shouldWrap?: boolean;\n  wrapExceptionKey?: number;\n  id?: string;\n  className?: string;\n  slideClassName?: string;\n  withSwipeControl?: boolean;\n  isBlockingAnimation?: boolean;\n  onStart?: NoneToVoidFunction;\n  onStop?: NoneToVoidFunction;\n  children: React.ReactNode | ChildrenFn;\n};\n\nconst FALLBACK_ANIMATION_END = 1000;\nconst CLASSES = {\n  slide: 'Transition_slide',\n  active: 'Transition_slide-active',\n  from: 'Transition_slide-from',\n  to: 'Transition_slide-to',\n  inactive: 'Transition_slide-inactive',\n};\n\nexport const ACTIVE_SLIDE_CLASS_NAME = CLASSES.active;\nexport const TO_SLIDE_CLASS_NAME = CLASSES.to;\n\nconst DISABLEABLE_ANIMATIONS = new Set<AnimationName>([\n  'slide', 'slideRtl', 'slideFade', 'zoomFade', 'zoomBounceSemiFade', 'slideLayers', 'pushSlide', 'reveal',\n  'slideOptimized', 'slideOptimizedRtl', 'slideVertical', 'slideVerticalFade',\n]);\n\nfunction Transition({\n  ref,\n  activeKey,\n  nextKey,\n  name,\n  direction = 'auto',\n  renderCount,\n  shouldRestoreHeight,\n  shouldCleanup,\n  cleanupExceptionKey,\n  cleanupOnlyKey,\n  shouldWrap,\n  wrapExceptionKey,\n  id,\n  className,\n  slideClassName,\n  withSwipeControl,\n  isBlockingAnimation,\n  onStart,\n  onStop,\n  children,\n}: TransitionProps) {\n  const currentKeyRef = useRef<number>();\n  // No need for a container to update on change\n  const shouldDisableAnimation = DISABLEABLE_ANIMATIONS.has(name)\n    && !selectCanAnimateInterface(getGlobal());\n\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const rendersRef = useRef<Record<number, React.ReactNode | ChildrenFn>>({});\n  const prevActiveKey = usePreviousDeprecated<any>(activeKey);\n  const forceUpdate = useForceUpdate();\n  const isAnimatingRef = useRef(false);\n  const isSwipeJustCancelledRef = useRef(false);\n\n  const hasActiveKeyChanged = prevActiveKey !== undefined && activeKey !== prevActiveKey;\n\n  if (!renderCount && hasActiveKeyChanged) {\n    rendersRef.current = { [prevActiveKey]: rendersRef.current[prevActiveKey] };\n  }\n\n  rendersRef.current[activeKey] = children;\n  if (nextKey) {\n    rendersRef.current[nextKey] = children;\n  }\n\n  const isBackwards = (\n    direction === -1\n    || (direction === 'auto' && prevActiveKey > activeKey)\n    || (direction === 'inverse' && prevActiveKey < activeKey)\n  );\n\n  useLayoutEffect(() => {\n    function cleanup() {\n      if (!shouldCleanup) {\n        return;\n      }\n      if (cleanupExceptionKey !== undefined) {\n        rendersRef.current = { [cleanupExceptionKey]: rendersRef.current[cleanupExceptionKey] };\n      } else if (cleanupOnlyKey !== undefined) {\n        rendersRef.current = omit(rendersRef.current, [cleanupOnlyKey]);\n      } else {\n        rendersRef.current = {};\n      }\n      forceUpdate();\n    }\n\n    const isSlideOptimized = name === 'slideOptimized' || name === 'slideOptimizedRtl';\n    const container = containerRef.current!;\n    const keys = Object.keys(rendersRef.current).map(Number);\n    const prevActiveIndex = renderCount ? prevActiveKey : keys.indexOf(prevActiveKey);\n    const activeIndex = renderCount ? activeKey : keys.indexOf(activeKey);\n\n    const childNodes = Array.from(container.childNodes);\n    if (!childNodes.length) {\n      return;\n    }\n\n    const childElements = Array.from(container.children) as HTMLElement[];\n    childElements.forEach((el) => {\n      addExtraClass(el, CLASSES.slide);\n\n      if (slideClassName) {\n        slideClassName.split(/\\s+/).forEach((token) => {\n          addExtraClass(el, token);\n        });\n      }\n    });\n\n    if (!hasActiveKeyChanged) {\n      if (isAnimatingRef.current) {\n        return;\n      }\n\n      childElements.forEach((childElement) => {\n        if (childElement === childNodes[activeIndex]) {\n          addExtraClass(childElement, CLASSES.active);\n\n          if (isSlideOptimized) {\n            setExtraStyles(childElement, {\n              transition: 'none',\n              transform: 'translate3d(0, 0, 0)',\n            });\n          }\n        } else if (!isSlideOptimized) {\n          addExtraClass(childElement, CLASSES.inactive);\n        }\n      });\n\n      return;\n    }\n\n    currentKeyRef.current = activeKey;\n\n    if (isSlideOptimized) {\n      if (!childNodes[activeIndex]) {\n        return;\n      }\n\n      performSlideOptimized(\n        shouldDisableAnimation,\n        name,\n        isBackwards,\n        cleanup,\n        activeKey,\n        currentKeyRef,\n        isAnimatingRef,\n        container,\n        childNodes[activeIndex],\n        childNodes[prevActiveIndex],\n        shouldRestoreHeight,\n        isBlockingAnimation,\n        onStart,\n        onStop,\n      );\n\n      return;\n    }\n\n    if (name === 'none' || shouldDisableAnimation || isSwipeJustCancelledRef.current) {\n      if (isSwipeJustCancelledRef.current) {\n        isSwipeJustCancelledRef.current = false;\n      }\n\n      childNodes.forEach((node, i) => {\n        if (node instanceof HTMLElement) {\n          removeExtraClass(node, CLASSES.from);\n          removeExtraClass(node, CLASSES.to);\n          toggleExtraClass(node, CLASSES.active, i === activeIndex);\n          toggleExtraClass(node, CLASSES.inactive, i !== activeIndex);\n        }\n      });\n\n      cleanup();\n\n      return;\n    }\n\n    childNodes.forEach((node, i) => {\n      if (node instanceof HTMLElement) {\n        removeExtraClass(node, CLASSES.active);\n        toggleExtraClass(node, CLASSES.from, i === prevActiveIndex);\n        toggleExtraClass(node, CLASSES.to, i === activeIndex);\n        toggleExtraClass(node, CLASSES.inactive, i !== prevActiveIndex && i !== activeIndex);\n      }\n    });\n\n    isAnimatingRef.current = true;\n    const endHeavyAnimation = beginHeavyAnimation(undefined, isBlockingAnimation);\n    onStart?.();\n\n    toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n    toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n    function onAnimationEnd() {\n      const activeElement = container.querySelector<HTMLDivElement>(`.${CLASSES.active}`);\n      const { clientHeight } = activeElement || {};\n\n      requestMutation(() => {\n        if (activeKey !== currentKeyRef.current) {\n          endHeavyAnimation();\n          return;\n        }\n\n        removeExtraClass(container, `Transition-${name}`);\n        removeExtraClass(container, `Transition-${name}Backwards`);\n\n        childNodes.forEach((node, i) => {\n          if (node instanceof HTMLElement) {\n            removeExtraClass(node, CLASSES.from);\n            removeExtraClass(node, CLASSES.to);\n            toggleExtraClass(node, CLASSES.active, i === activeIndex);\n            toggleExtraClass(node, CLASSES.inactive, i !== activeIndex);\n          }\n        });\n\n        if (shouldRestoreHeight) {\n          if (activeElement) {\n            setExtraStyles(activeElement, { height: 'auto' });\n            setExtraStyles(container, { height: `${clientHeight}px` });\n          }\n        }\n\n        onStop?.();\n        endHeavyAnimation();\n        isAnimatingRef.current = false;\n\n        cleanup();\n      });\n    }\n\n    const watchedNode = (name === 'reveal' || name === 'slideFadeAndroid') && isBackwards\n      ? childNodes[prevActiveIndex]\n      : childNodes[activeIndex];\n\n    if (watchedNode) {\n      if (withSwipeControl && childNodes[prevActiveIndex]) {\n        const giveUpAnimationEnd = waitForAnimationEnd(watchedNode, onAnimationEnd);\n\n        allowSwipeControlForTransition(\n          childNodes[prevActiveIndex] as HTMLElement,\n          childNodes[activeIndex] as HTMLElement,\n          () => {\n            giveUpAnimationEnd();\n            isSwipeJustCancelledRef.current = true;\n            onStop?.();\n            endHeavyAnimation();\n            isAnimatingRef.current = false;\n          },\n        );\n      } else {\n        waitForAnimationEnd(watchedNode, onAnimationEnd, undefined, FALLBACK_ANIMATION_END);\n      }\n    } else {\n      onAnimationEnd();\n    }\n  }, [\n    activeKey,\n    nextKey,\n    prevActiveKey,\n    hasActiveKeyChanged,\n    isBackwards,\n    name,\n    onStart,\n    onStop,\n    renderCount,\n    shouldRestoreHeight,\n    shouldCleanup,\n    slideClassName,\n    cleanupExceptionKey,\n    shouldDisableAnimation,\n    forceUpdate,\n    withSwipeControl,\n    isBlockingAnimation,\n    cleanupOnlyKey,\n  ]);\n\n  useEffect(() => {\n    if (!shouldRestoreHeight) {\n      return;\n    }\n\n    const container = containerRef.current!;\n    const activeElement = container.querySelector<HTMLDivElement>(`.${CLASSES.active}`)\n      || container.querySelector<HTMLDivElement>(`.${CLASSES.from}`);\n    if (!activeElement) {\n      return;\n    }\n\n    const { clientHeight, clientWidth } = activeElement || {};\n    if (!clientHeight || !clientWidth) {\n      return;\n    }\n\n    requestMutation(() => {\n      setExtraStyles(activeElement, { height: 'auto' });\n      setExtraStyles(container, {\n        height: `${clientHeight}px`,\n        flexBasis: `${clientHeight}px`,\n      });\n    });\n  }, [shouldRestoreHeight, children]);\n\n  const asFastList = !renderCount;\n  const renders = rendersRef.current;\n  const renderKeys = Object.keys(renderCount ? new Array(renderCount).fill(undefined) : renders).map(Number);\n  const contents = renderKeys.map((key) => {\n    const render = renders[key];\n    if (!render) {\n      return undefined;\n    }\n\n    const rendered = typeof render === 'function'\n      ? render(key === activeKey, key === prevActiveKey, key, activeKey)\n      : render;\n\n    return (shouldWrap && key !== wrapExceptionKey) || asFastList\n      ? <div key={key} teactOrderKey={key}>{rendered}</div>\n      : rendered;\n  });\n\n  return (\n    <div\n      ref={containerRef}\n      id={id}\n      className={buildClassName('Transition', className)}\n      teactFastList={asFastList}\n    >\n      {contents}\n    </div>\n  );\n}\n\nexport default Transition;\n\nfunction performSlideOptimized(\n  shouldDisableAnimation: boolean,\n  name: 'slideOptimized' | 'slideOptimizedRtl',\n  isBackwards: boolean,\n  cleanup: NoneToVoidFunction,\n  activeKey: number,\n  currentKeyRef: { current: number | undefined },\n  isAnimatingRef: { current: boolean | undefined },\n  container: HTMLElement,\n  toSlide: ChildNode,\n  fromSlide?: ChildNode,\n  shouldRestoreHeight?: boolean,\n  isBlockingAnimation?: boolean,\n  onStart?: NoneToVoidFunction,\n  onStop?: NoneToVoidFunction,\n) {\n  if (shouldDisableAnimation) {\n    toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n    toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n    if (fromSlide instanceof HTMLElement) {\n      removeExtraClass(fromSlide, CLASSES.active);\n      setExtraStyles(fromSlide, {\n        transition: 'none',\n        transform: '',\n      });\n    }\n\n    if (toSlide instanceof HTMLElement) {\n      addExtraClass(toSlide, CLASSES.active);\n      setExtraStyles(toSlide, {\n        transition: 'none',\n        transform: 'translate3d(0, 0, 0)',\n      });\n    }\n\n    cleanup();\n\n    return;\n  }\n\n  if (name === 'slideOptimizedRtl') {\n    isBackwards = !isBackwards;\n  }\n\n  isAnimatingRef.current = true;\n  const endHeavyAnimation = beginHeavyAnimation(undefined, isBlockingAnimation);\n  onStart?.();\n\n  toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n  toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n  if (fromSlide instanceof HTMLElement) {\n    setExtraStyles(fromSlide, {\n      transition: 'none',\n      transform: 'translate3d(0, 0, 0)',\n    });\n  }\n\n  if (toSlide instanceof HTMLElement) {\n    setExtraStyles(toSlide, {\n      transition: 'none',\n      transform: `translate3d(${isBackwards ? '-' : ''}100%, 0, 0)`,\n    });\n  }\n\n  requestForcedReflow(() => {\n    if (toSlide instanceof HTMLElement) {\n      forceReflow(toSlide);\n    }\n\n    return () => {\n      if (fromSlide instanceof HTMLElement) {\n        removeExtraClass(fromSlide, CLASSES.active);\n        setExtraStyles(fromSlide, {\n          transition: '',\n          transform: `translate3d(${isBackwards ? '' : '-'}100%, 0, 0)`,\n        });\n      }\n\n      if (toSlide instanceof HTMLElement) {\n        addExtraClass(toSlide, CLASSES.active);\n        setExtraStyles(toSlide, {\n          transition: '',\n          transform: 'translate3d(0, 0, 0)',\n        });\n      }\n    };\n  });\n\n  waitForTransitionEnd(toSlide, () => {\n    const clientHeight = toSlide instanceof HTMLElement ? toSlide.clientHeight : undefined;\n\n    requestMutation(() => {\n      if (activeKey !== currentKeyRef.current) {\n        endHeavyAnimation();\n        return;\n      }\n\n      if (fromSlide instanceof HTMLElement) {\n        setExtraStyles(fromSlide, {\n          transition: 'none',\n          transform: '',\n        });\n      }\n\n      if (shouldRestoreHeight && clientHeight && toSlide instanceof HTMLElement) {\n        setExtraStyles(toSlide, { height: 'auto' });\n        setExtraStyles(container, { height: `${clientHeight}px` });\n      }\n\n      onStop?.();\n      endHeavyAnimation();\n      isAnimatingRef.current = false;\n\n      cleanup();\n    });\n  });\n}\n","import type {\n  ApiLimitType, ApiLimitTypeForPromo, ApiPremiumSection, ApiReactionEmoji,\n} from './api/types';\n\nexport const APP_CODE_NAME = 'A';\nexport const APP_NAME = process.env.APP_NAME || `Telegram Web ${APP_CODE_NAME}`;\nexport const RELEASE_DATETIME = process.env.RELEASE_DATETIME;\n\nexport const PRODUCTION_HOSTNAME = 'web.telegram.org';\nexport const PRODUCTION_URL = 'https://web.telegram.org/a';\nexport const WEB_VERSION_BASE = 'https://web.telegram.org/'; // Used to redirect to other versions\nexport const BASE_URL = process.env.BASE_URL;\n\nexport const IS_MOCKED_CLIENT = process.env.APP_MOCKED_CLIENT === '1';\nexport const IS_TEST = process.env.APP_ENV === 'test';\nexport const IS_PERF = process.env.APP_ENV === 'perf';\nexport const IS_BETA = process.env.APP_ENV === 'staging';\nexport const IS_PACKAGED_ELECTRON = process.env.IS_PACKAGED_ELECTRON;\n\nexport const DEBUG = process.env.APP_ENV !== 'production';\nexport const DEBUG_MORE = false;\nexport const DEBUG_LOG_FILENAME = 'tt-log.json';\nexport const STRICTERDOM_ENABLED = DEBUG;\nexport const BOT_VERIFICATION_PEERS_LIMIT = 20;\n\nexport const BETA_CHANGELOG_URL = 'https://telegra.ph/WebA-Beta-03-20';\nexport const ELECTRON_HOST_URL = process.env.ELECTRON_HOST_URL!;\n\nexport const DEBUG_ALERT_MSG = 'Shoot!\\nSomething went wrong, please see the error details in Dev Tools Console.';\nexport const DEBUG_GRAMJS = false;\n\nexport const PAGE_TITLE = process.env.APP_TITLE!;\nexport const INACTIVE_MARKER = '[Inactive]';\n\nexport const DEBUG_PAYMENT_SMART_GLOCAL = false;\n\nexport const SESSION_USER_KEY = 'user_auth';\nexport const LEGACY_PASSCODE_CACHE_NAME = 'tt-passcode';\n\nexport const GLOBAL_STATE_CACHE_DISABLED = false;\nexport const GLOBAL_STATE_CACHE_KEY = 'tt-global-state';\nexport const GLOBAL_STATE_CACHE_USER_LIST_LIMIT = 500;\nexport const GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT = 200;\nexport const GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT = 10;\nexport const GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT = 150;\n\nexport const IS_SCREEN_LOCKED_CACHE_KEY = 'tt-is-screen-locked';\n\nexport const MEDIA_CACHE_DISABLED = false;\nexport const MEDIA_CACHE_NAME = 'tt-media';\nexport const MEDIA_CACHE_NAME_AVATARS = 'tt-media-avatars';\nexport const MEDIA_PROGRESSIVE_CACHE_DISABLED = false;\nexport const MEDIA_PROGRESSIVE_CACHE_NAME = 'tt-media-progressive';\nexport const MEDIA_CACHE_MAX_BYTES = 512 * 1024; // 512 KB\nexport const CUSTOM_BG_CACHE_NAME = 'tt-custom-bg';\nexport const LANG_CACHE_NAME = 'tt-lang-packs-v49';\nexport const ASSET_CACHE_NAME = 'tt-assets';\nexport const AUTODOWNLOAD_FILESIZE_MB_LIMITS = [1, 5, 10, 50, 100, 500];\nexport const DATA_BROADCAST_CHANNEL_NAME = 'tt-global';\nexport const ESTABLISH_BROADCAST_CHANNEL_NAME = 'tt-establish';\nexport const MULTITAB_LOCALSTORAGE_KEY = 'tt-multitab';\n\nexport const DOWNLOAD_WORKERS = 16;\nexport const UPLOAD_WORKERS = 16;\n\nconst isBigScreen = typeof window !== 'undefined' && window.innerHeight >= 900;\n\nexport const MIN_PASSWORD_LENGTH = 1;\n\nexport const MESSAGE_LIST_SLICE = isBigScreen ? 60 : 40;\nexport const MESSAGE_LIST_VIEWPORT_LIMIT = MESSAGE_LIST_SLICE * 2;\n\nexport const ARCHIVE_MINIMIZED_HEIGHT = 36;\nexport const CHAT_HEIGHT_PX = 72;\nexport const TOPIC_HEIGHT_PX = 65;\nexport const PEER_PICKER_ITEM_HEIGHT_PX = 56;\nexport const CHAT_LIST_SLICE = isBigScreen ? 30 : 25;\nexport const CHAT_LIST_LOAD_SLICE = 100;\nexport const SHARED_MEDIA_SLICE = 42;\nexport const CHAT_MEDIA_SLICE = 42;\nexport const MESSAGE_SEARCH_SLICE = 42;\nexport const GLOBAL_SEARCH_SLICE = 20;\nexport const GLOBAL_TOPIC_SEARCH_SLICE = 5;\nexport const GLOBAL_SEARCH_CONTACTS_LIMIT = 20;\nexport const MEMBERS_SLICE = 30;\nexport const MEMBERS_LOAD_SLICE = 200;\nexport const PINNED_MESSAGES_LIMIT = 50;\nexport const BLOCKED_LIST_LIMIT = 100;\nexport const PROFILE_SENSITIVE_AREA = 500;\nexport const TOPIC_LIST_SENSITIVE_AREA = 600;\nexport const GROUP_CALL_PARTICIPANTS_LIMIT = 100;\nexport const STORY_LIST_LIMIT = 100;\nexport const API_GENERAL_ID_LIMIT = 100;\nexport const STATISTICS_PUBLIC_FORWARDS_LIMIT = 50;\n\nexport const STORY_VIEWS_MIN_SEARCH = 15;\nexport const STORY_MIN_REACTIONS_SORT = 10;\nexport const STORY_VIEWS_MIN_CONTACTS_FILTER = 20;\n\nexport const GLOBAL_SUGGESTED_CHANNELS_ID = 'global';\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7799\nexport const TOP_REACTIONS_LIMIT = 100;\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7781\nexport const RECENT_REACTIONS_LIMIT = 50;\nexport const REACTION_LIST_LIMIT = 100;\nexport const REACTION_UNREAD_SLICE = 100;\nexport const MENTION_UNREAD_SLICE = 100;\nexport const TOPICS_SLICE = 20;\nexport const TOPICS_SLICE_SECOND_LOAD = 500;\n\nexport const TOP_CHAT_MESSAGES_PRELOAD_LIMIT = 20;\n\nexport const SPONSORED_MESSAGE_CACHE_MS = 300000; // 5 min\n\nexport const DEFAULT_VOLUME = 1;\nexport const DEFAULT_PLAYBACK_RATE = 1;\nexport const PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION = 20 * 60; // 20 min\n\nexport const ANIMATION_LEVEL_CUSTOM = -1;\nexport const ANIMATION_LEVEL_MIN = 0;\nexport const ANIMATION_LEVEL_MED = 1;\nexport const ANIMATION_LEVEL_MAX = 2;\nexport const ANIMATION_LEVEL_DEFAULT = ANIMATION_LEVEL_MAX;\n\nexport const DEFAULT_MESSAGE_TEXT_SIZE_PX = 16;\nexport const IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 17;\nexport const MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 15;\n\nexport const PREVIEW_AVATAR_COUNT = 3;\n\nexport const DRAFT_DEBOUNCE = 10000; // 10s\nexport const SEND_MESSAGE_ACTION_INTERVAL = 3000; // 3s\n// 10000s from https://corefork.telegram.org/api/url-authorization#automatic-authorization\nexport const APP_CONFIG_REFETCH_INTERVAL = 10000 * 1000;\nexport const GENERAL_REFETCH_INTERVAL = 60 * 60 * 1000; // 1h\n\nexport const EDITABLE_INPUT_ID = 'editable-message-text';\nexport const EDITABLE_INPUT_MODAL_ID = 'editable-message-text-modal';\nexport const EDITABLE_STORY_INPUT_ID = 'editable-story-input-text';\n// eslint-disable-next-line max-len\nexport const EDITABLE_INPUT_CSS_SELECTOR = `.messages-layout .Transition_slide-active #${EDITABLE_INPUT_ID}, .messages-layout .Transition > .Transition_slide-to #${EDITABLE_INPUT_ID}`;\nexport const EDITABLE_INPUT_MODAL_CSS_SELECTOR = `#${EDITABLE_INPUT_MODAL_ID}`;\nexport const EDITABLE_STORY_INPUT_CSS_SELECTOR = `#${EDITABLE_STORY_INPUT_ID}`;\n\nexport const CUSTOM_APPENDIX_ATTRIBUTE = 'data-has-custom-appendix';\nexport const MESSAGE_CONTENT_CLASS_NAME = 'message-content';\nexport const MESSAGE_CONTENT_SELECTOR = '.message-content';\n\nexport const RESIZE_HANDLE_CLASS_NAME = 'resizeHandle';\nexport const RESIZE_HANDLE_SELECTOR = `.${RESIZE_HANDLE_CLASS_NAME}`;\n\nexport const SNAP_EFFECT_CONTAINER_ID = 'snap-effect-container';\nexport const SNAP_EFFECT_ID = 'snap-effect';\n\nexport const STARS_ICON_PLACEHOLDER = '⭐';\nexport const STARS_CURRENCY_CODE = 'XTR';\n\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN = 1275; // px\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN = 925; // px\nexport const MOBILE_SCREEN_MAX_WIDTH = 600; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH = 950; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT = 450; // px\n\nexport const MAX_INT_32 = 2 ** 31 - 1;\nexport const TMP_CHAT_ID = '0';\n\nexport const ANIMATION_END_DELAY = 100;\nexport const ANIMATION_WAVE_MIN_INTERVAL = 200;\n\nexport const SCROLL_MIN_DURATION = 300;\nexport const SCROLL_MAX_DURATION = 600;\nexport const SCROLL_MAX_DISTANCE = 800;\nexport const SCROLL_SHORT_TRANSITION_MAX_DISTANCE = 300; // px\n\n// Average duration of message sending animation\nexport const API_UPDATE_THROTTLE = Math.round((SCROLL_MIN_DURATION + SCROLL_MAX_DURATION) / 2);\nexport const API_THROTTLE_RESET_UPDATES = new Set([\n  'newMessage', 'newScheduledMessage', 'deleteMessages', 'deleteScheduledMessages', 'deleteHistory',\n]);\n\nexport const LOCK_SCREEN_ANIMATION_DURATION_MS = 200;\n\nexport const STICKER_SIZE_INLINE_DESKTOP_FACTOR = 13;\nexport const STICKER_SIZE_INLINE_MOBILE_FACTOR = 11;\nexport const STICKER_SIZE_AUTH = 160;\nexport const STICKER_SIZE_AUTH_MOBILE = 120;\nexport const STICKER_SIZE_PICKER = 72;\nexport const EMOJI_SIZE_PICKER = 36;\nexport const COMPOSER_EMOJI_SIZE_PICKER = 32;\nexport const STICKER_SIZE_GENERAL_SETTINGS = 48;\nexport const STICKER_SIZE_PICKER_HEADER = 32;\nexport const STICKER_PICKER_MAX_SHARED_COVERS = 20;\nexport const STICKER_SIZE_SEARCH = 72;\nexport const STICKER_SIZE_MODAL = 72;\nexport const EMOJI_SIZE_MODAL = 36;\nexport const STICKER_SIZE_TWO_FA = 160;\nexport const STICKER_SIZE_PASSCODE = 160;\nexport const STICKER_SIZE_DISCUSSION_GROUPS = 140;\nexport const STICKER_SIZE_FOLDER_SETTINGS = 100;\nexport const STICKER_SIZE_INLINE_BOT_RESULT = 100;\nexport const STICKER_SIZE_JOIN_REQUESTS = 140;\nexport const STICKER_SIZE_INVITES = 140;\nexport const RECENT_STICKERS_LIMIT = 20;\nexport const RECENT_STATUS_LIMIT = 20;\nexport const EMOJI_STATUS_LOOP_LIMIT = 2;\nexport const EMOJI_SIZES = 7;\nexport const TOP_SYMBOL_SET_ID = 'top';\nexport const POPULAR_SYMBOL_SET_ID = 'popular';\nexport const RECENT_SYMBOL_SET_ID = 'recent';\nexport const SEARCH_SYMBOL_SET_ID = 'search';\nexport const FAVORITE_SYMBOL_SET_ID = 'favorite';\nexport const EFFECT_STICKERS_SET_ID = 'effectStickers';\nexport const EFFECT_EMOJIS_SET_ID = 'effectEmojis';\nexport const CHAT_STICKER_SET_ID = 'chatStickers';\nexport const DEFAULT_TOPIC_ICON_STICKER_ID = 'topic-default-icon';\nexport const DEFAULT_STATUS_ICON_ID = 'status-default-icon';\nexport const EMOJI_IMG_REGEX = /<img[^>]+alt=\"([^\"]+)\"(?![^>]*data-document-id)[^>]*>/gm;\n\nexport const BASE_EMOJI_KEYWORD_LANG = 'en';\n\nexport const MENU_TRANSITION_DURATION = 200;\nexport const SLIDE_TRANSITION_DURATION = 450;\n\nexport const BIRTHDAY_NUMBERS_SET = 'FestiveFontEmoji';\nexport const RESTRICTED_EMOJI_SET = 'RestrictedEmoji';\n\nexport const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n\nexport const VIDEO_WEBM_TYPE = 'video/webm';\nexport const GIF_MIME_TYPE = 'image/gif';\n\nexport const LOTTIE_STICKER_MIME_TYPE = 'application/x-tgsticker';\nexport const VIDEO_STICKER_MIME_TYPE = VIDEO_WEBM_TYPE;\n\nexport const SUPPORTED_PHOTO_CONTENT_TYPES = new Set([\n  'image/png', 'image/jpeg', GIF_MIME_TYPE,\n]);\n\nexport const SUPPORTED_VIDEO_CONTENT_TYPES = new Set([\n  'video/mp4', 'video/quicktime',\n]);\n\nexport const SUPPORTED_AUDIO_CONTENT_TYPES = new Set([\n  'audio/mp3',\n  'audio/ogg',\n  'audio/wav',\n  'audio/mpeg',\n  'audio/flac',\n  'audio/aac',\n  'audio/m4a',\n  'audio/mp4',\n  'audio/x-m4a',\n]);\n\nexport const CONTENT_TYPES_WITH_PREVIEW = new Set([\n  ...SUPPORTED_PHOTO_CONTENT_TYPES,\n  ...SUPPORTED_VIDEO_CONTENT_TYPES,\n]);\n\nexport const CONTENT_NOT_SUPPORTED = 'The message is not supported on this version of Telegram.';\n\n// Taken from https://github.com/telegramdesktop/tdesktop/blob/41d9a9fcbd0c809c60ddbd9350791b1436aff7d9/Telegram/SourceFiles/ui/boxes/choose_language_box.cpp#L28\nexport const SUPPORTED_TRANSLATION_LANGUAGES = [\n  // Official\n  'en', 'ar', 'be', 'ca', 'zh', 'nl', 'fr', 'de', 'id',\n  'it', 'ja', 'ko', 'pl', 'pt', 'ru', 'es', 'uk',\n  // Unofficial\n  'af', 'sq', 'am', 'hy', 'az', 'eu', 'bn', 'bs', 'bg',\n  'ceb', 'zh-CN', 'zh-TW', 'co', 'hr', 'cs', 'da', 'eo',\n  'et', 'fi', 'fy', 'gl', 'ka', 'el', 'gu', 'ht', 'ha',\n  'haw', 'he', 'iw', 'hi', 'hmn', 'hu', 'is', 'ig', 'ga',\n  'jv', 'kn', 'kk', 'km', 'rw', 'ku', 'ky', 'lo', 'la',\n  'lv', 'lt', 'lb', 'mk', 'mg', 'ms', 'ml', 'mt', 'mi',\n  'mr', 'mn', 'my', 'ne', 'no', 'ny', 'or', 'ps', 'fa',\n  'pa', 'ro', 'sm', 'gd', 'sr', 'st', 'sn', 'sd', 'si',\n  'sk', 'sl', 'so', 'su', 'sw', 'sv', 'tl', 'tg', 'ta',\n  'tt', 'te', 'th', 'tr', 'tk', 'ur', 'ug', 'uz', 'vi',\n  'cy', 'xh', 'yi', 'yo', 'zu',\n];\n\n// eslint-disable-next-line max-len\nexport const RE_LINK_TEMPLATE = '((ftp|https?):\\\\/\\\\/)?((www\\\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\\\.[a-zA-Z][-a-zA-Z0-9]{1,62})\\\\b([-a-zA-Z0-9()@:%_+.,~#?&/=]*)';\nexport const RE_MENTION_TEMPLATE = '(@[\\\\w\\\\d_-]+)';\nexport const RE_TG_LINK = /^tg:(\\/\\/)?/i;\nexport const RE_TME_LINK = /^(https?:\\/\\/)?([-a-zA-Z0-9@:%_+~#=]{1,32}\\.)?t\\.me/i;\nexport const RE_TELEGRAM_LINK = /^(https?:\\/\\/)?telegram\\.org\\//i;\nexport const TME_LINK_PREFIX = 'https://t.me/';\nexport const BOT_FATHER_USERNAME = 'botfather';\nexport const USERNAME_PURCHASE_ERROR = 'USERNAME_PURCHASE_AVAILABLE';\nexport const MESSAGE_ID_REQUIRED_ERROR = 'MESSAGE_ID_REQUIRED';\nexport const PURCHASE_USERNAME = 'auction';\nexport const ACCEPTABLE_USERNAME_ERRORS = new Set([USERNAME_PURCHASE_ERROR, 'USERNAME_INVALID']);\nexport const TME_WEB_DOMAINS = new Set(['t.me', 'web.t.me', 'a.t.me', 'k.t.me', 'z.t.me']);\nexport const WEB_APP_PLATFORM = 'weba';\nexport const LANG_PACK = 'weba';\n\n// eslint-disable-next-line max-len\nexport const COUNTRIES_WITH_12H_TIME_FORMAT = new Set(['AU', 'BD', 'CA', 'CO', 'EG', 'HN', 'IE', 'IN', 'JO', 'MX', 'MY', 'NI', 'NZ', 'PH', 'PK', 'SA', 'SV', 'US']);\n\nexport const API_CHAT_TYPES = ['bots', 'channels', 'chats', 'users'] as const;\n\nexport const HEART_REACTION: ApiReactionEmoji = {\n  type: 'emoji',\n  emoticon: '❤',\n};\n\n// MTProto constants\nexport const SERVICE_NOTIFICATIONS_USER_ID = '777000';\nexport const REPLIES_USER_ID = '1271266957'; // TODO For Test connection ID must be equal to 708513\nexport const VERIFICATION_CODES_USER_ID = '489000';\nexport const ANONYMOUS_USER_ID = '2666000';\nexport const RESTRICTED_EMOJI_SET_ID = '7173162320003080';\nexport const CHANNEL_ID_LENGTH = 14; // 14 symbols, based on TDLib's `ZERO_CHANNEL_ID = -1000000000000`\nexport const DEFAULT_GIF_SEARCH_BOT_USERNAME = 'gif';\nexport const ALL_FOLDER_ID = 0;\nexport const ARCHIVED_FOLDER_ID = 1;\nexport const SAVED_FOLDER_ID = -1;\nexport const DELETED_COMMENTS_CHANNEL_ID = '-1000000000777';\nexport const MAX_MEDIA_FILES_FOR_ALBUM = 10;\nexport const MAX_ACTIVE_PINNED_CHATS = 5;\nexport const SCHEDULED_WHEN_ONLINE = 0x7FFFFFFE;\nexport const LANG_PACKS = ['android', 'ios', 'tdesktop', 'macos'] as const;\nexport const FEEDBACK_URL = 'https://bugs.telegram.org/?tag_ids=41&sort=time';\nexport const FAQ_URL = 'https://telegram.org/faq';\nexport const PRIVACY_URL = 'https://telegram.org/privacy';\nexport const MINI_APP_TOS_URL = 'https://telegram.org/tos/mini-apps';\nexport const FRAGMENT_ADS_URL = 'https://fragment.com/ads';\nexport const GENERAL_TOPIC_ID = 1;\nexport const STORY_EXPIRE_PERIOD = 86400; // 1 day\nexport const STORY_VIEWERS_EXPIRE_PERIOD = 86400; // 1 day\nexport const FRESH_AUTH_PERIOD = 86400; // 1 day\nexport const GIVEAWAY_BOOST_PER_PREMIUM = 4;\nexport const GIVEAWAY_MAX_ADDITIONAL_CHANNELS = 10;\nexport const GIVEAWAY_MAX_ADDITIONAL_USERS = 10;\nexport const GIVEAWAY_MAX_ADDITIONAL_COUNTRIES = 10;\nexport const BOOST_PER_SENT_GIFT = 3;\nexport const FRAGMENT_PHONE_CODE = '888';\nexport const FRAGMENT_PHONE_LENGTH = 11;\n\nexport const LIGHT_THEME_BG_COLOR = '#99BA92';\nexport const DARK_THEME_BG_COLOR = '#0F0F0F';\nexport const DEFAULT_PATTERN_COLOR = '#4A8E3A8C';\nexport const DARK_THEME_PATTERN_COLOR = '#0A0A0A8C';\nexport const PEER_COLOR_BG_OPACITY = '1a';\nexport const PEER_COLOR_BG_ACTIVE_OPACITY = '2b';\nexport const PEER_COLOR_GRADIENT_STEP = 5; // px\nexport const MAX_UPLOAD_FILEPART_SIZE = 524288;\nexport const MAX_UNIQUE_REACTIONS = 11;\n\nexport const IGNORE_UNHANDLED_ERRORS = new Set([\n  'USER_CANCELED',\n]);\n\n// Group calls\nexport const GROUP_CALL_VOLUME_MULTIPLIER = 100;\nexport const GROUP_CALL_DEFAULT_VOLUME = 100 * GROUP_CALL_VOLUME_MULTIPLIER;\n\nexport const DEFAULT_LIMITS: Record<ApiLimitType, readonly [number, number]> = {\n  uploadMaxFileparts: [4000, 8000],\n  stickersFaved: [5, 10],\n  savedGifs: [200, 400],\n  dialogFiltersChats: [100, 200],\n  dialogFilters: [10, 20],\n  dialogFolderPinned: [5, 10],\n  captionLength: [1024, 4096],\n  channels: [500, 1000],\n  channelsPublic: [10, 20],\n  aboutLength: [70, 140],\n  chatlistInvites: [3, 100],\n  chatlistJoined: [2, 20],\n  recommendedChannels: [10, 100],\n  savedDialogsPinned: [5, 100],\n};\nexport const DEFAULT_MAX_MESSAGE_LENGTH = 4096;\n\nexport const ONE_TIME_MEDIA_TTL_SECONDS = 2147483647;\n\n// Premium\nexport const PREMIUM_FEATURE_SECTIONS = [\n  'stories',\n  'double_limits',\n  'more_upload',\n  'faster_download',\n  'voice_to_text',\n  'no_ads',\n  'infinite_reactions',\n  'premium_stickers',\n  'animated_emoji',\n  'advanced_chat_management',\n  'profile_badge',\n  'animated_userpics',\n  'emoji_status',\n  'translations',\n  'saved_tags',\n  'last_seen',\n  'message_privacy',\n  'effects',\n] as const;\n\nexport const PREMIUM_BOTTOM_VIDEOS: ApiPremiumSection[] = [\n  'faster_download',\n  'voice_to_text',\n  'advanced_chat_management',\n  'infinite_reactions',\n  'profile_badge',\n  'animated_userpics',\n  'emoji_status',\n  'translations',\n  'saved_tags',\n  'last_seen',\n  'message_privacy',\n  'effects',\n];\n\nexport const PREMIUM_LIMITS_ORDER: ApiLimitTypeForPromo[] = [\n  'channels',\n  'dialogFolderPinned',\n  'channelsPublic',\n  'savedGifs',\n  'stickersFaved',\n  'aboutLength',\n  'captionLength',\n  'dialogFilters',\n  'dialogFiltersChats',\n  'recommendedChannels',\n];\n","import { ApiChatFolder, ApiFormattedText, ApiMessageEntity, ApiMessageEntityBlockquote, ApiMessageEntityCustomEmoji, ApiMessageEntityDefault, ApiMessageEntityMentionName, ApiMessageEntityPre, ApiMessageEntityTextUrl, ApiMessageEntityTypes } from \"../api/types\";\nimport { DEBUG } from \"../config\";\nimport { renderTextWithEntities } from \"../components/common/helpers/renderTextWithEntities\";\nimport React from \"../lib/teact/teact\";\nimport TeactDOM from \"../lib/teact/teact-dom\";\nimport parseHtmlAsFormattedText from \"../util/parseHtmlAsFormattedText\";\nimport { TokenHelper, MarkedJS } from \"./text-editor/TokenHelper\";\nimport { areFormattedTextsEqual, FormattedTextKeys, normalizeWhitespace } from \"./text-editor/utils\";\nimport { MessageInputController } from \"./text-editor\";\n\ntype RawApiMessageEntity =\n  | Omit<ApiMessageEntityDefault, 'offset' | 'length'>\n  | Omit<ApiMessageEntityPre, 'offset' | 'length'>\n  | Omit<ApiMessageEntityTextUrl, 'offset' | 'length'>\n  | Omit<ApiMessageEntityMentionName, 'offset' | 'length'>\n  | Omit<ApiMessageEntityCustomEmoji, 'offset' | 'length'>\n  | Omit<ApiMessageEntityBlockquote, 'offset' | 'length'>;\n\n// For testing and development, including logging and utility functions.\nexport namespace Contest {\n  const IS_TESTING: boolean = false; // DEBUG;\n\n  const CUSTOM_EMOJIS = [\n    { id: \"5364029976469315203\", emoji: \"😂\" },\n    { id: \"5411159893853880009\", emoji: \"🔤\" },\n    { id: \"5330237710655306682\", emoji: \"📱\" },\n    { id: \"5384453284696181912\", emoji: \"🫤\" },\n    { id: \"5442667851246742007\", emoji: \"👍\" },\n    { id: \"5368324170671202286\", emoji: \"👍\" },\n    { id: \"5388929052935462187\", emoji: \"👍\" },\n    { id: \"5307862292547780573\", emoji: \"👍\" }\n  ];\n\n  class TestClass {\n    private _isTestCalled = false;\n\n    get isTestCalled() {\n      return this._isTestCalled;\n    }\n\n    runMessageInputTest(controller: MessageInputController) {\n      this._isTestCalled = true;\n      // const timeout = setTimeout(() => {\n      //   controller.setup(this.createMessageWithAllEntities(), {\n      //     source: \"TEST\"\n      //   });\n      // }, 3000);\n      // TestingSystem.try_start();\n    }\n\n    createMessageWithAllEntities({ withMarkdown = false, randomMode = false } = {}) {\n      return MMD_Utils.buildFormattedText(\n        { randomMode },\n        [\n          { text: 'Hello ' },\n          { text: '@username', entity: { type: ApiMessageEntityTypes.Mention } },\n          { text: '!\\nExplore ' },\n          { text: 'Telegram', entity: { type: ApiMessageEntityTypes.TextUrl, url: 'https://telegram.org' } },\n          { text: ' using ' },\n          { text: '#features', entity: { type: ApiMessageEntityTypes.Hashtag } },\n          { text: ' & ' },\n          { text: '$finance', entity: { type: ApiMessageEntityTypes.Cashtag } },\n          { text: '.\\nFormatting: ' },\n          { text: 'bold', entity: { type: ApiMessageEntityTypes.Bold } },\n          { text: ' / ' },\n          { text: 'italic', entity: { type: ApiMessageEntityTypes.Italic } },\n          { text: ' / ' },\n          { text: 'underlined', entity: { type: ApiMessageEntityTypes.Underline } },\n          { text: ' / ' },\n          { text: 'strikethrough', entity: { type: ApiMessageEntityTypes.Strike } },\n          { text: ' / ' },\n          { text: 'spoiler', entity: { type: ApiMessageEntityTypes.Spoiler } },\n          { text: ' text.\\n' },\n          { text: 'Inline code: ' },\n          { text: 'let x = 10;', entity: { type: ApiMessageEntityTypes.Code } },\n          { text: ' ' },\n          { text: CUSTOM_EMOJIS[0].emoji, entity: { type: ApiMessageEntityTypes.CustomEmoji, documentId: CUSTOM_EMOJIS[0].id } },\n          { text: '💙' },\n          { text: CUSTOM_EMOJIS[1].emoji, entity: { type: ApiMessageEntityTypes.CustomEmoji, documentId: CUSTOM_EMOJIS[1].id } },\n          { text: '🌟' },\n          { text: CUSTOM_EMOJIS[2].emoji, entity: { type: ApiMessageEntityTypes.CustomEmoji, documentId: CUSTOM_EMOJIS[2].id } },\n          { text: 'console.log(\"Code block without lang!\");\\nalert(\"Hello, World!\");', entity: { type: ApiMessageEntityTypes.Pre } },\n          { text: CUSTOM_EMOJIS[3].emoji, entity: { type: ApiMessageEntityTypes.CustomEmoji, documentId: CUSTOM_EMOJIS[3].id } },\n          { text: '\\nA separator text block. 🦄' },\n          {\n            text: `This is a multi-line\n               blockquote to showcase\n               how text formatting can be\n                 structured neatly for readability.`,\n            entity: { type: ApiMessageEntityTypes.Blockquote, collapsed: true }\n          },\n          { text: '\\nAnother separator block. 🌸' },\n          {\n            text: `#include <iostream>\\nint main() {\\n  std::cout << \"Hello, Telegram!\";\\n}`,\n            entity: { type: ApiMessageEntityTypes.Pre, language: 'cpp' }\n          },\n          { text: '\\nFinal text block. 🚀' },\n          { text: `A single-line blockquote example.`, entity: { type: ApiMessageEntityTypes.Blockquote, collapsed: true } },\n          withMarkdown ? { text: '\\n> This text *contains* **few** `markdown` ||syntax||.' } : undefined,\n          ...(randomMode ? [\n            { text: '\\nAdditional Markdown Stress Test:\\n' },\n            {\n              text: `Nested formatting test:\n              *Italic **Bold in italic***,\n              __Underline **Bold in underline**__,\n              ~~Strike *and italic* with spoiler~~.`\n            },\n            { text: '\\nList with markdown markers:\\n- Item 1\\n- Item 2\\n- Item 3' },\n            {\n              text: '\\nCode block with markdown-like syntax:\\n```python\\n# This is a comment\\nprint(\"Hello, world!\")\\n```'\n            },\n            {\n              text: '\\nEscaped markdown characters: \\\\*\\\\*not bold\\\\*\\\\* and \\\\_\\\\_not italic\\\\_\\\\_'\n            }\n          ] : [])\n        ]\n      );\n    }\n\n    tryAddCustomEmojiToFolder(folder?: ApiChatFolder) {\n      if (!folder) return undefined;\n      if (folder.id === 0) return folder;\n      if (folder.title.entities?.some(e => e.type === ApiMessageEntityTypes.CustomEmoji)) return folder;\n      if (MMD_Utils.Random.getRandomBool()) return folder; // ? Add custom icons randomly\n      const isEnd = MMD_Utils.Random.getRandomBool();\n      folder.title.entities = folder.title.entities ?? [];\n      const customEmoji = MMD_Utils.Random.getRandomElement(CUSTOM_EMOJIS)!;\n      folder.title.text = isEnd ? folder.title.text + \" \" : \" \" + folder.title.text;\n      folder.title.entities.push({\n        type: ApiMessageEntityTypes.CustomEmoji,\n        offset: isEnd ? folder.title.text.length - 1 : 0,\n        length: 1,\n        documentId: customEmoji.id\n      });\n      return folder;\n    }\n\n    isTestUserPremium(): boolean | undefined {\n      return true;\n    }\n  }\n\n  export const isTestMode = () => IS_TESTING;\n\n  const testInstance = IS_TESTING ? new TestClass() : undefined;\n\n  export const Test = () => {\n    if (!testInstance) throw new Error(\"Test mode is not enabled.\");\n    return testInstance;\n  };\n\n  export function createLogger(className: string) {\n    return new MMD_Utils.Logger(className);\n  }\n}\n\nnamespace MMD_Utils {\n  const LOG_BACKGROUND = '#111111DD';\n  const LOG_PREFIX_COLOR = '#E4D00A';\n  const LOG_CLASS_NAME_COLOR = '#0DD151';\n\n  export class Logger {\n    constructor(private readonly _name: string) { }\n\n    log(...data: any[]) {\n      Logger.printLog(this._name, ...data);\n    }\n\n    static printLog(className: string, ...data: any[]) {\n      if (!Contest.isTestMode()) return;\n      const timestamp = new Date().toLocaleTimeString([], { hour12: false });\n\n      console.log(\n        `%c[${timestamp}]%c[MMD]%c${className}`,\n        `color: grey; background: ${LOG_BACKGROUND}; padding: 0.25rem; border-radius: 0.25rem; text-align: center;`,  // Grey for timestamp\n        `color: ${LOG_PREFIX_COLOR}; background: ${LOG_BACKGROUND}; padding: 0.25rem; border-radius: 0.25rem; margin-left: 0.25rem; text-align: center;`,\n        `color: ${LOG_CLASS_NAME_COLOR}; background: ${LOG_BACKGROUND}; padding: 0.25rem; border-radius: 0.25rem; margin-left: 0.25rem; text-align: center;`,\n        ...data\n      );\n    }\n  }\n\n  export class Random {\n    private constructor() { }\n\n    static getRandomElement<T>(array: T[]): T | undefined {\n      if (array.length === 0) {\n        return undefined;\n      }\n      const randomIndex = Math.floor(Math.random() * array.length);\n      return array[randomIndex];\n    }\n\n    static getRandomElementAndDrop<T>(array: T[]): [T | undefined, T[]] {\n      if (array.length === 0) {\n        return [undefined, array];\n      }\n      const randomIndex = Math.floor(Math.random() * array.length);\n      const pickedElement = array[randomIndex];\n      const newArray = [...array.slice(0, randomIndex), ...array.slice(randomIndex + 1)];\n      return [pickedElement, newArray];\n    }\n\n    private static _seed: number = Date.now();\n\n    private static _xorshift(): number {\n      let x = Random._seed;\n      x ^= x << 13;\n      x ^= x >> 17;\n      x ^= x << 5;\n      Random._seed = x;\n      return x >>> 0;\n    }\n\n    static getRandomBool(): boolean {\n      return (Random._xorshift() & 1) === 1;\n    }\n  }\n\n  export function createLogger(className: string) {\n    return new Logger(className);\n  }\n\n  export function logger(className: string, ...data: any[]) {\n    Logger.printLog(className, ...data);\n  }\n\n  export function buildFormattedText(\n    options: { randomMode: boolean },\n    parts: ({ text: string; entity?: RawApiMessageEntity } | undefined)[]\n  ): ApiFormattedText {\n    let accumulatedText = '';\n    const entities: ApiMessageEntity[] = [];\n\n    parts.forEach((part) => {\n      if (options.randomMode && MMD_Utils.Random.getRandomBool()) return;\n      if (!part) return;\n      const startOffset = accumulatedText.length;\n      accumulatedText += part.text;\n\n      if (part.entity) {\n        switch (part.entity.type) {\n          case ApiMessageEntityTypes.CustomEmoji:\n            if (!part.entity.documentId) {\n              throw new Error(`Missing documentId for CustomEmoji entity. Entity: ${JSON.stringify(part.entity)}`);\n            }\n            break;\n          case ApiMessageEntityTypes.TextUrl:\n            if (!part.entity.url) {\n              throw new Error(`Missing URL for TextUrl entity. Entity: ${JSON.stringify(part.entity)}`);\n            }\n            break;\n          default:\n            break;\n        }\n        const newEntity = {\n          ...part.entity,\n          offset: startOffset,\n          length: part.text.length,\n        } as any;\n        entities.push(newEntity);\n      }\n    });\n\n    return {\n      text: accumulatedText,\n      entities,\n    };\n  }\n}\n\nclass TestingSystem {\n  private static _logger = Contest.createLogger(\"TestingSystem\");\n  private static _isStarted = false;\n  private constructor() { }\n\n  static try_start() {\n    if (this._isStarted) return;\n    this._isStarted = true;\n    this._run();\n  }\n\n  private static _run() {\n    try {\n      const startTime: number = Date.now();\n      let lastStepTime: number = startTime;\n\n      const logStep = (msg: string, data: Record<string, any> = {}): void => {\n        const now: number = Date.now();\n        TestingSystem._logger.log(`${msg} (Step: ${now - lastStepTime} ms)`, data);\n        lastStepTime = now;\n      };\n\n      logStep(\"1. Test started: Rendering and processing formatted text\");\n\n      const formattedText = Contest.Test().createMessageWithAllEntities();\n      logStep(\"2. Formatted text created\", { formattedText });\n\n      const rendered = renderTextWithEntities({ ...formattedText, isInEditMode: true });\n      logStep(\"3. Text rendered with entities\", { rendered });\n\n      const div: HTMLDivElement = document.createElement('div');\n      TeactDOM.render(<>{rendered}</>, div);\n      logStep(\"4. Div created and content rendered\", { div });\n\n      const markdown: string = TokenHelper.htmlToMarkdown(div);\n      logStep(\"5. Converted HTML to markdown\", { markdown });\n\n      const tokens = MarkedJS.tokenizer(markdown);\n      logStep(\"6. Tokens generated from markdown\", { tokens });\n\n      const formattedTextFromTokens = TokenHelper.tokensToFormattedText(tokens);\n      logStep(\"7. Converted tokens to API formatted text\", { formattedTextFromTokens });\n\n      const formattedTextFromHtml = parseHtmlAsFormattedText(div.innerHTML, false, true);\n      logStep(\"8. Formatted text parsed from HTML\", { formattedTextFromHtml });\n\n      TestingSystem._logger.log(`Total test duration: (${Date.now() - startTime} ms)`);\n\n      // Assertions\n      if (!areFormattedTextsEqual(formattedText, formattedTextFromTokens)\n        || !areFormattedTextsEqual(formattedText, formattedTextFromHtml)\n        || !areFormattedTextsEqual(formattedTextFromTokens, formattedTextFromHtml)) {\n        this.log_diffing(formattedText, formattedTextFromTokens, formattedTextFromHtml);\n        throw new Error(\"Test failed: Mismatch between original and processed formatted text.\");\n      }\n\n      TestingSystem._logger.log(\"✅ Test passed: formattedTextAfter is valid.\");\n    } catch (error) {\n      // Log any errors that occur during the test\n      TestingSystem._logger.log(\"Test failed with error:\\n\", error);\n      throw error;\n    }\n  }\n\n  private static log_diffing(formattedText: ApiFormattedText, formattedTextFromTokens: ApiFormattedText, formattedTextFromHtml: ApiFormattedText) {\n    // Destructure and provide defaults for entities\n    const { text: textA, entities: entsA = [] } = formattedText;\n    const { text: textB, entities: entsB = [] } = formattedTextFromTokens;\n    const { text: textC, entities: entsC = [] } = formattedTextFromHtml;\n\n    TestingSystem._logger.log({ formattedText, formattedTextFromTokens, formattedTextFromHtml });\n\n    // Compare texts\n    if (textA !== textB || textA !== textC || textB !== textC) {\n      TestingSystem._logger.log(\n        `Text mismatch detected:\n🔸 formattedText: \"${textA}\"\n🔸 normalize_formattedText: \"${normalizeWhitespace(textA)}\"\n------------------------------------------\n🔸 formattedTextFromTokens: \"${textB}\"\n🔸 normalize_formattedTextFromTokens: \"${normalizeWhitespace(textB)}\"\n------------------------------------------\n🔸 formattedTextFromHtml: \"${textC}\"\n🔸 normalize_formattedTextFromHtml: \"${normalizeWhitespace(textC)}\"`\n      );\n    }\n\n    // Compare entity counts\n    if (entsA.length !== entsB.length || entsA.length !== entsC.length) {\n      TestingSystem._logger.log(\n        `Entity count mismatch detected:\n formattedText: ${entsA.length} entities,\n formattedTextFromTokens: ${entsB.length} entities,\n formattedTextFromHtml: ${entsC.length} entities`\n      );\n      return;\n    }\n\n    // Helper to compare two entities at the same index\n    const compareEntities = (\n      expected: any,\n      actual: any,\n      label: string,\n      index: number\n    ) => {\n      if (\n        expected.type !== actual.type ||\n        expected.offset !== actual.offset ||\n        expected.length !== actual.length\n      ) {\n        TestingSystem._logger.log(\n          `${label} mismatch at index ${index}:\n Expected: ${JSON.stringify(expected)}\n Got:      ${JSON.stringify(actual)}`\n        );\n      }\n      // Compare additional key if defined for this entity type\n      const key = FormattedTextKeys[expected.type];\n      if (key && expected[key] !== actual[key]) {\n        TestingSystem._logger.log(\n          `${label} key mismatch at index ${index} (key: \"${key}\"):\n Expected: ${expected[key]}\n Got:      ${actual[key]}`\n        );\n      }\n    };\n\n    // Compare each entity in order\n    entsA.forEach((entity, i) => {\n      compareEntities(entity, entsB[i], \"(formattedText vs formattedTextFromTokens)\", i);\n      compareEntities(entity, entsC[i], \"(formattedText vs formattedTextFromHtml)\", i);\n    });\n  }\n\n}\n","import { isMarkdownMarker, MARKDOWN_MARKER_CLASS_NAME } from \".\";\nimport { ApiFormattedText, ApiSticker, ApiMessageEntityTypes } from \"../../api/types\";\nimport renderText from \"../../components/common/helpers/renderText\";\nimport { renderTextWithEntities, processEntity } from \"../../components/common/helpers/renderTextWithEntities\";\n// import parseHtmlAsFormattedText from \"../../util/parseHtmlAsFormattedText\";\nimport { Contest } from \"../contest\";\nimport { MarkdownEditorUtils, TokenHelper, MarkedJS } from \"./TokenHelper\";\nimport { RichTextEditorInstance } from \"./RichTextEditor\";\nimport { areFormattedTextsEqual, isKeyboardEvent, MultiLock, Utils } from \"./utils\";\nimport React, { } from '../../lib/teact/teact';\nimport { checkCodeBlockHeaderFooter } from \"../../components/common/code/CodeBlock\";\nimport { checkBlockQuoteFirstLast } from \"../../components/common/Blockquote\";\n\nenum EventKey {\n  Enter = 'Enter',\n  Backspace = 'Backspace',\n  Space = 'Space',\n  Delete = 'Delete',\n  ArrowUp = 'ArrowUp',\n  ArrowDown = 'ArrowDown',\n  ArrowLeft = 'ArrowLeft',\n  ArrowRight = 'ArrowRight',\n  Tab = 'Tab',\n  Escape = 'Escape',\n}\n\nconst CONFIG = {\n  MARKDOWN_HANDLER_DEBOUNCE_MS: 250,\n  HISTORY_DEBOUNCE_MS: 400,\n  HISTORY_MAX_STACK_SIZE: 100\n}\n\nconst EVENTS: (keyof HTMLElementEventMap)[] = [\n  \"click\", \"keyup\", \"keydown\", \"compositionend\", \"compositionstart\", 'selectionchange'\n];\n\nenum BlockType {\n  Paragraph = \"Paragraph\",\n  CodeBlock = \"CodeBlock\",\n  QuoteBlock = \"QuoteBlock\"\n}\n\ninterface TextEditorOptions {\n  messageSendKeyCombo: \"enter\" | \"ctrl-enter\" | undefined;\n  isCurrentUserPremium?: boolean;\n  initialText?: ApiFormattedText;\n  canSendCustomEmoji?: (emoji: ApiSticker, emojiSetId?: string) => boolean;\n}\n\nclass MarkdownHandler {\n  private _prevMarkdown?: string;\n  private _prevTokens: MarkedJS.Token[] = [];\n  private _debounceTimer?: number;\n  private readonly _logger = Contest.createLogger(\"MarkdownHandler\");\n\n  constructor(private readonly _controller: MessageInputController) { }\n\n  reloadMarkdownCache() {\n    const root = this._controller.getRoot();\n    if (!root) return;\n    const markdown = TokenHelper.htmlToMarkdown(root);\n    this._prevMarkdown = markdown.trim();\n    const tokens = MarkedJS.tokenizer(markdown);\n    this._prevTokens = tokens;\n  }\n\n  checkImmediately() {\n    this._debounceTimer = undefined;\n    this.onContentChanged();\n  }\n\n  checkMarkdownMarkers() {\n    const root = this._controller.getRoot();\n    if (!root) return;\n    const blockElement = Utils.getTopmostBlockLevelEntity(root);\n    root.querySelectorAll(`.${MARKDOWN_MARKER_CLASS_NAME}`).forEach(el => el.classList.remove('show'));\n    let element = Utils.getTopmostInlineEntity(blockElement || root);\n    if (!element) {\n      // ? For cases when Caret is *TEXT*| near to markdown marker but not inside the entity\n      const candidate = Utils.getClosestElementToCaret();\n      if (candidate instanceof HTMLElement && candidate !== root && root.contains(candidate))\n        element = candidate;\n    }\n    if (!(element instanceof HTMLElement)) return;\n    element.querySelectorAll(`.${MARKDOWN_MARKER_CLASS_NAME}`).forEach(el => el.classList.add('show'));\n  }\n\n  onContentChanged() {\n    if (this._debounceTimer) return;\n    this._debounceTimer = window.setTimeout(() => {\n      this._check();\n      this._debounceTimer = undefined;\n    }, CONFIG.MARKDOWN_HANDLER_DEBOUNCE_MS);\n  }\n\n  checkForAutoInsert(event: KeyboardEvent) {\n    const char = MarkdownEditorUtils.AUTO_INSERT_CHARS[event.key];\n    if (event.repeat || !char) return;\n\n    const selection = window.getSelection();\n    if (!selection?.rangeCount) return;\n\n    const range = selection.getRangeAt(0);\n    const root = this._controller.getRoot();\n    if (!root || !range.collapsed) return;\n\n    event.preventDefault();\n    const cursorPos = Utils.getCaretCharacterOffset(root);\n    const currentText = Utils.getTextContentWithBreaks(root, { skipMarkdownMarker: false });\n\n    if (event.key === \"`\") {\n      const lineInfo = Utils.getCaretLineInfo(root);\n      if (lineInfo) {\n        const currentLine = lineInfo.lines[lineInfo.currentLineIndex];\n        if (currentLine === \"``\") {\n          const info = this._controller.getBlockInfo();\n          if (info && info.blockType === BlockType.Paragraph) {\n            // ? Move caret to end of line\n            if (lineInfo.currentLineCaretOffset !== currentLine.length)\n              Utils.setCaretCharacterOffset(root, currentLine.length);\n\n            const DEFAULT_LANG = \"\",\n              extraOffset = DEFAULT_LANG.length + 1, // 1 for new `\n              newRange = Utils.getSelectionRange();\n            if (!newRange) return;\n            const textNode = document.createTextNode(`\\`${DEFAULT_LANG}\\n\\n\\`\\`\\``);\n            newRange.insertNode(textNode);\n            Utils.setCaretCharacterOffset(root, currentLine.length + extraOffset);\n            return;\n          }\n        }\n      }\n    }\n\n    const handleInsertCharacter = (char: string, eachSide: number, count: number) => {\n      const textToInsert = char.repeat(count);\n      range.deleteContents();\n      const textNode = document.createTextNode(textToInsert);\n      range.insertNode(textNode);\n\n      const newRange = document.createRange();\n      newRange.setStart(textNode, eachSide);\n      newRange.setEnd(newRange.startContainer, newRange.startOffset);\n      selection.removeAllRanges();\n      selection.addRange(newRange);\n    };\n\n    const lastChar = currentText[cursorPos - 1];\n    const nextChar = currentText[cursorPos + 1];\n\n    const isAccepted = (sideChar?: string) => !sideChar || sideChar.trim() === '' || sideChar.trim() === '\\n';\n    const isValid = isAccepted(lastChar) && isAccepted(nextChar);\n    handleInsertCharacter(event.key, isValid ? char.eachSide : 1, isValid ? char.eachSide * 2 : 1);\n  }\n\n  private _check() {\n    const root = this._controller.getRoot();\n    if (!root) return;\n    const markdown = TokenHelper.htmlToMarkdown(root);\n    if (this._prevMarkdown === markdown.trim()) {\n      return;\n    }\n    const tokens = MarkedJS.tokenizer(markdown);\n    this._logger.log(\"Markdown content updated, checking for tokens..\", { prevMarkdown: this._prevMarkdown, markdown });\n    this._prevMarkdown = markdown.trim();\n    if (!MarkedJS.hasStructureChanged(this._prevTokens, tokens)) return;\n\n    this._logger.log(\"Tokens structure changed, updating text editor.\", { tokens, prevTokens: this._prevTokens });\n    this._prevTokens = tokens;\n    const formattedText = TokenHelper.tokensToFormattedText(tokens);\n    queueMicrotask(() => {\n      this._controller.setup(formattedText, { source: \"MarkdownHelper\" });\n    });\n  }\n}\n\nexport const BlockLevelTypesList = [ApiMessageEntityTypes.Pre, ApiMessageEntityTypes.Blockquote] as const;\nexport const InlineFormattingTypesList = [\n  ApiMessageEntityTypes.Bold,\n  ApiMessageEntityTypes.Italic,\n  ApiMessageEntityTypes.Underline,\n  ApiMessageEntityTypes.Strike,\n  ApiMessageEntityTypes.Spoiler,\n  ApiMessageEntityTypes.Code,\n] as const;\n\nexport type FormattingTypes = (typeof InlineFormattingTypesList)[number] | ApiMessageEntityTypes.Blockquote;\n\nenum LockType {\n  ContentChange = \"ContentChange\",\n  History = \"History\"\n}\n\ntype HistoryState = {\n  caretOffset: number | undefined,\n  formattedText: ApiFormattedText\n}\n\nclass HistoryManager {\n  private _undoStack: HistoryState[] = [];\n  private _redoStack: HistoryState[] = [];\n  private _currentState?: HistoryState;\n  private _saveTimeout?: NodeJS.Timeout;\n  private _logger = Contest.createLogger(\"HistoryManager\");\n\n  constructor(initialState: HistoryState) {\n    this._currentState = initialState;\n  }\n\n  saveState(newState: HistoryState) {\n    if (this._saveTimeout) {\n      clearTimeout(this._saveTimeout);\n      this._saveTimeout = undefined;\n    }\n    this._saveState(newState);\n  }\n\n  saveStateDebounced(newState: HistoryState) {\n    if (this._saveTimeout) {\n      clearTimeout(this._saveTimeout);\n    }\n    this._saveTimeout = setTimeout(() => {\n      this._saveState(newState);\n    }, CONFIG.HISTORY_DEBOUNCE_MS);\n  }\n\n  private _saveState(newState: HistoryState) {\n    const hasStateChanged = !this._currentState || !areFormattedTextsEqual(newState.formattedText, this._currentState.formattedText);\n      // || newState.caretOffset !== this._currentState.caretOffset;\n\n    if (!hasStateChanged) {\n      this._logger.log(\"No changes detected, skipping save\", { newState });\n      return;\n    }\n    this._logger.log(\"State saved\", { newState });\n\n    if (this._currentState) {\n      this._undoStack.push(this._currentState);\n      if (this._undoStack.length > CONFIG.HISTORY_MAX_STACK_SIZE) {\n        this._undoStack.shift(); // Remove the oldest state\n      }\n    }\n    this._currentState = newState;\n    this._redoStack = [];\n  }\n\n  undo() {\n    if (this._undoStack.length > 0) {\n      this._redoStack.push(this._currentState!);\n      this._currentState = this._undoStack.pop()!;\n      return this._currentState;\n    }\n    return null; // No more states to undo\n  }\n\n  redo() {\n    if (this._redoStack.length > 0) {\n      this._undoStack.push(this._currentState!);\n      this._currentState = this._redoStack.pop()!;\n      return this._currentState;\n    }\n    return undefined; // No more states to redo\n  }\n\n  getCurrentState() {\n    return this._currentState;\n  }\n}\n\nexport class MessageInputController {\n  private readonly _logger = Contest.createLogger(\"[MessageInputController]\");\n  private readonly _markdownHandler: MarkdownHandler;\n  private readonly _history = new HistoryManager({\n    formattedText: { text: '' },\n    caretOffset: 0\n  });\n  locker = new MultiLock<LockType>();\n\n  constructor(readonly options: TextEditorOptions, private readonly _richTextEditorRef: React.RefObject<RichTextEditorInstance>) {\n    this._logger.log(\"constructor()\");\n    this._markdownHandler = new MarkdownHandler(this);\n    this._init();\n  }\n\n  private _init() {\n    const richTextEditor = this._richTextEditorRef.current;\n    if (!richTextEditor) throw new Error(\"element reference is missing.\");\n    const root = richTextEditor.getRoot();\n    if (!root) throw new Error(\"Root element reference is missing.\");\n\n    EVENTS.forEach(event => root.addEventListener(event, this._eventHandler.bind(this)));\n    document.addEventListener(\"selectionchange\", this._eventHandler.bind(this));\n\n    richTextEditor.onContentChange(() => {\n      if (!this.locker.isLocked(LockType.ContentChange)) this._markdownHandler.onContentChanged();\n      if (!this.locker.isLocked(LockType.History)) this._saveHistory(true);\n    });\n\n    if (!this.options.initialText && Contest.isTestMode()) Contest.Test().runMessageInputTest(this);\n\n    if (this.options.initialText) {\n      this.setup(this.options.initialText, { source: 'initialText' });\n    }\n  }\n\n  getRoot() {\n    return this._richTextEditorRef.current?.getRoot();\n  }\n\n  cleanup() {\n    this._logger.log(\"cleanup()\");\n    const root = this._richTextEditorRef.current?.getRoot();\n    EVENTS.forEach(event => root?.removeEventListener(event, this._eventHandler));\n    document.removeEventListener(\"selectionchange\", this._eventHandler);\n    this._richTextEditorRef.current?.clearContent();\n  }\n\n  handleCloseTextFormatter() {\n    Utils.clearSelection();\n  }\n\n  getHtmlBeforeSelection() {\n    return '';\n  }\n\n  getSelectedTextInfo() {\n    const root = this.getRoot()!;\n    const elements = Utils.getInlineEntitiesInSelection(root) || [];\n    const selectionInfo = this.getBlockInfo();\n\n    const blockLevelEntities = BlockLevelTypesList.filter(type =>\n      elements.some(el => el.dataset.entityType === type)\n      // ? Adding block level element if current selection is inside it\n      || selectionInfo?.blockElement?.dataset.entityType === type);\n    const activeFormats: FormattingTypes[] = InlineFormattingTypesList.filter(type => elements.some(el => el.dataset.entityType === type));\n    const availableFormats: FormattingTypes[] = [...InlineFormattingTypesList];\n    // If no block elements exist or the only block element is Blockquote, add Blockquote to active and available formats\n    if (blockLevelEntities.length === 1 && blockLevelEntities[0] === ApiMessageEntityTypes.Blockquote) {\n      activeFormats.push(ApiMessageEntityTypes.Blockquote);\n      availableFormats.push(ApiMessageEntityTypes.Blockquote);\n      // if (selectionInfo && selectionInfo.blockElement) elements.push(selectionInfo.blockElement);\n    }\n    else if (blockLevelEntities.length === 0) {\n      availableFormats.push(ApiMessageEntityTypes.Blockquote);\n      // if (selectionInfo && selectionInfo.blockElement) elements.push(selectionInfo.blockElement);\n    }\n    this._logger.log(\"getSelectedTextInfo\", {\n      selectionInfo: selectionInfo,\n      elements,\n      availableFormats,\n      activeFormats\n    });\n\n    return { availableFormats, activeFormats, elements };\n  }\n\n  canOpenTextFormatter() {\n    return !this._isInsideCodeBlock();\n  }\n\n  applyFormatToSelectedText(type: FormattingTypes) {\n    this._logger.log(\"applyFormatToSelectedText\", { type });\n\n    const { elements, availableFormats, activeFormats } = this.getSelectedTextInfo();\n    this._logger.log(\"applyFormatToSelectedText\", { type, elements, availableFormats, activeFormats });\n\n    if (!availableFormats.includes(type)) return;\n\n    const isActive = activeFormats.includes(type);\n    if (isActive) {\n      const effectedElements = elements.filter(x => x.dataset.entityType === type);\n      effectedElements.forEach(x => {\n        Utils.moveContentOutsideOfElement(x, isMarkdownMarker);\n      });\n    }\n    else {\n      const marker = MarkdownEditorUtils.getMarkerByType(type);\n      if (!marker) return;\n      if (type === ApiMessageEntityTypes.Blockquote) {\n        Utils.addTextAtStartAndEndOfSelection(`${marker} `, \"\");\n      }\n      else {\n        Utils.addTextAtStartAndEndOfSelection(marker, marker);\n      }\n    }\n  }\n\n  getHtml() {\n    return this._richTextEditorRef.current?.getHtml() || \"\";\n  }\n\n  isTouched() {\n    return !this.isHtmlEmpty();\n  }\n\n  isHtmlEmpty() {\n    const html = this.getHtml();\n    return html === '' || html === '\\n' || html === '<br>';\n  }\n\n  listen(cb: () => void) {\n    return this._richTextEditorRef.current?.onContentChange(cb);\n  }\n\n  deleteLastCharacterOutsideSelection() { }\n\n  getFormattedText(): ApiFormattedText {\n    return TokenHelper.htmlToFormattedText(this.getRoot()!);\n    // const formattedText = parseHtmlAsFormattedText(this.getHtml(), false, true);\n    // return formattedText;\n  }\n\n  setup(formattedText?: ApiFormattedText, options: {\n    source?: string,\n    isHistory?: boolean\n  } = { isHistory: false }) {\n    if (Contest.isTestMode() && options.source === \"useDraft()\") return; // ! Ignore Draft during tests\n\n    this._logger.log(`setup() called from '${options.source}'`, { formattedText, options });\n    if (formattedText) {\n      const rendered = renderTextWithEntities({\n        ...formattedText,\n        isInEditMode: true\n      });\n      this._richTextEditorRef.current?.replaceContent(<>{rendered}</>);\n      if (options.isHistory) this._markdownHandler.checkMarkdownMarkers();\n    }\n    else {\n      this.resetEditor();\n    }\n    if (!options.isHistory) {\n      this._saveHistory();\n    }\n  }\n\n  private _isInsideCodeBlock() {\n    const blockInfo = this.getBlockInfo();\n    return blockInfo && blockInfo.blockType === BlockType.CodeBlock;\n  }\n\n  resetEditor() {\n    this._logger.log(\"resetEditor()\");\n    this._richTextEditorRef.current?.clearContent();\n  }\n\n  insertEmoji(emoji: string | ApiSticker) {\n    this._logger.log('insertEmoji()', emoji);\n    if (this._isInsideCodeBlock()) return;\n    if (typeof emoji === 'string') {\n      const newEmoji = renderText(emoji);\n      this._richTextEditorRef.current?.insertElement(<>{newEmoji}</>);\n      this._saveHistory();\n    }\n    else {\n      const emojiSetId = 'id' in emoji.stickerSetInfo ? emoji.stickerSetInfo.id : undefined;\n      if (this.options.canSendCustomEmoji?.(emoji, emojiSetId))\n\n        if (emoji.emoji) {\n          const newEmoji = processEntity({\n            entity: {\n              documentId: emoji.id,\n              type: ApiMessageEntityTypes.CustomEmoji,\n              length: emoji.emoji.length,\n              offset: 0\n            },\n            entityContent: \"\",\n            nestedEntityContent: [],\n          });\n          this._richTextEditorRef.current?.insertElement(<>{newEmoji}</>);\n          this._saveHistory();\n        }\n    }\n  }\n\n  private _eventHandler(event: Event) {\n    switch (event.type as keyof HTMLElementEventMap) {\n      case 'click': {\n        // this.content.clickHandler(event);\n        break;\n      }\n      case 'selectionchange': {\n        this._markdownHandler.checkMarkdownMarkers();\n      }\n      case 'keydown': {\n        if (isKeyboardEvent(event))\n          this._keydownHandler(event);\n        break;\n      }\n      case 'keyup': {\n        // this.content.keyupHandler(event);\n        break;\n      }\n      case 'compositionend':\n      case 'compositionstart': {\n        // this.content.composeHandler(event);\n        break;\n      }\n    }\n  }\n\n  getBlockInfo() {\n    const range = Utils.getSelectionRange();\n    if (!range) return undefined;\n\n    const root = this.getRoot();\n    if (!root) return undefined;\n\n    const blockElement = Utils.getTopmostBlockLevelEntity(root);\n\n    const blockType = blockElement?.dataset.entityType === ApiMessageEntityTypes.Pre\n      ? BlockType.CodeBlock\n      : blockElement?.dataset.entityType === ApiMessageEntityTypes.Blockquote\n        ? BlockType.QuoteBlock\n        : BlockType.Paragraph;\n\n    return {\n      range,\n      isCollapsed: range.collapsed,\n      isMultipleBlockSelected: false,\n      blockType,\n      blockElement\n    };\n  }\n\n  private _keydownHandler(event: KeyboardEvent) {\n    const { messageSendKeyCombo } = this.options;\n    const isSend = event.key === EventKey.Enter &&\n      ((messageSendKeyCombo === 'enter' && !event.shiftKey) ||\n        (messageSendKeyCombo === 'ctrl-enter' && (event.ctrlKey || event.metaKey)));\n    if (isSend) return; // ? Handle send in the <NewMessageInput>\n\n    if (event.key === EventKey.Backspace || event.key === EventKey.Enter) {\n      const selectionInfo = this.getBlockInfo();\n      if (selectionInfo) {\n        if (selectionInfo.blockType === BlockType.CodeBlock) {\n          if (this._handleCodeBlockKeyDown(event, selectionInfo)) {\n            event.preventDefault();\n            return;\n          }\n        }\n        else if (selectionInfo.blockType === BlockType.QuoteBlock) {\n          if (this._handleBlockQuoteKeyDown(event, selectionInfo)) {\n            event.preventDefault();\n            return;\n          }\n        }\n      }\n    }\n\n    switch (event.key) {\n      // case EventKey.Backspace: {\n      //   // ! remove the break\n      //   // if ()\n      //   // if text is empty move\n      //   break;\n      // }\n      case EventKey.Delete:\n        const info = this.getBlockInfo();\n        if (info?.blockElement) {\n          info?.blockElement.remove();\n        }\n        break;\n      case EventKey.Enter:\n        if (!event.shiftKey) {\n          event.preventDefault();\n          Utils.simulateEnter();\n        }\n        break;\n      default:\n        if ((event.ctrlKey || event.metaKey) && !event.repeat) {\n          if (event.key === \"z\") {\n            event.preventDefault();\n            event.shiftKey ? this._redoHistory() : this._undoHistory();\n          } else if (event.key === \"y\") {\n            event.preventDefault();\n            this._redoHistory();\n          }\n        }\n        else {\n          this._markdownHandler.checkForAutoInsert(event);\n        }\n        break;\n    }\n  }\n\n  private _saveHistory(isDebounced: boolean = false) {\n    const root = this.getRoot();\n    if (!root) return;\n    const newState: HistoryState = {\n      caretOffset: Utils.getCaretCharacterOffset(root),\n      formattedText: this.getFormattedText()\n    };\n    if (isDebounced) this._history.saveStateDebounced(newState);\n    else this._history.saveState(newState);\n  }\n\n  private _undoHistory() {\n    const state = this._history.undo();\n    if (!state) return;\n    this._logger.log(\"_undoHistory()\", { state });\n    const root = this.getRoot();\n    if (!root) return;\n    this.locker.lock(LockType.ContentChange);\n    this.locker.lock(LockType.History);\n    this.setup(state.formattedText, {\n      source: \"history-undo\",\n      isHistory: true\n    });\n    this._markdownHandler.reloadMarkdownCache(); // ! Pervent rerender request from MarkdownHandler after unlock\n    this.locker.unlock(LockType.History);\n    this.locker.unlock(LockType.ContentChange);\n    Utils.setCaretCharacterOffset(root, state.caretOffset);\n    this._markdownHandler.checkMarkdownMarkers();\n  }\n\n  private _redoHistory() {\n    const state = this._history.redo();\n    if (!state) return;\n    this._logger.log(\"_redoHistory()\", { state });\n    const root = this.getRoot();\n    if (!root) return;\n    this.locker.lock(LockType.ContentChange);\n    this.locker.lock(LockType.History);\n    this.setup(state.formattedText, {\n      source: \"history-redo\",\n      isHistory: true\n    });\n    this._markdownHandler.reloadMarkdownCache(); // ! Pervent rerender request from MarkdownHandler after unlock\n    this.locker.unlock(LockType.History);\n    this.locker.unlock(LockType.ContentChange);\n    Utils.setCaretCharacterOffset(root, state.caretOffset);\n    this._markdownHandler.checkMarkdownMarkers();\n  }\n\n  private _handleBlockQuoteKeyDown(event: KeyboardEvent, info: ReturnType<typeof this.getBlockInfo>) {\n    if (!info?.blockElement || info.blockType !== BlockType.QuoteBlock || !this._richTextEditorRef.current) return;\n\n    const { gradientContainer: container } = checkBlockQuoteFirstLast(info.blockElement);\n    if (!(container instanceof HTMLElement)) return;\n\n    const lineInfo = Utils.extractFullLineInfo(container);\n    if (!lineInfo) return;\n\n    if (event.code === EventKey.Backspace) {\n      if (lineInfo.isInFirstLine && lineInfo.isInLastLine && lineInfo.isCurrentLineEmpty) {\n        info.blockElement.remove();\n        return true;\n      }\n      else if (lineInfo.isInFirstLine && lineInfo.isStartOfCurrentLine) {\n        Utils.moveCaretToEndOfPreviousSibling(info.blockElement);\n        return true;\n      }\n    }\n    else if (event.code === EventKey.Enter) {\n      if (lineInfo.isInThirdLine && lineInfo.isTwoFirstLineEmpty) {\n        this.locker.lock(LockType.ContentChange);\n        if (container.firstChild) container.removeChild(container.firstChild);\n        if (container.firstChild) container.removeChild(container.firstChild);\n        Utils.insertHardBreak('before', info.blockElement);\n        this.locker.unlock(LockType.ContentChange);\n        return true;\n      }\n      else if (lineInfo.isInLastLine && lineInfo.isTwoLastLineEmpty) {\n        this.locker.lock(LockType.ContentChange);\n        if (container.lastChild) container.removeChild(container.lastChild);\n        if (container.lastChild) container.removeChild(container.lastChild);\n        Utils.insertHardBreak('after', info.blockElement);\n        this.locker.unlock(LockType.ContentChange);\n        return true;\n      }\n    }\n  }\n\n  private _handleCodeBlockKeyDown(event: KeyboardEvent, info: ReturnType<typeof this.getBlockInfo>) {\n    if (!info?.blockElement || info.blockType !== BlockType.CodeBlock || !this._richTextEditorRef.current) return;\n\n    const { header, footer, isInHeader, isInFooter, codeContent } = checkCodeBlockHeaderFooter(info.blockElement, info.range.startContainer);\n\n    if (!(codeContent instanceof HTMLElement)) return;\n\n    const lineInfo = Utils.extractFullLineInfo(codeContent);\n    if (!lineInfo) return;\n\n    if (event.code === EventKey.Backspace) {\n      if (isInHeader) {\n        const headerOffset = Utils.getCaretCharacterOffset(header as HTMLElement);\n        if (headerOffset === 0) {\n          Utils.insertHardBreak('before', info.blockElement);\n          return true;\n        }\n        // ? Our tokenizer (Markedjs) doesn't check for ending tags in CodeBlock, so we should remove the footer marker when removing the header marker.\n        else if (headerOffset <= 3) {\n          footer?.remove();\n          header?.remove();\n          return true;\n        }\n      }\n      else if (isInFooter) {\n        const footerOffset = Utils.getCaretCharacterOffset(footer as HTMLElement);\n        if (footerOffset === 0) {\n          Utils.setCaretCharacterOffset(codeContent, 0);\n          return true;\n        }\n        else if (footerOffset <= 3) {\n          footer?.remove();\n          header?.remove();\n          return true;\n        }\n      }\n    }\n    else if (event.code === EventKey.Enter) {\n      if (isInHeader) {\n        const headerOffset = Utils.getCaretCharacterOffset(header as HTMLElement);\n        if (headerOffset === 0) {\n          Utils.insertHardBreak('before', info.blockElement);\n          return true;\n        }\n        else if (codeContent) {\n          Utils.setCaretCharacterOffset(codeContent, 0);\n          return true;\n        }\n      } else if (isInFooter) {\n        Utils.insertHardBreak('after', info.blockElement);\n        return true;\n      }\n    }\n  }\n}\n","import type { MarkedOptions } from './MarkedOptions';\n\n/**\n * Gets the original marked default options.\n */\nexport function _getDefaults(): MarkedOptions {\n  return {\n    async: false,\n    breaks: false,\n    extensions: null,\n    gfm: true,\n    hooks: null,\n    pedantic: false,\n    renderer: null,\n    silent: false,\n    tokenizer: null,\n    walkTokens: null,\n  };\n}\n\nexport let _defaults = _getDefaults();\n\nexport function changeDefaults(newDefaults: MarkedOptions) {\n  _defaults = newDefaults;\n}\n","const noopTest = { exec: () => null } as unknown as RegExp;\n\nfunction edit(regex: string | RegExp, opt = '') {\n  let source = typeof regex === 'string' ? regex : regex.source;\n  const obj = {\n    replace: (name: string | RegExp, val: string | RegExp) => {\n      let valSource = typeof val === 'string' ? val : val.source;\n      valSource = valSource.replace(other.caret, '$1');\n      source = source.replace(name, valSource);\n      return obj;\n    },\n    getRegex: () => {\n      return new RegExp(source, opt);\n    },\n  };\n  return obj;\n}\n\nexport const other = {\n  codeRemoveIndent: /^(?: {1,4}| {0,3}\\t)/gm,\n  outputLinkReplace: /\\\\([\\[\\]])/g,\n  indentCodeCompensation: /^(\\s+)(?:```)/,\n  beginningSpace: /^\\s+/,\n  endingHash: /#$/,\n  startingSpaceChar: /^ /,\n  endingSpaceChar: / $/,\n  nonSpaceChar: /[^ ]/,\n  newLineCharGlobal: /\\n/g,\n  tabCharGlobal: /\\t/g,\n  multipleSpaceGlobal: /\\s+/g,\n  blankLine: /^[ \\t]*$/,\n  doubleBlankLine: /\\n[ \\t]*\\n[ \\t]*$/,\n  blockquoteStart: /^ {0,3}>/,\n  blockquoteSetextReplace: /\\n {0,3}((?:=+|-+) *)(?=\\n|$)/g,\n  blockquoteSetextReplace2: /^ {0,3}>[ \\t]?/gm,\n  listReplaceTabs: /^\\t+/,\n  listReplaceNesting: /^ {1,4}(?=( {4})*[^ ])/g,\n  listIsTask: /^\\[[ xX]\\] /,\n  listReplaceTask: /^\\[[ xX]\\] +/,\n  anyLine: /\\n.*\\n/,\n  hrefBrackets: /^<(.*)>$/,\n  tableDelimiter: /[:|]/,\n  tableAlignChars: /^\\||\\| *$/g,\n  tableRowBlankLine: /\\n[ \\t]*$/,\n  tableAlignRight: /^ *-+: *$/,\n  tableAlignCenter: /^ *:-+: *$/,\n  tableAlignLeft: /^ *:-+ *$/,\n  startATag: /^<a /i,\n  endATag: /^<\\/a>/i,\n  startPreScriptTag: /^<(pre|code|kbd|script)(\\s|>)/i,\n  endPreScriptTag: /^<\\/(pre|code|kbd|script)(\\s|>)/i,\n  startAngleBracket: /^</,\n  endAngleBracket: />$/,\n  pedanticHrefTitle: /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/,\n  unicodeAlphaNumeric: /[\\p{L}\\p{N}]/u,\n  escapeTest: /[&<>\"']/,\n  escapeReplace: /[&<>\"']/g,\n  escapeTestNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/,\n  escapeReplaceNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/g,\n  unescapeTest: /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig,\n  caret: /(^|[^\\[])\\^/g,\n  percentDecode: /%25/g,\n  findPipe: /\\|/g,\n  splitPipe: / \\|/,\n  slashPipe: /\\\\\\|/g,\n  carriageReturn: /\\r\\n|\\r/g,\n  spaceLine: /^ +$/gm,\n  notSpaceStart: /^\\S*/,\n  endingNewline: /\\n$/,\n  listItemRegex: (bull: string) => new RegExp(`^( {0,3}${bull})((?:[\\t ][^\\\\n]*)?(?:\\\\n|$))`),\n  nextBulletRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \\t][^\\\\n]*)?(?:\\\\n|$))`),\n  hrRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`),\n  fencesBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:\\`\\`\\`|~~~)`),\n  headingBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}#`),\n  htmlBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}<(?:[a-z].*>|!--)`, 'i'),\n};\n\n/**\n * Block-Level Grammar\n */\n\nconst newline = /^(?:[ \\t]*(?:\\n|$))+/;\nconst blockCode = /^((?: {4}| {0,3}\\t)[^\\n]+(?:\\n(?:[ \\t]*(?:\\n|$))*)?)+/;\nconst fences = /^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/;\nconst hr = /^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/;\nconst heading = /^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/;\nconst bullet = /(?:[*+-]|\\d{1,9}[.)])/;\nconst lheading = edit(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\\n(?!\\s*?\\n|bull |blockCode|fences|blockquote|heading|html))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/)\n  .replace(/bull/g, bullet) // lists can interrupt\n  .replace(/blockCode/g, /(?: {4}| {0,3}\\t)/) // indented code blocks can interrupt\n  .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n  .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n  .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n  .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n  .getRegex();\nconst _paragraph = /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/;\nconst blockText = /^[^\\n]+/;\nconst _blockLabel = /(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;\nconst def = edit(/^ {0,3}\\[(label)\\]: *(?:\\n[ \\t]*)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n[ \\t]*)?| *\\n[ \\t]*)(title))? *(?:\\n+|$)/)\n  .replace('label', _blockLabel)\n  .replace('title', /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/)\n  .getRegex();\n\nconst list = edit(/^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/)\n  .replace(/bull/g, bullet)\n  .getRegex();\n\nconst _tag = 'address|article|aside|base|basefont|blockquote|body|caption'\n  + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption'\n  + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe'\n  + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option'\n  + '|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title'\n  + '|tr|track|ul';\nconst _comment = /<!--(?:-?>|[\\s\\S]*?(?:-->|$))/;\nconst html = edit(\n  '^ {0,3}(?:' // optional indentation\n+ '<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)' // (1)\n+ '|comment[^\\\\n]*(\\\\n+|$)' // (2)\n+ '|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)' // (3)\n+ '|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)' // (4)\n+ '|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)' // (5)\n+ '|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (6)\n+ '|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) open tag\n+ '|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) closing tag\n+ ')', 'i')\n  .replace('comment', _comment)\n  .replace('tag', _tag)\n  .replace('attribute', / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst paragraph = edit(_paragraph)\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n  .replace('|table', '')\n  .replace('blockquote', ' {0,3}>')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockquote = edit(/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/)\n  .replace('paragraph', paragraph)\n  .getRegex();\n\n/**\n * Normal Block Grammar\n */\n\nconst blockNormal = {\n  blockquote,\n  code: blockCode,\n  def,\n  fences,\n  heading,\n  hr,\n  html,\n  lheading,\n  list,\n  newline,\n  paragraph,\n  table: noopTest,\n  text: blockText,\n};\n\ntype BlockKeys = keyof typeof blockNormal;\n\n/**\n * GFM Block Grammar\n */\n\nconst gfmTable = edit(\n  '^ *([^\\\\n ].*)\\\\n' // Header\n+ ' {0,3}((?:\\\\| *)?:?-+:? *(?:\\\\| *:?-+:? *)*(?:\\\\| *)?)' // Align\n+ '(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)') // Cells\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('blockquote', ' {0,3}>')\n  .replace('code', '(?: {4}| {0,3}\\t)[^\\\\n]')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // tables can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockGfm: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  table: gfmTable,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n    .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n    .replace('table', gfmTable) // interrupt paragraphs with table\n    .replace('blockquote', ' {0,3}>')\n    .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n    .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n    .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n    .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n    .getRegex(),\n};\n\n/**\n * Pedantic grammar (original John Gruber's loose markdown specification)\n */\n\nconst blockPedantic: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  html: edit(\n    '^ *(?:comment *(?:\\\\n|\\\\s*$)'\n    + '|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)' // closed tag\n    + '|<tag(?:\"[^\"]*\"|\\'[^\\']*\\'|\\\\s[^\\'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))')\n    .replace('comment', _comment)\n    .replace(/tag/g, '(?!(?:'\n      + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub'\n      + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)'\n      + '\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b')\n    .getRegex(),\n  def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n  heading: /^(#{1,6})(.*)(?:\\n+|$)/,\n  fences: noopTest, // fences not supported\n  lheading: /^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' *#{1,6} *[^\\n]')\n    .replace('lheading', lheading)\n    .replace('|table', '')\n    .replace('blockquote', ' {0,3}>')\n    .replace('|fences', '')\n    .replace('|list', '')\n    .replace('|html', '')\n    .replace('|tag', '')\n    .getRegex(),\n};\n\n/**\n * Inline-Level Grammar\n */\n\nconst escape = /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/;\nconst inlineCode = /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/;\nconst br = /^( {2,}|\\\\)\\n(?!\\s*$)/;\nconst inlineText = /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/;\n\n// list of unicode punctuation marks, plus any missing characters from CommonMark spec\nconst _punctuation = /[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpace = /[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpace = /[^\\s\\p{P}\\p{S}]/u;\nconst punctuation = edit(/^((?![*_])punctSpace)/, 'u')\n  .replace(/punctSpace/g, _punctuationOrSpace).getRegex();\n\n// GFM allows ~ inside strong and em for strikethrough\nconst _punctuationGfmStrongEm = /(?!~)[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpaceGfmStrongEm = /(?!~)[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpaceGfmStrongEm = /(?:[^\\s\\p{P}\\p{S}]|~)/u;\n\n// sequences em should skip over [title](link), `code`, <html>\nconst blockSkip = /\\[[^[\\]]*?\\]\\((?:\\\\.|[^\\\\\\(\\)]|\\((?:\\\\.|[^\\\\\\(\\)])*\\))*\\)|`[^`]*?`|<[^<>]*?>/g;\n\nconst emStrongLDelimCore = /^(?:\\*+(?:((?!\\*)punct)|[^\\s*]))|^_+(?:((?!_)punct)|([^\\s_]))/;\n\nconst emStrongLDelim = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongLDelimGfm = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\nconst emStrongRDelimAstCore =\n  '^[^_*]*?__[^_*]*?\\\\*[^_*]*?(?=__)' // Skip orphan inside strong\n+ '|[^*]+(?=[^*])' // Consume to delim\n+ '|(?!\\\\*)punct(\\\\*+)(?=[\\\\s]|$)' // (1) #*** can only be a Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?!\\\\*)(?=punctSpace|$)' // (2) a***#, a*** can only be a Right Delimiter\n+ '|(?!\\\\*)punctSpace(\\\\*+)(?=notPunctSpace)' // (3) #***a, ***a can only be Left Delimiter\n+ '|[\\\\s](\\\\*+)(?!\\\\*)(?=punct)' // (4) ***# can only be Left Delimiter\n+ '|(?!\\\\*)punct(\\\\*+)(?!\\\\*)(?=punct)' // (5) #***# can be either Left or Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?=notPunctSpace)'; // (6) a***a can be either Left or Right Delimiter\n\nconst emStrongRDelimAst = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongRDelimAstGfm = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpaceGfmStrongEm)\n  .replace(/punctSpace/g, _punctuationOrSpaceGfmStrongEm)\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\n// (6) Not allowed for _\nconst emStrongRDelimUnd = edit(\n  '^[^_*]*?\\\\*\\\\*[^_*]*?_[^_*]*?(?=\\\\*\\\\*)' // Skip orphan inside strong\n+ '|[^_]+(?=[^_])' // Consume to delim\n+ '|(?!_)punct(_+)(?=[\\\\s]|$)' // (1) #___ can only be a Right Delimiter\n+ '|notPunctSpace(_+)(?!_)(?=punctSpace|$)' // (2) a___#, a___ can only be a Right Delimiter\n+ '|(?!_)punctSpace(_+)(?=notPunctSpace)' // (3) #___a, ___a can only be Left Delimiter\n+ '|[\\\\s](_+)(?!_)(?=punct)' // (4) ___# can only be Left Delimiter\n+ '|(?!_)punct(_+)(?!_)(?=punct)', 'gu') // (5) #___# can be either Left or Right Delimiter\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst anyPunctuation = edit(/\\\\(punct)/, 'gu')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst autolink = edit(/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/)\n  .replace('scheme', /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/)\n  .replace('email', /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/)\n  .getRegex();\n\nconst _inlineComment = edit(_comment).replace('(?:-->|$)', '-->').getRegex();\nconst tag = edit(\n  '^comment'\n    + '|^</[a-zA-Z][\\\\w:-]*\\\\s*>' // self-closing tag\n    + '|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>' // open tag\n    + '|^<\\\\?[\\\\s\\\\S]*?\\\\?>' // processing instruction, e.g. <?php ?>\n    + '|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>' // declaration, e.g. <!DOCTYPE html>\n    + '|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>') // CDATA section\n  .replace('comment', _inlineComment)\n  .replace('attribute', /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst _inlineLabel = /(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;\n\nconst link = edit(/^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/)\n  .replace('label', _inlineLabel)\n  .replace('href', /<(?:\\\\.|[^\\n<>\\\\])+>|[^\\s\\x00-\\x1f]*/)\n  .replace('title', /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/)\n  .getRegex();\n\nconst reflink = edit(/^!?\\[(label)\\]\\[(ref)\\]/)\n  .replace('label', _inlineLabel)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst nolink = edit(/^!?\\[(ref)\\](?:\\[\\])?/)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst reflinkSearch = edit('reflink|nolink(?!\\\\()', 'g')\n  .replace('reflink', reflink)\n  .replace('nolink', nolink)\n  .getRegex();\n\n/**\n * Normal Inline Grammar\n */\n\nconst inlineNormal = {\n  _backpedal: noopTest, // only used for GFM url\n  anyPunctuation,\n  autolink,\n  blockSkip,\n  br,\n  code: inlineCode,\n  del: noopTest,\n  emStrongLDelim,\n  emStrongRDelimAst,\n  emStrongRDelimUnd,\n  escape,\n  link,\n  nolink,\n  punctuation,\n  reflink,\n  reflinkSearch,\n  tag,\n  text: inlineText,\n  url: noopTest,\n};\n\ntype InlineKeys = keyof typeof inlineNormal;\n\n/**\n * Pedantic Inline Grammar\n */\n\nconst inlinePedantic: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  link: edit(/^!?\\[(label)\\]\\((.*?)\\)/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n  reflink: edit(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n};\n\n/**\n * GFM Inline Grammar\n */\n\nconst inlineGfm: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  emStrongRDelimAst: emStrongRDelimAstGfm,\n  emStrongLDelim: emStrongLDelimGfm,\n  url: edit(/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/, 'i')\n    .replace('email', /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/)\n    .getRegex(),\n  _backpedal: /(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,\n  del: /^(~~?)(?=[^\\s~])((?:\\\\.|[^\\\\])*?(?:\\\\.|[^\\s~\\\\]))\\1(?=[^~]|$)/,\n  text: /^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/,\n};\n\n/**\n * GFM + Line Breaks Inline Grammar\n */\n\nconst inlineBreaks: Record<InlineKeys, RegExp> = {\n  ...inlineGfm,\n  br: edit(br).replace('{2,}', '*').getRegex(),\n  text: edit(inlineGfm.text)\n    .replace('\\\\b_', '\\\\b_| {2,}\\\\n')\n    .replace(/\\{2,\\}/g, '*')\n    .getRegex(),\n};\n\n/**\n * exports\n */\n\nexport const block = {\n  normal: blockNormal,\n  gfm: blockGfm,\n  pedantic: blockPedantic,\n};\n\nexport const inline = {\n  normal: inlineNormal,\n  gfm: inlineGfm,\n  breaks: inlineBreaks,\n  pedantic: inlinePedantic,\n};\n\nexport interface Rules {\n  other: typeof other\n  block: Record<BlockKeys, RegExp>\n  inline: Record<InlineKeys, RegExp>\n}\n","import { other } from './rules';\n\n/**\n * Helpers\n */\nconst escapeReplacements: { [index: string]: string } = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n};\nconst getEscapeReplacement = (ch: string) => escapeReplacements[ch];\n\nexport function escape(html: string, encode?: boolean) {\n  if (encode) {\n    if (other.escapeTest.test(html)) {\n      return html.replace(other.escapeReplace, getEscapeReplacement);\n    }\n  } else {\n    if (other.escapeTestNoEncode.test(html)) {\n      return html.replace(other.escapeReplaceNoEncode, getEscapeReplacement);\n    }\n  }\n\n  return html;\n}\n\nexport function unescape(html: string) {\n  // explicitly match decimal, hex, and named HTML entities\n  return html.replace(other.unescapeTest, (_, n) => {\n    n = n.toLowerCase();\n    if (n === 'colon') return ':';\n    if (n.charAt(0) === '#') {\n      return n.charAt(1) === 'x'\n        ? String.fromCharCode(parseInt(n.substring(2), 16))\n        : String.fromCharCode(+n.substring(1));\n    }\n    return '';\n  });\n}\n\nexport function cleanUrl(href: string) {\n  try {\n    href = encodeURI(href).replace(other.percentDecode, '%');\n  } catch {\n    return null;\n  }\n  return href;\n}\n\nexport function splitCells(tableRow: string, count?: number) {\n  // ensure that every cell-delimiting pipe has a space\n  // before it to distinguish it from an escaped pipe\n  const row = tableRow.replace(other.findPipe, (match, offset, str) => {\n      let escaped = false;\n      let curr = offset;\n      while (--curr >= 0 && str[curr] === '\\\\') escaped = !escaped;\n      if (escaped) {\n        // odd number of slashes means | is escaped\n        // so we leave it alone\n        return '|';\n      } else {\n        // add space before unescaped |\n        return ' |';\n      }\n    }),\n    cells = row.split(other.splitPipe);\n  let i = 0;\n\n  // First/last cell in a row cannot be empty if it has no leading/trailing pipe\n  if (!cells[0].trim()) {\n    cells.shift();\n  }\n  if (cells.length > 0 && !cells.at(-1)?.trim()) {\n    cells.pop();\n  }\n\n  if (count) {\n    if (cells.length > count) {\n      cells.splice(count);\n    } else {\n      while (cells.length < count) cells.push('');\n    }\n  }\n\n  for (; i < cells.length; i++) {\n    // leading or trailing whitespace is ignored per the gfm spec\n    cells[i] = cells[i].trim().replace(other.slashPipe, '|');\n  }\n  return cells;\n}\n\n/**\n * Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').\n * /c*$/ is vulnerable to REDOS.\n *\n * @param str\n * @param c\n * @param invert Remove suffix of non-c chars instead. Default falsey.\n */\nexport function rtrim(str: string, c: string, invert?: boolean) {\n  const l = str.length;\n  if (l === 0) {\n    return '';\n  }\n\n  // Length of suffix matching the invert condition.\n  let suffLen = 0;\n\n  // Step left until we fail to match the invert condition.\n  while (suffLen < l) {\n    const currChar = str.charAt(l - suffLen - 1);\n    if (currChar === c && !invert) {\n      suffLen++;\n    } else if (currChar !== c && invert) {\n      suffLen++;\n    } else {\n      break;\n    }\n  }\n\n  return str.slice(0, l - suffLen);\n}\n\nexport function findClosingBracket(str: string, b: string) {\n  if (str.indexOf(b[1]) === -1) {\n    return -1;\n  }\n\n  let level = 0;\n  for (let i = 0; i < str.length; i++) {\n    if (str[i] === '\\\\') {\n      i++;\n    } else if (str[i] === b[0]) {\n      level++;\n    } else if (str[i] === b[1]) {\n      level--;\n      if (level < 0) {\n        return i;\n      }\n    }\n  }\n  return -1;\n}\n","import { _defaults } from './defaults';\nimport {\n  rtrim,\n  splitCells,\n  findClosingBracket,\n} from './helpers';\nimport type { Rules } from './rules';\nimport type { _Lexer } from './Lexer';\nimport type { Links, Tokens, Token } from './Tokens';\nimport type { MarkedOptions } from './MarkedOptions';\n\nfunction outputLink(cap: string[], link: Pick<Tokens.Link, 'href' | 'title'>, raw: string, lexer: _Lexer, rules: Rules): Tokens.Link | Tokens.Image {\n  const href = link.href;\n  const title = link.title || null;\n  const text = cap[1].replace(rules.other.outputLinkReplace, '$1');\n\n  if (cap[0].charAt(0) !== '!') {\n    lexer.state.inLink = true;\n    const token: Tokens.Link = {\n      type: 'link',\n      raw,\n      href,\n      title,\n      text,\n      tokens: lexer.inlineTokens(text),\n    };\n    lexer.state.inLink = false;\n    return token;\n  }\n  return {\n    type: 'image',\n    raw,\n    href,\n    title,\n    text,\n  };\n}\n\nfunction indentCodeCompensation(raw: string, text: string, rules: Rules) {\n  const matchIndentToCode = raw.match(rules.other.indentCodeCompensation);\n\n  if (matchIndentToCode === null) {\n    return text;\n  }\n\n  const indentToCode = matchIndentToCode[1];\n\n  return text\n    .split('\\n')\n    .map(node => {\n      const matchIndentInNode = node.match(rules.other.beginningSpace);\n      if (matchIndentInNode === null) {\n        return node;\n      }\n\n      const [indentInNode] = matchIndentInNode;\n\n      if (indentInNode.length >= indentToCode.length) {\n        return node.slice(indentToCode.length);\n      }\n\n      return node;\n    })\n    .join('\\n');\n}\n\n/**\n * Tokenizer\n */\nexport class _Tokenizer {\n  options: MarkedOptions;\n  rules!: Rules; // set by the lexer\n  lexer!: _Lexer; // set by the lexer\n\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  space(src: string): Tokens.Space | undefined {\n    const cap = this.rules.block.newline.exec(src);\n    if (cap && cap[0].length > 0) {\n      return {\n        type: 'space',\n        raw: cap[0],\n      };\n    }\n  }\n\n  code(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.code.exec(src);\n    if (cap) {\n      const text = cap[0].replace(this.rules.other.codeRemoveIndent, '');\n      return {\n        type: 'code',\n        raw: cap[0],\n        codeBlockStyle: 'indented',\n        text: !this.options.pedantic\n          ? rtrim(text, '\\n')\n          : text,\n      };\n    }\n  }\n\n  fences(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.fences.exec(src);\n    if (cap) {\n      const raw = cap[0];\n      const text = indentCodeCompensation(raw, cap[3] || '', this.rules);\n\n      return {\n        type: 'code',\n        raw,\n        lang: cap[2] ? cap[2].trim().replace(this.rules.inline.anyPunctuation, '$1') : cap[2],\n        text,\n      };\n    }\n  }\n\n  heading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.heading.exec(src);\n    if (cap) {\n      let text = cap[2].trim();\n\n      // remove trailing #s\n      if (this.rules.other.endingHash.test(text)) {\n        const trimmed = rtrim(text, '#');\n        if (this.options.pedantic) {\n          text = trimmed.trim();\n        } else if (!trimmed || this.rules.other.endingSpaceChar.test(trimmed)) {\n          // CommonMark requires space before trailing #s\n          text = trimmed.trim();\n        }\n      }\n\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[1].length,\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  hr(src: string): Tokens.Hr | undefined {\n    const cap = this.rules.block.hr.exec(src);\n    if (cap) {\n      return {\n        type: 'hr',\n        raw: rtrim(cap[0], '\\n'),\n      };\n    }\n  }\n\n  blockquote(src: string): Tokens.Blockquote | undefined {\n    const cap = this.rules.block.blockquote.exec(src);\n    if (cap) {\n      let lines = rtrim(cap[0], '\\n').split('\\n');\n      let raw = '';\n      let text = '';\n      const tokens: Token[] = [];\n\n      while (lines.length > 0) {\n        let inBlockquote = false;\n        const currentLines = [];\n\n        let i;\n        for (i = 0; i < lines.length; i++) {\n          // get lines up to a continuation\n          if (this.rules.other.blockquoteStart.test(lines[i])) {\n            currentLines.push(lines[i]);\n            inBlockquote = true;\n          } else if (!inBlockquote) {\n            currentLines.push(lines[i]);\n          } else {\n            break;\n          }\n        }\n        lines = lines.slice(i);\n\n        const currentRaw = currentLines.join('\\n');\n        const currentText = currentRaw\n          // precede setext continuation with 4 spaces so it isn't a setext\n          .replace(this.rules.other.blockquoteSetextReplace, '\\n    $1')\n          .replace(this.rules.other.blockquoteSetextReplace2, '');\n        raw = raw ? `${raw}\\n${currentRaw}` : currentRaw;\n        text = text ? `${text}\\n${currentText}` : currentText;\n\n        // parse blockquote lines as top level tokens\n        // merge paragraphs if this is a continuation\n        const top = this.lexer.state.top;\n        this.lexer.state.top = true;\n\n        this.lexer.blockTokens(currentText, tokens, true);\n        this.lexer.state.top = top;\n\n        // if there is no continuation then we are done\n        if (lines.length === 0) {\n          break;\n        }\n\n        const lastToken = tokens.at(-1);\n\n        if (lastToken?.type === 'code') {\n          // blockquote continuation cannot be preceded by a code block\n          break;\n        } else if (lastToken?.type === 'blockquote') {\n          // include continuation in nested blockquote\n          const oldToken = lastToken as Tokens.Blockquote;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.blockquote(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - oldToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.text.length) + newToken.text;\n          break;\n        } else if (lastToken?.type === 'list') {\n          // include continuation in nested list\n          const oldToken = lastToken as Tokens.List;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.list(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - lastToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.raw.length) + newToken.raw;\n          lines = newText.substring(tokens.at(-1)!.raw.length).split('\\n');\n          continue;\n        }\n      }\n\n      return {\n        type: 'blockquote',\n        raw,\n        tokens,\n        text,\n      };\n    }\n  }\n\n  list(src: string): Tokens.List | undefined {\n    let cap = this.rules.block.list.exec(src);\n    if (cap) {\n      let bull = cap[1].trim();\n      const isordered = bull.length > 1;\n\n      const list: Tokens.List = {\n        type: 'list',\n        raw: '',\n        ordered: isordered,\n        start: isordered ? +bull.slice(0, -1) : '',\n        loose: false,\n        items: [],\n      };\n\n      bull = isordered ? `\\\\d{1,9}\\\\${bull.slice(-1)}` : `\\\\${bull}`;\n\n      if (this.options.pedantic) {\n        bull = isordered ? bull : '[*+-]';\n      }\n\n      // Get next list item\n      const itemRegex = this.rules.other.listItemRegex(bull);\n      let endsWithBlankLine = false;\n      // Check if current bullet point can start a new List Item\n      while (src) {\n        let endEarly = false;\n        let raw = '';\n        let itemContents = '';\n        if (!(cap = itemRegex.exec(src))) {\n          break;\n        }\n\n        if (this.rules.block.hr.test(src)) { // End list if bullet was actually HR (possibly move into itemRegex?)\n          break;\n        }\n\n        raw = cap[0];\n        src = src.substring(raw.length);\n\n        let line = cap[2].split('\\n', 1)[0].replace(this.rules.other.listReplaceTabs, (t: string) => ' '.repeat(3 * t.length));\n        let nextLine = src.split('\\n', 1)[0];\n        let blankLine = !line.trim();\n\n        let indent = 0;\n        if (this.options.pedantic) {\n          indent = 2;\n          itemContents = line.trimStart();\n        } else if (blankLine) {\n          indent = cap[1].length + 1;\n        } else {\n          indent = cap[2].search(this.rules.other.nonSpaceChar); // Find first non-space char\n          indent = indent > 4 ? 1 : indent; // Treat indented code blocks (> 4 spaces) as having only 1 indent\n          itemContents = line.slice(indent);\n          indent += cap[1].length;\n        }\n\n        if (blankLine && this.rules.other.blankLine.test(nextLine)) { // Items begin with at most one blank line\n          raw += nextLine + '\\n';\n          src = src.substring(nextLine.length + 1);\n          endEarly = true;\n        }\n\n        if (!endEarly) {\n          const nextBulletRegex = this.rules.other.nextBulletRegex(indent);\n          const hrRegex = this.rules.other.hrRegex(indent);\n          const fencesBeginRegex = this.rules.other.fencesBeginRegex(indent);\n          const headingBeginRegex = this.rules.other.headingBeginRegex(indent);\n          const htmlBeginRegex = this.rules.other.htmlBeginRegex(indent);\n\n          // Check if following lines should be included in List Item\n          while (src) {\n            const rawLine = src.split('\\n', 1)[0];\n            let nextLineWithoutTabs;\n            nextLine = rawLine;\n\n            // Re-align to follow commonmark nesting rules\n            if (this.options.pedantic) {\n              nextLine = nextLine.replace(this.rules.other.listReplaceNesting, '  ');\n              nextLineWithoutTabs = nextLine;\n            } else {\n              nextLineWithoutTabs = nextLine.replace(this.rules.other.tabCharGlobal, '    ');\n            }\n\n            // End list item if found code fences\n            if (fencesBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new heading\n            if (headingBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of html block\n            if (htmlBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new bullet\n            if (nextBulletRegex.test(nextLine)) {\n              break;\n            }\n\n            // Horizontal rule found\n            if (hrRegex.test(nextLine)) {\n              break;\n            }\n\n            if (nextLineWithoutTabs.search(this.rules.other.nonSpaceChar) >= indent || !nextLine.trim()) { // Dedent if possible\n              itemContents += '\\n' + nextLineWithoutTabs.slice(indent);\n            } else {\n              // not enough indentation\n              if (blankLine) {\n                break;\n              }\n\n              // paragraph continuation unless last line was a different block level element\n              if (line.replace(this.rules.other.tabCharGlobal, '    ').search(this.rules.other.nonSpaceChar) >= 4) { // indented code block\n                break;\n              }\n              if (fencesBeginRegex.test(line)) {\n                break;\n              }\n              if (headingBeginRegex.test(line)) {\n                break;\n              }\n              if (hrRegex.test(line)) {\n                break;\n              }\n\n              itemContents += '\\n' + nextLine;\n            }\n\n            if (!blankLine && !nextLine.trim()) { // Check if current line is blank\n              blankLine = true;\n            }\n\n            raw += rawLine + '\\n';\n            src = src.substring(rawLine.length + 1);\n            line = nextLineWithoutTabs.slice(indent);\n          }\n        }\n\n        if (!list.loose) {\n          // If the previous item ended with a blank line, the list is loose\n          if (endsWithBlankLine) {\n            list.loose = true;\n          } else if (this.rules.other.doubleBlankLine.test(raw)) {\n            endsWithBlankLine = true;\n          }\n        }\n\n        let istask: RegExpExecArray | null = null;\n        let ischecked: boolean | undefined;\n        // Check for task list items\n        if (this.options.gfm) {\n          istask = this.rules.other.listIsTask.exec(itemContents);\n          if (istask) {\n            ischecked = istask[0] !== '[ ] ';\n            itemContents = itemContents.replace(this.rules.other.listReplaceTask, '');\n          }\n        }\n\n        list.items.push({\n          type: 'list_item',\n          raw,\n          task: !!istask,\n          checked: ischecked,\n          loose: false,\n          text: itemContents,\n          tokens: [],\n        });\n\n        list.raw += raw;\n      }\n\n      // Do not consume newlines at end of final item. Alternatively, make itemRegex *start* with any newlines to simplify/speed up endsWithBlankLine logic\n      const lastItem = list.items.at(-1);\n      if (lastItem) {\n        lastItem.raw = lastItem.raw.trimEnd();\n        lastItem.text = lastItem.text.trimEnd();\n      } else {\n        // not a list since there were no items\n        return;\n      }\n      list.raw = list.raw.trimEnd();\n\n      // Item child tokens handled here at end because we needed to have the final item to trim it first\n      for (let i = 0; i < list.items.length; i++) {\n        this.lexer.state.top = false;\n        list.items[i].tokens = this.lexer.blockTokens(list.items[i].text, []);\n\n        if (!list.loose) {\n          // Check if list should be loose\n          const spacers = list.items[i].tokens.filter(t => t.type === 'space');\n          const hasMultipleLineBreaks = spacers.length > 0 && spacers.some(t => this.rules.other.anyLine.test(t.raw));\n\n          list.loose = hasMultipleLineBreaks;\n        }\n      }\n\n      // Set all items to loose if list is loose\n      if (list.loose) {\n        for (let i = 0; i < list.items.length; i++) {\n          list.items[i].loose = true;\n        }\n      }\n\n      return list;\n    }\n  }\n\n  html(src: string): Tokens.HTML | undefined {\n    const cap = this.rules.block.html.exec(src);\n    if (cap) {\n      const token: Tokens.HTML = {\n        type: 'html',\n        block: true,\n        raw: cap[0],\n        pre: cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style',\n        text: cap[0],\n      };\n      return token;\n    }\n  }\n\n  def(src: string): Tokens.Def | undefined {\n    const cap = this.rules.block.def.exec(src);\n    if (cap) {\n      const tag = cap[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const href = cap[2] ? cap[2].replace(this.rules.other.hrefBrackets, '$1').replace(this.rules.inline.anyPunctuation, '$1') : '';\n      const title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline.anyPunctuation, '$1') : cap[3];\n      return {\n        type: 'def',\n        tag,\n        raw: cap[0],\n        href,\n        title,\n      };\n    }\n  }\n\n  table(src: string): Tokens.Table | undefined {\n    const cap = this.rules.block.table.exec(src);\n    if (!cap) {\n      return;\n    }\n\n    if (!this.rules.other.tableDelimiter.test(cap[2])) {\n      // delimiter row must have a pipe (|) or colon (:) otherwise it is a setext heading\n      return;\n    }\n\n    const headers = splitCells(cap[1]);\n    const aligns = cap[2].replace(this.rules.other.tableAlignChars, '').split('|');\n    const rows = cap[3]?.trim() ? cap[3].replace(this.rules.other.tableRowBlankLine, '').split('\\n') : [];\n\n    const item: Tokens.Table = {\n      type: 'table',\n      raw: cap[0],\n      header: [],\n      align: [],\n      rows: [],\n    };\n\n    if (headers.length !== aligns.length) {\n      // header and align columns must be equal, rows can be different.\n      return;\n    }\n\n    for (const align of aligns) {\n      if (this.rules.other.tableAlignRight.test(align)) {\n        item.align.push('right');\n      } else if (this.rules.other.tableAlignCenter.test(align)) {\n        item.align.push('center');\n      } else if (this.rules.other.tableAlignLeft.test(align)) {\n        item.align.push('left');\n      } else {\n        item.align.push(null);\n      }\n    }\n\n    for (let i = 0; i < headers.length; i++) {\n      item.header.push({\n        text: headers[i],\n        tokens: this.lexer.inline(headers[i]),\n        header: true,\n        align: item.align[i],\n      });\n    }\n\n    for (const row of rows) {\n      item.rows.push(splitCells(row, item.header.length).map((cell, i) => {\n        return {\n          text: cell,\n          tokens: this.lexer.inline(cell),\n          header: false,\n          align: item.align[i],\n        };\n      }));\n    }\n\n    return item;\n  }\n\n  lheading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.lheading.exec(src);\n    if (cap) {\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[2].charAt(0) === '=' ? 1 : 2,\n        text: cap[1],\n        tokens: this.lexer.inline(cap[1]),\n      };\n    }\n  }\n\n  paragraph(src: string): Tokens.Paragraph | undefined {\n    const cap = this.rules.block.paragraph.exec(src);\n    if (cap) {\n      const text = cap[1].charAt(cap[1].length - 1) === '\\n'\n        ? cap[1].slice(0, -1)\n        : cap[1];\n      return {\n        type: 'paragraph',\n        raw: cap[0],\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  text(src: string): Tokens.Text | undefined {\n    const cap = this.rules.block.text.exec(src);\n    if (cap) {\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        tokens: this.lexer.inline(cap[0]),\n      };\n    }\n  }\n\n  escape(src: string): Tokens.Escape | undefined {\n    const cap = this.rules.inline.escape.exec(src);\n    if (cap) {\n      return {\n        type: 'escape',\n        raw: cap[0],\n        text: cap[1],\n      };\n    }\n  }\n\n  tag(src: string): Tokens.Tag | undefined {\n    const cap = this.rules.inline.tag.exec(src);\n    if (cap) {\n      if (!this.lexer.state.inLink && this.rules.other.startATag.test(cap[0])) {\n        this.lexer.state.inLink = true;\n      } else if (this.lexer.state.inLink && this.rules.other.endATag.test(cap[0])) {\n        this.lexer.state.inLink = false;\n      }\n      if (!this.lexer.state.inRawBlock && this.rules.other.startPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = true;\n      } else if (this.lexer.state.inRawBlock && this.rules.other.endPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = false;\n      }\n\n      return {\n        type: 'html',\n        raw: cap[0],\n        inLink: this.lexer.state.inLink,\n        inRawBlock: this.lexer.state.inRawBlock,\n        block: false,\n        text: cap[0],\n      };\n    }\n  }\n\n  link(src: string): Tokens.Link | Tokens.Image | undefined {\n    const cap = this.rules.inline.link.exec(src);\n    if (cap) {\n      const trimmedUrl = cap[2].trim();\n      if (!this.options.pedantic && this.rules.other.startAngleBracket.test(trimmedUrl)) {\n        // commonmark requires matching angle brackets\n        if (!(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          return;\n        }\n\n        // ending angle bracket cannot be escaped\n        const rtrimSlash = rtrim(trimmedUrl.slice(0, -1), '\\\\');\n        if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {\n          return;\n        }\n      } else {\n        // find closing parenthesis\n        const lastParenIndex = findClosingBracket(cap[2], '()');\n        if (lastParenIndex > -1) {\n          const start = cap[0].indexOf('!') === 0 ? 5 : 4;\n          const linkLen = start + cap[1].length + lastParenIndex;\n          cap[2] = cap[2].substring(0, lastParenIndex);\n          cap[0] = cap[0].substring(0, linkLen).trim();\n          cap[3] = '';\n        }\n      }\n      let href = cap[2];\n      let title = '';\n      if (this.options.pedantic) {\n        // split pedantic href and title\n        const link = this.rules.other.pedanticHrefTitle.exec(href);\n\n        if (link) {\n          href = link[1];\n          title = link[3];\n        }\n      } else {\n        title = cap[3] ? cap[3].slice(1, -1) : '';\n      }\n\n      href = href.trim();\n      if (this.rules.other.startAngleBracket.test(href)) {\n        if (this.options.pedantic && !(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          // pedantic allows starting angle bracket without ending angle bracket\n          href = href.slice(1);\n        } else {\n          href = href.slice(1, -1);\n        }\n      }\n      return outputLink(cap, {\n        href: href ? href.replace(this.rules.inline.anyPunctuation, '$1') : href,\n        title: title ? title.replace(this.rules.inline.anyPunctuation, '$1') : title,\n      }, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  reflink(src: string, links: Links): Tokens.Link | Tokens.Image | Tokens.Text | undefined {\n    let cap;\n    if ((cap = this.rules.inline.reflink.exec(src))\n      || (cap = this.rules.inline.nolink.exec(src))) {\n      const linkString = (cap[2] || cap[1]).replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const link = links[linkString.toLowerCase()];\n      if (!link) {\n        const text = cap[0].charAt(0);\n        return {\n          type: 'text',\n          raw: text,\n          text,\n        };\n      }\n      return outputLink(cap, link, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  emStrong(src: string, maskedSrc: string, prevChar = ''): Tokens.Em | Tokens.Strong | undefined {\n    let match = this.rules.inline.emStrongLDelim.exec(src);\n    if (!match) return;\n\n    // _ can't be between two alphanumerics. \\p{L}\\p{N} includes non-english alphabet/numbers as well\n    if (match[3] && prevChar.match(this.rules.other.unicodeAlphaNumeric)) return;\n\n    const nextChar = match[1] || match[2] || '';\n\n    if (!nextChar || !prevChar || this.rules.inline.punctuation.exec(prevChar)) {\n      // unicode Regex counts emoji as 1 char; spread into array for proper count (used multiple times below)\n      const lLength = [...match[0]].length - 1;\n      let rDelim, rLength, delimTotal = lLength, midDelimTotal = 0;\n\n      const endReg = match[0][0] === '*' ? this.rules.inline.emStrongRDelimAst : this.rules.inline.emStrongRDelimUnd;\n      endReg.lastIndex = 0;\n\n      // Clip maskedSrc to same section of string as src (move to lexer?)\n      maskedSrc = maskedSrc.slice(-1 * src.length + lLength);\n\n      while ((match = endReg.exec(maskedSrc)) != null) {\n        rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];\n\n        if (!rDelim) continue; // skip single * in __abc*abc__\n\n        rLength = [...rDelim].length;\n\n        if (match[3] || match[4]) { // found another Left Delim\n          delimTotal += rLength;\n          continue;\n        } else if (match[5] || match[6]) { // either Left or Right Delim\n          if (lLength % 3 && !((lLength + rLength) % 3)) {\n            midDelimTotal += rLength;\n            continue; // CommonMark Emphasis Rules 9-10\n          }\n        }\n\n        delimTotal -= rLength;\n\n        if (delimTotal > 0) continue; // Haven't found enough closing delimiters\n\n        // Remove extra characters. *a*** -> *a*\n        rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);\n        // char length can be >1 for unicode characters;\n        const lastCharLength = [...match[0]][0].length;\n        const raw = src.slice(0, lLength + match.index + lastCharLength + rLength);\n\n        // Create `em` if smallest delimiter has odd char count. *a***\n        if (Math.min(lLength, rLength) % 2) {\n          const text = raw.slice(1, -1);\n          return {\n            type: 'em',\n            raw,\n            text,\n            tokens: this.lexer.inlineTokens(text),\n          };\n        }\n\n        // Create 'strong' if smallest delimiter has even char count. **a***\n        const text = raw.slice(2, -2);\n        return {\n          type: 'strong',\n          raw,\n          text,\n          tokens: this.lexer.inlineTokens(text),\n        };\n      }\n    }\n  }\n\n  codespan(src: string): Tokens.Codespan | undefined {\n    const cap = this.rules.inline.code.exec(src);\n    if (cap) {\n      let text = cap[2].replace(this.rules.other.newLineCharGlobal, ' ');\n      const hasNonSpaceChars = this.rules.other.nonSpaceChar.test(text);\n      const hasSpaceCharsOnBothEnds = this.rules.other.startingSpaceChar.test(text) && this.rules.other.endingSpaceChar.test(text);\n      if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n        text = text.substring(1, text.length - 1);\n      }\n      return {\n        type: 'codespan',\n        raw: cap[0],\n        text,\n      };\n    }\n  }\n\n  br(src: string): Tokens.Br | undefined {\n    const cap = this.rules.inline.br.exec(src);\n    if (cap) {\n      return {\n        type: 'br',\n        raw: cap[0],\n      };\n    }\n  }\n\n  del(src: string): Tokens.Del | undefined {\n    const cap = this.rules.inline.del.exec(src);\n    if (cap) {\n      return {\n        type: 'del',\n        raw: cap[0],\n        text: cap[2],\n        tokens: this.lexer.inlineTokens(cap[2]),\n      };\n    }\n  }\n\n  autolink(src: string): Tokens.Link | undefined {\n    const cap = this.rules.inline.autolink.exec(src);\n    if (cap) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[1];\n        href = 'mailto:' + text;\n      } else {\n        text = cap[1];\n        href = text;\n      }\n\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  url(src: string): Tokens.Link | undefined {\n    let cap;\n    if (cap = this.rules.inline.url.exec(src)) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[0];\n        href = 'mailto:' + text;\n      } else {\n        // do extended autolink path validation\n        let prevCapZero;\n        do {\n          prevCapZero = cap[0];\n          cap[0] = this.rules.inline._backpedal.exec(cap[0])?.[0] ?? '';\n        } while (prevCapZero !== cap[0]);\n        text = cap[0];\n        if (cap[1] === 'www.') {\n          href = 'http://' + cap[0];\n        } else {\n          href = cap[0];\n        }\n      }\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  inlineText(src: string): Tokens.Text | undefined {\n    const cap = this.rules.inline.text.exec(src);\n    if (cap) {\n      const escaped = this.lexer.state.inRawBlock;\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        escaped,\n      };\n    }\n  }\n}\n","import { _Tokenizer } from './Tokenizer';\nimport { _defaults } from './defaults';\nimport { other, block, inline } from './rules';\nimport type { Token, TokensList, Tokens } from './Tokens';\nimport type { MarkedOptions } from './MarkedOptions';\n\n/**\n * Block Lexer\n */\nexport class _Lexer {\n  tokens: TokensList;\n  options: MarkedOptions;\n  state: {\n    inLink: boolean;\n    inRawBlock: boolean;\n    top: boolean;\n  };\n\n  private tokenizer: _Tokenizer;\n  private inlineQueue: { src: string, tokens: Token[] }[];\n\n  constructor(options?: MarkedOptions) {\n    // TokenList cannot be created in one go\n    this.tokens = [] as unknown as TokensList;\n    this.tokens.links = Object.create(null);\n    this.options = options || _defaults;\n    this.options.tokenizer = this.options.tokenizer || new _Tokenizer();\n    this.tokenizer = this.options.tokenizer;\n    this.tokenizer.options = this.options;\n    this.tokenizer.lexer = this;\n    this.inlineQueue = [];\n    this.state = {\n      inLink: false,\n      inRawBlock: false,\n      top: true,\n    };\n\n    const rules = {\n      other,\n      block: block.normal,\n      inline: inline.normal,\n    };\n\n    if (this.options.pedantic) {\n      rules.block = block.pedantic;\n      rules.inline = inline.pedantic;\n    } else if (this.options.gfm) {\n      rules.block = block.gfm;\n      if (this.options.breaks) {\n        rules.inline = inline.breaks;\n      } else {\n        rules.inline = inline.gfm;\n      }\n    }\n    this.tokenizer.rules = rules;\n  }\n\n  /**\n   * Expose Rules\n   */\n  static get rules() {\n    return {\n      block,\n      inline,\n    };\n  }\n\n  /**\n   * Static Lex Method\n   */\n  static lex(src: string, options?: MarkedOptions) {\n    const lexer = new _Lexer(options);\n    return lexer.lex(src);\n  }\n\n  /**\n   * Static Lex Inline Method\n   */\n  static lexInline(src: string, options?: MarkedOptions) {\n    const lexer = new _Lexer(options);\n    return lexer.inlineTokens(src);\n  }\n\n  /**\n   * Preprocessing\n   */\n  lex(src: string) {\n    src = src.replace(other.carriageReturn, '\\n');\n\n    this.blockTokens(src, this.tokens);\n\n    for (let i = 0; i < this.inlineQueue.length; i++) {\n      const next = this.inlineQueue[i];\n      this.inlineTokens(next.src, next.tokens);\n    }\n    this.inlineQueue = [];\n\n    return this.tokens;\n  }\n\n  /**\n   * Lexing\n   */\n  blockTokens(src: string, tokens?: Token[], lastParagraphClipped?: boolean): Token[];\n  blockTokens(src: string, tokens?: TokensList, lastParagraphClipped?: boolean): TokensList;\n  blockTokens(src: string, tokens: Token[] = [], lastParagraphClipped = false) {\n    if (this.options.pedantic) {\n      src = src.replace(other.tabCharGlobal, '    ').replace(other.spaceLine, '');\n    }\n\n    while (src) {\n      let token: Tokens.Generic | undefined;\n\n      if (this.options.extensions?.block?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // newline\n      if (token = this.tokenizer.space(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.raw.length === 1 && lastToken !== undefined) {\n          // if there's a single \\n as a spacer, it's terminating the last line,\n          // so move it there so that we don't get unnecessary paragraph tags\n          lastToken.raw += '\\n';\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.code(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        // An indented code block cannot interrupt a paragraph.\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // fences\n      if (token = this.tokenizer.fences(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // heading\n      if (token = this.tokenizer.heading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // hr\n      if (token = this.tokenizer.hr(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // blockquote\n      if (token = this.tokenizer.blockquote(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // list\n      if (token = this.tokenizer.list(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // html\n      if (token = this.tokenizer.html(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // def\n      if (token = this.tokenizer.def(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.raw;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else if (!this.tokens.links[token.tag]) {\n          this.tokens.links[token.tag] = {\n            href: token.href,\n            title: token.title,\n          };\n        }\n        continue;\n      }\n\n      // table (gfm)\n      if (token = this.tokenizer.table(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // lheading\n      if (token = this.tokenizer.lheading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // top-level paragraph\n      // prevent paragraph consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startBlock) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startBlock.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {\n        const lastToken = tokens.at(-1);\n        if (lastParagraphClipped && lastToken?.type === 'paragraph') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        lastParagraphClipped = cutSrc.length !== src.length;\n        src = src.substring(token.raw.length);\n        continue;\n      }\n\n      // text\n      if (token = this.tokenizer.text(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    this.state.top = true;\n    return tokens;\n  }\n\n  inline(src: string, tokens: Token[] = []) {\n    this.inlineQueue.push({ src, tokens });\n    return tokens;\n  }\n\n  /**\n   * Lexing/Compiling\n   */\n  inlineTokens(src: string, tokens: Token[] = []): Token[] {\n    // String with links masked to avoid interference with em and strong\n    let maskedSrc = src;\n    let match: RegExpExecArray | null = null;\n\n    // Mask out reflinks\n    if (this.tokens.links) {\n      const links = Object.keys(this.tokens.links);\n      if (links.length > 0) {\n        while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n          if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {\n            maskedSrc = maskedSrc.slice(0, match.index)\n              + '[' + 'a'.repeat(match[0].length - 2) + ']'\n              + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n          }\n        }\n      }\n    }\n    // Mask out other blocks\n    while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '[' + 'a'.repeat(match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n    }\n\n    // Mask out escaped characters\n    while ((match = this.tokenizer.rules.inline.anyPunctuation.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '++' + maskedSrc.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);\n    }\n\n    let keepPrevChar = false;\n    let prevChar = '';\n    while (src) {\n      if (!keepPrevChar) {\n        prevChar = '';\n      }\n      keepPrevChar = false;\n\n      let token: Tokens.Generic | undefined;\n\n      // extensions\n      if (this.options.extensions?.inline?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // escape\n      if (token = this.tokenizer.escape(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // tag\n      if (token = this.tokenizer.tag(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // link\n      if (token = this.tokenizer.link(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // reflink, nolink\n      if (token = this.tokenizer.reflink(src, this.tokens.links)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.type === 'text' && lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // em & strong\n      if (token = this.tokenizer.emStrong(src, maskedSrc, prevChar)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.codespan(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // br\n      if (token = this.tokenizer.br(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // del (gfm)\n      if (token = this.tokenizer.del(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // autolink\n      if (token = this.tokenizer.autolink(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // url (gfm)\n      if (!this.state.inLink && (token = this.tokenizer.url(src))) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // text\n      // prevent inlineText consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startInline) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startInline.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (token = this.tokenizer.inlineText(cutSrc)) {\n        src = src.substring(token.raw.length);\n        if (token.raw.slice(-1) !== '_') { // Track prevChar before string of ____ started\n          prevChar = token.raw.slice(-1);\n        }\n        keepPrevChar = true;\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    return tokens;\n  }\n}\n","import { _defaults } from './defaults';\nimport {\n  cleanUrl,\n  escape,\n} from './helpers';\nimport { other } from './rules';\nimport type { MarkedOptions } from './MarkedOptions';\nimport type { Tokens } from './Tokens';\nimport type { _Parser } from './Parser';\n\n/**\n * Renderer\n */\nexport class _Renderer {\n  options: MarkedOptions;\n  parser!: _Parser; // set by the parser\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  space(token: Tokens.Space): string {\n    return '';\n  }\n\n  code({ text, lang, escaped }: Tokens.Code): string {\n    const langString = (lang || '').match(other.notSpaceStart)?.[0];\n\n    const code = text.replace(other.endingNewline, '') + '\\n';\n\n    if (!langString) {\n      return '<pre><code>'\n        + (escaped ? code : escape(code, true))\n        + '</code></pre>\\n';\n    }\n\n    return '<pre><code class=\"language-'\n      + escape(langString)\n      + '\">'\n      + (escaped ? code : escape(code, true))\n      + '</code></pre>\\n';\n  }\n\n  blockquote({ tokens }: Tokens.Blockquote): string {\n    const body = this.parser.parse(tokens);\n    return `<blockquote>\\n${body}</blockquote>\\n`;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag) : string {\n    return text;\n  }\n\n  heading({ tokens, depth }: Tokens.Heading): string {\n    return `<h${depth}>${this.parser.parseInline(tokens)}</h${depth}>\\n`;\n  }\n\n  hr(token: Tokens.Hr): string {\n    return '<hr>\\n';\n  }\n\n  list(token: Tokens.List): string {\n    const ordered = token.ordered;\n    const start = token.start;\n\n    let body = '';\n    for (let j = 0; j < token.items.length; j++) {\n      const item = token.items[j];\n      body += this.listitem(item);\n    }\n\n    const type = ordered ? 'ol' : 'ul';\n    const startAttr = (ordered && start !== 1) ? (' start=\"' + start + '\"') : '';\n    return '<' + type + startAttr + '>\\n' + body + '</' + type + '>\\n';\n  }\n\n  listitem(item: Tokens.ListItem): string {\n    let itemBody = '';\n    if (item.task) {\n      const checkbox = this.checkbox({ checked: !!item.checked });\n      if (item.loose) {\n        if (item.tokens[0]?.type === 'paragraph') {\n          item.tokens[0].text = checkbox + ' ' + item.tokens[0].text;\n          if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === 'text') {\n            item.tokens[0].tokens[0].text = checkbox + ' ' + escape(item.tokens[0].tokens[0].text);\n            item.tokens[0].tokens[0].escaped = true;\n          }\n        } else {\n          item.tokens.unshift({\n            type: 'text',\n            raw: checkbox + ' ',\n            text: checkbox + ' ',\n            escaped: true,\n          });\n        }\n      } else {\n        itemBody += checkbox + ' ';\n      }\n    }\n\n    itemBody += this.parser.parse(item.tokens, !!item.loose);\n\n    return `<li>${itemBody}</li>\\n`;\n  }\n\n  checkbox({ checked }: Tokens.Checkbox): string {\n    return '<input '\n      + (checked ? 'checked=\"\" ' : '')\n      + 'disabled=\"\" type=\"checkbox\">';\n  }\n\n  paragraph({ tokens }: Tokens.Paragraph): string {\n    return `<p>${this.parser.parseInline(tokens)}</p>\\n`;\n  }\n\n  table(token: Tokens.Table): string {\n    let header = '';\n\n    // header\n    let cell = '';\n    for (let j = 0; j < token.header.length; j++) {\n      cell += this.tablecell(token.header[j]);\n    }\n    header += this.tablerow({ text: cell });\n\n    let body = '';\n    for (let j = 0; j < token.rows.length; j++) {\n      const row = token.rows[j];\n\n      cell = '';\n      for (let k = 0; k < row.length; k++) {\n        cell += this.tablecell(row[k]);\n      }\n\n      body += this.tablerow({ text: cell });\n    }\n    if (body) body = `<tbody>${body}</tbody>`;\n\n    return '<table>\\n'\n      + '<thead>\\n'\n      + header\n      + '</thead>\\n'\n      + body\n      + '</table>\\n';\n  }\n\n  tablerow({ text }: Tokens.TableRow): string {\n    return `<tr>\\n${text}</tr>\\n`;\n  }\n\n  tablecell(token: Tokens.TableCell): string {\n    const content = this.parser.parseInline(token.tokens);\n    const type = token.header ? 'th' : 'td';\n    const tag = token.align\n      ? `<${type} align=\"${token.align}\">`\n      : `<${type}>`;\n    return tag + content + `</${type}>\\n`;\n  }\n\n  /**\n   * span level renderer\n   */\n  strong({ tokens }: Tokens.Strong): string {\n    return `<strong>${this.parser.parseInline(tokens)}</strong>`;\n  }\n\n  em({ tokens }: Tokens.Em): string {\n    return `<em>${this.parser.parseInline(tokens)}</em>`;\n  }\n\n  codespan({ text }: Tokens.Codespan): string {\n    return `<code>${escape(text, true)}</code>`;\n  }\n\n  br(token: Tokens.Br): string {\n    return '<br>';\n  }\n\n  del({ tokens }: Tokens.Del): string {\n    return `<del>${this.parser.parseInline(tokens)}</del>`;\n  }\n\n  link({ href, title, tokens }: Tokens.Link): string {\n    const text = this.parser.parseInline(tokens);\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return text;\n    }\n    href = cleanHref;\n    let out = '<a href=\"' + href + '\"';\n    if (title) {\n      out += ' title=\"' + (escape(title)) + '\"';\n    }\n    out += '>' + text + '</a>';\n    return out;\n  }\n\n  image({ href, title, text }: Tokens.Image): string {\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return escape(text);\n    }\n    href = cleanHref;\n\n    let out = `<img src=\"${href}\" alt=\"${text}\"`;\n    if (title) {\n      out += ` title=\"${escape(title)}\"`;\n    }\n    out += '>';\n    return out;\n  }\n\n  text(token: Tokens.Text | Tokens.Escape) : string {\n    return 'tokens' in token && token.tokens\n      ? this.parser.parseInline(token.tokens)\n      : ('escaped' in token && token.escaped ? token.text : escape(token.text));\n  }\n}\n","import type { Tokens } from './Tokens';\n\n/**\n * TextRenderer\n * returns only the textual part of the token\n */\nexport class _TextRenderer {\n  // no need for block level renderers\n  strong({ text }: Tokens.Strong) {\n    return text;\n  }\n\n  em({ text }: Tokens.Em) {\n    return text;\n  }\n\n  codespan({ text }: Tokens.Codespan) {\n    return text;\n  }\n\n  del({ text }: Tokens.Del) {\n    return text;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag) {\n    return text;\n  }\n\n  text({ text }: Tokens.Text | Tokens.Escape | Tokens.Tag) {\n    return text;\n  }\n\n  link({ text }: Tokens.Link) {\n    return '' + text;\n  }\n\n  image({ text }: Tokens.Image) {\n    return '' + text;\n  }\n\n  br() {\n    return '';\n  }\n}\n","import { _Renderer } from './Renderer';\nimport { _TextRenderer } from './TextRenderer';\nimport { _defaults } from './defaults';\nimport type { MarkedToken, Token, Tokens } from './Tokens';\nimport type { MarkedOptions } from './MarkedOptions';\n\n/**\n * Parsing & Compiling\n */\nexport class _Parser {\n  options: MarkedOptions;\n  renderer: _Renderer;\n  textRenderer: _TextRenderer;\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n    this.options.renderer = this.options.renderer || new _Renderer();\n    this.renderer = this.options.renderer;\n    this.renderer.options = this.options;\n    this.renderer.parser = this;\n    this.textRenderer = new _TextRenderer();\n  }\n\n  /**\n   * Static Parse Method\n   */\n  static parse(tokens: Token[], options?: MarkedOptions) {\n    const parser = new _Parser(options);\n    return parser.parse(tokens);\n  }\n\n  /**\n   * Static Parse Inline Method\n   */\n  static parseInline(tokens: Token[], options?: MarkedOptions) {\n    const parser = new _Parser(options);\n    return parser.parseInline(tokens);\n  }\n\n  /**\n   * Parse Loop\n   */\n  parse(tokens: Token[], top = true): string {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const genericToken = anyToken as Tokens.Generic;\n        const ret = this.options.extensions.renderers[genericToken.type].call({ parser: this }, genericToken);\n        if (ret !== false || !['space', 'hr', 'heading', 'code', 'table', 'blockquote', 'list', 'html', 'paragraph', 'text'].includes(genericToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'space': {\n          out += this.renderer.space(token);\n          continue;\n        }\n        case 'hr': {\n          out += this.renderer.hr(token);\n          continue;\n        }\n        case 'heading': {\n          out += this.renderer.heading(token);\n          continue;\n        }\n        case 'code': {\n          out += this.renderer.code(token);\n          continue;\n        }\n        case 'table': {\n          out += this.renderer.table(token);\n          continue;\n        }\n        case 'blockquote': {\n          out += this.renderer.blockquote(token);\n          continue;\n        }\n        case 'list': {\n          out += this.renderer.list(token);\n          continue;\n        }\n        case 'html': {\n          out += this.renderer.html(token);\n          continue;\n        }\n        case 'paragraph': {\n          out += this.renderer.paragraph(token);\n          continue;\n        }\n        case 'text': {\n          let textToken = token;\n          let body = this.renderer.text(textToken);\n          while (i + 1 < tokens.length && tokens[i + 1].type === 'text') {\n            textToken = tokens[++i] as Tokens.Text;\n            body += '\\n' + this.renderer.text(textToken);\n          }\n          if (top) {\n            out += this.renderer.paragraph({\n              type: 'paragraph',\n              raw: body,\n              text: body,\n              tokens: [{ type: 'text', raw: body, text: body, escaped: true }],\n            });\n          } else {\n            out += body;\n          }\n          continue;\n        }\n\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '';\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n\n    return out;\n  }\n\n  /**\n   * Parse Inline Tokens\n   */\n  parseInline(tokens: Token[], renderer: _Renderer | _TextRenderer = this.renderer): string {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const ret = this.options.extensions.renderers[anyToken.type].call({ parser: this }, anyToken);\n        if (ret !== false || !['escape', 'html', 'link', 'image', 'strong', 'em', 'codespan', 'br', 'del', 'text'].includes(anyToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'escape': {\n          out += renderer.text(token);\n          break;\n        }\n        case 'html': {\n          out += renderer.html(token);\n          break;\n        }\n        case 'link': {\n          out += renderer.link(token);\n          break;\n        }\n        case 'image': {\n          out += renderer.image(token);\n          break;\n        }\n        case 'strong': {\n          out += renderer.strong(token);\n          break;\n        }\n        case 'em': {\n          out += renderer.em(token);\n          break;\n        }\n        case 'codespan': {\n          out += renderer.codespan(token);\n          break;\n        }\n        case 'br': {\n          out += renderer.br(token);\n          break;\n        }\n        case 'del': {\n          out += renderer.del(token);\n          break;\n        }\n        case 'text': {\n          out += renderer.text(token);\n          break;\n        }\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '';\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n    return out;\n  }\n}\n","import { _defaults } from './defaults';\nimport { _Lexer } from './Lexer';\nimport { _Parser } from './Parser';\nimport type { MarkedOptions } from './MarkedOptions';\nimport type { Token, TokensList } from './Tokens';\n\nexport class _Hooks {\n  options: MarkedOptions;\n  block?: boolean;\n\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  static passThroughHooks = new Set([\n    'preprocess',\n    'postprocess',\n    'processAllTokens',\n  ]);\n\n  /**\n   * Process markdown before marked\n   */\n  preprocess(markdown: string) {\n    return markdown;\n  }\n\n  /**\n   * Process HTML after marked is finished\n   */\n  postprocess(html: string) {\n    return html;\n  }\n\n  /**\n   * Process all tokens before walk tokens\n   */\n  processAllTokens(tokens: Token[] | TokensList) {\n    return tokens;\n  }\n\n  /**\n   * Provide function to tokenize markdown\n   */\n  provideLexer() {\n    return this.block ? _Lexer.lex : _Lexer.lexInline;\n  }\n\n  /**\n   * Provide function to parse tokens\n   */\n  provideParser() {\n    return this.block ? _Parser.parse : _Parser.parseInline;\n  }\n}\n","import { _Lexer } from './Lexer';\nimport { _Parser } from './Parser';\nimport { _Tokenizer } from './Tokenizer';\nimport { _Renderer } from './Renderer';\nimport { _TextRenderer } from './TextRenderer';\nimport { _Hooks } from './Hooks';\nimport { Marked } from './Instance';\nimport {\n  _getDefaults,\n  changeDefaults,\n  _defaults,\n} from './defaults';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions';\nimport type { Token, TokensList } from './Tokens';\nimport type { MaybePromise } from './Instance';\n\nconst markedInstance = new Marked();\n\n/**\n * Compiles markdown to HTML asynchronously.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options, having async: true\n * @return Promise of string of compiled HTML\n */\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\n\n/**\n * Compiles markdown to HTML.\n *\n * @param src String of markdown source to be compiled\n * @param options Optional hash of options\n * @return String of compiled HTML. Will be a Promise of string if async is set to true by any extensions.\n */\nexport function marked(src: string, options: MarkedOptions & { async: false }): string;\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\nexport function marked(src: string, options?: MarkedOptions | null): string | Promise<string>;\nexport function marked(src: string, opt?: MarkedOptions | null): string | Promise<string> {\n  return markedInstance.parse(src, opt);\n}\n\n/**\n * Sets the default options.\n *\n * @param options Hash of options\n */\nmarked.options =\nmarked.setOptions = function(options: MarkedOptions) {\n  markedInstance.setOptions(options);\n  marked.defaults = markedInstance.defaults;\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\n/**\n * Gets the original marked default options.\n */\nmarked.getDefaults = _getDefaults;\n\nmarked.defaults = _defaults;\n\n/**\n * Use Extension\n */\n\nmarked.use = function(...args: MarkedExtension[]) {\n  markedInstance.use(...args);\n  marked.defaults = markedInstance.defaults;\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\n/**\n * Run callback for every token\n */\n\nmarked.walkTokens = function(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n  return markedInstance.walkTokens(tokens, callback);\n};\n\n/**\n * Compiles markdown to HTML without enclosing `p` tag.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options\n * @return String of compiled HTML\n */\nmarked.parseInline = markedInstance.parseInline;\n\n/**\n * Expose\n */\nmarked.Parser = _Parser;\nmarked.parser = _Parser.parse;\nmarked.Renderer = _Renderer;\nmarked.TextRenderer = _TextRenderer;\nmarked.Lexer = _Lexer;\nmarked.lexer = _Lexer.lex;\nmarked.Tokenizer = _Tokenizer;\nmarked.Hooks = _Hooks;\nmarked.parse = marked;\n\nexport const options = marked.options;\nexport const setOptions = marked.setOptions;\nexport const use = marked.use;\nexport const walkTokens = marked.walkTokens;\nexport const parseInline = marked.parseInline;\nexport const parse = marked;\nexport const parser = _Parser.parse;\nexport const lexer = _Lexer.lex;\nexport { _defaults as defaults, _getDefaults as getDefaults } from './defaults';\nexport { _Lexer as Lexer } from './Lexer';\nexport { _Parser as Parser } from './Parser';\nexport { _Tokenizer as Tokenizer } from './Tokenizer';\nexport { _Renderer as Renderer } from './Renderer';\nexport { _TextRenderer as TextRenderer } from './TextRenderer';\nexport { _Hooks as Hooks } from './Hooks';\nexport { Marked } from './Instance';\nexport type * from './MarkedOptions';\nexport type * from './Tokens';\n","import { _getDefaults } from './defaults';\nimport { _Lexer } from './Lexer';\nimport { _Parser } from './Parser';\nimport { _Hooks } from './Hooks';\nimport { _Renderer } from './Renderer';\nimport { _Tokenizer } from './Tokenizer';\nimport { _TextRenderer } from './TextRenderer';\nimport { escape } from './helpers';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions';\nimport type { Token, Tokens, TokensList } from './Tokens';\n\nexport type MaybePromise = void | Promise<void>;\n\ntype UnknownFunction = (...args: unknown[]) => unknown;\ntype GenericRendererFunction = (...args: unknown[]) => string | false;\n\nexport class Marked {\n  defaults = _getDefaults();\n  options = this.setOptions;\n\n  parse = this.parseMarkdown(true);\n  parseInline = this.parseMarkdown(false);\n\n  Parser = _Parser;\n  Renderer = _Renderer;\n  TextRenderer = _TextRenderer;\n  Lexer = _Lexer;\n  Tokenizer = _Tokenizer;\n  Hooks = _Hooks;\n\n  constructor(...args: MarkedExtension[]) {\n    this.use(...args);\n  }\n\n  /**\n   * Run callback for every token\n   */\n  walkTokens(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n    let values: MaybePromise[] = [];\n    for (const token of tokens) {\n      values = values.concat(callback.call(this, token));\n      switch (token.type) {\n        case 'table': {\n          const tableToken = token as Tokens.Table;\n          for (const cell of tableToken.header) {\n            values = values.concat(this.walkTokens(cell.tokens, callback));\n          }\n          for (const row of tableToken.rows) {\n            for (const cell of row) {\n              values = values.concat(this.walkTokens(cell.tokens, callback));\n            }\n          }\n          break;\n        }\n        case 'list': {\n          const listToken = token as Tokens.List;\n          values = values.concat(this.walkTokens(listToken.items, callback));\n          break;\n        }\n        default: {\n          const genericToken = token as Tokens.Generic;\n          if (this.defaults.extensions?.childTokens?.[genericToken.type]) {\n            this.defaults.extensions.childTokens[genericToken.type].forEach((childTokens) => {\n              const tokens = genericToken[childTokens].flat(Infinity) as Token[] | TokensList;\n              values = values.concat(this.walkTokens(tokens, callback));\n            });\n          } else if (genericToken.tokens) {\n            values = values.concat(this.walkTokens(genericToken.tokens, callback));\n          }\n        }\n      }\n    }\n    return values;\n  }\n\n  use(...args: MarkedExtension[]) {\n    const extensions: MarkedOptions['extensions'] = this.defaults.extensions || { renderers: {}, childTokens: {} };\n\n    args.forEach((pack) => {\n      // copy options to new object\n      const opts = { ...pack } as MarkedOptions;\n\n      // set async to true if it was set to true before\n      opts.async = this.defaults.async || opts.async || false;\n\n      // ==-- Parse \"addon\" extensions --== //\n      if (pack.extensions) {\n        pack.extensions.forEach((ext) => {\n          if (!ext.name) {\n            throw new Error('extension name required');\n          }\n          if ('renderer' in ext) { // Renderer extensions\n            const prevRenderer = extensions.renderers[ext.name];\n            if (prevRenderer) {\n              // Replace extension with func to run new extension but fall back if false\n              extensions.renderers[ext.name] = function(...args) {\n                let ret = ext.renderer.apply(this, args);\n                if (ret === false) {\n                  ret = prevRenderer.apply(this, args);\n                }\n                return ret;\n              };\n            } else {\n              extensions.renderers[ext.name] = ext.renderer;\n            }\n          }\n          if ('tokenizer' in ext) { // Tokenizer Extensions\n            if (!ext.level || (ext.level !== 'block' && ext.level !== 'inline')) {\n              throw new Error(\"extension level must be 'block' or 'inline'\");\n            }\n            const extLevel = extensions[ext.level];\n            if (extLevel) {\n              extLevel.unshift(ext.tokenizer);\n            } else {\n              extensions[ext.level] = [ext.tokenizer];\n            }\n            if (ext.start) { // Function to check for start of token\n              if (ext.level === 'block') {\n                if (extensions.startBlock) {\n                  extensions.startBlock.push(ext.start);\n                } else {\n                  extensions.startBlock = [ext.start];\n                }\n              } else if (ext.level === 'inline') {\n                if (extensions.startInline) {\n                  extensions.startInline.push(ext.start);\n                } else {\n                  extensions.startInline = [ext.start];\n                }\n              }\n            }\n          }\n          if ('childTokens' in ext && ext.childTokens) { // Child tokens to be visited by walkTokens\n            extensions.childTokens[ext.name] = ext.childTokens;\n          }\n        });\n        opts.extensions = extensions;\n      }\n\n      // ==-- Parse \"overwrite\" extensions --== //\n      if (pack.renderer) {\n        const renderer = this.defaults.renderer || new _Renderer(this.defaults);\n        for (const prop in pack.renderer) {\n          if (!(prop in renderer)) {\n            throw new Error(`renderer '${prop}' does not exist`);\n          }\n          if (['options', 'parser'].includes(prop)) {\n            // ignore options property\n            continue;\n          }\n          const rendererProp = prop as Exclude<keyof _Renderer, 'options' | 'parser'>;\n          const rendererFunc = pack.renderer[rendererProp] as GenericRendererFunction;\n          const prevRenderer = renderer[rendererProp] as GenericRendererFunction;\n          // Replace renderer with func to run extension, but fall back if false\n          renderer[rendererProp] = (...args: unknown[]) => {\n            let ret = rendererFunc.apply(renderer, args);\n            if (ret === false) {\n              ret = prevRenderer.apply(renderer, args);\n            }\n            return ret || '';\n          };\n        }\n        opts.renderer = renderer;\n      }\n      if (pack.tokenizer) {\n        const tokenizer = this.defaults.tokenizer || new _Tokenizer(this.defaults);\n        for (const prop in pack.tokenizer) {\n          if (!(prop in tokenizer)) {\n            throw new Error(`tokenizer '${prop}' does not exist`);\n          }\n          if (['options', 'rules', 'lexer'].includes(prop)) {\n            // ignore options, rules, and lexer properties\n            continue;\n          }\n          const tokenizerProp = prop as Exclude<keyof _Tokenizer, 'options' | 'rules' | 'lexer'>;\n          const tokenizerFunc = pack.tokenizer[tokenizerProp] as UnknownFunction;\n          const prevTokenizer = tokenizer[tokenizerProp] as UnknownFunction;\n          // Replace tokenizer with func to run extension, but fall back if false\n          // @ts-expect-error cannot type tokenizer function dynamically\n          tokenizer[tokenizerProp] = (...args: unknown[]) => {\n            let ret = tokenizerFunc.apply(tokenizer, args);\n            if (ret === false) {\n              ret = prevTokenizer.apply(tokenizer, args);\n            }\n            return ret;\n          };\n        }\n        opts.tokenizer = tokenizer;\n      }\n\n      // ==-- Parse Hooks extensions --== //\n      if (pack.hooks) {\n        const hooks = this.defaults.hooks || new _Hooks();\n        for (const prop in pack.hooks) {\n          if (!(prop in hooks)) {\n            throw new Error(`hook '${prop}' does not exist`);\n          }\n          if (['options', 'block'].includes(prop)) {\n            // ignore options and block properties\n            continue;\n          }\n          const hooksProp = prop as Exclude<keyof _Hooks, 'options' | 'block'>;\n          const hooksFunc = pack.hooks[hooksProp] as UnknownFunction;\n          const prevHook = hooks[hooksProp] as UnknownFunction;\n          if (_Hooks.passThroughHooks.has(prop)) {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (arg: unknown) => {\n              if (this.defaults.async) {\n                return Promise.resolve(hooksFunc.call(hooks, arg)).then(ret => {\n                  return prevHook.call(hooks, ret);\n                });\n              }\n\n              const ret = hooksFunc.call(hooks, arg);\n              return prevHook.call(hooks, ret);\n            };\n          } else {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (...args: unknown[]) => {\n              let ret = hooksFunc.apply(hooks, args);\n              if (ret === false) {\n                ret = prevHook.apply(hooks, args);\n              }\n              return ret;\n            };\n          }\n        }\n        opts.hooks = hooks;\n      }\n\n      // ==-- Parse WalkTokens extensions --== //\n      if (pack.walkTokens) {\n        const walkTokens = this.defaults.walkTokens;\n        const packWalktokens = pack.walkTokens;\n        opts.walkTokens = function(token) {\n          let values: MaybePromise[] = [];\n          values.push(packWalktokens.call(this, token));\n          if (walkTokens) {\n            values = values.concat(walkTokens.call(this, token));\n          }\n          return values;\n        };\n      }\n\n      this.defaults = { ...this.defaults, ...opts };\n    });\n\n    return this;\n  }\n\n  setOptions(opt: MarkedOptions) {\n    this.defaults = { ...this.defaults, ...opt };\n    return this;\n  }\n\n  lexer(src: string, options?: MarkedOptions) {\n    return _Lexer.lex(src, options ?? this.defaults);\n  }\n\n  parser(tokens: Token[], options?: MarkedOptions) {\n    return _Parser.parse(tokens, options ?? this.defaults);\n  }\n\n  private parseMarkdown(blockType: boolean) {\n    type overloadedParse = {\n      (src: string, options: MarkedOptions & { async: true }): Promise<string>;\n      (src: string, options: MarkedOptions & { async: false }): string;\n      (src: string, options?: MarkedOptions | null): string | Promise<string>;\n    };\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parse: overloadedParse = (src: string, options?: MarkedOptions | null): any => {\n      const origOpt = { ...options };\n      const opt = { ...this.defaults, ...origOpt };\n\n      const throwError = this.onError(!!opt.silent, !!opt.async);\n\n      // throw error if an extension set async to true but parse was called with async: false\n      if (this.defaults.async === true && origOpt.async === false) {\n        return throwError(new Error('marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise.'));\n      }\n\n      // throw error in case of non string input\n      if (typeof src === 'undefined' || src === null) {\n        return throwError(new Error('marked(): input parameter is undefined or null'));\n      }\n      if (typeof src !== 'string') {\n        return throwError(new Error('marked(): input parameter is of type '\n          + Object.prototype.toString.call(src) + ', string expected'));\n      }\n\n      if (opt.hooks) {\n        opt.hooks.options = opt;\n        opt.hooks.block = blockType;\n      }\n\n      const lexer = opt.hooks ? opt.hooks.provideLexer() : (blockType ? _Lexer.lex : _Lexer.lexInline);\n      const parser = opt.hooks ? opt.hooks.provideParser() : (blockType ? _Parser.parse : _Parser.parseInline);\n\n      if (opt.async) {\n        return Promise.resolve(opt.hooks ? opt.hooks.preprocess(src) : src)\n          .then(src => lexer(src, opt))\n          .then(tokens => opt.hooks ? opt.hooks.processAllTokens(tokens) : tokens)\n          .then(tokens => opt.walkTokens ? Promise.all(this.walkTokens(tokens, opt.walkTokens)).then(() => tokens) : tokens)\n          .then(tokens => parser(tokens, opt))\n          .then(html => opt.hooks ? opt.hooks.postprocess(html) : html)\n          .catch(throwError);\n      }\n\n      try {\n        if (opt.hooks) {\n          src = opt.hooks.preprocess(src) as string;\n        }\n        let tokens = lexer(src, opt);\n        if (opt.hooks) {\n          tokens = opt.hooks.processAllTokens(tokens);\n        }\n        if (opt.walkTokens) {\n          this.walkTokens(tokens, opt.walkTokens);\n        }\n        let html = parser(tokens, opt);\n        if (opt.hooks) {\n          html = opt.hooks.postprocess(html) as string;\n        }\n        return html;\n      } catch (e) {\n        return throwError(e as Error);\n      }\n    };\n\n    return parse;\n  }\n\n  private onError(silent: boolean, async: boolean) {\n    return (e: Error): string | Promise<string> => {\n      if (silent) {\n        const msg = '<p>An error occurred:</p><pre>'\n          + escape(e.message + '', true)\n          + '</pre>';\n        if (async) {\n          return Promise.resolve(msg);\n        }\n        return msg;\n      }\n\n      if (async) {\n        return Promise.reject(e);\n      }\n      throw e;\n    };\n  }\n}\n","import { isMarkdownMarker } from \".\";\nimport { ApiFormattedText, ApiMessageEntity, ApiMessageEntityTypes } from \"../../api/types\";\nimport { getBlockQuoteInnerText as extractBlockQuoteData } from \"../../components/common/Blockquote\";\nimport { extractCodeBlockData } from \"../../components/common/code/CodeBlock\";\nimport { getEntityTypeFromNode } from \"../../util/parseHtmlAsFormattedText\";\nimport { rtrim } from \"./lib/marked/helpers\";\nimport { marked, Token as _Token } from \"./lib/marked/marked\";\n\n// TelegramTokenTypes Examples and Platforms\n// Bold = **bold**              // Platforms: Markdown, TDesktop, TWeb\n// Italic = *italic*            // Platforms: Markdown\n// Spoiler = ||spoiler||        // Platforms: TMarkdown2, TDesktop, TWeb\n// Underline = __underline__    // Platforms:\n// Strike = ~~strikethrough~~   // Platforms: GFM, TDesktop, TWeb\n// Code = `inline code`         // Platforms: Markdown, TMarkdown2, TDesktop, TWeb\n// Pre = ```code block```       // Platforms: Markdown, TMarkdown2, TDesktop, TWeb\n// Blockquote = > quotation     // Platforms: Markdown\n\nexport namespace MarkedJS {\n  enum OrgTokenType {\n    space = 'space',             // Whitespace\n    code = 'code',               // Inline code: `code`\n    heading = 'heading',         // Headings: #, ##, ###, etc.\n    table = 'table',             // Tables\n    hr = 'hr',                   // Horizontal rule: ---, ***, ___\n    blockquote = 'blockquote',   // Blockquote: >\n    list = 'list',               // Ordered or unordered lists\n    list_item = 'list_item',     // List item\n    paragraph = 'paragraph',     // Paragraph of text\n    strong = 'strong',           // Bold: **bold** or __bold__\n    em = 'em',                   // Italic: *italic* or _italic_\n    codespan = 'codespan',       // Inline code: `code`\n    br = 'br',                   // Line break\n    del = 'del',                 // Strikethrough: ~~strikethrough~~\n    link = 'link',               // Link: [text](url)\n    image = 'image',             // Image: ![alt](url)\n    text = 'text',               // Plain text\n    escape = 'escape',           // Escaped characters: \\*\n    tag = 'tag',                 // HTML tags\n    html = 'html',               // Raw HTML blocks\n    def = 'def',                 // Link definition: [id]: url \"title\"\n    checkbox = 'checkbox',       // Task list checkbox: [x] or [ ]\n    listItem = 'listItem',       // List item (duplicate key for consistency)\n    tableCell = 'tableCell',     // Table cell\n    tableRow = 'tableRow',       // Table row\n  }\n\n  enum ExtraTokenType {\n    spoiler = 'spoiler',\n    underline = 'underline',\n    tblockquote = \"tblockquote\" // ? MarkedJS doesnt support html tags inside BlockQuote\n  }\n\n  export const TokenType = { ...OrgTokenType, ...ExtraTokenType };\n\n  export type TokenType = OrgTokenType | ExtraTokenType;\n\n  export type Token = _Token;\n\n  const markedLexer = new marked.Lexer();\n  marked.use({\n    breaks: true,\n    gfm: true,\n    extensions: [\n      {\n        level: 'inline',\n        name: ExtraTokenType.spoiler,\n        start: (src) => src.indexOf(\"||\"),\n        tokenizer: (src) => {\n          const cap = /^(\\|\\|?)(?=[^\\s|])((?:\\\\.|[^\\\\])*?(?:\\\\.|[^\\s|\\\\]))\\1(?=[^|]|$)/.exec(src);\n          if (cap) {\n            return {\n              type: ExtraTokenType.spoiler,\n              raw: cap[0],\n              text: cap[2],\n              tokens: markedLexer.inlineTokens(cap[2]),\n            };\n          }\n        }\n      },\n      {\n        level: 'inline',\n        name: ExtraTokenType.underline,\n        start: (src) => src.indexOf(\"__\"),\n        tokenizer: (src) => {\n          const cap = /^(__?)(?=[^\\s_])((?:\\\\.|[^\\\\])*?(?:\\\\.|[^\\s_\\\\]))\\1(?=[^_]|$)/.exec(src);\n          if (cap) {\n            return {\n              type: ExtraTokenType.underline,\n              raw: cap[0],\n              text: cap[2],\n              tokens: markedLexer.inlineTokens(cap[2]),\n            };\n          }\n        }\n      }\n    ],\n    renderer: {},\n    tokenizer: {\n      // ? Block level tokenizers\n      code: src => undefined,\n      heading: src => undefined,\n      hr: src => undefined,\n      list: src => undefined,\n      html: src => undefined,\n      def: src => undefined,\n      table: src => undefined,\n      lheading: src => undefined,\n      // ? Inline level tokenizers\n      reflink: (src, links) => undefined,\n      autolink: (src) => undefined,\n    }\n  });\n\n  export function tokenizer(src: string) {\n    return marked.lexer(src);\n  }\n\n  /**\n * Recursively checks whether two token arrays have the same structure.\n * It compares only the `type` property and the structure of any nested tokens.\n */\n  function isStructureEqual(tokens1: _Token[], tokens2: _Token[]): boolean {\n    // Different lengths means the structure has changed\n    if (tokens1.length !== tokens2.length) {\n      return false;\n    }\n\n    // Compare each token in order\n    for (let i = 0; i < tokens1.length; i++) {\n      const token1 = tokens1[i];\n      const token2 = tokens2[i];\n\n      // Check if the token types are the same\n      if (token1.type !== token2.type) {\n        return false;\n      }\n\n      // Check if both tokens have a 'tokens' property.\n      const token1HasChildren = 'tokens' in token1;\n      const token2HasChildren = 'tokens' in token2;\n      if (token1HasChildren !== token2HasChildren) {\n        return false;\n      }\n\n      // If the token has children, check them recursively.\n      if (token1HasChildren && token2HasChildren) {\n        const children1 = token1.tokens || [];\n        const children2 = token2.tokens || [];\n        if (!isStructureEqual(children1, children2)) {\n          return false;\n        }\n      }\n    }\n\n    // All tokens match structurally.\n    return true;\n  }\n\n\n  /**\n    * Returns true if the AST structure has changed.\n    * In other words, it returns true if the two token arrays do NOT have the same structure.\n    */\n  export function hasStructureChanged(oldTokens: Token[], newTokens: Token[]): boolean {\n    return !isStructureEqual(oldTokens, newTokens);\n  }\n}\n\nexport const MarkdownEditorUtils = {\n  AUTO_INSERT_CHARS: {\n    \"*\": { eachSide: 1 },\n    \"_\": { eachSide: 2 },\n    \"~\": { eachSide: 2 },\n    \"|\": { eachSide: 2 },\n    \"`\": { eachSide: 1 },\n  } as { [key: string]: { eachSide: number } },\n\n  INLINE_MARKERS: {\n    [ApiMessageEntityTypes.Bold]: \"**\",\n    [ApiMessageEntityTypes.Italic]: \"*\",\n    [ApiMessageEntityTypes.Underline]: \"__\",\n    [ApiMessageEntityTypes.Strike]: \"~~\",\n    [ApiMessageEntityTypes.Spoiler]: \"||\",\n    [ApiMessageEntityTypes.Code]: \"`\",\n  } as { [key in ApiMessageEntityTypes]: string },\n\n  BLOCK_MARKERS: {\n    [ApiMessageEntityTypes.Pre]: \"```\",\n    [ApiMessageEntityTypes.Blockquote]: \">\",\n  } as { [key in ApiMessageEntityTypes]: string },\n\n  getInlineMarkerByType(type: ApiMessageEntityTypes): string | null {\n    return this.INLINE_MARKERS[type] || null;\n  },\n\n  getBlockMarkerByType(type: ApiMessageEntityTypes): string | null {\n    return this.BLOCK_MARKERS[type] || null;\n  },\n\n  getMarkerByType(type: ApiMessageEntityTypes): string | null {\n    return this.INLINE_MARKERS[type] || this.BLOCK_MARKERS[type] || null;\n  },\n};\n\nexport namespace TokenHelper {\n  function getEntityFromToken(token: MarkedJS.Token, startOffset: number, length: number): ApiMessageEntity | undefined {\n    switch (token.type) {\n      case MarkedJS.TokenType.strong:\n        return { type: ApiMessageEntityTypes.Bold, offset: startOffset, length };\n      case MarkedJS.TokenType.spoiler:\n        return { type: ApiMessageEntityTypes.Spoiler, offset: startOffset, length };\n      case MarkedJS.TokenType.em:\n        return { type: ApiMessageEntityTypes.Italic, offset: startOffset, length };\n      case MarkedJS.TokenType.underline:\n        return { type: ApiMessageEntityTypes.Underline, offset: startOffset, length };\n      case MarkedJS.TokenType.del:\n        return { type: ApiMessageEntityTypes.Strike, offset: startOffset, length };\n      case MarkedJS.TokenType.codespan:\n        return { type: ApiMessageEntityTypes.Code, offset: startOffset, length };\n      case MarkedJS.TokenType.code:\n        return { type: ApiMessageEntityTypes.Pre, offset: startOffset, length, language: token.lang || undefined };\n      case MarkedJS.TokenType.link:\n        if (token.href) {\n          return { type: ApiMessageEntityTypes.TextUrl, offset: startOffset, length, url: token.href };\n        }\n        return undefined;\n      case MarkedJS.TokenType.blockquote:\n      case MarkedJS.TokenType.tblockquote:\n        return { type: ApiMessageEntityTypes.Blockquote, offset: startOffset, length };\n      default:\n        return undefined;\n    }\n  }\n\n  export function htmlToMarkdown(htmlNode: Node): string {\n    // ? Shared context prevents exponential string growth, avoiding RangeError.\n    const context: { markdown: string; lastNodeEntityType?: ApiMessageEntityTypes } = { markdown: \"\" };\n\n    function addNewlineIfNeeded() {\n      if (!context.markdown.endsWith(\"\\n\") && context.markdown !== \"\") {\n        context.markdown += \"\\n\";\n      }\n    }\n\n    function processChildsNodes(node: ChildNode) {\n      if (node.hasChildNodes()) {\n        for (const child of node.childNodes) {\n          processNode(child);\n        }\n      }\n    }\n\n    function addToMarkdown(newMarkdown: string) {\n      // ? There must be at least one \\n before and after block level entities\n      if (context.lastNodeEntityType === ApiMessageEntityTypes.Blockquote || context.lastNodeEntityType === ApiMessageEntityTypes.Pre) {\n        if (context.markdown !== \"\") {\n          // ! we dont need to check this because \\n will get removed in the renderTextWithEntities\n          // !newMarkdown.startsWith(\"\\n\") &&\n          context.markdown += \"\\n\";\n        }\n      }\n      context.markdown += newMarkdown;\n    }\n\n    function processNode(node: Node) {\n      if (node.nodeType === Node.ELEMENT_NODE && node.nodeName.toLowerCase() === 'br') {\n        addToMarkdown(\"\\n\");\n        context.lastNodeEntityType = undefined;\n      }\n      else if (node.nodeType === Node.TEXT_NODE) {\n        addToMarkdown(node.textContent || '');\n        context.lastNodeEntityType = undefined;\n      }\n      // For image emoji\n      else if (node instanceof HTMLImageElement && node.dataset.isEmoji === \"true\") {\n        addToMarkdown(node.alt);\n        context.lastNodeEntityType = undefined;\n      }\n      else if (node instanceof Element) {\n        const type = getEntityTypeFromNode(node);\n        switch (type) {\n          // * Inline Markdown Entities: just process children. (markdown markers applied in rendering)\n          case ApiMessageEntityTypes.Bold:\n          case ApiMessageEntityTypes.Italic:\n          case ApiMessageEntityTypes.Strike:\n          case ApiMessageEntityTypes.Code:\n          case ApiMessageEntityTypes.Spoiler:\n            processChildsNodes(node);\n            break;\n          // * Block Level Markdown Entities: ensure a newline before and after.\n          case ApiMessageEntityTypes.Pre: {\n            addNewlineIfNeeded();\n            const cb = extractCodeBlockData(node);\n            if (!cb) throw new Error(\"Failed to extract code block.\");\n            // ? Footer or header coudl get removed by Backspace, so we check to replacing them with ''\n            addToMarkdown(`${cb.startMarker??''}${cb.language}\\n${cb.codeContent}\\n${cb.endMarker??''}`);\n            break;\n          }\n          case ApiMessageEntityTypes.Blockquote: {\n            addNewlineIfNeeded();\n            // const quoteContent = getTextContentWithBreaks(node, {\n            //   skipMarkdownMarker: false\n            // });\n            // const formattedQuote = quoteContent\n            //   .split('\\n')\n            //   .map(line => '> ' + line)\n            //   .join('\\n');\n            // addToMarkdown(formattedQuote);\n            const startTag = node.outerHTML.split('>')[0] + '>';\n            const endTag = \"</span>\";\n            addToMarkdown(startTag);\n            context.lastNodeEntityType = undefined;\n            processChildsNodes(node);\n            addToMarkdown(endTag);\n            break;\n          }\n          // * Telegram entities without markdown support.\n          case ApiMessageEntityTypes.Mention:\n          case ApiMessageEntityTypes.TextUrl:\n          case ApiMessageEntityTypes.Url:\n          case ApiMessageEntityTypes.Cashtag:\n          case ApiMessageEntityTypes.Hashtag:\n            addToMarkdown(node.outerHTML);\n            break;\n          case ApiMessageEntityTypes.CustomEmoji: {\n            const startTag = node.outerHTML.split('>')[0] + '>';\n            const emoji = (node as HTMLImageElement).alt || node.getAttribute('data-alt') || '';\n            const endTag = node instanceof HTMLImageElement ? '</img>' : '</div>';\n            addToMarkdown(startTag + emoji + endTag);\n            break;\n          }\n          default:\n            processChildsNodes(node);\n        }\n        context.lastNodeEntityType = type;\n      }\n    }\n\n    processNode(htmlNode);\n    return context.markdown;\n  }\n\n  export function tokensToFormattedText(tokens: MarkedJS.Token[]): ApiFormattedText {\n    function processTokens(\n      tokens: MarkedJS.Token[],\n      currentOffset: number,\n      pendingEntities: { startOffset: number; type?: ApiMessageEntityTypes; href?: string; documentId?: string; language?: string }[]\n    ): { text: string; entities: ApiMessageEntity[]; offset: number } {\n      let localText = \"\", localOffset = currentOffset;\n      let localEntities: ApiMessageEntity[] = [];\n\n      for (const token of tokens) {\n        const startOffset = localOffset;\n        let entity: ApiMessageEntity | undefined;\n        let tokenText = \"\";\n        let childTexts = \"\";\n        let childEntities: ApiMessageEntity[] = [];\n\n        switch (token.type) {\n          case MarkedJS.TokenType.text:\n          case MarkedJS.TokenType.codespan:\n          case MarkedJS.TokenType.strong:\n          case MarkedJS.TokenType.em:\n          case MarkedJS.TokenType.del:\n          case MarkedJS.TokenType.link:\n          case MarkedJS.TokenType.underline:\n          case MarkedJS.TokenType.spoiler:\n          case MarkedJS.TokenType.blockquote:\n          case MarkedJS.TokenType.tblockquote:\n            tokenText = token.text;\n            break;\n          case MarkedJS.TokenType.code:\n            tokenText = token.text;\n            break;\n          case MarkedJS.TokenType.escape:\n          case MarkedJS.TokenType.space:\n          case MarkedJS.TokenType.br:\n            tokenText = token.raw;\n            break;\n          case MarkedJS.TokenType.html:\n            entity = getEntityFromHtmlToken(token, { localOffset, startOffset, pendingEntities });\n            break;\n          case MarkedJS.TokenType.paragraph:\n            // ? Skip paragraph for it childrens\n            break;\n          default:\n            tokenText = token.raw;\n            break;\n        }\n        if ('tokens' in token && token.tokens && token.tokens.length) {\n          const processed = processTokens(token.tokens, localOffset, pendingEntities);\n          childEntities.push(...processed.entities);\n          childTexts = processed.text;\n        }\n\n        if (!entity) entity = getEntityFromToken(token, startOffset, childTexts.length || tokenText.length);\n        if (entity) localEntities.push(entity);\n\n        localText += (childTexts || tokenText);\n        localOffset += (childTexts || tokenText).length;\n        localEntities.push(...childEntities);\n      }\n\n      return {\n        text: localText,\n        entities: localEntities,\n        offset: localOffset,\n      };\n    }\n\n    let { text, entities } = processTokens(tokens, 0, []);\n    // ? First We should add Parent Entity then child entities because ordering in nested entities important for renderTextWithEntities\n    entities = entities.sort((a, b) => a.offset - b.offset);\n    return { text, entities };\n  }\n\n  function getEntityFromHtmlToken(token: MarkedJS.Token, options: {\n    pendingEntities: Array<{\n      type?: ApiMessageEntityTypes; startOffset: number;\n      href?: string, documentId?: string, language?: string, collapsed?: true\n    }>,\n    localOffset: number,\n    startOffset: number,\n    checkLength?: boolean\n  }): ApiMessageEntity | undefined {\n    if (token.type !== MarkedJS.TokenType.html) throw new Error();\n    const { pendingEntities, localOffset, startOffset, checkLength } = options;\n    const isOpening = token.raw[0] === '<' && token.raw[1] !== '/';\n    const isClosing = token.raw[0] === '<' && token.raw[1] === '/';\n\n    if (isOpening) {\n      const extractAttribute = (attr: string) => token.raw.match(new RegExp(`${attr}=\"([^\"]*)\"`, \"i\"))?.[1];\n      const entityType = extractAttribute(\"data-entity-type\");\n\n      if (entityType) {\n        const href = extractAttribute(\"href\");\n        const documentId = extractAttribute(\"data-document-id\");\n        const language = extractAttribute(\"data-language\");\n        const collapsed = extractAttribute(\"data-collapsed\");\n\n        pendingEntities.push({\n          type: entityType as ApiMessageEntityTypes,\n          startOffset: localOffset,\n          href,\n          documentId,\n          language,\n          collapsed: collapsed === \"true\" ? true : undefined\n        });\n      }\n    } else if (isClosing) {\n      const pendingEntity = pendingEntities.pop();\n      if (pendingEntity) {\n        const length = localOffset - pendingEntity.startOffset;\n        if (!checkLength || length > 0) {\n          const { type } = pendingEntity;\n          if (type === ApiMessageEntityTypes.TextUrl) {\n            if (!pendingEntity.href) {\n              throw new Error(`Missing href for TextUrl entity. Entity: ${pendingEntity}`);\n            }\n            return {\n              type: type,\n              offset: startOffset - length,\n              length,\n              url: pendingEntity.href,\n            };\n          }\n          else if (type === ApiMessageEntityTypes.CustomEmoji) {\n            if (!pendingEntity.documentId) {\n              throw new Error(`Missing documentId for CustomEmoji entity. Entity: ${pendingEntity}`);\n            }\n            return {\n              type: type,\n              offset: startOffset - length,\n              length,\n              documentId: pendingEntity.documentId\n            };\n          }\n          else if (type === ApiMessageEntityTypes.Pre) {\n            return {\n              type: type,\n              offset: startOffset - length,\n              length,\n              language: pendingEntity.language\n            };\n          }\n          else if (type === ApiMessageEntityTypes.Blockquote) {\n            return {\n              type: type,\n              offset: startOffset - length,\n              length,\n              collapsed: pendingEntity.collapsed\n            };\n          }\n          else if (type === ApiMessageEntityTypes.Mention ||\n            type === ApiMessageEntityTypes.Url ||\n            type === ApiMessageEntityTypes.Cashtag ||\n            type === ApiMessageEntityTypes.Hashtag) {\n            return {\n              type: type,\n              offset: startOffset - length,\n              length,\n            };\n          }\n          else {\n            throw new Error(`Unsupported entity type: ${type}`);\n          }\n        }\n      }\n    }\n  }\n\n  export function htmlToFormattedText(htmlNode: Node): ApiFormattedText {\n    return tokensToFormattedText(htmlToTokens(htmlNode));\n  }\n\n  function entityTypeToTokenType(entityType?: ApiMessageEntityTypes): MarkedJS.TokenType {\n    switch (entityType) {\n      case ApiMessageEntityTypes.Bold:\n        return MarkedJS.TokenType.strong;\n      case ApiMessageEntityTypes.Blockquote:\n        return MarkedJS.TokenType.blockquote;\n      case ApiMessageEntityTypes.BotCommand:\n        return MarkedJS.TokenType.text;\n      case ApiMessageEntityTypes.Cashtag:\n        return MarkedJS.TokenType.text;\n      case ApiMessageEntityTypes.Code:\n        return MarkedJS.TokenType.codespan;\n      case ApiMessageEntityTypes.Email:\n        return MarkedJS.TokenType.link;\n      case ApiMessageEntityTypes.Hashtag:\n        return MarkedJS.TokenType.text;\n      case ApiMessageEntityTypes.Italic:\n        return MarkedJS.TokenType.em;\n      case ApiMessageEntityTypes.MentionName:\n        return MarkedJS.TokenType.link;\n      case ApiMessageEntityTypes.Mention:\n        return MarkedJS.TokenType.link;\n      case ApiMessageEntityTypes.Phone:\n        return MarkedJS.TokenType.link;\n      case ApiMessageEntityTypes.Pre:\n        return MarkedJS.TokenType.code;\n      case ApiMessageEntityTypes.Strike:\n        return MarkedJS.TokenType.del;\n      case ApiMessageEntityTypes.TextUrl:\n        return MarkedJS.TokenType.link;\n      case ApiMessageEntityTypes.Url:\n        return MarkedJS.TokenType.link;\n      case ApiMessageEntityTypes.Underline:\n        return MarkedJS.TokenType.underline;\n      case ApiMessageEntityTypes.Spoiler:\n        return MarkedJS.TokenType.spoiler;\n      case ApiMessageEntityTypes.CustomEmoji:\n        return MarkedJS.TokenType.text;\n      case ApiMessageEntityTypes.Unknown:\n      default:\n        return MarkedJS.TokenType.text;\n    }\n  }\n\n  export function htmlToTokens(htmlNode: Node): MarkedJS.Token[] {\n    function processNode(node: Node): MarkedJS.Token[] {\n      if (node.nodeType === Node.TEXT_NODE) {\n        const text = node.textContent || '';\n        return [{\n          type: MarkedJS.TokenType.text,\n          text,\n          raw: text\n        }];\n      }\n      else if (node.nodeType === Node.ELEMENT_NODE) {\n        const element = node as HTMLElement;\n        if (isMarkdownMarker(element)) return [];\n        const tag = element.tagName.toLowerCase();\n\n        // Handle <br>\n        if (tag === 'br') {\n          return [{\n            type: MarkedJS.TokenType.br,\n            raw: '\\n'\n          }];\n        }\n        // Handle image emoji: output alt text as plain text.\n        else if (element instanceof HTMLImageElement && element.dataset.isEmoji === \"true\") {\n          const alt = element.alt;\n          return [{\n            type: MarkedJS.TokenType.text,\n            text: alt,\n            raw: alt\n          }];\n        }\n\n        const entityType = getEntityTypeFromNode(element);\n\n        if (entityType === ApiMessageEntityTypes.Blockquote) {\n          const startTag = element.outerHTML.split('>')[0] + '>';\n          return [\n            { type: MarkedJS.TokenType.html, raw: startTag, block: true, },\n            ...processChildNodes(element),\n            { type: MarkedJS.TokenType.html, raw: `</${element.tagName.toLowerCase()}>` }\n          ];\n        }\n        else if (entityType === ApiMessageEntityTypes.Pre) {\n          const cb = extractCodeBlockData(element);\n          if (!cb) throw new Error(\"Failed to extract code block.\");\n          const startTag = element.outerHTML.split('>')[0] + '>';\n          return [\n            { type: MarkedJS.TokenType.html, raw: startTag, block: true, },\n            { type: MarkedJS.TokenType.text, raw: element.innerHTML, text: cb.codeContent },\n            { type: MarkedJS.TokenType.html, raw: `</${element.tagName.toLowerCase()}>` }\n          ];\n        }\n        else if (entityType && [ApiMessageEntityTypes.Mention, ApiMessageEntityTypes.TextUrl, ApiMessageEntityTypes.Url,\n        ApiMessageEntityTypes.Cashtag, ApiMessageEntityTypes.Hashtag, ApiMessageEntityTypes.CustomEmoji].includes(entityType)) {\n          const startTag = element.outerHTML.split('>')[0] + '>';\n          const text = entityType === ApiMessageEntityTypes.CustomEmoji ? element.dataset.alt : element.innerText;\n          return [\n            { type: MarkedJS.TokenType.html, raw: startTag },\n            { type: MarkedJS.TokenType.text, raw: element.innerHTML, text },\n            { type: MarkedJS.TokenType.html, raw: `</${element.tagName.toLowerCase()}>` }\n          ];\n        }\n        else {\n          // Inline elements (strong, em, del, codespan, text, etc.)\n          const tokenType = entityTypeToTokenType(entityType);\n          return [{\n            type: tokenType,\n            tokens: processChildNodes(element),\n            text: element.innerText,\n            raw: element.outerHTML\n          }];\n        }\n      }\n      return [];\n    }\n\n    function processChildNodes(node: Node): MarkedJS.Token[] {\n      const tokens: MarkedJS.Token[] = [];\n      node.childNodes.forEach(child => tokens.push(...processNode(child)));\n      return tokens;\n    }\n\n    return processNode(htmlNode);\n  }\n}\n","import { ApiMessageEntity } from \"../../api/types\";\nimport React, { FC, RefObject, useEffect, useState } from \"../../lib/teact/teact\";\nimport buildClassName from \"../../util/buildClassName\";\nimport { MarkdownEditorUtils } from \"./TokenHelper\";\nimport { FormattingTypes, MessageInputController } from \"./MessageInputController\";\n\nexport type { FormattingTypes }\nexport { MessageInputController };\nexport type MessageInputRefType = RefObject<MessageInputController | null>;\n\nexport const MARKDOWN_MARKER_CLASS_NAME = 'markdown-marker';\n\nexport function isMarkdownMarker(node: Node) {\n  return node instanceof HTMLElement && node.className.includes(MARKDOWN_MARKER_CLASS_NAME);\n}\n\nexport function handleClickOnNonContentEditable(\n  e: React.MouseEvent<HTMLSpanElement, MouseEvent>,\n  onClick?: () => void\n) {\n  e.preventDefault();\n  const selection = window.getSelection();\n  if (!selection || selection.rangeCount === 0) return;\n\n  const range = document.createRange();\n  range.setStartAfter(e.currentTarget);\n  range.collapse(true);\n\n  selection.removeAllRanges();\n  selection.addRange(range);\n\n  onClick?.();\n}\n\nexport const BlockMarkdownMarkerRenderer: FC<{\n  entityType?: ApiMessageEntity['type'];\n  className?: string;\n  disableRendering?: boolean;\n  contentEditable?: boolean;\n}> = (props) => {\n  return !props.disableRendering && props.entityType\n    ? <span className={buildClassName(props.className, MARKDOWN_MARKER_CLASS_NAME, 'show')}\n      contentEditable={props.contentEditable} data-markdown-marker={true}\n      onClick={props.contentEditable ? undefined : handleClickOnNonContentEditable}>\n      {MarkdownEditorUtils.getBlockMarkerByType(props.entityType as any)}\n    </span>\n    : undefined;\n}\n\nexport const MarkdownMarkerRenderer = ({\n  entityType,\n  disableRendering,\n  children,\n}: {\n  entityType?: ApiMessageEntity['type'];\n  disableRendering: boolean;\n  children: React.ReactNode;\n}) => {\n  if (disableRendering) return children;\n  const marker = entityType ? MarkdownEditorUtils.getInlineMarkerByType(entityType as any) : undefined;\n  if (!marker) return children;\n  const markerClassName = buildClassName(MARKDOWN_MARKER_CLASS_NAME, 'show');\n  return (\n    <>\n      <span className={markerClassName} data-markdown-marker={true}>{marker}</span>\n      {children}\n      <span className={markerClassName} data-markdown-marker={true}>{marker}</span>\n    </>\n  );\n};\n\nexport const useMessageInputEvent = (ref: MessageInputRefType) => {\n  const [isMessageInputChanged, setIsChanged] = useState<boolean>(false);\n\n  useEffect(() => {\n    if (!ref.current) return;\n    const unsubscribe = ref.current.listen(() => {\n      setIsChanged((prev) => !prev);\n    });\n\n    return () => {\n      unsubscribe?.();\n    }\n  }, [ref.current]);\n\n  return { isMessageInputChanged };\n};\n","import { isMarkdownMarker } from \"..\";\nimport { ApiFormattedText, ApiMessageEntityTypes } from \"../../../api/types\";\nimport { useCallback, useEffect, useState } from \"../../../lib/teact/teact\";\nimport focusEditableElement from \"../../../util/focusEditableElement\";\nimport { getEntityTypeFromNode } from \"../../../util/parseHtmlAsFormattedText\";\nimport { Contest } from \"../../contest\";\nimport { BlockLevelTypesList, InlineFormattingTypesList } from \"../MessageInputController\";\n\ntype VoidCallback = () => void;\n\nexport class ChangeNotifier<TEvent, TResponse = void> {\n  private _changeCallbacks = new Set<(event: TEvent) => TResponse>();\n\n  notify(event: TEvent): void {\n    queueMicrotask(() => {\n      this._changeCallbacks.forEach((cb) => cb(event));\n    });\n  }\n\n  notifySync(event: TEvent): TResponse[] {\n    const responses: TResponse[] = [];\n    this._changeCallbacks.forEach((cb) => {\n      responses.push(cb(event));\n    });\n    return responses;\n  }\n\n  listen(cb: (event: TEvent) => TResponse): () => void {\n    this._changeCallbacks.add(cb);\n    return () => {\n      this._changeCallbacks.delete(cb);\n    };\n  }\n\n  clear(): void {\n    this._changeCallbacks.clear();\n  }\n}\n\nexport const useOperationQueue = () => {\n  const [operationQueue, setOperationQueue] = useState<VoidCallback[]>([]);\n\n  const processQueue = useCallback(() => {\n    setOperationQueue((prevQueue) => {\n      if (prevQueue.length === 0) {\n        return [];\n      }\n\n      const [operation, ...rest] = prevQueue;\n      operation();\n      return rest;\n    });\n  }, []);\n\n  useEffect(() => {\n    if (operationQueue.length > 0) {\n      processQueue();\n    }\n  }, [operationQueue, processQueue]);\n\n  const enqueueOperation = useCallback((operation: VoidCallback) => {\n    setOperationQueue((prevQueue) => [...prevQueue, operation]);\n  }, []);\n\n  return { enqueueOperation };\n};\n\nexport const FormattedTextKeys: Partial<Record<string, string>> = {\n  pre: \"language\",\n  textUrl: \"url\",\n  mentionName: \"userId\",\n  blockquote: \"collapsed\",\n  customEmoji: \"documentId\",\n};\n\nexport function normalizeWhitespace(str: string) {\n  // Replaces all whitespace characters (spaces, tabs, newlines) with a single space\n  return str.replace(/\\s+/g, ' ').trim();\n}\n\nexport function areFormattedTextsEqual(a?: ApiFormattedText, b?: ApiFormattedText): boolean {\n  if (!a || !b) return a === b;\n\n  if (normalizeWhitespace(a.text) !== normalizeWhitespace(b.text)) return false;\n\n  const entsA = a.entities?.sort((e1, e2) => e1.offset - e2.offset) ?? [];\n  const entsB = b.entities?.sort((e1, e2) => e1.offset - e2.offset) ?? [];\n\n  if (entsA.length !== entsB.length) return false;\n\n  return entsA.every((e, i) => {\n    const f = entsB[i];\n    if (e.type !== f.type || e.offset !== f.offset || e.length !== f.length) return false;\n    const key = FormattedTextKeys[e.type];\n    return key ? (e as any)[key] === (f as any)[key] : true;\n  });\n}\n\n// narrowing Event type to KeyboardEvent.\nexport function isKeyboardEvent(event: Event): event is KeyboardEvent {\n  return 'key' in event;\n}\n\n// narrowing Event type to MouseEvent.\nexport function isMouseEvent(event: Event): event is MouseEvent {\n  return 'x' in event;\n}\n\nexport function isInputEvent(event: Event): event is InputEvent {\n  return 'inputType' in event;\n}\n\n// narrowing Note type to Element.\nexport function isElement(node: Node): node is Element {\n  return node.nodeType === Node.ELEMENT_NODE;\n}\n\nexport class MultiLock<T> {\n  private _locks: Map<T, boolean> = new Map();\n  private readonly _logger = Contest.createLogger(\"Locker\");\n\n  lock(key: T): void {\n    this._logger.log(`Locking with key: ${key}`);\n    this._locks.set(key, true);\n  }\n\n  unlock(key: T): void {\n    this._logger.log(`Unlocking with key: ${key}`);\n    this._locks.set(key, false);\n  }\n\n  isLocked(key: T): boolean {\n    return this._locks.get(key) || false;\n  }\n}\n\nexport class NodeHelper {\n  private readonly _logger = Contest.createLogger(\"NodeHelper\");\n\n  constructor() { }\n\n  syncDOMNodes(target: HTMLElement, source: HTMLElement): void {\n    const targetNodes = Array.from(target.childNodes);\n    const sourceNodes = Array.from(source.childNodes);\n\n    let i = 0;\n    while (i < sourceNodes.length || i < targetNodes.length) {\n      const targetNode = targetNodes[i];\n      const sourceNode = sourceNodes[i];\n\n      if (!targetNode) {\n        this._logger.log(\"appendChild()\", {\n          sourceNode,\n          targetNode\n        });\n        target.appendChild(sourceNode);\n      } else if (!sourceNode) {\n        target.removeChild(targetNode);\n      } else if (!this.isEqual(targetNode, sourceNode!)) {\n        // const nodeAType = getEntityTypeFromNode(targetNode);\n        // if (nodeAType === ApiMessageEntityTypes.CustomEmoji) {\n        //   // replace the CustomEmoji node\n        // }\n        // else  if (nodeAType === ApiMessageEntityTypes.Blockquote) {\n        //   // if both have same type but their content is differennt only update the content\n        // }\n        if (targetNode.nodeType === Node.TEXT_NODE && sourceNode.nodeType === Node.TEXT_NODE) {\n          // Update only text content instead of replacing the node\n          targetNode.textContent = sourceNode.textContent;\n        } else {\n          this._logger.log(\"replaceChild()\", {\n            sourceNode,\n            targetNode\n          });\n          // this.logNodeDifferences(sourceNode, targetNode);\n          target.replaceChild(sourceNode, targetNode);\n        }\n      }\n      i++;\n    }\n  }\n\n  isEqual(nodeA: ChildNode, nodeB: ChildNode) {\n    const nodeAType = getEntityTypeFromNode(nodeA);\n    const nodeBType = getEntityTypeFromNode(nodeA);\n    if (nodeAType !== nodeBType) return false;\n\n    switch (nodeAType) {\n      case ApiMessageEntityTypes.CustomEmoji:\n        if (!(nodeA instanceof HTMLElement)) return false;\n        if (!(nodeB instanceof HTMLElement)) return false;\n        if (nodeA.dataset.documentId !== nodeB.dataset.documentId) return false;\n        if (nodeA.dataset.alt !== nodeB.dataset.alt) return false;\n        return true;\n      case ApiMessageEntityTypes.Blockquote:\n        if (!(nodeA instanceof HTMLElement)) return false;\n        if (!(nodeB instanceof HTMLElement)) return false;\n      // if (nodeA.dataset.collapsed !== nodeB.dataset.collapsed) return false;\n      // if (nodeA.textContent !== nodeB.textContent) return false;\n      // check for text content\n      // return true;\n      default:\n        break;\n    }\n\n    return nodeA.isEqualNode(nodeB);\n  }\n\n  logNodeDifferences(nodeA: Node, nodeB: Node, path: string = 'root') {\n    // Compare node names and types\n    if (nodeA.nodeName !== nodeB.nodeName) {\n      this._logger.log(`${path}: Node names differ: ${nodeA.nodeName} vs ${nodeB.nodeName}`);\n    }\n    if (nodeA.nodeType !== nodeB.nodeType) {\n      this._logger.log(`${path}: Node types differ: ${nodeA.nodeType} vs ${nodeB.nodeType}`);\n    }\n\n    // For text nodes, compare text content\n    if (nodeA.nodeType === Node.TEXT_NODE && nodeB.nodeType === Node.TEXT_NODE) {\n      if (nodeA.textContent !== nodeB.textContent) {\n        this._logger.log(`${path}: Text content differs: \"${nodeA.textContent}\" vs \"${nodeB.textContent}\"`);\n      }\n      return;\n    }\n\n    // Compare attributes if both nodes are elements\n    if (nodeA instanceof Element && nodeB instanceof Element) {\n      const attrsA: Record<string, string> = {};\n      for (let i = 0; i < nodeA.attributes.length; i++) {\n        const attr = nodeA.attributes[i];\n        attrsA[attr.name] = attr.value;\n      }\n      const attrsB: Record<string, string> = {};\n      for (let i = 0; i < nodeB.attributes.length; i++) {\n        const attr = nodeB.attributes[i];\n        attrsB[attr.name] = attr.value;\n      }\n\n      for (const name in attrsA) {\n        if (!(name in attrsB)) {\n          this._logger.log(`${path}: Attribute \"${name}\" present in nodeA but missing in nodeB`);\n        } else if (attrsA[name] !== attrsB[name]) {\n          this._logger.log(`${path}: Attribute \"${name}\" differs: \"${attrsA[name]}\" vs \"${attrsB[name]}\"`);\n        }\n      }\n      for (const name in attrsB) {\n        if (!(name in attrsA)) {\n          this._logger.log(`${path}: Attribute \"${name}\" present in nodeB but missing in nodeA`);\n        }\n      }\n    }\n\n    // Compare child nodes\n    const childrenA: NodeListOf<Node> = nodeA.childNodes;\n    const childrenB: NodeListOf<Node> = nodeB.childNodes;\n\n    if (childrenA.length !== childrenB.length) {\n      this._logger.log(`${path}: Different number of children: ${childrenA.length} vs ${childrenB.length}`);\n    }\n\n    const max = Math.max(childrenA.length, childrenB.length);\n    for (let i = 0; i < max; i++) {\n      const childA: Node | undefined = childrenA[i] ?? undefined;\n      const childB: Node | undefined = childrenB[i] ?? undefined;\n      if (!childA) {\n        this._logger.log(`${path}: Missing child in nodeA at index ${i} (nodeB: ${childB?.nodeName})`);\n        continue;\n      }\n      if (!childB) {\n        this._logger.log(`${path}: Missing child in nodeB at index ${i} (nodeA: ${childA.nodeName})`);\n        continue;\n      }\n      this.logNodeDifferences(childA, childB, `${path} > ${childA.nodeName}[${i}]`);\n    }\n  }\n}\n\nexport namespace Utils {\n  const CUSTOM_EMOJI_LENGTH_IN_CARET = 1;\n\n  export function getSelectionRange() {\n    const selection = window.getSelection();\n    if (!selection || !selection.rangeCount) return undefined;\n\n    const range = selection.getRangeAt(0);\n    return range;\n  }\n\n  // ? Count Breaklines and CustomEmoji in caret offset\n  // ? Also because CustomEmoji is not contenteditable so user couldnt write\n  function createTreeWalker(element: HTMLElement) {\n    const walker = document.createTreeWalker(\n      element,\n      NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,\n      {\n        acceptNode(node) {\n          // Include text nodes and <br> elements\n          if (node.nodeType === Node.TEXT_NODE || node.nodeName === 'BR') {\n            return NodeFilter.FILTER_ACCEPT;\n          }\n          else if (node instanceof HTMLElement && node.dataset.entityType === ApiMessageEntityTypes.CustomEmoji) {\n            return NodeFilter.FILTER_ACCEPT;\n          }\n          return NodeFilter.FILTER_SKIP;\n        },\n      }\n    );\n    return walker;\n  }\n\n  export function getCaretCharacterOffset(element: HTMLElement): number {\n    const selection = window.getSelection();\n    if (!selection || selection.rangeCount === 0) {\n      return 0;\n    }\n\n    const range = selection.getRangeAt(0);\n    const preCaretRange = range.cloneRange();\n    preCaretRange.selectNodeContents(element);\n    preCaretRange.setEnd(range.endContainer, range.endOffset);\n\n    // Create a temporary element to hold the cloned range\n    const tempElement = document.createElement('div');\n    tempElement.appendChild(preCaretRange.cloneContents());\n\n    // Handle <br> tags and newlines\n    const walker = createTreeWalker(tempElement);\n\n    let caretPosition = 0;\n    let currentNode;\n\n    // Traverse the DOM and count characters, including <br> and newlines\n    while ((currentNode = walker.nextNode())) {\n      if (currentNode.nodeName === 'BR') {\n        caretPosition += 1; // Count <br> as a single character\n      }\n      else if (currentNode instanceof HTMLElement && currentNode.dataset.entityType === ApiMessageEntityTypes.CustomEmoji) {\n        caretPosition += CUSTOM_EMOJI_LENGTH_IN_CARET; // Count each emoji as one character\n      }\n      else if (currentNode.nodeType === Node.TEXT_NODE) {\n        caretPosition += currentNode.textContent?.length || 0;\n      }\n    }\n\n    return caretPosition;\n  }\n\n  export function setCaretCharacterOffset(element: HTMLElement, offset?: number): void {\n    const walker = createTreeWalker(element);\n\n    let currentOffset = 0;\n    let targetNode: Node | null = null;\n    let targetOffset = 0;\n\n    if (offset !== undefined) {\n      // Traverse the DOM to find the node and offset where the caret should be placed\n      while (walker.nextNode()) {\n        const node = walker.currentNode;\n\n        if (node.nodeName === 'BR') {\n          // Treat <br> as a single character\n          if (currentOffset + 1 >= offset) {\n            if (node.parentNode) {\n              targetNode = node.parentNode; // Place caret after the <br>\n              // Find the index of the <br> node among its siblings\n              const childNodes = Array.from(node.parentNode.childNodes);\n              targetOffset = childNodes.indexOf(node as ChildNode) + 1;\n            } else {\n              // If parentNode is null, fall back to the element itself\n              targetNode = element;\n              targetOffset = element.childNodes.length;\n            }\n            break;\n          }\n          currentOffset += 1;\n        }\n        else if (node instanceof HTMLElement && node.dataset.entityType === ApiMessageEntityTypes.CustomEmoji) {\n          // Count emoji as 1 character\n          if (currentOffset + CUSTOM_EMOJI_LENGTH_IN_CARET >= offset) {\n            targetNode = node;\n            targetOffset = 0; // Emojis are treated as 1 character\n            break;\n          }\n          currentOffset += CUSTOM_EMOJI_LENGTH_IN_CARET;\n        }\n        else if (node.nodeType === Node.TEXT_NODE) {\n          const textLength = node.textContent?.length || 0;\n\n          if (currentOffset + textLength >= offset) {\n            targetNode = node;\n            targetOffset = offset - currentOffset;\n            break;\n          }\n          currentOffset += textLength;\n        }\n      }\n    }\n\n    // If no target node is found, place the caret at the end of the element\n    if (!targetNode) {\n      targetNode = element;\n      targetOffset = element.childNodes.length;\n    }\n\n    // Handle non-contentEditable nodes like CustomEmoji\n    if (targetNode.nodeType !== Node.TEXT_NODE\n      && targetNode !== element\n      && !(targetNode as HTMLElement).isContentEditable) {\n      // Place the caret after the target node in its parent container\n      const parentNode = targetNode.parentNode as HTMLElement;\n      if (parentNode) {\n        const childNodes = Array.from(parentNode.childNodes);\n        targetOffset = childNodes.indexOf(targetNode as ChildNode) + 1;\n        targetNode = parentNode;\n      }\n    }\n\n    // Set the caret position\n    const range = document.createRange();\n    const selection = window.getSelection();\n\n    if (selection && targetNode) {\n      range.setStart(targetNode, targetOffset);\n      range.collapse(true);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n\n  export function moveContentOutsideOfElement(element: HTMLElement, shouldExclude: (element: Node) => boolean): void {\n    const parent = element.parentNode;\n    if (!parent) return;\n\n    const fragment = document.createDocumentFragment();\n    let child = element.firstChild;\n\n    while (child) {\n      const nextSibling = child.nextSibling;\n      if (!shouldExclude(child)) {\n        fragment.appendChild(child);\n      }\n      child = nextSibling;\n    }\n\n    parent.insertBefore(fragment, element);\n    parent.removeChild(element);\n  }\n\n  export function addTextAtStartAndEndOfSelection(textToAddStart: string, textToAddEnd: string) {\n    const range = getSelectionRange();\n    if (!range) return;\n\n    const startContainer = range.startContainer;\n    const startOffset = range.startOffset;\n    const endContainer = range.endContainer;\n    let endOffset = range.endOffset;\n\n    // Add text at the start of the selection\n    if (startContainer.nodeType === Node.TEXT_NODE) {\n      const textNode = startContainer as Text;\n      textNode.insertData(startOffset, textToAddStart);\n    } else if (startContainer.nodeType === Node.ELEMENT_NODE) {\n      const element = startContainer as HTMLElement;\n      const textNode = document.createTextNode(textToAddStart);\n      if (startOffset === 0) {\n        element.parentNode?.insertBefore(textNode, element);\n      } else {\n        element.insertBefore(textNode, element.childNodes[startOffset]);\n      }\n    }\n\n    // Adjust endOffset due to the insertion at the start\n    if (startContainer === endContainer) {\n      endOffset += textToAddStart.length;\n    }\n\n    // Add text at the end of the selection\n    if (endContainer.nodeType === Node.TEXT_NODE) {\n      const textNode = endContainer as Text;\n      textNode.insertData(endOffset, textToAddEnd);\n    } else if (endContainer.nodeType === Node.ELEMENT_NODE) {\n      const element = endContainer as HTMLElement;\n      const textNode = document.createTextNode(textToAddEnd);\n      if (endOffset === element.childNodes.length) {\n        element.appendChild(textNode);\n      } else {\n        element.insertBefore(textNode, element.childNodes[endOffset]);\n      }\n    }\n\n    // Update the selection to include the newly added text\n    // const newRange = document.createRange();\n    // newRange.setStart(startContainer, startOffset);\n    // newRange.setEnd(endContainer, endOffset + textToAddEnd.length);\n    // selection.removeAllRanges();\n    // selection.addRange(newRange);\n  }\n\n  export function getInlineEntitiesInSelection(root: HTMLElement) {\n    const range = getSelectionRange();\n    if (!range) return null;\n    if (range.collapsed) return null;\n\n    const entities = new Set<HTMLElement>();\n\n    const walker = document.createTreeWalker(\n      root,\n      NodeFilter.SHOW_TEXT,\n      {\n        acceptNode: (node) =>\n          range.intersectsNode(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP\n      }\n    );\n\n    let currentNode: Node | null = walker.currentNode;\n    while (currentNode) {\n      let ancestor: Node | null = currentNode;\n      while (ancestor && ancestor !== root) {\n        if (\n          ancestor instanceof HTMLElement &&\n          InlineFormattingTypesList.includes(ancestor.dataset.entityType as any)\n        ) {\n          entities.add(ancestor);\n        }\n        ancestor = ancestor.parentNode;\n      }\n      currentNode = walker.nextNode();\n    }\n    return Array.from(entities);\n\n    // const topEntities: Set<HTMLElement> = new Set();\n\n    // function findTopmostEntity(node: Node | null) {\n    //   let topEntity: HTMLElement | null = null;\n    //   while (node && node !== root) {\n    //     if (node instanceof HTMLElement && InlineFormattingTypesList.includes(node.dataset.entityType as any)) {\n    //       topEntity = node;\n    //     }\n    //     node = node.parentNode;\n    //   }\n    //   if (topEntity) topEntities.add(topEntity);\n    // }\n\n    // // Traverse from startContainer to endContainer\n    // let node: Node | null = range.startContainer;\n    // const endNode: Node | null = range.endContainer;\n    // let reachedEnd = false;\n\n    // while (node && !reachedEnd) {\n    //   findTopmostEntity(node);\n    //   if (node === endNode) reachedEnd = true;\n    //   node = node.nextSibling || (node.parentNode ? node.parentNode.nextSibling : null);\n    // }\n\n    // return Array.from(topEntities);\n\n    // let elements: HTMLElement[] = [];\n\n    // // Helper function to traverse the DOM and collect elements within the range\n    // function traverseAndCollect(node: Node) {\n    //   if (node.nodeType === Node.ELEMENT_NODE) {\n    //     const element = node as HTMLElement;\n\n    //     // Only push the element if it's within the selected range\n    //     if (range!.intersectsNode(element)) {\n    //       elements.push(element);\n    //     }\n\n    //     // Traverse child nodes\n    //     node.childNodes.forEach(traverseAndCollect);\n    //   }\n    // }\n\n    // const commonAncestor = range.commonAncestorContainer;\n    // traverseAndCollect(commonAncestor);\n\n    // // ? Case: User selects all or part of text inside an inline entity, but the markdown markers are not selected.\n    // if (range.startContainer === range.endContainer && range.startContainer instanceof Text) {\n    //   const { startContainer } = range;\n    //   if (\n    //     startContainer.previousElementSibling && isMarkdownMarker(startContainer.previousElementSibling) &&\n    //     startContainer.nextElementSibling && isMarkdownMarker(startContainer.nextElementSibling)\n    //   ) {\n    //     const parent = startContainer.parentElement;\n    //     if (parent instanceof HTMLElement && InlineFormattingTypesList.includes(parent.dataset.entityType as any)) {\n    //       elements.push(parent);\n    //     }\n    //   }\n    // }\n    // console.log(\"MMD getInlineEntitiesInSelection() 0\", elements);\n    // elements = elements.filter(x => InlineFormattingTypesList.includes(x.dataset.entityType as any));\n    // console.log(\"MMD getInlineEntitiesInSelection() 1\", elements, range);\n\n    // return elements;\n  }\n\n  export function getTopmostInlineEntity(root: HTMLElement) {\n    const range = getSelectionRange();\n    if (!range) return undefined;\n\n    let node: Node | null = range.startContainer;\n    let topEntity: HTMLElement | undefined = undefined;\n\n    while (node && node !== root) {\n      if (node instanceof HTMLElement && InlineFormattingTypesList.includes(node.dataset.entityType as any)) {\n        topEntity = node;\n      }\n      node = node.parentNode;\n    }\n\n    return topEntity;\n  }\n\n  export function getTopmostBlockLevelEntity(root: HTMLElement) {\n    const range = getSelectionRange();\n    if (!range) return null;\n\n    let node: Node | null = range.startContainer;\n    let topEntity: HTMLElement | null = null;\n\n    while (node && node !== root) {\n      if (node instanceof HTMLElement && BlockLevelTypesList.includes(node.dataset.entityType as any)) {\n        topEntity = node;\n      }\n      node = node.parentNode;\n    }\n\n    return topEntity;\n  }\n\n  export function getClosestElementToCaret() {\n    const range = getSelectionRange();\n    if (!range) return;\n    let node = range.startContainer;\n\n    // If caret is inside a text node, check if it's at the beginning or end.\n    if (node.nodeType === Node.TEXT_NODE) {\n      const offset = range.startOffset;\n\n      // At the beginning of the text node:\n      if (offset === 0) {\n        let prev = node.previousSibling;\n        while (prev && prev.nodeType !== Node.ELEMENT_NODE) {\n          prev = prev.previousSibling;\n        }\n        if (prev) return prev;\n      }\n\n      // At the end of the text node:\n      if (node.textContent && offset === node.textContent.length) { // Use nodeValue instead of textContent\n        let next = node.nextSibling;\n        while (next && next.nodeType !== Node.ELEMENT_NODE) {\n          next = next.nextSibling;\n        }\n        if (next) return next;\n      }\n\n      return node;\n    }\n\n    // If the caret is in an element node, check if it is at the beginning or end of its child nodes.\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      if (range.startOffset === 0) {\n        return node.previousSibling || node;\n      } else if (range.startOffset === node.childNodes.length) {\n        return node; // node.nextSibling || node;\n      }\n    }\n\n    return node;\n  }\n\n  function getDeepestLastChild(node: Node) {\n    while (node.lastChild) {\n      node = node.lastChild;\n    }\n    return node;\n  }\n\n  export function moveCaretToEndOfPreviousSibling(element: Node): void {\n    let prevSibling = element.previousSibling;\n\n    while (\n      prevSibling &&\n      prevSibling.nodeType !== Node.TEXT_NODE &&\n      (!prevSibling.textContent || !prevSibling.textContent.trim())\n    ) {\n      prevSibling = prevSibling.previousSibling;\n    }\n\n    if (!prevSibling) {\n      if (element.previousSibling) prevSibling = element.previousSibling;\n      else return;\n    }\n\n    const range = document.createRange();\n    const selection = window.getSelection();\n    if (!selection) return;\n\n    let targetNode: Node = prevSibling;\n    let offset = 0;\n\n    if (prevSibling.nodeType !== Node.TEXT_NODE) {\n      targetNode = getDeepestLastChild(prevSibling);\n      if (targetNode.nodeType === Node.TEXT_NODE) {\n        offset = targetNode.textContent ? targetNode.textContent.length : 0;\n      } else {\n        offset = targetNode.childNodes.length;\n      }\n    } else {\n      offset = prevSibling.textContent ? prevSibling.textContent.length : 0;\n    }\n\n    try {\n      range.setStart(targetNode, offset);\n      range.collapse(true);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  export function getTextContentWithBreaks(node: Node, options: {\n    skipMarkdownMarker?: boolean;\n    trim?: boolean;\n  } = { skipMarkdownMarker: true, trim: false }): string {\n    if (!node || (options.skipMarkdownMarker && isMarkdownMarker(node))) return \"\";\n    if (node.nodeType === Node.TEXT_NODE) return node.textContent || \"\";\n    if (node.nodeName === 'BR') return '\\n';\n\n    let text = Array.from(node.childNodes)\n      .map(child => getTextContentWithBreaks(child, options))\n      .join(\"\");\n\n    return options.trim ? text.trim() : text;\n  }\n\n  export function getCaretLineInfo(container: HTMLElement) {\n    if (!container) return null;\n\n    const text = getTextContentWithBreaks(container, { skipMarkdownMarker: false });\n    let lines = text.split('\\n');\n    // ? Remove a trailing empty line (placeholder blank line per WHATWG recommendations)\n    if (lines.length > 1 && lines[lines.length - 1].trim() === '') {\n      lines.pop();\n    }\n\n    const caretOffset = getCaretCharacterOffset(container);\n    let currentLineIndex = 0;\n    let accumulatedLength = 0;\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      if (caretOffset <= accumulatedLength + line.length) {\n        currentLineIndex = i;\n        break;\n      }\n      accumulatedLength += line.length + 1; // for \\n of new Line\n    }\n\n    return {\n      lines,\n      currentLineIndex,\n      currentLineCaretOffset: caretOffset - accumulatedLength\n    };\n  }\n\n  export function simulateEnter() {\n    document.execCommand(\"insertLineBreak\");\n  }\n\n  export function extractFullLineInfo(container: HTMLElement) {\n    const caretLineInfo = getCaretLineInfo(container);\n    if (!caretLineInfo) return undefined;\n\n    const { currentLineIndex, lines, currentLineCaretOffset } = caretLineInfo;\n    const isEmpty = (indexes: number[]) => indexes.every(i => lines[i]?.trim() === '');\n\n    return {\n      isInFirstLine: currentLineIndex === 0,\n      isInThirdLine: currentLineIndex === 2,\n      isTwoFirstLineEmpty: lines.length >= 2 && isEmpty([0, 1]),\n      isInLastLine: currentLineIndex === lines.length - 1,\n      isTwoLastLineEmpty: lines.length >= 2 && isEmpty([lines.length - 2, lines.length - 1]),\n      isStartOfCurrentLine: currentLineCaretOffset === 0,\n      isCurrentLineEmpty: lines[currentLineIndex]?.trim() === '',\n    };\n  }\n\n  export function insertHardBreak(position: 'before' | 'after', targetNode?: Node) {\n    const selection = document.getSelection();\n    if (!selection || selection.rangeCount === 0) return;\n\n    const range = selection.getRangeAt(0);\n    let currentNode = targetNode || range.startContainer;\n    if (!currentNode.parentNode) return; // Ensure it's inside a valid parent\n\n    const newLine = document.createElement('div');\n    newLine.appendChild(document.createElement('br'));\n\n    if (position === 'before') {\n      // Insert before the specified or detected node\n      currentNode.parentNode.insertBefore(newLine, currentNode);\n    } else {\n      // Insert after the specified node or at the selection\n      currentNode.parentNode.insertBefore(newLine, currentNode.nextSibling);\n    }\n\n    // Move the cursor after the newly inserted line\n    const newRange = document.createRange();\n    newRange.setStartAfter(newLine);\n    newRange.collapse(true);\n\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n  }\n\n  export function clearSelection() {\n    const selection = window.getSelection();\n    if (!selection) {\n      return;\n    }\n\n    if (selection.removeAllRanges) {\n      selection.removeAllRanges();\n    } else if (selection.empty) {\n      selection.empty();\n    }\n  }\n}\n","import type { ActionReturnType } from '../../types';\nimport { ManagementProgress } from '../../../types';\n\nimport {\n  CUSTOM_BG_CACHE_NAME,\n  LANG_CACHE_NAME,\n  LOCK_SCREEN_ANIMATION_DURATION_MS,\n  MEDIA_CACHE_NAME,\n  MEDIA_CACHE_NAME_AVATARS,\n  MEDIA_PROGRESSIVE_CACHE_NAME,\n} from '../../../config';\nimport { updateAppBadge } from '../../../util/appBadge';\nimport { MAIN_IDB_STORE, PASSCODE_IDB_STORE } from '../../../util/browser/idb';\nimport * as cacheApi from '../../../util/cacheApi';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { unsubscribe } from '../../../util/notifications';\nimport { clearEncryptedSession, encryptSession, forgetPasscode } from '../../../util/passcode';\nimport { parseInitialLocationHash, resetInitialLocationHash, resetLocationHash } from '../../../util/routing';\nimport { pause } from '../../../util/schedulers';\nimport {\n  clearStoredSession,\n  loadStoredSession,\n  storeSession,\n} from '../../../util/sessions';\nimport { forceWebsync } from '../../../util/websync';\nimport {\n  IS_WEBM_SUPPORTED, MAX_BUFFER_SIZE, PLATFORM_ENV,\n} from '../../../util/windowEnvironment';\nimport {\n  callApi, callApiLocal, initApi, setShouldEnableDebugLog,\n} from '../../../api/gramjs';\nimport { serializeGlobal } from '../../cache';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from '../../index';\nimport {\n  clearGlobalForLockScreen, updateManagementProgress, updatePasscodeSettings,\n} from '../../reducers';\n\naddActionHandler('initApi', (global, actions): ActionReturnType => {\n  const initialLocationHash = parseInitialLocationHash();\n\n  const hasTestParam = window.location.search.includes('test') || initialLocationHash?.tgWebAuthTest === '1';\n\n  void initApi(actions.apiUpdate, {\n    userAgent: navigator.userAgent,\n    platform: PLATFORM_ENV,\n    sessionData: loadStoredSession(),\n    isWebmSupported: IS_WEBM_SUPPORTED,\n    maxBufferSize: MAX_BUFFER_SIZE,\n    webAuthToken: initialLocationHash?.tgWebAuthToken,\n    dcId: initialLocationHash?.tgWebAuthDcId ? Number(initialLocationHash?.tgWebAuthDcId) : undefined,\n    mockScenario: initialLocationHash?.mockScenario,\n    shouldAllowHttpTransport: global.settings.byKey.shouldAllowHttpTransport,\n    shouldForceHttpTransport: global.settings.byKey.shouldForceHttpTransport,\n    shouldDebugExportedSenders: global.settings.byKey.shouldDebugExportedSenders,\n    langCode: global.settings.byKey.language,\n    isTestServerRequested: hasTestParam,\n  });\n\n  void setShouldEnableDebugLog(Boolean(global.settings.byKey.shouldCollectDebugLogs));\n});\n\naddActionHandler('setAuthPhoneNumber', (global, actions, payload): ActionReturnType => {\n  const { phoneNumber } = payload!;\n\n  void callApi('provideAuthPhoneNumber', phoneNumber.replace(/[^\\d]/g, ''));\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('setAuthCode', (global, actions, payload): ActionReturnType => {\n  const { code } = payload!;\n\n  void callApi('provideAuthCode', code);\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('setAuthPassword', (global, actions, payload): ActionReturnType => {\n  const { password } = payload!;\n\n  void callApi('provideAuthPassword', password);\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('uploadProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const {\n    file, isFallback, isVideo, videoTs, bot,\n    tabId = getCurrentTabId(),\n  } = payload!;\n\n  global = updateManagementProgress(global, ManagementProgress.InProgress, tabId);\n  setGlobal(global);\n\n  const result = await callApi('uploadProfilePhoto', file, isFallback, isVideo, videoTs, bot);\n  if (!result) return;\n\n  global = getGlobal();\n  global = updateManagementProgress(global, ManagementProgress.Complete, tabId);\n  setGlobal(global);\n\n  actions.loadFullUser({ userId: global.currentUserId! });\n});\n\naddActionHandler('signUp', (global, actions, payload): ActionReturnType => {\n  const { firstName, lastName } = payload!;\n\n  void callApi('provideAuthRegistration', { firstName, lastName });\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('returnToAuthPhoneNumber', (global): ActionReturnType => {\n  void callApi('restartAuth');\n\n  return {\n    ...global,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('goToAuthQrCode', (global): ActionReturnType => {\n  void callApi('restartAuthWithQr');\n\n  return {\n    ...global,\n    authIsLoadingQrCode: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('saveSession', (global, actions, payload): ActionReturnType => {\n  if (global.passcode.isScreenLocked) {\n    return;\n  }\n\n  const { sessionData } = payload;\n  if (sessionData) {\n    storeSession(sessionData, global.currentUserId);\n  } else {\n    clearStoredSession();\n  }\n});\n\naddActionHandler('signOut', async (global, actions, payload): Promise<void> => {\n  if ('hangUp' in actions) actions.hangUp({ tabId: getCurrentTabId() });\n  if ('leaveGroupCall' in actions) actions.leaveGroupCall({ tabId: getCurrentTabId() });\n\n  try {\n    resetInitialLocationHash();\n    resetLocationHash();\n    await unsubscribe();\n    await Promise.race([callApi('destroy'), pause(3000)]);\n    await forceWebsync(false);\n  } catch (err) {\n    // Do nothing\n  }\n\n  actions.reset();\n\n  if (payload?.forceInitApi) {\n    actions.initApi();\n  }\n});\n\naddActionHandler('requestChannelDifference', (global, actions, payload): ActionReturnType => {\n  const { chatId } = payload;\n\n  void callApi('requestChannelDifference', chatId);\n});\n\naddActionHandler('reset', (global, actions): ActionReturnType => {\n  clearStoredSession();\n  clearEncryptedSession();\n\n  void cacheApi.clear(MEDIA_CACHE_NAME);\n  void cacheApi.clear(MEDIA_CACHE_NAME_AVATARS);\n  void cacheApi.clear(MEDIA_PROGRESSIVE_CACHE_NAME);\n  void cacheApi.clear(CUSTOM_BG_CACHE_NAME);\n\n  MAIN_IDB_STORE.clear();\n  PASSCODE_IDB_STORE.clear();\n\n  const langCachePrefix = LANG_CACHE_NAME.replace(/\\d+$/, '');\n  const langCacheVersion = Number((LANG_CACHE_NAME.match(/\\d+$/) || ['0'])[0]);\n  for (let i = 0; i < langCacheVersion; i++) {\n    void cacheApi.clear(`${langCachePrefix}${i === 0 ? '' : i}`);\n  }\n\n  updateAppBadge(0);\n\n  actions.initShared({ force: true });\n  Object.values(global.byTabId).forEach(({ id: otherTabId, isMasterTab }) => {\n    actions.init({ tabId: otherTabId, isMasterTab });\n  });\n});\n\naddActionHandler('disconnect', (): ActionReturnType => {\n  void callApiLocal('disconnect');\n});\n\naddActionHandler('destroyConnection', (): ActionReturnType => {\n  void callApiLocal('destroy', true, true);\n});\n\naddActionHandler('loadNearestCountry', async (global): Promise<void> => {\n  if (global.connectionState !== 'connectionStateReady') {\n    return;\n  }\n\n  const authNearestCountry = await callApi('fetchNearestCountry');\n\n  global = getGlobal();\n  global = {\n    ...global,\n    authNearestCountry,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setDeviceToken', (global, actions, deviceToken): ActionReturnType => {\n  return {\n    ...global,\n    push: {\n      deviceToken,\n      subscribedAt: Date.now(),\n    },\n  };\n});\n\naddActionHandler('deleteDeviceToken', (global): ActionReturnType => {\n  return {\n    ...global,\n    push: undefined,\n  };\n});\n\naddActionHandler('lockScreen', async (global): Promise<void> => {\n  const sessionJson = JSON.stringify({ ...loadStoredSession(), userId: global.currentUserId });\n  const globalJson = await serializeGlobal(global);\n\n  await encryptSession(sessionJson, globalJson);\n  forgetPasscode();\n  clearStoredSession();\n  updateAppBadge(0);\n\n  global = getGlobal();\n  global = updatePasscodeSettings(\n    global,\n    {\n      isScreenLocked: true,\n      invalidAttemptsCount: 0,\n      timeoutUntil: undefined,\n    },\n  );\n  setGlobal(global);\n\n  setTimeout(() => {\n    global = getGlobal();\n    global = clearGlobalForLockScreen(global);\n    setGlobal(global);\n  }, LOCK_SCREEN_ANIMATION_DURATION_MS);\n\n  try {\n    await unsubscribe();\n    await callApi('destroy', true);\n  } catch (err) {\n    // Do nothing\n  }\n});\n","import type { ApiPrivacySettings, ApiUsername } from '../../../api/types';\nimport type { ActionReturnType } from '../../types';\nimport {\n  ProfileEditProgress,\n  UPLOADING_WALLPAPER_SLUG,\n} from '../../../types';\n\nimport { APP_CONFIG_REFETCH_INTERVAL, COUNTRIES_WITH_12H_TIME_FORMAT } from '../../../config';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { requestPermission, subscribe, unsubscribe } from '../../../util/notifications';\nimport { setTimeFormat } from '../../../util/oldLangProvider';\nimport requestActionTimeout from '../../../util/requestActionTimeout';\nimport { getServerTime } from '../../../util/serverTime';\nimport { callApi } from '../../../api/gramjs';\nimport { buildApiInputPrivacyRules } from '../../helpers';\nimport { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport {\n  addBlockedUser, addNotifyExceptions, deletePeerPhoto,\n  removeBlockedUser, replaceSettings, updateChat,\n  updateNotifySettings, updateUser, updateUserFullInfo,\n} from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport {\n  selectChat, selectTabState, selectUser,\n} from '../../selectors';\n\naddActionHandler('updateProfile', async (global, actions, payload): Promise<void> => {\n  const {\n    photo, firstName, lastName, bio: about, username,\n    tabId = getCurrentTabId(),\n  } = payload;\n\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: ProfileEditProgress.InProgress,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  if (photo) {\n    await callApi('uploadProfilePhoto', photo);\n  }\n\n  if (firstName || lastName || about) {\n    const result = await callApi('updateProfile', { firstName, lastName, about });\n    if (result) {\n      global = getGlobal();\n      const currentUser = currentUserId && selectUser(global, currentUserId);\n\n      if (currentUser) {\n        global = updateUser(\n          global,\n          currentUser.id,\n          {\n            firstName,\n            lastName,\n          },\n        );\n        global = updateUserFullInfo(global, currentUser.id, { bio: about });\n        setGlobal(global);\n      }\n    }\n  }\n\n  if (username !== undefined) {\n    const result = await callApi('updateUsername', username);\n    global = getGlobal();\n    const currentUser = currentUserId && selectUser(global, currentUserId);\n\n    if (result && currentUser) {\n      const shouldUsernameUpdate = currentUser.usernames?.find((u) => u.isEditable);\n      const usernames = shouldUsernameUpdate\n        ? currentUser.usernames?.map((u) => (u.isEditable ? { ...u, username } : u))\n        : [{ username, isEditable: true, isActive: true } as ApiUsername, ...currentUser.usernames || []];\n      global = updateUser(global, currentUserId, { usernames });\n      setGlobal(global);\n    }\n  }\n\n  global = getGlobal();\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: ProfileEditProgress.Complete,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  if (photo) {\n    actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n  }\n});\n\naddActionHandler('updateProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const { photo, isFallback } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) return;\n  const currentUser = selectUser(global, currentUserId);\n  if (!currentUser) return;\n\n  global = updateUser(global, currentUserId, { avatarPhotoId: undefined });\n  global = updateUserFullInfo(global, currentUserId, { profilePhoto: undefined });\n\n  setGlobal(global);\n\n  const result = await callApi('updateProfilePhoto', photo, isFallback);\n  if (!result) return;\n\n  actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n});\n\naddActionHandler('deleteProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const { photo } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) return;\n\n  const isDeleted = await callApi('deleteProfilePhotos', [photo]);\n  if (!isDeleted) return;\n\n  global = getGlobal();\n  global = deletePeerPhoto(global, currentUserId, photo.id);\n  setGlobal(global);\n\n  actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n});\n\naddActionHandler('checkUsername', async (global, actions, payload): Promise<void> => {\n  const { username, tabId = getCurrentTabId() } = payload!;\n\n  let tabState = selectTabState(global, tabId);\n  // No need to check the username if profile update is already in progress\n  if (tabState.profileEdit && tabState.profileEdit.progress === ProfileEditProgress.InProgress) {\n    return;\n  }\n\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: tabState.profileEdit ? tabState.profileEdit.progress : ProfileEditProgress.Idle,\n      checkedUsername: undefined,\n      isUsernameAvailable: undefined,\n      error: undefined,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  const { result, error } = (await callApi('checkUsername', username))!;\n\n  global = getGlobal();\n  tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    profileEdit: {\n      ...tabState.profileEdit!,\n      checkedUsername: username,\n      isUsernameAvailable: result === true,\n      error,\n    },\n  }, tabId);\n  setGlobal(global);\n});\n\naddActionHandler('loadWallpapers', async (global): Promise<void> => {\n  const result = await callApi('fetchWallpapers');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: result.wallpapers,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('uploadWallpaper', async (global, actions, payload): Promise<void> => {\n  const file = payload;\n  const previewBlobUrl = URL.createObjectURL(file);\n\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: [\n        {\n          slug: UPLOADING_WALLPAPER_SLUG,\n          document: {\n            mediaType: 'document',\n            fileName: '',\n            size: file.size,\n            mimeType: file.type,\n            previewBlobUrl,\n          },\n        },\n        ...(global.settings.loadedWallpapers || []),\n      ],\n    },\n  };\n  setGlobal(global);\n\n  const result = await callApi('uploadWallpaper', file);\n  if (!result) {\n    return;\n  }\n\n  const { wallpaper } = result;\n\n  global = getGlobal();\n  if (!global.settings.loadedWallpapers) {\n    return;\n  }\n\n  const firstWallpaper = global.settings.loadedWallpapers[0];\n  if (!firstWallpaper || firstWallpaper.slug !== UPLOADING_WALLPAPER_SLUG) {\n    return;\n  }\n\n  const withLocalMedia = {\n    ...wallpaper,\n    document: {\n      ...wallpaper.document,\n      previewBlobUrl,\n    },\n  };\n\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: [\n        withLocalMedia,\n        ...global.settings.loadedWallpapers.slice(1),\n      ],\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadBlockedUsers', async (global): Promise<void> => {\n  const result = await callApi('fetchBlockedUsers', {});\n  if (!result) return;\n\n  global = getGlobal();\n\n  global = {\n    ...global,\n    blocked: {\n      ids: result.blockedIds,\n      totalCount: result.totalCount,\n    },\n  };\n\n  setGlobal(global);\n});\n\naddActionHandler('blockUser', async (global, actions, payload): Promise<void> => {\n  const { userId, isOnlyStories } = payload;\n\n  const user = selectUser(global, userId);\n  if (!user) return;\n\n  const result = await callApi('blockUser', {\n    user,\n    isOnlyStories: isOnlyStories || undefined,\n  });\n  if (!result) return;\n\n  global = getGlobal();\n  global = addBlockedUser(global, userId);\n  setGlobal(global);\n});\n\naddActionHandler('unblockUser', async (global, actions, payload): Promise<void> => {\n  const { userId, isOnlyStories } = payload;\n\n  const user = selectUser(global, userId);\n  if (!user) return;\n\n  const result = await callApi('unblockUser', {\n    user,\n    isOnlyStories: isOnlyStories || undefined,\n  });\n  if (!result) return;\n\n  global = getGlobal();\n  global = removeBlockedUser(global, userId);\n  setGlobal(global);\n});\n\naddActionHandler('loadNotificationExceptions', async (global): Promise<void> => {\n  const result = await callApi('fetchNotificationExceptions');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = addNotifyExceptions(global, result);\n  setGlobal(global);\n});\n\naddActionHandler('loadNotificationSettings', async (global): Promise<void> => {\n  const result = await callApi('fetchNotificationSettings');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = replaceSettings(global, result);\n  setGlobal(global);\n});\n\naddActionHandler('updateNotificationSettings', async (global, actions, payload): Promise<void> => {\n  const { peerType, isSilent, shouldShowPreviews } = payload!;\n\n  const result = await callApi('updateNotificationSettings', peerType, { isSilent, shouldShowPreviews });\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = updateNotifySettings(global, peerType, isSilent, shouldShowPreviews);\n  setGlobal(global);\n});\n\naddActionHandler('updateWebNotificationSettings', async (global, actions, payload): Promise<void> => {\n  const oldSettings = global.settings.byKey;\n  global = replaceSettings(global, payload);\n  setGlobal(global);\n  const { hasWebNotifications, hasPushNotifications } = global.settings.byKey;\n  if (!oldSettings.hasPushNotifications && hasPushNotifications) {\n    await subscribe();\n  }\n  if (oldSettings.hasPushNotifications && !hasPushNotifications) {\n    await unsubscribe();\n  }\n  if (!oldSettings.hasWebNotifications && hasWebNotifications) {\n    const isGranted = await requestPermission();\n    if (!isGranted) {\n      global = getGlobal();\n      global = replaceSettings(global, { hasWebNotifications: false });\n      setGlobal(global);\n    }\n  }\n});\n\naddActionHandler('updateContactSignUpNotification', async (global, actions, payload): Promise<void> => {\n  const { isSilent } = payload;\n\n  const result = await callApi('updateContactSignUpNotification', isSilent);\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = replaceSettings(global, { hasContactJoinedNotifications: !isSilent });\n  setGlobal(global);\n});\n\naddActionHandler('loadLanguages', async (global): Promise<void> => {\n  const result = await callApi('fetchLanguages');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      languages: result,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadPrivacySettings', async (global): Promise<void> => {\n  const result = await Promise.all([\n    callApi('fetchPrivacySettings', 'phoneNumber'),\n    callApi('fetchPrivacySettings', 'addByPhone'),\n    callApi('fetchPrivacySettings', 'lastSeen'),\n    callApi('fetchPrivacySettings', 'profilePhoto'),\n    callApi('fetchPrivacySettings', 'forwards'),\n    callApi('fetchPrivacySettings', 'chatInvite'),\n    callApi('fetchPrivacySettings', 'phoneCall'),\n    callApi('fetchPrivacySettings', 'phoneP2P'),\n    callApi('fetchPrivacySettings', 'voiceMessages'),\n    callApi('fetchPrivacySettings', 'bio'),\n    callApi('fetchPrivacySettings', 'birthday'),\n    callApi('fetchPrivacySettings', 'gifts'),\n  ]);\n\n  if (result.some((e) => e === undefined)) {\n    return;\n  }\n\n  const [\n    phoneNumberSettings,\n    addByPhoneSettings,\n    lastSeenSettings,\n    profilePhotoSettings,\n    forwardsSettings,\n    chatInviteSettings,\n    phoneCallSettings,\n    phoneP2PSettings,\n    voiceMessagesSettings,\n    bioSettings,\n    birthdaySettings,\n    giftsSettings,\n  ] = result as {\n    rules: ApiPrivacySettings;\n  }[];\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        phoneNumber: phoneNumberSettings.rules,\n        addByPhone: addByPhoneSettings.rules,\n        lastSeen: lastSeenSettings.rules,\n        profilePhoto: profilePhotoSettings.rules,\n        forwards: forwardsSettings.rules,\n        chatInvite: chatInviteSettings.rules,\n        phoneCall: phoneCallSettings.rules,\n        phoneP2P: phoneP2PSettings.rules,\n        voiceMessages: voiceMessagesSettings.rules,\n        bio: bioSettings.rules,\n        birthday: birthdaySettings.rules,\n        gifts: giftsSettings.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setPrivacyVisibility', async (global, actions, payload): Promise<void> => {\n  const { privacyKey, visibility, onSuccess } = payload!;\n\n  if (!global.settings.privacy[privacyKey]) {\n    const result = await callApi('fetchPrivacySettings', privacyKey);\n    if (!result) {\n      return;\n    }\n\n    global = getGlobal();\n    global = {\n      ...global,\n      settings: {\n        ...global.settings,\n        privacy: {\n          ...global.settings.privacy,\n          [privacyKey]: result.rules,\n        },\n      },\n    };\n    setGlobal(global);\n  }\n\n  const {\n    privacy: { [privacyKey]: settings },\n  } = global.settings;\n\n  if (!settings) {\n    return;\n  }\n\n  const rules = buildApiInputPrivacyRules(global, {\n    visibility,\n    allowedIds: [...settings.allowUserIds, ...settings.allowChatIds],\n    blockedIds: [...settings.blockUserIds, ...settings.blockChatIds],\n    botsPrivacy: settings.botsPrivacy,\n  });\n\n  const result = await callApi('setPrivacySettings', privacyKey, rules);\n  if (!result) {\n    return;\n  }\n\n  onSuccess?.();\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        [privacyKey]: result.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setPrivacySettings', async (global, actions, payload): Promise<void> => {\n  const {\n    privacyKey, isAllowList, updatedIds, isPremiumAllowed, botsPrivacy,\n  } = payload!;\n  const {\n    privacy: { [privacyKey]: settings },\n  } = global.settings;\n\n  if (!settings) {\n    return;\n  }\n\n  const rules = buildApiInputPrivacyRules(global, {\n    visibility: settings.visibility,\n    isUnspecified: settings.isUnspecified,\n    shouldAllowPremium: isPremiumAllowed,\n    allowedIds: isAllowList ? updatedIds : [...settings.allowUserIds, ...settings.allowChatIds],\n    blockedIds: !isAllowList ? updatedIds : [...settings.blockUserIds, ...settings.blockChatIds],\n    botsPrivacy,\n  });\n\n  const result = await callApi('setPrivacySettings', privacyKey, rules);\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        [privacyKey]: result.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('updateIsOnline', (global, actions, payload): ActionReturnType => {\n  if (global.connectionState !== 'connectionStateReady') return;\n  callApi('updateIsOnline', payload);\n});\n\naddActionHandler('loadContentSettings', async (global): Promise<void> => {\n  const result = await callApi('fetchContentSettings');\n  if (!result) return;\n\n  global = getGlobal();\n  global = replaceSettings(global, result);\n  setGlobal(global);\n});\n\naddActionHandler('updateContentSettings', async (global, actions, payload): Promise<void> => {\n  global = replaceSettings(global, { isSensitiveEnabled: payload });\n  setGlobal(global);\n\n  const result = await callApi('updateContentSettings', payload);\n  if (!result) {\n    global = getGlobal();\n    global = replaceSettings(global, { isSensitiveEnabled: !payload });\n    setGlobal(global);\n  }\n});\n\naddActionHandler('loadCountryList', async (global, actions, payload): Promise<void> => {\n  let { langCode } = payload;\n  if (!langCode) langCode = global.settings.byKey.language;\n\n  const countryList = await callApi('fetchCountryList', { langCode });\n  if (!countryList) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    countryList,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('ensureTimeFormat', async (global, actions, payload): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload || {};\n  if (global.authNearestCountry) {\n    const timeFormat = COUNTRIES_WITH_12H_TIME_FORMAT\n      .has(global.authNearestCountry.toUpperCase()) ? '12h' : '24h';\n    actions.setSettingOption({ timeFormat, tabId });\n    setTimeFormat(timeFormat);\n  }\n\n  if (global.settings.byKey.wasTimeFormatSetManually) {\n    return;\n  }\n\n  const nearestCountryCode = await callApi('fetchNearestCountry');\n  if (nearestCountryCode) {\n    const timeFormat = COUNTRIES_WITH_12H_TIME_FORMAT.has(nearestCountryCode.toUpperCase()) ? '12h' : '24h';\n    actions.setSettingOption({ timeFormat, tabId });\n    setTimeFormat(timeFormat);\n  }\n});\n\naddActionHandler('loadAppConfig', async (global, actions, payload): Promise<void> => {\n  const hash = payload?.hash;\n\n  const appConfig = await callApi('fetchAppConfig', hash);\n  if (!appConfig) return;\n\n  requestActionTimeout({\n    action: 'loadAppConfig',\n    payload: { hash: appConfig.hash },\n  }, APP_CONFIG_REFETCH_INTERVAL);\n\n  global = getGlobal();\n  global = {\n    ...global,\n    appConfig,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadConfig', async (global): Promise<void> => {\n  const config = await callApi('fetchConfig');\n  if (!config) return;\n\n  global = getGlobal();\n  const timeout = config.expiresAt - getServerTime();\n  requestActionTimeout({\n    action: 'loadConfig',\n    payload: undefined,\n  }, timeout * 1000);\n\n  global = {\n    ...global,\n    config,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadPeerColors', async (global): Promise<void> => {\n  const hash = global.peerColors?.generalHash;\n  const result = await callApi('fetchPeerColors', hash);\n  if (!result) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    peerColors: {\n      ...global.peerColors,\n      general: result.colors,\n      generalHash: result.hash,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadTimezones', async (global): Promise<void> => {\n  const hash = global.timezones?.hash;\n  const result = await callApi('fetchTimezones', hash);\n  if (!result) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    timezones: {\n      byId: buildCollectionByKey(result.timezones, 'id'),\n      hash: result.hash,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadGlobalPrivacySettings', async (global): Promise<void> => {\n  const globalSettings = await callApi('fetchGlobalPrivacySettings');\n  if (!globalSettings) {\n    return;\n  }\n\n  global = getGlobal();\n  global = replaceSettings(global, { ...globalSettings });\n  setGlobal(global);\n});\n\naddActionHandler('updateGlobalPrivacySettings', async (global, actions, payload): Promise<void> => {\n  const shouldArchiveAndMuteNewNonContact = payload.shouldArchiveAndMuteNewNonContact\n    ?? Boolean(global.settings.byKey.shouldArchiveAndMuteNewNonContact);\n  const shouldHideReadMarks = payload.shouldHideReadMarks ?? Boolean(global.settings.byKey.shouldHideReadMarks);\n  const shouldNewNonContactPeersRequirePremium = payload.shouldNewNonContactPeersRequirePremium\n    ?? Boolean(global.settings.byKey.shouldNewNonContactPeersRequirePremium);\n\n  global = replaceSettings(global, { shouldArchiveAndMuteNewNonContact, shouldHideReadMarks });\n  setGlobal(global);\n\n  const result = await callApi('updateGlobalPrivacySettings', {\n    shouldArchiveAndMuteNewNonContact,\n    shouldHideReadMarks,\n    shouldNewNonContactPeersRequirePremium,\n  });\n\n  global = getGlobal();\n  global = replaceSettings(global, {\n    shouldArchiveAndMuteNewNonContact: !result\n      ? !shouldArchiveAndMuteNewNonContact\n      : result.shouldArchiveAndMuteNewNonContact,\n    shouldHideReadMarks: !result ? !shouldHideReadMarks : result.shouldHideReadMarks,\n    shouldNewNonContactPeersRequirePremium: !result\n      ? !shouldNewNonContactPeersRequirePremium\n      : result.shouldNewNonContactPeersRequirePremium,\n  });\n  setGlobal(global);\n});\n\naddActionHandler('toggleUsername', async (global, actions, payload): Promise<void> => {\n  const { username, isActive } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  const currentUser = selectUser(global, currentUserId);\n  if (!currentUser?.usernames) {\n    return;\n  }\n\n  const usernames = currentUser.usernames.map((item) => {\n    if (item.username !== username) {\n      return item;\n    }\n\n    return { ...item, isActive: isActive || undefined };\n  });\n\n  global = updateUser(global, currentUserId, { usernames });\n  setGlobal(global);\n\n  const result = await callApi('toggleUsername', { username, isActive });\n\n  if (!result) {\n    actions.loadFullUser({ userId: currentUserId });\n  }\n});\n\naddActionHandler('toggleChatUsername', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, username, isActive,\n  } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat?.usernames) {\n    return;\n  }\n\n  const usernames = chat.usernames.map((item) => {\n    if (item.username !== username) {\n      return item;\n    }\n\n    return { ...item, isActive: isActive || undefined };\n  });\n\n  global = updateChat(global, chatId, { usernames });\n  setGlobal(global);\n\n  const result = await callApi('toggleUsername', {\n    chatId: chat.id,\n    accessHash: chat.accessHash,\n    username,\n    isActive,\n  });\n\n  if (!result) {\n    actions.loadFullChat({ chatId });\n  }\n});\n\naddActionHandler('sortUsernames', async (global, actions, payload): Promise<void> => {\n  const { usernames } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  const result = await callApi('reorderUsernames', { usernames });\n\n  // After saving the order of usernames, server sends an update with the necessary data,\n  // so there is no need to update the state in this place\n  if (!result) {\n    actions.loadUser({ userId: currentUserId });\n  }\n});\n\naddActionHandler('sortChatUsernames', async (global, actions, payload): Promise<void> => {\n  const { chatId, usernames } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const prevUsernames = [...chat.usernames!];\n  const sortedUsernames = chat.usernames!.reduce((res, currentUsername) => {\n    const idx = usernames.findIndex((username) => username === currentUsername.username);\n    res[idx] = currentUsername;\n\n    return res;\n  }, [] as ApiUsername[]);\n\n  global = updateChat(global, chatId, { usernames: sortedUsernames });\n  setGlobal(global);\n\n  const result = await callApi('reorderUsernames', {\n    chatId: chat.id,\n    accessHash: chat.accessHash,\n    usernames,\n  });\n\n  if (!result) {\n    global = getGlobal();\n    global = updateChat(global, chatId, { usernames: prevUsernames });\n    setGlobal(global);\n  }\n});\n","import type {\n  ApiUpdateAuthorizationError,\n  ApiUpdateAuthorizationState,\n  ApiUpdateConnectionState,\n  ApiUpdateCurrentUser,\n  ApiUpdateServerTimeOffset,\n  ApiUpdateSession,\n} from '../../../api/types';\nimport type { LangCode } from '../../../types';\nimport type { RequiredGlobalActions } from '../../index';\nimport type { ActionReturnType, GlobalState } from '../../types';\n\nimport { SESSION_USER_KEY } from '../../../config';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { getShippingError, shouldClosePaymentModal } from '../../../util/getReadableErrorText';\nimport { unique } from '../../../util/iteratees';\nimport { oldSetLanguage } from '../../../util/oldLangProvider';\nimport { clearWebTokenAuth } from '../../../util/routing';\nimport { setServerTimeOffset } from '../../../util/serverTime';\nimport { forceWebsync } from '../../../util/websync';\nimport { isChatChannel, isChatSuperGroup } from '../../helpers';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from '../../index';\nimport { updateUser, updateUserFullInfo } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport { selectTabState } from '../../selectors';\n\naddActionHandler('apiUpdate', (global, actions, update): ActionReturnType => {\n  switch (update['@type']) {\n    case 'updateApiReady':\n      onUpdateApiReady(global);\n      break;\n\n    case 'updateAuthorizationState':\n      onUpdateAuthorizationState(global, update);\n      break;\n\n    case 'updateAuthorizationError':\n      onUpdateAuthorizationError(global, update);\n      break;\n\n    case 'updateWebAuthTokenFailed':\n      onUpdateWebAuthTokenFailed(global);\n      break;\n\n    case 'updateConnectionState':\n      onUpdateConnectionState(global, actions, update);\n      break;\n\n    case 'updateSession':\n      onUpdateSession(global, actions, update);\n      break;\n\n    case 'updateServerTimeOffset':\n      onUpdateServerTimeOffset(update);\n      break;\n\n    case 'updateCurrentUser':\n      onUpdateCurrentUser(global, update);\n      break;\n\n    case 'requestReconnectApi':\n      global = { ...global, isSynced: false };\n      setGlobal(global);\n\n      onUpdateConnectionState(global, actions, {\n        '@type': 'updateConnectionState',\n        connectionState: 'connectionStateConnecting',\n      });\n      actions.initApi();\n      break;\n\n    case 'requestSync':\n      actions.sync();\n      break;\n\n    case 'updateFetchingDifference':\n      global = { ...global, isFetchingDifference: update.isFetching };\n      setGlobal(global);\n      break;\n\n    case 'error': {\n      Object.values(global.byTabId).forEach(({ id: tabId }) => {\n        const paymentShippingError = getShippingError(update.error);\n        if (paymentShippingError) {\n          actions.addPaymentError({ error: paymentShippingError, tabId });\n        } else if (shouldClosePaymentModal(update.error)) {\n          actions.closePaymentModal({ tabId });\n        } else if (actions.showDialog) {\n          actions.showDialog({ data: update.error, tabId });\n        }\n      });\n\n      break;\n    }\n  }\n});\n\nfunction onUpdateApiReady<T extends GlobalState>(global: T) {\n  void oldSetLanguage(global.settings.byKey.language as LangCode);\n}\n\nfunction onUpdateAuthorizationState<T extends GlobalState>(global: T, update: ApiUpdateAuthorizationState) {\n  global = getGlobal();\n\n  const wasAuthReady = global.authState === 'authorizationStateReady';\n  const authState = update.authorizationState;\n\n  global = {\n    ...global,\n    authState,\n    authIsLoading: false,\n  };\n  setGlobal(global);\n\n  global = getGlobal();\n\n  switch (authState) {\n    case 'authorizationStateLoggingOut':\n      void forceWebsync(false);\n\n      global = {\n        ...global,\n        isLoggingOut: true,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitCode':\n      global = {\n        ...global,\n        authIsCodeViaApp: update.isCodeViaApp,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitPassword':\n      global = {\n        ...global,\n        authHint: update.hint,\n      };\n\n      if (update.noReset) {\n        global = {\n          ...global,\n          hasWebAuthTokenPasswordRequired: true,\n        };\n      }\n\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitQrCode':\n      global = {\n        ...global,\n        authIsLoadingQrCode: false,\n        authQrCode: update.qrCode,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateReady': {\n      if (wasAuthReady) {\n        break;\n      }\n\n      void forceWebsync(true);\n\n      global = {\n        ...global,\n        isLoggingOut: false,\n      };\n      Object.values(global.byTabId).forEach(({ id: tabId }) => {\n        global = updateTabState(global, {\n          isInactive: false,\n        }, tabId);\n      });\n      setGlobal(global);\n\n      break;\n    }\n  }\n}\n\nfunction onUpdateAuthorizationError<T extends GlobalState>(global: T, update: ApiUpdateAuthorizationError) {\n  global = {\n    ...global,\n    authErrorKey: update.errorKey,\n  };\n  setGlobal(global);\n}\n\nfunction onUpdateWebAuthTokenFailed<T extends GlobalState>(global: T) {\n  clearWebTokenAuth();\n  global = getGlobal();\n\n  global = {\n    ...global,\n    hasWebAuthTokenFailed: true,\n  };\n  setGlobal(global);\n}\n\nfunction onUpdateConnectionState<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, update: ApiUpdateConnectionState,\n) {\n  const { connectionState } = update;\n\n  global = getGlobal();\n  const tabState = selectTabState(global, getCurrentTabId());\n  if (connectionState === 'connectionStateReady' && tabState.isMasterTab && tabState.multitabNextAction) {\n    // @ts-ignore\n    actions[tabState.multitabNextAction.action](tabState.multitabNextAction.payload);\n    actions.clearMultitabNextAction({ tabId: tabState.id });\n  }\n\n  if (connectionState === global.connectionState) {\n    return;\n  }\n\n  global = {\n    ...global,\n    connectionState,\n  };\n  setGlobal(global);\n\n  if (global.isSynced) {\n    const channelStackIds = Object.values(global.byTabId)\n      .flatMap((tab) => tab.messageLists)\n      .map((messageList) => messageList.chatId)\n      .filter((chatId) => {\n        const chat = global.chats.byId[chatId];\n        return chat && (isChatChannel(chat) || isChatSuperGroup(chat));\n      });\n    if (connectionState === 'connectionStateReady' && channelStackIds.length) {\n      unique(channelStackIds).forEach((chatId) => {\n        actions.requestChannelDifference({ chatId });\n      });\n    }\n  }\n\n  if (connectionState === 'connectionStateBroken') {\n    actions.signOut({ forceInitApi: true });\n  }\n}\n\nfunction onUpdateSession<T extends GlobalState>(global: T, actions: RequiredGlobalActions, update: ApiUpdateSession) {\n  const { sessionData } = update;\n  const { authRememberMe, authState } = global;\n  const isEmpty = !sessionData || !sessionData.mainDcId;\n\n  const isTest = sessionData?.isTest;\n  if (isTest) {\n    global = {\n      ...global,\n      config: {\n        ...global.config,\n        isTestServer: isTest,\n      },\n    };\n    setGlobal(global);\n  }\n\n  if (!authRememberMe || authState !== 'authorizationStateReady' || isEmpty) {\n    return;\n  }\n\n  actions.saveSession({ sessionData });\n}\n\nfunction onUpdateServerTimeOffset(update: ApiUpdateServerTimeOffset) {\n  setServerTimeOffset(update.serverTimeOffset);\n}\n\nfunction onUpdateCurrentUser<T extends GlobalState>(global: T, update: ApiUpdateCurrentUser) {\n  const { currentUser, currentUserFullInfo } = update;\n\n  global = {\n    ...updateUser(global, currentUser.id, currentUser),\n    currentUserId: currentUser.id,\n  };\n  global = updateUserFullInfo(global, currentUser.id, currentUserFullInfo);\n  setGlobal(global);\n\n  updateSessionUserId(currentUser.id);\n}\n\nfunction updateSessionUserId(currentUserId: string) {\n  const sessionUserAuth = localStorage.getItem(SESSION_USER_KEY);\n  if (!sessionUserAuth) return;\n\n  const userAuth = JSON.parse(sessionUserAuth);\n  userAuth.id = currentUserId;\n\n  localStorage.setItem(SESSION_USER_KEY, JSON.stringify(userAuth));\n}\n","import { addCallback } from '../../../lib/teact/teactn';\n\nimport type { LangCode } from '../../../types';\nimport type { ActionReturnType, GlobalState } from '../../types';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { subscribe, unsubscribe } from '../../../util/notifications';\nimport { oldSetLanguage } from '../../../util/oldLangProvider';\nimport { decryptSessionByCurrentHash } from '../../../util/passcode';\nimport { applyPerformanceSettings } from '../../../util/perfomanceSettings';\nimport { hasStoredSession, storeSession } from '../../../util/sessions';\nimport switchTheme from '../../../util/switchTheme';\nimport { getSystemTheme, setSystemThemeChangeCallback } from '../../../util/systemTheme';\nimport { startWebsync, stopWebsync } from '../../../util/websync';\nimport {\n  IS_ANDROID, IS_ELECTRON, IS_IOS, IS_LINUX,\n  IS_MAC_OS, IS_SAFARI, IS_TOUCH_ENV, IS_WINDOWS,\n} from '../../../util/windowEnvironment';\nimport { callApi } from '../../../api/gramjs';\nimport { clearCaching, setupCaching } from '../../cache';\nimport { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport { replaceSettings } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport {\n  selectCanAnimateInterface,\n  selectNotifySettings, selectPerformanceSettings, selectTabState, selectTheme,\n} from '../../selectors';\n\nconst HISTORY_ANIMATION_DURATION = 450;\n\nsetSystemThemeChangeCallback((theme) => {\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  let global = getGlobal();\n\n  if (!global.isInited || !global.settings.byKey.shouldUseSystemTheme) return;\n\n  global = replaceSettings(global, { theme });\n  setGlobal(global);\n});\n\naddActionHandler('switchMultitabRole', async (global, actions, payload): Promise<void> => {\n  const { isMasterTab, tabId = getCurrentTabId() } = payload;\n\n  if (isMasterTab === selectTabState(global, tabId).isMasterTab) {\n    callApi('broadcastLocalDbUpdateFull');\n    return;\n  }\n\n  global = updateTabState(global, {\n    isMasterTab,\n  }, tabId);\n  setGlobal(global, { forceSyncOnIOs: true });\n\n  if (!isMasterTab) {\n    void unsubscribe();\n    actions.destroyConnection();\n    stopWebsync();\n    clearCaching();\n    actions.onSomeTabSwitchedMultitabRole();\n  } else {\n    if (global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n      const { sessionJson } = await decryptSessionByCurrentHash();\n      const session = JSON.parse(sessionJson);\n      storeSession(session, session.userId);\n    }\n\n    if (hasStoredSession()) {\n      setupCaching();\n    }\n\n    global = getGlobal();\n    if (!global.passcode.hasPasscode || !global.passcode.isScreenLocked) {\n      if (global.connectionState === 'connectionStateReady') {\n        global = {\n          ...global,\n          connectionState: 'connectionStateConnecting',\n        };\n        setGlobal(global);\n      }\n      actions.initApi();\n    }\n\n    startWebsync();\n  }\n});\n\naddActionHandler('onSomeTabSwitchedMultitabRole', async (global): Promise<void> => {\n  if (global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n    const { sessionJson } = await decryptSessionByCurrentHash();\n    const session = JSON.parse(sessionJson);\n    storeSession(session, session.userId);\n  }\n\n  callApi('broadcastLocalDbUpdateFull');\n});\n\naddActionHandler('initShared', (): ActionReturnType => {\n  startWebsync();\n});\n\naddActionHandler('initMain', (global): ActionReturnType => {\n  const { hasWebNotifications, hasPushNotifications } = selectNotifySettings(global);\n  if (hasWebNotifications && hasPushNotifications) {\n    // Most of the browsers only show the notifications permission prompt after the first user gesture.\n    const events = ['click', 'keypress'];\n    const subscribeAfterUserGesture = () => {\n      void subscribe();\n      events.forEach((event) => {\n        document.removeEventListener(event, subscribeAfterUserGesture);\n      });\n    };\n    events.forEach((event) => {\n      document.addEventListener(event, subscribeAfterUserGesture, { once: true });\n    });\n  }\n});\n\naddCallback((global: GlobalState) => {\n  let isUpdated = false;\n  const tabState = selectTabState(global, getCurrentTabId());\n  if (!tabState?.shouldInit) return;\n\n  global = getGlobal();\n\n  global = updateTabState(global, {\n    shouldInit: false,\n  }, tabState.id);\n\n  const { messageTextSize, language } = global.settings.byKey;\n\n  const globalTheme = selectTheme(global);\n  const systemTheme = getSystemTheme();\n  const theme = global.settings.byKey.shouldUseSystemTheme ? systemTheme : globalTheme;\n\n  const performanceType = selectPerformanceSettings(global);\n\n  void oldSetLanguage(language as LangCode, undefined, true);\n\n  requestMutation(() => {\n    document.documentElement.style.setProperty(\n      '--composer-text-size', `${Math.max(messageTextSize, IS_IOS ? 16 : 15)}px`,\n    );\n    document.documentElement.style.setProperty('--message-meta-height', `${Math.floor(messageTextSize * 1.3125)}px`);\n    document.documentElement.style.setProperty('--message-text-size', `${messageTextSize}px`);\n    document.documentElement.setAttribute('data-message-text-size', messageTextSize.toString());\n    document.body.classList.add('initial');\n    document.body.classList.add(IS_TOUCH_ENV ? 'is-touch-env' : 'is-pointer-env');\n    applyPerformanceSettings(performanceType);\n\n    if (IS_IOS) {\n      document.body.classList.add('is-ios');\n    } else if (IS_ANDROID) {\n      document.body.classList.add('is-android');\n    } else if (IS_MAC_OS) {\n      document.body.classList.add('is-macos');\n    } else if (IS_WINDOWS) {\n      document.body.classList.add('is-windows');\n    } else if (IS_LINUX) {\n      document.body.classList.add('is-linux');\n    }\n    if (IS_SAFARI) {\n      document.body.classList.add('is-safari');\n    }\n    if (IS_ELECTRON) {\n      document.body.classList.add('is-electron');\n    }\n  });\n\n  const canAnimate = selectCanAnimateInterface(global);\n\n  switchTheme(theme, canAnimate);\n  // Make sure global has the latest theme. Will cause `switchTheme` on change\n  global = replaceSettings(global, { theme });\n\n  startWebsync();\n\n  isUpdated = true;\n\n  if (isUpdated) setGlobal(global);\n});\n\naddActionHandler('setInstallPrompt', (global, actions, payload): ActionReturnType => {\n  const { canInstall, tabId = getCurrentTabId() } = payload;\n  return updateTabState(global, {\n    canInstall,\n  }, tabId);\n});\n\naddActionHandler('setIsUiReady', (global, actions, payload): ActionReturnType => {\n  const { uiReadyState, tabId = getCurrentTabId() } = payload!;\n\n  if (uiReadyState === 2) {\n    requestMutation(() => {\n      document.body.classList.remove('initial');\n    });\n  }\n\n  return updateTabState(global, {\n    uiReadyState,\n  }, tabId);\n});\n\naddActionHandler('setAuthPhoneNumber', (global, actions, payload): ActionReturnType => {\n  const { phoneNumber } = payload!;\n\n  return {\n    ...global,\n    authPhoneNumber: phoneNumber,\n  };\n});\n\naddActionHandler('setAuthRememberMe', (global, actions, payload): ActionReturnType => {\n  return {\n    ...global,\n    authRememberMe: Boolean(payload),\n  };\n});\n\naddActionHandler('clearAuthErrorKey', (global): ActionReturnType => {\n  return {\n    ...global,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('disableHistoryAnimations', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  setTimeout(() => {\n    global = getGlobal();\n    global = updateTabState(global, {\n      shouldSkipHistoryAnimations: false,\n    }, tabId);\n    setGlobal(global);\n\n    requestMutation(() => {\n      document.body.classList.remove('no-animate');\n    });\n  }, HISTORY_ANIMATION_DURATION);\n\n  global = updateTabState(global, {\n    shouldSkipHistoryAnimations: true,\n  }, tabId);\n  setGlobal(global, { forceSyncOnIOs: true });\n});\n","import { addCallback } from '../../../lib/teact/teactn';\n\nimport type { ActionReturnType, GlobalState } from '../../types';\nimport { type LangCode, SettingsScreens } from '../../../types';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { disableDebugConsole, initDebugConsole } from '../../../util/debugConsole';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { oldSetLanguage, setTimeFormat } from '../../../util/oldLangProvider';\nimport { applyPerformanceSettings } from '../../../util/perfomanceSettings';\nimport switchTheme from '../../../util/switchTheme';\nimport { updatePeerColors } from '../../../util/theme';\nimport { IS_IOS } from '../../../util/windowEnvironment';\nimport { callApi, setShouldEnableDebugLog } from '../../../api/gramjs';\nimport {\n  addActionHandler, getActions, getGlobal, setGlobal,\n} from '../../index';\nimport { replaceSettings, replaceThemeSettings } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport { selectCanAnimateInterface, selectChatFolder } from '../../selectors';\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  // eslint-disable-next-line eslint-multitab-tt/no-getactions-in-actions\n  const { updatePageTitle, updateShouldDebugExportedSenders, updateShouldEnableDebugLog } = getActions();\n\n  const oldGlobal = prevGlobal;\n  prevGlobal = global;\n\n  if (!oldGlobal) return;\n\n  const settings = global.settings.byKey;\n  const prevSettings = oldGlobal.settings.byKey;\n  const performance = global.settings.performance;\n  const prevPerformance = oldGlobal.settings.performance;\n  const peerColors = global.peerColors;\n  const prevPeerColors = oldGlobal.peerColors;\n\n  if (peerColors && peerColors !== prevPeerColors) {\n    updatePeerColors(peerColors.general);\n  }\n\n  if (performance !== prevPerformance) {\n    requestMutation(() => {\n      applyPerformanceSettings(performance);\n    });\n  }\n\n  if (settings.theme !== prevSettings.theme) {\n    const withAnimation = document.hasFocus() ? selectCanAnimateInterface(global) : false;\n    switchTheme(settings.theme, withAnimation);\n  }\n\n  if (settings.language !== prevSettings.language) {\n    oldSetLanguage(settings.language as LangCode);\n  }\n\n  if (settings.timeFormat !== prevSettings.timeFormat) {\n    setTimeFormat(settings.timeFormat);\n  }\n\n  if (settings.messageTextSize !== prevSettings.messageTextSize) {\n    document.documentElement.style.setProperty(\n      '--composer-text-size', `${Math.max(settings.messageTextSize, IS_IOS ? 16 : 15)}px`,\n    );\n    document.documentElement.style.setProperty('--message-meta-height',\n      `${Math.floor(settings.messageTextSize * 1.3125)}px`);\n    document.documentElement.style.setProperty('--message-text-size', `${settings.messageTextSize}px`);\n    document.documentElement.setAttribute('data-message-text-size', settings.messageTextSize.toString());\n  }\n\n  if (settings.canDisplayChatInTitle !== prevSettings.canDisplayChatInTitle) {\n    updatePageTitle();\n  }\n\n  if (settings.shouldForceHttpTransport !== prevSettings.shouldForceHttpTransport) {\n    callApi('setForceHttpTransport', Boolean(settings.shouldForceHttpTransport));\n  }\n\n  if (settings.shouldAllowHttpTransport !== prevSettings.shouldAllowHttpTransport) {\n    callApi('setAllowHttpTransport', Boolean(settings.shouldAllowHttpTransport));\n    if (!settings.shouldAllowHttpTransport && settings.shouldForceHttpTransport) {\n      global = getGlobal();\n      global = {\n        ...global,\n        settings: {\n          ...global.settings,\n          byKey: {\n            ...global.settings.byKey,\n            shouldForceHttpTransport: false,\n          },\n        },\n      };\n      setGlobal(global);\n    }\n  }\n\n  if (settings.shouldDebugExportedSenders !== prevSettings.shouldDebugExportedSenders) {\n    updateShouldDebugExportedSenders();\n  }\n\n  if (settings.shouldCollectDebugLogs !== prevSettings.shouldCollectDebugLogs) {\n    updateShouldEnableDebugLog();\n  }\n});\n\naddActionHandler('updateShouldEnableDebugLog', (global): ActionReturnType => {\n  const { settings } = global;\n\n  if (settings.byKey.shouldCollectDebugLogs) {\n    setShouldEnableDebugLog(true);\n    initDebugConsole();\n  } else {\n    setShouldEnableDebugLog(false);\n    disableDebugConsole();\n  }\n});\n\naddActionHandler('updateShouldDebugExportedSenders', (global): ActionReturnType => {\n  const { settings } = global;\n  callApi('setShouldDebugExportedSenders', Boolean(settings.byKey.shouldDebugExportedSenders));\n});\n\naddActionHandler('setSettingOption', (global, actions, payload): ActionReturnType => {\n  return replaceSettings(global, payload);\n});\n\naddActionHandler('updatePerformanceSettings', (global, actions, payload): ActionReturnType => {\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      performance: {\n        ...global.settings.performance,\n        ...payload,\n      },\n    },\n  };\n\n  return global;\n});\n\naddActionHandler('setThemeSettings', (global, actions, payload): ActionReturnType => {\n  const { theme, ...settings } = payload;\n\n  return replaceThemeSettings(global, theme, settings);\n});\n\naddActionHandler('requestNextSettingsScreen', (global, actions, payload): ActionReturnType => {\n  const { screen, foldersAction, tabId = getCurrentTabId() } = payload;\n  return updateTabState(global, {\n    nextSettingsScreen: screen,\n    nextFoldersAction: foldersAction,\n  }, tabId);\n});\n\naddActionHandler('openEditChatFolder', (global, actions, payload): ActionReturnType => {\n  const { folderId, isOnlyInvites, tabId = getCurrentTabId(), isModal } = payload;\n\n  const chatFolder = selectChatFolder(global, folderId);\n  if (!chatFolder) return;\n\n  actions.requestNextSettingsScreen({\n    screen: isOnlyInvites ? SettingsScreens.FoldersEditFolderInvites : SettingsScreens.FoldersEditFolderFromChatList,\n    foldersAction: {\n      type: 'editFolder',\n      payload: {isModal, ...chatFolder},\n    },\n    tabId,\n  });\n});\n\naddActionHandler('openShareChatFolderModal', (global, actions, payload): ActionReturnType => {\n  const {\n    folderId, url, noRequestNextScreen, tabId = getCurrentTabId(),\n  } = payload;\n\n  const chatFolder = selectChatFolder(global, folderId);\n  const isChatList = chatFolder?.isChatList;\n  if (isChatList && !noRequestNextScreen) {\n    actions.openEditChatFolder({ folderId, isOnlyInvites: true, tabId });\n    return undefined;\n  }\n\n  if (!noRequestNextScreen) actions.requestNextSettingsScreen({ screen: SettingsScreens.FoldersShare, tabId });\n\n  return updateTabState(global, {\n    shareFolderScreen: {\n      folderId,\n      isFromSettings: Boolean(noRequestNextScreen),\n      url,\n    },\n  }, tabId);\n});\n\naddActionHandler('closeShareChatFolderModal', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  actions.requestNextSettingsScreen({ screen: undefined, tabId });\n\n  return updateTabState(global, {\n    shareFolderScreen: undefined,\n  }, tabId);\n});\n","/* eslint-disable eslint-multitab-tt/no-immediate-global */\nimport { getIsHeavyAnimating, onFullyIdle } from '../lib/teact/teact';\nimport { addCallback, removeCallback } from '../lib/teact/teactn';\n\nimport type {\n  ApiAvailableReaction,\n  ApiMessage,\n} from '../api/types';\nimport type { MessageList, ThreadId } from '../types';\nimport type { ActionReturnType, GlobalState } from './types';\nimport { MAIN_THREAD_ID } from '../api/types';\n\nimport {\n  ALL_FOLDER_ID,\n  ANIMATION_LEVEL_MED,\n  ANIMATION_LEVEL_MIN,\n  ARCHIVED_FOLDER_ID,\n  DEBUG,\n  DEFAULT_LIMITS,\n  GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT,\n  GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT,\n  GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT,\n  GLOBAL_STATE_CACHE_DISABLED,\n  GLOBAL_STATE_CACHE_KEY,\n  GLOBAL_STATE_CACHE_USER_LIST_LIMIT,\n  IS_SCREEN_LOCKED_CACHE_KEY,\n  SAVED_FOLDER_ID,\n} from '../config';\nimport { MAIN_IDB_STORE } from '../util/browser/idb';\nimport { getOrderedIds } from '../util/folderManager';\nimport {\n  compact, pick, pickTruthy, unique,\n} from '../util/iteratees';\nimport { encryptSession } from '../util/passcode';\nimport { onBeforeUnload, throttle } from '../util/schedulers';\nimport { hasStoredSession } from '../util/sessions';\nimport { isUserId } from './helpers';\nimport { addActionHandler, getGlobal } from './index';\nimport { INITIAL_GLOBAL_STATE, INITIAL_PERFORMANCE_STATE_MID, INITIAL_PERFORMANCE_STATE_MIN } from './initialState';\nimport { clearGlobalForLockScreen } from './reducers';\nimport {\n  selectChatLastMessageId,\n  selectChatMessages,\n  selectCurrentMessageList,\n  selectTopics,\n  selectViewportIds,\n  selectVisibleUsers,\n} from './selectors';\n\nimport { getIsMobile } from '../hooks/useAppLayout';\n\nconst UPDATE_THROTTLE = 5000;\n\nconst updateCacheThrottled = throttle(() => onFullyIdle(() => updateCache()), UPDATE_THROTTLE, false);\nconst updateCacheForced = () => updateCache(true);\n\nlet isCaching = false;\nlet isRemovingCache = false;\nlet unsubscribeFromBeforeUnload: NoneToVoidFunction | undefined;\n\nexport function cacheGlobal(global: GlobalState) {\n  return MAIN_IDB_STORE.set(GLOBAL_STATE_CACHE_KEY, global);\n}\n\nexport function loadCachedGlobal() {\n  return MAIN_IDB_STORE.get<GlobalState>(GLOBAL_STATE_CACHE_KEY);\n}\n\nexport function removeGlobalFromCache() {\n  return MAIN_IDB_STORE.del(GLOBAL_STATE_CACHE_KEY);\n}\n\nfunction cacheIsScreenLocked(global: GlobalState) {\n  if (global?.passcode?.isScreenLocked) localStorage.setItem(IS_SCREEN_LOCKED_CACHE_KEY, 'true');\n}\n\nexport function initCache() {\n  if (GLOBAL_STATE_CACHE_DISABLED) {\n    return;\n  }\n\n  const resetCache = () => {\n    isRemovingCache = true;\n    removeGlobalFromCache().finally(() => {\n      localStorage.removeItem(IS_SCREEN_LOCKED_CACHE_KEY);\n      isRemovingCache = false;\n      if (!isCaching) {\n        return;\n      }\n\n      clearCaching();\n    });\n  };\n\n  addActionHandler('saveSession', (): ActionReturnType => {\n    if (isCaching) {\n      return;\n    }\n\n    setupCaching();\n    updateCacheForced();\n  });\n\n  addActionHandler('reset', resetCache);\n}\n\nexport async function loadCache(initialState: GlobalState): Promise<GlobalState | undefined> {\n  if (GLOBAL_STATE_CACHE_DISABLED) {\n    return undefined;\n  }\n\n  const cache = await readCache(initialState);\n\n  if (cache.passcode.hasPasscode || hasStoredSession()) {\n    setupCaching();\n\n    return cache;\n  } else {\n    clearCaching();\n\n    return undefined;\n  }\n}\n\nexport function setupCaching() {\n  isCaching = true;\n  unsubscribeFromBeforeUnload = onBeforeUnload(updateCacheForced, true);\n  window.addEventListener('blur', updateCacheForced);\n  addCallback(updateCacheThrottled);\n}\n\nexport function clearCaching() {\n  isCaching = false;\n  removeCallback(updateCacheThrottled);\n  window.removeEventListener('blur', updateCacheForced);\n  if (unsubscribeFromBeforeUnload) {\n    unsubscribeFromBeforeUnload();\n  }\n}\n\nasync function readCache(initialState: GlobalState): Promise<GlobalState> {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.time('global-state-cache-read');\n  }\n\n  const json = localStorage.getItem(GLOBAL_STATE_CACHE_KEY);\n  const cachedFromLocalStorage = json ? JSON.parse(json) as GlobalState : undefined;\n  if (cachedFromLocalStorage) localStorage.removeItem(GLOBAL_STATE_CACHE_KEY);\n\n  const cached = cachedFromLocalStorage || await loadCachedGlobal();\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.timeEnd('global-state-cache-read');\n  }\n\n  if (cached) {\n    migrateCache(cached, initialState);\n  }\n\n  const newState = {\n    ...initialState,\n    ...cached,\n  };\n\n  return newState;\n}\n\nexport function migrateCache(cached: GlobalState, initialState: GlobalState) {\n  try {\n    unsafeMigrateCache(cached, initialState);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n  }\n}\n\nfunction unsafeMigrateCache(cached: GlobalState, initialState: GlobalState) {\n  const untypedCached = cached as any;\n  // Pre-fill settings with defaults\n  cached.settings.byKey = {\n    ...initialState.settings.byKey,\n    ...cached.settings.byKey,\n  };\n\n  cached.settings.themes = {\n    ...initialState.settings.themes,\n    ...cached.settings.themes,\n  };\n\n  cached.chatFolders = {\n    ...initialState.chatFolders,\n    ...cached.chatFolders,\n  };\n\n  if (!cached.settings.performance) {\n    if (cached.settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n      cached.settings.performance = INITIAL_PERFORMANCE_STATE_MIN;\n    } else if (cached.settings.byKey.animationLevel === ANIMATION_LEVEL_MED) {\n      cached.settings.performance = INITIAL_PERFORMANCE_STATE_MID;\n    } else {\n      cached.settings.performance = initialState.settings.performance;\n    }\n  }\n\n  cached.settings.performance = {\n    ...initialState.settings.performance,\n    ...cached.settings.performance,\n  };\n\n  if (cached.appConfig && !cached.appConfig.limits) {\n    cached.appConfig.limits = DEFAULT_LIMITS;\n  }\n\n  if (!cached.chats.similarChannelsById) {\n    cached.chats.similarChannelsById = initialState.chats.similarChannelsById;\n  }\n\n  if (!cached.chats.similarBotsById) {\n    cached.chats.similarBotsById = initialState.chats.similarBotsById;\n  }\n\n  if (!cached.chats.lastMessageIds) {\n    cached.chats.lastMessageIds = initialState.chats.lastMessageIds;\n  }\n\n  // Clear old color storage to optimize cache size\n  if (untypedCached?.appConfig?.peerColors) {\n    untypedCached.appConfig.peerColors = undefined;\n    untypedCached.appConfig.darkPeerColors = undefined;\n  }\n\n  if (!cached.fileUploads.byMessageKey) {\n    cached.fileUploads.byMessageKey = {};\n  }\n\n  if (!cached.reactions) {\n    cached.reactions = initialState.reactions;\n  }\n\n  if (!cached.quickReplies) {\n    cached.quickReplies = initialState.quickReplies;\n  }\n\n  if (!cached.users.previewMediaByBotId) {\n    cached.users.previewMediaByBotId = initialState.users.previewMediaByBotId;\n  }\n  if (!cached.chats.loadingParameters) {\n    cached.chats.loadingParameters = initialState.chats.loadingParameters;\n  }\n  if (!cached.topBotApps) {\n    cached.topBotApps = initialState.topBotApps;\n  }\n\n  if (!cached.reactions.defaultTags?.[0]?.type) {\n    cached.reactions = initialState.reactions;\n  }\n\n  if (!cached.users.commonChatsById) {\n    cached.users.commonChatsById = initialState.users.commonChatsById;\n  }\n  if (!cached.users.botAppPermissionsById) {\n    cached.users.botAppPermissionsById = initialState.users.botAppPermissionsById;\n  }\n  if (!cached.chats.topicsInfoById) {\n    cached.chats.topicsInfoById = initialState.chats.topicsInfoById;\n  }\n\n  if (!cached.messages.pollById) {\n    cached.messages.pollById = initialState.messages.pollById;\n  }\n  if (!cached.settings.botVerificationShownPeerIds) {\n    cached.settings.botVerificationShownPeerIds = initialState.settings.botVerificationShownPeerIds;\n  }\n\n  if (!cached.peers) {\n    cached.peers = initialState.peers;\n  }\n}\n\nfunction updateCache(force?: boolean) {\n  const global = getGlobal();\n  if (isRemovingCache || !isCaching || global.isLoggingOut || (!force && getIsHeavyAnimating())) {\n    return;\n  }\n\n  forceUpdateCache();\n}\n\nexport function forceUpdateCache(noEncrypt = false) {\n  const global = getGlobal();\n  const { hasPasscode, isScreenLocked } = global.passcode;\n\n  if (hasPasscode) {\n    if (!isScreenLocked && !noEncrypt) {\n      const serializedGlobal = serializeGlobal(global);\n      void encryptSession(undefined, serializedGlobal);\n    }\n\n    cacheIsScreenLocked(global);\n    cacheGlobal(clearGlobalForLockScreen(global, false));\n    return;\n  }\n\n  cacheIsScreenLocked(global);\n  cacheGlobal(reduceGlobal(global));\n}\n\nfunction reduceGlobal<T extends GlobalState>(global: T) {\n  const reducedGlobal: GlobalState = {\n    ...INITIAL_GLOBAL_STATE,\n    ...pick(global, [\n      'appConfig',\n      'config',\n      'authState',\n      'authPhoneNumber',\n      'authRememberMe',\n      'authNearestCountry',\n      'attachMenu',\n      'currentUserId',\n      'contactList',\n      'topPeers',\n      'topInlineBots',\n      'topBotApps',\n      'recentEmojis',\n      'recentCustomEmojis',\n      'push',\n      'serviceNotifications',\n      'attachmentSettings',\n      'leftColumnWidth',\n      'archiveSettings',\n      'mediaViewer',\n      'audioPlayer',\n      'shouldShowContextMenuHint',\n      'trustedBotIds',\n      'recentlyFoundChatIds',\n      'peerColors',\n      'savedReactionTags',\n      'timezones',\n      'availableEffectById',\n    ]),\n    lastIsChatInfoShown: !getIsMobile() ? global.lastIsChatInfoShown : undefined,\n    customEmojis: reduceCustomEmojis(global),\n    users: reduceUsers(global),\n    chats: reduceChats(global),\n    messages: reduceMessages(global),\n    settings: reduceSettings(global),\n    chatFolders: reduceChatFolders(global),\n    groupCalls: reduceGroupCalls(global),\n    reactions: {\n      ...pick(global.reactions, [\n        'defaultTags',\n        'recentReactions',\n        'topReactions',\n        'effectReactions',\n        'hash',\n      ]),\n      availableReactions: reduceAvailableReactions(global.reactions.availableReactions),\n    },\n    passcode: pick(global.passcode, [\n      'isScreenLocked',\n      'hasPasscode',\n      'invalidAttemptsCount',\n      'timeoutUntil',\n    ]),\n  };\n\n  return reducedGlobal;\n}\n\nexport function serializeGlobal<T extends GlobalState>(global: T) {\n  return JSON.stringify(reduceGlobal(global));\n}\n\nfunction reduceCustomEmojis<T extends GlobalState>(global: T): GlobalState['customEmojis'] {\n  const { lastRendered, byId } = global.customEmojis;\n  const idsToSave = lastRendered.slice(0, GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT);\n  const byIdToSave = pick(byId, idsToSave);\n\n  return {\n    byId: byIdToSave,\n    lastRendered: idsToSave,\n    forEmoji: {},\n    added: {},\n    statusRecent: {},\n  };\n}\n\nfunction reduceUsers<T extends GlobalState>(global: T): GlobalState['users'] {\n  const {\n    users: {\n      byId, statusesById, fullInfoById, botAppPermissionsById,\n    }, currentUserId,\n  } = global;\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }) => selectCurrentMessageList(global, tabId)),\n  ).map(({ chatId }) => chatId).filter((chatId) => isUserId(chatId));\n\n  const visibleUserIds = unique(compact(Object.values(global.byTabId)\n    .flatMap(({ id: tabId }) => selectVisibleUsers(global, tabId)?.map((u) => u.id) || [])));\n\n  const chatStoriesUserIds = currentChatIds\n    .flatMap((chatId) => Object.values(selectChatMessages(global, chatId) || {}))\n    .map((message) => message.content.storyData?.peerId || message.content.webPage?.story?.peerId)\n    .filter((id): id is string => Boolean(id) && isUserId(id));\n\n  const attachBotIds = Object.keys(global.attachMenu?.bots || {});\n\n  const idsToSave = unique([\n    ...currentUserId ? [currentUserId] : [],\n    ...currentChatIds,\n    ...chatStoriesUserIds,\n    ...visibleUserIds || [],\n    ...attachBotIds,\n    ...global.topPeers.userIds || [],\n    ...global.recentlyFoundChatIds?.filter(isUserId) || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT).filter(isUserId) || [],\n    ...getOrderedIds(ALL_FOLDER_ID)?.filter(isUserId) || [],\n    ...global.contactList?.userIds || [],\n    ...Object.keys(byId),\n  ]).slice(0, GLOBAL_STATE_CACHE_USER_LIST_LIMIT);\n\n  return {\n    ...INITIAL_GLOBAL_STATE.users,\n    byId: pickTruthy(byId, idsToSave),\n    statusesById: pickTruthy(statusesById, idsToSave),\n    fullInfoById: pickTruthy(fullInfoById, idsToSave),\n    botAppPermissionsById,\n  };\n}\n\nfunction reduceChats<T extends GlobalState>(global: T): GlobalState['chats'] {\n  const { chats: { byId }, currentUserId } = global;\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }): MessageList | undefined => {\n        return selectCurrentMessageList(global, tabId);\n      }),\n  ).map(({ chatId }) => chatId);\n\n  const messagesChatIds = compact(Object.values(global.byTabId).flatMap(({ id: tabId }) => {\n    const messageList = selectCurrentMessageList(global, tabId);\n    if (!messageList) return undefined;\n\n    const messages = selectChatMessages(global, messageList.chatId);\n    const viewportIds = selectViewportIds(global, messageList.chatId, messageList.threadId, tabId);\n    return viewportIds?.map((id) => {\n      const message = messages[id];\n      if (!message) return undefined;\n      const content = message.content;\n      const replyPeer = message.replyInfo?.type === 'message' && message.replyInfo.replyToPeerId;\n      return content.storyData?.peerId || content.webPage?.story?.peerId || replyPeer;\n    });\n  }));\n\n  const idsToSave = unique([\n    ...currentUserId ? [currentUserId] : [],\n    ...currentChatIds,\n    ...messagesChatIds,\n    ...global.recentlyFoundChatIds || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT) || [],\n    ...getOrderedIds(ALL_FOLDER_ID) || [],\n    ...getOrderedIds(SAVED_FOLDER_ID) || [],\n    ...Object.keys(byId),\n  ]).slice(0, GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT);\n\n  return {\n    ...global.chats,\n    similarChannelsById: {},\n    similarBotsById: {},\n    isFullyLoaded: {},\n    loadingParameters: INITIAL_GLOBAL_STATE.chats.loadingParameters,\n    byId: pickTruthy(global.chats.byId, idsToSave),\n    fullInfoById: pickTruthy(global.chats.fullInfoById, idsToSave),\n    lastMessageIds: {\n      all: pickTruthy(global.chats.lastMessageIds.all || {}, idsToSave),\n      saved: global.chats.lastMessageIds.saved,\n    },\n    topicsInfoById: pickTruthy(global.chats.topicsInfoById, currentChatIds),\n  };\n}\n\nfunction reduceMessages<T extends GlobalState>(global: T): GlobalState['messages'] {\n  const { currentUserId } = global;\n  const byChatId: GlobalState['messages']['byChatId'] = {};\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }) => selectCurrentMessageList(global, tabId)),\n  ).map(({ chatId }) => chatId);\n  const forumPanelChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ forumPanelChatId }) => forumPanelChatId),\n  );\n  const chatIdsToSave = unique([\n    ...currentChatIds,\n    ...currentUserId ? [currentUserId] : [],\n    ...forumPanelChatIds,\n    ...getOrderedIds(ALL_FOLDER_ID) || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT) || [],\n  ]);\n\n  const openedChatThreadIds = Object.values(global.byTabId).reduce((acc, { id: tabId }) => {\n    const { chatId: tabChatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n    if (!tabChatId || !threadId || threadId === MAIN_THREAD_ID) {\n      return acc;\n    }\n    const current = acc[tabChatId] || new Set();\n    current.add(threadId);\n    acc[tabChatId] = current;\n\n    return acc;\n  }, {} as Record<string, Set<ThreadId>>);\n\n  const pollIdsToSave: string[] = [];\n\n  chatIdsToSave.forEach((chatId) => {\n    const current = global.messages.byChatId[chatId];\n    if (!current) {\n      return;\n    }\n\n    const chatLastMessageId = selectChatLastMessageId(global, chatId);\n\n    const openedThreadIds = Array.from(openedChatThreadIds[chatId] || []);\n    const commentThreadIds = Object.values(global.messages.byChatId[chatId].threadsById || {})\n      .map(({ threadInfo }) => (threadInfo?.isCommentsInfo ? threadInfo?.originMessageId : undefined))\n      .filter(Boolean);\n    const threadIds = unique(openedThreadIds.concat(commentThreadIds));\n\n    const threadsToSave = pickTruthy(current.threadsById, [MAIN_THREAD_ID, ...threadIds]);\n\n    const viewportIdsToSave = unique(Object.values(threadsToSave).flatMap((thread) => thread.lastViewportIds || []));\n    const topics = selectTopics(global, chatId);\n    const topicLastMessageIds = topics && forumPanelChatIds.includes(chatId)\n      ? Object.values(topics).map(({ lastMessageId }) => lastMessageId) : [];\n    const savedLastMessageIds = chatId === currentUserId && global.chats.lastMessageIds.saved\n      ? Object.values(global.chats.lastMessageIds.saved) : [];\n    const lastMessageIdsToSave = [chatLastMessageId].concat(topicLastMessageIds).concat(savedLastMessageIds)\n      .filter(Boolean);\n    const byId = pick(current.byId, viewportIdsToSave.concat(lastMessageIdsToSave));\n    const threadsById = Object.keys(threadsToSave).reduce((acc, key) => {\n      const thread = threadsToSave[Number(key)];\n      acc[Number(key)] = {\n        ...thread,\n        listedIds: thread.lastViewportIds,\n        pinnedIds: undefined,\n        typingStatus: undefined,\n      };\n      return acc;\n    }, {} as GlobalState['messages']['byChatId'][string]['threadsById']);\n\n    const cleanedById = Object.values(byId).reduce((acc, message) => {\n      if (!message) return acc;\n\n      let cleanedMessage = omitLocalMedia(message);\n      cleanedMessage = omitLocalPaidReactions(cleanedMessage);\n      acc[message.id] = cleanedMessage;\n\n      if (message.content.pollId) {\n        pollIdsToSave.push(message.content.pollId);\n      }\n\n      return acc;\n    }, {} as Record<number, ApiMessage>);\n\n    byChatId[chatId] = {\n      byId: cleanedById,\n      threadsById,\n    };\n  });\n\n  return {\n    byChatId,\n    pollById: pickTruthy(global.messages.pollById, pollIdsToSave),\n    sponsoredByChatId: {},\n  };\n}\n\nfunction omitLocalPaidReactions(message: ApiMessage): ApiMessage {\n  if (!message.reactions?.results.length) return message;\n  return {\n    ...message,\n    reactions: {\n      ...message.reactions,\n      results: message.reactions.results.map((reaction) => {\n        if (reaction.localAmount) {\n          return {\n            ...reaction,\n            localAmount: undefined,\n          };\n        }\n        return reaction;\n      }),\n    },\n  };\n}\n\nfunction omitLocalMedia(message: ApiMessage): ApiMessage {\n  const {\n    photo, video, document, sticker,\n  } = message.content;\n\n  return {\n    ...message,\n    content: {\n      ...message.content,\n      photo: photo && {\n        ...photo,\n        blobUrl: undefined,\n      },\n      video: video && {\n        ...video,\n        blobUrl: undefined,\n        previewBlobUrl: undefined,\n      },\n      document: document && {\n        ...document,\n        previewBlobUrl: undefined,\n      },\n      sticker: sticker && {\n        ...sticker,\n        isPreloadedGlobally: undefined,\n      },\n    },\n    previousLocalId: undefined,\n  };\n}\n\nfunction reduceSettings<T extends GlobalState>(global: T): GlobalState['settings'] {\n  const {\n    byKey, themes, performance, botVerificationShownPeerIds, miniAppsCachedPosition, miniAppsCachedSize,\n  } = global.settings;\n\n  return {\n    byKey,\n    themes,\n    performance,\n    privacy: {},\n    notifyExceptions: {},\n    botVerificationShownPeerIds,\n    miniAppsCachedPosition,\n    miniAppsCachedSize,\n  };\n}\n\nfunction reduceChatFolders<T extends GlobalState>(global: T): GlobalState['chatFolders'] {\n  return {\n    ...global.chatFolders,\n  };\n}\n\nfunction reduceGroupCalls<T extends GlobalState>(global: T): GlobalState['groupCalls'] {\n  return {\n    ...global.groupCalls,\n    byId: {},\n    activeGroupCallId: undefined,\n  };\n}\n\nfunction reduceAvailableReactions(availableReactions?: ApiAvailableReaction[]): ApiAvailableReaction[] | undefined {\n  return availableReactions\n    ?.map((r) => pick(r, ['reaction', 'staticIcon', 'title', 'isInactive']));\n}\n","import type { ApiChatType, ApiPhoto } from '../../api/types';\nimport type { WebApp } from '../../types/webapp';\n\nimport { REPLIES_USER_ID, VERIFICATION_CODES_USER_ID } from '../../config';\n\nexport function getBotCoverMediaHash(photo: ApiPhoto) {\n  return `photo${photo.id}?size=x`;\n}\n\nexport function convertToApiChatType(type: string): ApiChatType | undefined {\n  if (type === 'channels') return 'channels';\n  if (type === 'chats' || type === 'groups') return 'chats';\n  if (type === 'users') return 'users';\n  if (type === 'bots') return 'bots';\n  return undefined;\n}\n\nexport function getWebAppKey(webApp: Partial<WebApp>) {\n  if (webApp.requestUrl) return webApp.requestUrl;\n  if (webApp.appName) return `${webApp.botId}?appName=${webApp.appName}`;\n  return webApp.botId!;\n}\n\nexport function isSystemBot(botId: string) {\n  return botId === REPLIES_USER_ID || botId === VERIFICATION_CODES_USER_ID;\n}\n","import type {\n  ApiChat,\n  ApiChatAdminRights,\n  ApiChatBannedRights,\n  ApiChatFolder,\n  ApiChatFullInfo,\n  ApiChatInviteInfo,\n  ApiPeer,\n  ApiTopic,\n  ApiUser,\n} from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport type {\n  CustomPeer, NotifyException, NotifySettings, ThreadId,\n} from '../../types';\nimport type { LangFn } from '../../util/localization';\nimport { MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  ANONYMOUS_USER_ID,\n  ARCHIVED_FOLDER_ID, CHANNEL_ID_LENGTH, GENERAL_TOPIC_ID, REPLIES_USER_ID, TME_LINK_PREFIX,\n  VERIFICATION_CODES_USER_ID,\n} from '../../config';\nimport { formatDateToString, formatTime } from '../../util/dates/dateFormat';\nimport { prepareSearchWordsForNeedle } from '../../util/searchWords';\nimport { getGlobal } from '..';\nimport { isSystemBot } from './bots';\nimport { getMainUsername, getUserFirstOrLastName } from './users';\n\nconst FOREVER_BANNED_DATE = Date.now() / 1000 + 31622400; // 366 days\n\nexport function isUserId(entityId: string) {\n  return !entityId.startsWith('-');\n}\n\nexport function isPeerChat(entity: ApiPeer): entity is ApiChat {\n  return 'title' in entity;\n}\n\nexport function isPeerUser(entity: ApiPeer): entity is ApiUser {\n  return !isPeerChat(entity);\n}\n\nexport function isChannelId(entityId: string) {\n  return entityId.length === CHANNEL_ID_LENGTH && entityId.startsWith('-1');\n}\n\nexport function toChannelId(mtpId: string) {\n  return `-1${mtpId.padStart(CHANNEL_ID_LENGTH - 2, '0')}`;\n}\n\nexport function isChatGroup(chat: ApiChat) {\n  return isChatBasicGroup(chat) || isChatSuperGroup(chat);\n}\n\nexport function isChatBasicGroup(chat: ApiChat) {\n  return chat.type === 'chatTypeBasicGroup';\n}\n\nexport function isChatSuperGroup(chat: ApiChat) {\n  return chat.type === 'chatTypeSuperGroup';\n}\n\nexport function isChatChannel(chat: ApiChat) {\n  return chat.type === 'chatTypeChannel';\n}\n\nexport function isCommonBoxChat(chat: ApiChat) {\n  return chat.type === 'chatTypePrivate' || chat.type === 'chatTypeBasicGroup';\n}\n\nexport function isChatWithRepliesBot(chatId: string) {\n  return chatId === REPLIES_USER_ID;\n}\n\nexport function isChatWithVerificationCodesBot(chatId: string) {\n  return chatId === VERIFICATION_CODES_USER_ID;\n}\n\nexport function isAnonymousForwardsChat(chatId: string) {\n  return chatId === ANONYMOUS_USER_ID;\n}\n\nexport function getChatTypeString(chat: ApiChat) {\n  switch (chat.type) {\n    case 'chatTypePrivate':\n      return 'PrivateChat';\n    case 'chatTypeBasicGroup':\n    case 'chatTypeSuperGroup':\n      return 'AccDescrGroup';\n    case 'chatTypeChannel':\n      return 'AccDescrChannel';\n    default:\n      return 'Chat';\n  }\n}\n\nexport function getPrivateChatUserId(chat: ApiChat) {\n  if (chat.type !== 'chatTypePrivate' && chat.type !== 'chatTypeSecret') {\n    return undefined;\n  }\n  return chat.id;\n}\n\nexport function getChatTitle(lang: OldLangFn | LangFn, chat: ApiChat, isSelf = false) {\n  if (isSelf) {\n    return lang('SavedMessages');\n  }\n  return chat.title || lang('HiddenName');\n}\n\nexport function getChatLink(chat: ApiChat) {\n  const activeUsername = getMainUsername(chat);\n\n  return activeUsername ? `${TME_LINK_PREFIX}${activeUsername}` : undefined;\n}\n\nexport function getChatAvatarHash(\n  owner: ApiPeer,\n  size: 'normal' | 'big' = 'normal',\n  avatarPhotoId = owner.avatarPhotoId,\n) {\n  if (!avatarPhotoId) {\n    return undefined;\n  }\n\n  switch (size) {\n    case 'big':\n      return `profile${owner.id}?${avatarPhotoId}`;\n    default:\n      return `avatar${owner.id}?${avatarPhotoId}`;\n  }\n}\n\nexport function isChatAdmin(chat: ApiChat) {\n  return Boolean(chat.adminRights || chat.isCreator);\n}\n\nexport function getHasAdminRight(chat: ApiChat, key: keyof ApiChatAdminRights) {\n  return chat.adminRights?.[key] || false;\n}\n\nexport function getCanManageTopic(chat: ApiChat, topic: ApiTopic) {\n  if (topic.id === GENERAL_TOPIC_ID) return chat.isCreator;\n  return chat.isCreator || getHasAdminRight(chat, 'manageTopics') || topic.isOwner;\n}\n\nexport function isUserRightBanned(chat: ApiChat, key: keyof ApiChatBannedRights, chatFullInfo?: ApiChatFullInfo) {\n  const unrestrictedByBoosts = chatFullInfo?.boostsToUnrestrict\n    && (chatFullInfo.boostsApplied || 0) >= chatFullInfo.boostsToUnrestrict;\n  return Boolean(\n    (chat.currentUserBannedRights?.[key])\n    || (chat.defaultBannedRights?.[key] && !unrestrictedByBoosts),\n  );\n}\n\nexport function getCanPostInChat(\n  chat: ApiChat, topic?: ApiTopic, isMessageThread?: boolean, chatFullInfo?: ApiChatFullInfo,\n) {\n  if (topic) {\n    if (chat.isForum) {\n      if (chat.isNotJoined) {\n        return false;\n      }\n\n      if (topic?.isClosed && !topic.isOwner && !getHasAdminRight(chat, 'manageTopics')) {\n        return false;\n      }\n    }\n  }\n\n  if (chat.isRestricted || chat.isForbidden || chat.migratedTo\n    || (!isMessageThread && chat.isNotJoined) || isSystemBot(chat.id) || isAnonymousForwardsChat(chat.id)) {\n    return false;\n  }\n\n  if (chat.isCreator) {\n    return true;\n  }\n\n  if (isUserId(chat.id)) {\n    return true;\n  }\n\n  if (isChatChannel(chat)) {\n    return getHasAdminRight(chat, 'postMessages');\n  }\n\n  return isChatAdmin(chat) || !isUserRightBanned(chat, 'sendMessages', chatFullInfo);\n}\n\nexport interface IAllowedAttachmentOptions {\n  canAttachMedia: boolean;\n  canAttachPolls: boolean;\n  canSendStickers: boolean;\n  canSendGifs: boolean;\n  canAttachEmbedLinks: boolean;\n  canSendPhotos: boolean;\n  canSendVideos: boolean;\n  canSendRoundVideos: boolean;\n  canSendAudios: boolean;\n  canSendVoices: boolean;\n  canSendPlainText: boolean;\n  canSendDocuments: boolean;\n}\n\nexport function getAllowedAttachmentOptions(\n  chat?: ApiChat,\n  chatFullInfo?: ApiChatFullInfo,\n  isChatWithBot = false,\n  isStoryReply = false,\n): IAllowedAttachmentOptions {\n  if (!chat) {\n    return {\n      canAttachMedia: false,\n      canAttachPolls: false,\n      canSendStickers: false,\n      canSendGifs: false,\n      canAttachEmbedLinks: false,\n      canSendPhotos: false,\n      canSendVideos: false,\n      canSendRoundVideos: false,\n      canSendAudios: false,\n      canSendVoices: false,\n      canSendPlainText: false,\n      canSendDocuments: false,\n    };\n  }\n\n  const isAdmin = isChatAdmin(chat);\n\n  return {\n    canAttachMedia: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendMedia', chatFullInfo),\n    canAttachPolls: !isStoryReply\n      && (isAdmin || !isUserRightBanned(chat, 'sendPolls', chatFullInfo))\n      && (!isUserId(chat.id) || isChatWithBot),\n    canSendStickers: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendStickers', chatFullInfo),\n    canSendGifs: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendGifs', chatFullInfo),\n    canAttachEmbedLinks: !isStoryReply && (isAdmin || !isUserRightBanned(chat, 'embedLinks', chatFullInfo)),\n    canSendPhotos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendPhotos', chatFullInfo),\n    canSendVideos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendVideos', chatFullInfo),\n    canSendRoundVideos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendRoundvideos', chatFullInfo),\n    canSendAudios: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendAudios', chatFullInfo),\n    canSendVoices: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendVoices', chatFullInfo),\n    canSendPlainText: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendPlain', chatFullInfo),\n    canSendDocuments: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendDocs', chatFullInfo),\n  };\n}\n\nexport function getMessageSendingRestrictionReason(\n  lang: OldLangFn,\n  currentUserBannedRights?: ApiChatBannedRights,\n  defaultBannedRights?: ApiChatBannedRights,\n) {\n  if (currentUserBannedRights?.sendMessages) {\n    const { untilDate } = currentUserBannedRights;\n    return untilDate && untilDate < FOREVER_BANNED_DATE\n      ? lang(\n        'Channel.Persmission.Denied.SendMessages.Until',\n        lang(\n          'formatDateAtTime',\n          [formatDateToString(new Date(untilDate * 1000), lang.code), formatTime(lang, untilDate * 1000)],\n        ),\n      )\n      : lang('Channel.Persmission.Denied.SendMessages.Forever');\n  }\n\n  if (defaultBannedRights?.sendMessages) {\n    return lang('Channel.Persmission.Denied.SendMessages.DefaultRestrictedText');\n  }\n\n  return undefined;\n}\n\nexport function getForumComposerPlaceholder(\n  lang: OldLangFn,\n  chat?: ApiChat,\n  threadId: ThreadId = MAIN_THREAD_ID,\n  topics?: Record<number, ApiTopic>,\n  isReplying?: boolean,\n) {\n  if (!chat?.isForum) {\n    return undefined;\n  }\n\n  if (threadId === MAIN_THREAD_ID) {\n    if (isReplying || (topics && !topics[GENERAL_TOPIC_ID]?.isClosed)) return undefined;\n    return lang('lng_forum_replies_only');\n  }\n\n  const topic = topics?.[Number(threadId)];\n  if (!topic) {\n    return undefined;\n  }\n\n  if (topic.isClosed && !topic.isOwner && !getHasAdminRight(chat, 'manageTopics')) {\n    return lang('TopicClosedByAdmin');\n  }\n\n  return undefined;\n}\n\nexport function isChatArchived(chat: ApiChat) {\n  return chat.folderId === ARCHIVED_FOLDER_ID;\n}\n\nexport function selectIsChatMuted(\n  chat: ApiChat, notifySettings: NotifySettings, notifyExceptions: Record<string, NotifyException> = {},\n) {\n  // If this chat is in exceptions they take precedence\n  if (notifyExceptions[chat.id] && notifyExceptions[chat.id].isMuted !== undefined) {\n    return notifyExceptions[chat.id].isMuted;\n  }\n\n  return (\n    chat.isMuted\n    || (isUserId(chat.id) && !notifySettings.hasPrivateChatsNotifications)\n    || (isChatChannel(chat) && !notifySettings.hasBroadcastNotifications)\n    || (isChatGroup(chat) && !notifySettings.hasGroupNotifications)\n  );\n}\n\nexport function selectShouldShowMessagePreview(\n  chat: ApiChat, notifySettings: NotifySettings, notifyExceptions: Record<string, NotifyException> = {},\n) {\n  const {\n    hasPrivateChatsMessagePreview = true,\n    hasBroadcastMessagePreview = true,\n    hasGroupMessagePreview = true,\n  } = notifySettings;\n  // If this chat is in exceptions they take precedence\n  if (notifyExceptions[chat.id] && notifyExceptions[chat.id].shouldShowPreviews !== undefined) {\n    return notifyExceptions[chat.id].shouldShowPreviews;\n  }\n\n  return (isUserId(chat.id) && hasPrivateChatsMessagePreview)\n    || (isChatChannel(chat) && hasBroadcastMessagePreview)\n    || (isChatGroup(chat) && hasGroupMessagePreview);\n}\n\nexport function getCanDeleteChat(chat: ApiChat) {\n  return isChatBasicGroup(chat) || ((isChatSuperGroup(chat) || isChatChannel(chat)) && chat.isCreator);\n}\n\nexport function getFolderDescriptionText(lang: OldLangFn, folder: ApiChatFolder, chatsCount?: number) {\n  const {\n    excludedChatIds, includedChatIds,\n    bots, groups, contacts, nonContacts, channels,\n  } = folder;\n\n  const filters = [bots, groups, contacts, nonContacts, channels];\n\n  // If folder has multiple additive filters or uses include/exclude lists,\n  // we display folder chats count\n  if (\n    chatsCount !== undefined && (\n      Object.values(filters).filter(Boolean).length > 1\n      || (excludedChatIds?.length)\n      || (includedChatIds?.length)\n    )) {\n    return lang('Chats', chatsCount);\n  }\n\n  // Otherwise, we return a short description of a single filter\n  if (bots) {\n    return lang('FilterBots');\n  } else if (groups) {\n    return lang('FilterGroups');\n  } else if (channels) {\n    return lang('FilterChannels');\n  } else if (contacts) {\n    return lang('FilterContacts');\n  } else if (nonContacts) {\n    return lang('FilterNonContacts');\n  } else {\n    return undefined;\n  }\n}\n\nexport function getMessageSenderName(lang: OldLangFn, chatId: string, sender?: ApiPeer) {\n  if (!sender || isUserId(chatId)) {\n    return undefined;\n  }\n\n  if (isPeerChat(sender)) {\n    if (chatId === sender.id) return undefined;\n\n    return sender.title;\n  }\n\n  if (sender.isSelf) {\n    return lang('FromYou');\n  }\n\n  return getUserFirstOrLastName(sender);\n}\n\nexport function filterChatsByName(\n  lang: OldLangFn,\n  chatIds: string[],\n  chatsById: Record<string, ApiChat>,\n  query?: string,\n  currentUserId?: string,\n) {\n  if (!query) {\n    return chatIds;\n  }\n\n  const searchWords = prepareSearchWordsForNeedle(query);\n\n  return chatIds.filter((id) => {\n    const chat = chatsById[id];\n    if (!chat) {\n      return false;\n    }\n    const isSelf = id === currentUserId;\n\n    const translatedTitle = getChatTitle(lang, chat, isSelf);\n    if (isSelf) {\n      // Search both \"Saved Messages\" and user title\n      return searchWords(translatedTitle) || searchWords(chat.title);\n    }\n\n    return searchWords(translatedTitle) || Boolean(chat.usernames?.find(({ username }) => searchWords(username)));\n  });\n}\n\nexport function isChatPublic(chat: ApiChat) {\n  return chat.usernames?.some(({ isActive }) => isActive);\n}\n\nexport function getOrderedTopics(\n  topics: ApiTopic[], pinnedOrder?: number[], shouldSortByLastMessage = false,\n): ApiTopic[] {\n  if (shouldSortByLastMessage) {\n    return topics.sort((a, b) => b.lastMessageId - a.lastMessageId);\n  } else {\n    const pinned = topics.filter((topic) => topic.isPinned);\n    const ordered = topics\n      .filter((topic) => !topic.isPinned && !topic.isHidden)\n      .sort((a, b) => b.lastMessageId - a.lastMessageId);\n    const hidden = topics.filter((topic) => !topic.isPinned && topic.isHidden)\n      .sort((a, b) => b.lastMessageId - a.lastMessageId);\n\n    const pinnedOrdered = pinnedOrder\n      ? pinnedOrder.map((id) => pinned.find((topic) => topic.id === id)).filter(Boolean) : pinned;\n\n    return [...pinnedOrdered, ...ordered, ...hidden];\n  }\n}\n\nexport function getCleanPeerId(peerId: string) {\n  return isChannelId(peerId)\n    // Remove -1 and leading zeros\n    ? peerId.replace(/^-10+/, '')\n    : peerId.replace('-', '');\n}\n\nexport function getPeerIdDividend(peerId: string) {\n  return Math.abs(Number(getCleanPeerId(peerId)));\n}\n\nexport function getPeerColorKey(peer: ApiPeer | undefined) {\n  if (peer?.color?.color) return peer.color.color;\n\n  return peer ? getPeerIdDividend(peer.id) % 7 : 0;\n}\n\nexport function getPeerColorCount(peer: ApiPeer) {\n  const key = getPeerColorKey(peer);\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  return getGlobal().peerColors?.general[key].colors?.length || 1;\n}\n\nexport function getIsSavedDialog(chatId: string, threadId: ThreadId | undefined, currentUserId: string | undefined) {\n  return chatId === currentUserId && threadId !== MAIN_THREAD_ID;\n}\n\nexport function getGroupStatus(lang: OldLangFn, chat: ApiChat) {\n  const chatTypeString = lang(getChatTypeString(chat));\n  const { membersCount } = chat;\n\n  if (chat.isRestricted) {\n    return chatTypeString === 'Channel' ? 'channel is inaccessible' : 'group is inaccessible';\n  }\n\n  if (!membersCount) {\n    return chatTypeString;\n  }\n\n  return chatTypeString === 'Channel'\n    ? lang('Subscribers', membersCount, 'i')\n    : lang('Members', membersCount, 'i');\n}\n\nexport function getCustomPeerFromInvite(invite: ApiChatInviteInfo): CustomPeer {\n  const {\n    title, color, isVerified, isFake, isScam,\n  } = invite;\n  return {\n    isCustomPeer: true,\n    title,\n    peerColorId: color,\n    isVerified,\n    fakeType: isFake ? 'fake' : isScam ? 'scam' : undefined,\n  };\n}\n","import type {\n  ApiAvailableReaction,\n  ApiChatReactions,\n  ApiMessage,\n  ApiReactionCount,\n  ApiReactionKey,\n  ApiReactions,\n  ApiReactionWithPaid,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nexport function getMessageRecentReaction(message: Partial<ApiMessage>) {\n  return message.isOutgoing ? message.reactions?.recentReactions?.[0] : undefined;\n}\nexport function checkIfHasUnreadReactions(global: GlobalState, reactions: ApiReactions) {\n  const { currentUserId } = global;\n  return reactions?.recentReactions?.some(\n    ({ isUnread, isOwn, peerId }) => isUnread && !isOwn && currentUserId !== peerId,\n  );\n}\n\nexport function areReactionsEmpty(reactions: ApiReactions) {\n  return !reactions.results.some(({ count, localAmount }) => count || localAmount);\n}\n\nexport function getReactionKey(reaction: ApiReactionWithPaid): ApiReactionKey {\n  switch (reaction.type) {\n    case 'emoji':\n      return `emoji-${reaction.emoticon}`;\n    case 'custom':\n      return `document-${reaction.documentId}`;\n    case 'paid':\n      return 'paid';\n    default: {\n      // Legacy reactions\n      const uniqueValue = (reaction as any).emoticon || (reaction as any).documentId;\n      return `unsupported-${uniqueValue}`;\n    }\n  }\n}\n\nexport function isSameReaction(first?: ApiReactionWithPaid, second?: ApiReactionWithPaid) {\n  if (first === second) {\n    return true;\n  }\n\n  if (!first || !second) {\n    return false;\n  }\n\n  return getReactionKey(first) === getReactionKey(second);\n}\n\nexport function canSendReaction(reaction: ApiReactionWithPaid, chatReactions: ApiChatReactions) {\n  if (chatReactions.type === 'all') {\n    return reaction.type === 'emoji' || chatReactions.areCustomAllowed;\n  }\n\n  if (chatReactions.type === 'some') {\n    return chatReactions.allowed.some((r) => isSameReaction(r, reaction));\n  }\n\n  return false;\n}\n\nexport function sortReactions<T extends ApiAvailableReaction | ApiReactionWithPaid>(\n  reactions: T[],\n  topReactions?: ApiReactionWithPaid[],\n): T[] {\n  return reactions.slice().sort((left, right) => {\n    const reactionOne = left ? ('reaction' in left ? left.reaction : left) as ApiReactionWithPaid : undefined;\n    const reactionTwo = right ? ('reaction' in right ? right.reaction : right) as ApiReactionWithPaid : undefined;\n\n    if (reactionOne?.type === 'paid') return -1;\n    if (reactionTwo?.type === 'paid') return 1;\n\n    const indexOne = topReactions?.findIndex((reaction) => isSameReaction(reaction, reactionOne)) || 0;\n    const indexTwo = topReactions?.findIndex((reaction) => isSameReaction(reaction, reactionTwo)) || 0;\n    return (\n      (indexOne > -1 ? indexOne : Infinity) - (indexTwo > -1 ? indexTwo : Infinity)\n    );\n  });\n}\n\nexport function getUserReactions(message: ApiMessage): ApiReactionWithPaid[] {\n  return message.reactions?.results?.filter((r): r is Required<ApiReactionCount> => isReactionChosen(r))\n    .sort((a, b) => a.chosenOrder - b.chosenOrder)\n    .map((r) => r.reaction) || [];\n}\n\nexport function isReactionChosen(reaction: ApiReactionCount) {\n  return reaction.chosenOrder !== undefined;\n}\n\nexport function updateReactionCount(reactionCount: ApiReactionCount[], newReactions: ApiReactionWithPaid[]) {\n  const results = reactionCount.map((current) => (\n    isReactionChosen(current) ? {\n      ...current,\n      chosenOrder: undefined,\n      count: current.count - 1,\n    } : current\n  )).filter(({ count }) => count > 0);\n\n  newReactions.forEach((reaction, i) => {\n    const existingIndex = results.findIndex((r) => isSameReaction(r.reaction, reaction));\n    if (existingIndex > -1) {\n      results[existingIndex] = {\n        ...results[existingIndex],\n        chosenOrder: i,\n        count: results[existingIndex].count + 1,\n      };\n    } else {\n      results.push({\n        reaction,\n        chosenOrder: i,\n        count: 1,\n      });\n    }\n  });\n\n  return results;\n}\n\nexport function addPaidReaction(\n  reactionCount: ApiReactionCount[], count: number, isAnonymous?: boolean,\n): ApiReactionCount[] {\n  const results: ApiReactionCount[] = [];\n  const hasPaid = reactionCount.some((current) => current.reaction.type === 'paid');\n  if (hasPaid) {\n    reactionCount.forEach((current) => {\n      if (current.reaction.type === 'paid') {\n        results.push({\n          ...current,\n          localAmount: (current.localAmount || 0) + count,\n          chosenOrder: -1,\n          localIsPrivate: isAnonymous !== undefined ? isAnonymous : current.localIsPrivate,\n          localPreviousChosenOrder: current.chosenOrder,\n        });\n        return;\n      }\n\n      results.push(current);\n    });\n\n    return results;\n  }\n\n  return [\n    {\n      reaction: { type: 'paid' },\n      count: 0,\n      chosenOrder: -1,\n      localAmount: count,\n      localIsPrivate: isAnonymous,\n    },\n    ...reactionCount,\n  ];\n}\n","import type { ApiStory, ApiVideo } from '../../api/types';\n\nimport { getPhotoMediaHash, getVideoMediaHash } from './messageMedia';\n\ntype StorySize = 'pictogram' | 'preview' | 'full' | 'download';\nconst STORY_ALT_VIDEO_WIDTH = 480;\n\nexport function getStoryMediaHash(\n  story: ApiStory, size: StorySize, isAlt: true,\n): string | undefined;\nexport function getStoryMediaHash(story: ApiStory): string;\nexport function getStoryMediaHash(story: ApiStory, size: StorySize): string;\nexport function getStoryMediaHash(\n  story: ApiStory, size: StorySize = 'preview', isAlt?: boolean,\n) {\n  const isVideo = Boolean(story.content.video);\n\n  if (isVideo) {\n    if (isAlt && !story.content.altVideos) return undefined;\n    const media = isAlt ? getPreferredAlt(story.content.altVideos!) : story.content.video!;\n    return getVideoMediaHash(media, size);\n  }\n\n  return getPhotoMediaHash(story.content.photo!, size);\n}\n\nfunction getPreferredAlt(alts: ApiVideo[]) {\n  const alt = alts.reduce((prev, curr) => (\n    Math.abs((curr.width || 0) - STORY_ALT_VIDEO_WIDTH) < Math.abs((prev.width || 0) - STORY_ALT_VIDEO_WIDTH)\n      ? curr : prev\n  ));\n  return alt;\n}\n\nexport function getStoryKey(chatId: string, storyId: number) {\n  return `story${chatId}-${storyId}`;\n}\n","import type { ApiInputPrivacyRules, BotsPrivacyType, PrivacyVisibility } from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { partition } from '../../util/iteratees';\nimport { isUserId } from './chats';\n\nexport function buildApiInputPrivacyRules(global: GlobalState, {\n  visibility,\n  isUnspecified,\n  allowedIds,\n  blockedIds,\n  shouldAllowPremium,\n  botsPrivacy,\n}: {\n  visibility: PrivacyVisibility;\n  isUnspecified?: boolean;\n  allowedIds: string[];\n  blockedIds: string[];\n  shouldAllowPremium?: true;\n  botsPrivacy: BotsPrivacyType;\n}): ApiInputPrivacyRules {\n  const {\n    users: { byId: usersById },\n    chats: { byId: chatsById },\n  } = global;\n\n  const [allowedUserIds, allowedChatIds] = partition(allowedIds, isUserId);\n  const [blockedUserIds, blockedChatIds] = partition(blockedIds, isUserId);\n\n  const rules: ApiInputPrivacyRules = {\n    visibility,\n    isUnspecified,\n    allowedUsers: allowedUserIds.map((userId) => usersById[userId]).filter(Boolean),\n    allowedChats: allowedChatIds.map((chatId) => chatsById[chatId]).filter(Boolean),\n    blockedUsers: blockedUserIds.map((userId) => usersById[userId]).filter(Boolean),\n    blockedChats: blockedChatIds.map((chatId) => chatsById[chatId]).filter(Boolean),\n    shouldAllowPremium,\n    botsPrivacy,\n  };\n\n  return rules;\n}\n","import type {\n  ApiAttachment,\n  ApiAudio,\n  ApiDimensions,\n  ApiDocument,\n  ApiGame,\n  ApiLocation,\n  ApiMediaExtendedPreview,\n  ApiMessage,\n  ApiMessageSearchType,\n  ApiPhoto,\n  ApiSticker,\n  ApiVideo,\n  ApiVoice,\n  ApiWebDocument,\n  MediaContainer,\n} from '../../api/types';\nimport type { ActiveDownloads } from '../../types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport {\n  IS_OPFS_SUPPORTED,\n  IS_OPUS_SUPPORTED,\n  IS_PROGRESSIVE_SUPPORTED,\n  IS_SAFARI,\n  MAX_BUFFER_SIZE,\n} from '../../util/windowEnvironment';\nimport { getDocumentHasPreview } from '../../components/common/helpers/documentInfo';\nimport { getAttachmentMediaType, matchLinkInMessageText } from './messages';\n\nexport type MediaWithThumbs = ApiPhoto | ApiVideo | ApiDocument | ApiSticker | ApiMediaExtendedPreview;\nexport type DownloadableMedia = ApiPhoto | ApiVideo | ApiDocument | ApiSticker | ApiAudio | ApiVoice | ApiWebDocument;\n\ntype Target =\n  'micro'\n  | 'pictogram'\n  | 'inline'\n  | 'preview'\n  | 'full'\n  | 'download';\n\nexport function getMessageContent(message: MediaContainer) {\n  return message.content;\n}\n\nexport function hasMessageMedia(message: MediaContainer) {\n  return Boolean((\n    getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageContact(message)\n    || getMessagePollId(message)\n    || getMessageAction(message)\n    || getMessageAudio(message)\n    || getMessageVoice(message)\n  ));\n}\n\nexport function canEditMedia(message: MediaContainer) {\n  const {\n    photo, video, altVideos, audio, document, text, webPage, ...otherMedia\n  } = message.content;\n\n  return !video?.isRound && !Object.keys(otherMedia).length;\n}\n\nexport function getMessagePhoto(message: MediaContainer) {\n  return message.content.photo;\n}\n\nexport function getMessageActionPhoto(message: MediaContainer) {\n  return message.content.action?.type === 'suggestProfilePhoto' ? message.content.action.photo : undefined;\n}\n\nexport function getMessageVideo(message: MediaContainer) {\n  return message.content.video;\n}\n\nexport function getMessageRoundVideo(message: MediaContainer) {\n  const { video } = message.content;\n\n  return video?.isRound ? video : undefined;\n}\n\nexport function getMessageAction(message: MediaContainer) {\n  return message.content.action;\n}\n\nexport function getMessageAudio(message: MediaContainer) {\n  return message.content.audio;\n}\n\nexport function getMessageVoice(message: MediaContainer) {\n  return message.content.voice;\n}\n\nexport function getMessageSticker(message: MediaContainer) {\n  return message.content.sticker;\n}\n\nexport function getMessageDocument(message: MediaContainer) {\n  return message.content.document;\n}\n\nexport function getMessageWebPageDocument(message: MediaContainer) {\n  return getMessageWebPage(message)?.document;\n}\n\nexport function isDocumentPhoto(document: ApiDocument) {\n  return document.innerMediaType === 'photo';\n}\n\nexport function isDocumentVideo(document: ApiDocument) {\n  return document.innerMediaType === 'video';\n}\n\nexport function isMessageDocumentSticker(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document ? document.mimeType === 'image/webp' : undefined;\n}\n\nexport function getMessageContact(message: MediaContainer) {\n  return message.content.contact;\n}\n\nexport function getMessagePollId(message: MediaContainer) {\n  return message.content.pollId;\n}\n\nexport function getMessageInvoice(message: MediaContainer) {\n  return message.content.invoice;\n}\n\nexport function getMessageLocation(message: MediaContainer) {\n  return message.content.location;\n}\n\nexport function getMessageWebPage(message: MediaContainer) {\n  return message.content.webPage;\n}\n\nexport function getMessagePaidMedia(message: MediaContainer) {\n  return message.content.paidMedia;\n}\n\nexport function getMessageWebPagePhoto(message: MediaContainer) {\n  return getMessageWebPage(message)?.photo;\n}\n\nexport function getMessageDocumentPhoto(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document && isDocumentPhoto(document) ? document : undefined;\n}\n\nexport function getMessageWebPageVideo(message: MediaContainer) {\n  return getMessageWebPage(message)?.video;\n}\n\nexport function getMessageWebPageAudio(message: MediaContainer) {\n  return getMessageWebPage(message)?.audio;\n}\n\nexport function getMessageDocumentVideo(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document && isDocumentVideo(document) ? document : undefined;\n}\n\nexport function getMessageDownloadableMedia(message: MediaContainer): DownloadableMedia | undefined {\n  return (\n    getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageAudio(message)\n    || getMessageVoice(message)\n    || getMessageWebPagePhoto(message)\n    || getMessageWebPageVideo(message)\n    || getMessageWebPageAudio(message)\n  );\n}\n\nfunction getMessageMediaThumbnail(message: MediaContainer) {\n  const media = getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageWebPagePhoto(message)\n    || getMessageWebPageVideo(message)\n    || getMessageInvoice(message)?.extendedMedia;\n\n  if (!media) {\n    return undefined;\n  }\n\n  return media.thumbnail;\n}\n\nexport function getMessageMediaThumbDataUri(message: MediaContainer) {\n  return getMessageMediaThumbnail(message)?.dataUri;\n}\n\nexport function getMediaThumbUri(media: MediaWithThumbs) {\n  return media.thumbnail?.dataUri;\n}\n\nexport function getMessageIsSpoiler(message: MediaContainer) {\n  const media = getMessagePhoto(message)\n    || getMessageVideo(message);\n\n  const invoiceMedia = getMessageInvoice(message)?.extendedMedia;\n  return Boolean(invoiceMedia || media?.isSpoiler);\n}\n\nexport function buildStaticMapHash(\n  geo: ApiLocation['geo'],\n  width: number,\n  height: number,\n  zoom: number,\n  scale: number,\n) {\n  const {\n    long, lat, accessHash, accuracyRadius,\n  } = geo;\n\n  // eslint-disable-next-line max-len\n  return `staticMap:${accessHash}?lat=${lat}&long=${long}&w=${width}&h=${height}&zoom=${zoom}&scale=${scale}&accuracyRadius=${accuracyRadius}`;\n}\n\nexport function getMessageMediaHash(\n  message: MediaContainer,\n  target: Target,\n) {\n  const {\n    video, sticker, audio, voice, document,\n  } = message.content;\n\n  const messagePhoto = getMessagePhoto(message) || getMessageWebPagePhoto(message);\n  const actionPhoto = getMessageActionPhoto(message);\n  const messageVideo = video || getMessageWebPageVideo(message);\n  const messageDocument = document || getMessageWebPageDocument(message);\n  const messageAudio = audio || getMessageWebPageAudio(message);\n\n  if (messageVideo) {\n    return getVideoMediaHash(messageVideo, target);\n  }\n\n  if (messagePhoto || actionPhoto) {\n    return getPhotoMediaHash(messagePhoto || actionPhoto!, target, Boolean(actionPhoto));\n  }\n\n  if (messageDocument) {\n    return getDocumentMediaHash(messageDocument, target);\n  }\n\n  if (sticker) {\n    return getStickerMediaHash(sticker, target);\n  }\n\n  if (messageAudio) {\n    return getAudioMediaHash(messageAudio, target);\n  }\n\n  if (voice) {\n    return getVoiceMediaHash(voice, target);\n  }\n\n  return undefined;\n}\n\nexport function getPhotoMediaHash(photo: ApiPhoto | ApiDocument, target: Target, isAction?: boolean) {\n  const base = `photo${photo.id}`;\n  const isVideo = photo.mediaType === 'photo' && photo.isVideo;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return `${base}?size=${isAction ? 'a' : 'm'}`;\n    case 'inline':\n      return !hasMediaLocalBlobUrl(photo) ? `${base}?size=${isAction ? 'b' : 'x'}` : undefined;\n    case 'preview':\n      return `${base}?size=${isAction ? 'b' : 'x'}`;\n    case 'download':\n      return !isVideo ? base : getVideoProfilePhotoMediaHash(photo);\n    case 'full':\n    default:\n      return base;\n  }\n}\n\nexport function getProfilePhotoMediaHash(photo: ApiPhoto) {\n  return `photo${photo.id}?size=c`;\n}\n\nexport function getVideoProfilePhotoMediaHash(photo: ApiPhoto) {\n  if (!photo.isVideo) return undefined;\n  return `photo${photo.id}?size=u`;\n}\n\nexport function getVideoMediaHash(video: ApiVideo | ApiDocument, target: Target) {\n  const base = `document${video.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return `${base}?size=m`;\n    case 'inline':\n      return !hasMediaLocalBlobUrl(video) ? appendProgressiveQueryParameters(video, base) : undefined;\n    case 'preview':\n      return `${base}?size=x`;\n    case 'download':\n      return `${base}?download`;\n    case 'full':\n    default:\n      return appendProgressiveQueryParameters(video, base);\n  }\n}\n\nexport function getVideoPreviewMediaHash(video: ApiVideo) {\n  return video.hasVideoPreview ? `document${video.id}?size=v` : undefined;\n}\n\nexport function getDocumentMediaHash(document: ApiDocument, target: Target) {\n  const base = `document${document.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n    case 'inline':\n    case 'preview':\n      if (!getDocumentHasPreview(document) || hasMediaLocalBlobUrl(document)) {\n        return undefined;\n      }\n\n      return `${base}?size=m`;\n    case 'full':\n    case 'download':\n    default:\n      return base;\n  }\n}\n\nexport function getAudioMediaHash(audio: ApiAudio, target: Target) {\n  const base = `document${audio.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return getAudioHasCover(audio) ? `${base}?size=m` : undefined;\n    case 'inline':\n      return appendProgressiveQueryParameters(audio, base);\n    case 'download':\n      return `${base}?download`;\n    default:\n      return base;\n  }\n}\n\nexport function getVoiceMediaHash(voice: ApiVoice, target: Target) {\n  const base = `document${voice.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return undefined;\n    case 'download':\n      return `${base}?download`;\n    case 'inline':\n    default:\n      return base;\n  }\n}\n\nexport function getWebDocumentHash(webDocument?: ApiWebDocument) {\n  if (!webDocument) return undefined;\n  return `webDocument:${webDocument.url}`;\n}\n\nexport function getStickerMediaHash(sticker: ApiSticker, target: Target) {\n  const base = `document${sticker.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      if (!sticker.previewPhotoSizes?.some((size) => size.type === 's')) {\n        return getStickerMediaHash(sticker, 'preview');\n      }\n      return `${base}?size=s`;\n    case 'preview':\n      return `${base}?size=m`;\n    case 'download':\n      return `${base}?download`;\n    case 'inline':\n    default:\n      return base;\n  }\n}\n\nexport function getMediaHash(media: DownloadableMedia, target: Target) {\n  switch (media.mediaType) {\n    case 'photo':\n      return getPhotoMediaHash(media, target);\n    case 'video':\n      return getVideoMediaHash(media, target);\n    case 'document':\n      return getDocumentMediaHash(media, target);\n    case 'audio':\n      return getAudioMediaHash(media, target);\n    case 'voice':\n      return getVoiceMediaHash(media, target);\n    case 'sticker':\n      return getStickerMediaHash(media, target);\n    case 'webDocument':\n      return getWebDocumentHash(media);\n    default:\n      return undefined;\n  }\n}\n\nexport function getGamePreviewPhotoHash(game: ApiGame) {\n  const { photo } = game;\n\n  if (photo) {\n    return `photo${photo.id}?size=x`;\n  }\n\n  return undefined;\n}\n\nexport function getGamePreviewVideoHash(game: ApiGame) {\n  const { document } = game;\n\n  if (document) {\n    return `document${document.id}`;\n  }\n\n  return undefined;\n}\n\nexport function appendProgressiveQueryParameters(media: ApiAudio | ApiVideo | ApiDocument, base: string) {\n  if (IS_PROGRESSIVE_SUPPORTED && IS_SAFARI) {\n    return `${base}?fileSize=${media.size}&mimeType=${media.mimeType}`;\n  }\n\n  return base;\n}\n\nexport function getAudioHasCover(media: ApiAudio) {\n  return media.thumbnailSizes && media.thumbnailSizes.length > 0;\n}\n\nexport function getMediaFormat(\n  media: DownloadableMedia, target: Target,\n): ApiMediaFormat {\n  const isDocument = media.mediaType === 'document';\n  const hasInnerVideo = isDocument && media.innerMediaType === 'video';\n  const isVideo = media.mediaType === 'video' || hasInnerVideo;\n  const isAudio = media.mediaType === 'audio';\n  const isVoice = media.mediaType === 'voice';\n\n  const size = getMediaFileSize(media) || 0; // Media types that do not have `size` are smaller than `MAX_BUFFER_SIZE`\n\n  if (target === 'download') {\n    if (IS_PROGRESSIVE_SUPPORTED && size > MAX_BUFFER_SIZE && !IS_OPFS_SUPPORTED) {\n      return ApiMediaFormat.DownloadUrl;\n    }\n    return ApiMediaFormat.BlobUrl;\n  }\n\n  if (isVideo && IS_PROGRESSIVE_SUPPORTED && (\n    target === 'full' || target === 'inline'\n  )) {\n    return ApiMediaFormat.Progressive;\n  }\n\n  if (isAudio || isVoice) {\n    // Safari\n    if (isVoice && !IS_OPUS_SUPPORTED) {\n      return ApiMediaFormat.BlobUrl;\n    }\n\n    return ApiMediaFormat.Progressive;\n  }\n\n  return ApiMediaFormat.BlobUrl;\n}\n\nexport function getMediaFileSize(media: DownloadableMedia) {\n  return 'size' in media ? media.size : undefined;\n}\n\nexport function hasMediaLocalBlobUrl(media: ApiPhoto | ApiVideo | ApiDocument) {\n  if ('blobUrl' in media) {\n    return Boolean(media.blobUrl);\n  }\n\n  if ('previewBlobUrl' in media) {\n    return Boolean(media.previewBlobUrl);\n  }\n\n  return false;\n}\n\nexport function getChatMediaMessageIds(\n  messages: Record<number, ApiMessage>, listedIds: number[], isFromSharedMedia = false,\n) {\n  return getMessageContentIds(messages, listedIds, isFromSharedMedia ? 'media' : 'inlineMedia');\n}\n\nexport function getPhotoFullDimensions(photo: Pick<ApiPhoto, 'sizes' | 'thumbnail'>): ApiDimensions | undefined {\n  return (\n    photo.sizes.find((size) => size.type === 'w')\n    || photo.sizes.find((size) => size.type === 'y')\n    || getPhotoInlineDimensions(photo)\n  );\n}\n\nexport function getPhotoInlineDimensions(photo: Pick<ApiPhoto, 'sizes' | 'thumbnail'>): ApiDimensions | undefined {\n  return (\n    photo.sizes.find((size) => size.type === 'x')\n    || photo.sizes.find((size) => size.type === 'm')\n    || photo.sizes.find((size) => size.type === 's')\n    || photo.thumbnail\n  );\n}\n\nexport function getVideoDimensions(video: ApiVideo): ApiDimensions | undefined {\n  if (video.width && video.height) {\n    return video as ApiDimensions;\n  }\n\n  return undefined;\n}\n\nexport function getMediaTransferState(\n  progress?: number, isLoadNeeded = false, isUploading = false,\n) {\n  const isTransferring = isUploading || isLoadNeeded;\n  const transferProgress = Number(progress);\n\n  return {\n    isUploading, isTransferring, transferProgress,\n  };\n}\n\nexport function getMessageContentIds(\n  messages: Record<number, ApiMessage>, messageIds: number[], contentType: ApiMessageSearchType | 'inlineMedia',\n) {\n  let validator: Function;\n\n  switch (contentType) {\n    case 'media':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        return getMessagePhoto(message) || (video && !video.isRound && !video.isGif);\n      };\n      break;\n\n    case 'documents':\n      validator = getMessageDocument;\n      break;\n\n    case 'links':\n      validator = (message: ApiMessage) => getMessageWebPage(message) || matchLinkInMessageText(message);\n      break;\n\n    case 'audio':\n      validator = getMessageAudio;\n      break;\n\n    case 'voice':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        return getMessageVoice(message) || (video && video.isRound);\n      };\n      break;\n\n    case 'inlineMedia':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        const document = getMessageDocument(message);\n        return (\n          getMessagePhoto(message)\n          || (video && !video.isRound && !video.isGif)\n          || (document && isDocumentPhoto(document))\n          || (document && isDocumentVideo(document))\n        );\n      };\n      break;\n\n    default:\n      return [] as Array<number>;\n  }\n\n  return messageIds.reduce((result, messageId) => {\n    if (messages[messageId] && validator(messages[messageId])) {\n      result.push(messageId);\n    }\n\n    return result;\n  }, [] as Array<number>);\n}\n\nexport function getMediaDuration(message: ApiMessage) {\n  const { audio, voice, video } = getMessageContent(message);\n  const media = audio || voice || video || getMessageWebPageVideo(message) || getMessageWebPageAudio(message);\n  if (!media) {\n    return undefined;\n  }\n\n  return media.duration;\n}\n\nexport function canReplaceMessageMedia(message: ApiMessage, attachment: ApiAttachment) {\n  const isPhotoOrVideo = Boolean(getMessagePhoto(message)\n    || getMessageWebPagePhoto(message) || Boolean(getMessageVideo(message)\n      || getMessageWebPageVideo(message)));\n  const isFile = Boolean(getMessageAudio(message)\n    || getMessageVoice(message) || getMessageDocument(message));\n\n  const fileType = getAttachmentMediaType(attachment);\n\n  return (\n    (isPhotoOrVideo && (fileType === 'photo' || fileType === 'video'))\n    || (isFile && (fileType === 'audio' || fileType === 'file'))\n  );\n}\n\nexport function isMediaLoadableInViewer(newMessage: ApiMessage) {\n  if (!newMessage.content) return false;\n  if (newMessage.content.photo) return true;\n  if (newMessage.content.video && !newMessage.content.video.isRound && !newMessage.content.video.isGif) return true;\n  return false;\n}\n\nexport function getMediaFilename(media: DownloadableMedia) {\n  if ('fileName' in media && media.fileName) {\n    return media.fileName;\n  }\n\n  if (media.mediaType === 'sticker') {\n    const extension = media.isLottie ? 'tgs' : media.isVideo ? 'webm' : 'webp';\n    return `${media.id}.${extension}`;\n  }\n\n  if (media.mediaType === 'photo') {\n    return `${media.id}.${media.isVideo ? 'mp4' : 'jpg'}`;\n  }\n\n  if (media.mediaType === 'voice') {\n    return `${media.id}.${IS_OPUS_SUPPORTED ? 'ogg' : 'wav'}`;\n  }\n\n  if ('id' in media && media.id) {\n    return media.id;\n  }\n\n  return `${media.mediaType}-${Math.random().toString(36).slice(4)}`;\n}\n\nexport function getIsDownloading(activeDownloads: ActiveDownloads, media: DownloadableMedia) {\n  const hash = getMediaHash(media, 'download');\n  if (!hash) return false;\n  return Boolean(activeDownloads[hash]);\n}\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiMediaExtendedPreview, ApiMessage, MediaContent, StatefulMediaContent,\n} from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { CONTENT_NOT_SUPPORTED } from '../../config';\nimport trimText from '../../util/trimText';\nimport { renderTextWithEntities } from '../../components/common/helpers/renderTextWithEntities';\nimport {\n  getExpiredMessageContentDescription, getMessageText, getMessageTranscription, isExpiredMessageContent,\n} from './messages';\n\nconst SPOILER_CHARS = ['⠺', '⠵', '⠞', '⠟'];\nexport const TRUNCATED_SUMMARY_LENGTH = 80;\n\nexport function getMessageSummaryText(\n  lang: OldLangFn,\n  message: ApiMessage,\n  statefulContent: StatefulMediaContent | undefined,\n  noEmoji = false,\n  truncateLength = TRUNCATED_SUMMARY_LENGTH,\n  isExtended = false,\n) {\n  const emoji = !noEmoji && getMessageSummaryEmoji(message);\n  const emojiWithSpace = emoji ? `${emoji} ` : '';\n  const text = trimText(getMessageTextWithSpoilers(message, statefulContent), truncateLength);\n  const description = getMessageSummaryDescription(lang, message, statefulContent, text, isExtended);\n\n  return `${emojiWithSpace}${description}`;\n}\n\nexport function getMessageTextWithSpoilers(message: ApiMessage, statefulContent: StatefulMediaContent | undefined) {\n  const transcription = getMessageTranscription(message);\n\n  const textWithoutTranscription = getMessageText(statefulContent?.story || message);\n  if (!textWithoutTranscription) {\n    return transcription;\n  }\n\n  const { entities } = message.content.text || {};\n  if (!entities?.length) {\n    return transcription ? `${transcription}\\n${textWithoutTranscription}` : textWithoutTranscription;\n  }\n\n  const text = entities.reduce((accText, {\n    type,\n    offset,\n    length,\n  }) => {\n    if (type !== ApiMessageEntityTypes.Spoiler) {\n      return accText;\n    }\n\n    const spoiler = generateBrailleSpoiler(length);\n\n    return `${accText.substr(0, offset)}${spoiler}${accText.substr(offset + length, accText.length)}`;\n  }, textWithoutTranscription);\n\n  return transcription ? `${transcription}\\n${text}` : text;\n}\n\nexport function getMessageSummaryEmoji(message: ApiMessage) {\n  const {\n    photo,\n    video,\n    audio,\n    voice,\n    document,\n    sticker,\n    pollId,\n    paidMedia,\n  } = message.content;\n\n  if (message.groupedId || photo || paidMedia) {\n    return '🖼';\n  }\n\n  if (video) {\n    return '📹';\n  }\n\n  if (sticker) {\n    return sticker.emoji;\n  }\n\n  if (audio) {\n    return '🎧';\n  }\n\n  if (voice) {\n    return '🎤';\n  }\n\n  if (document) {\n    return '📎';\n  }\n\n  if (pollId) {\n    return '📊';\n  }\n\n  return undefined;\n}\n\nexport function getMediaContentTypeDescription(\n  lang: OldLangFn, content: MediaContent, statefulContent: StatefulMediaContent | undefined,\n) {\n  return getSummaryDescription(lang, content, statefulContent);\n}\nexport function getMessageSummaryDescription(\n  lang: OldLangFn,\n  message: ApiMessage,\n  statefulContent: StatefulMediaContent | undefined,\n  truncatedText?: string | TeactNode,\n  isExtended = false,\n) {\n  return getSummaryDescription(lang, message.content, statefulContent, message, truncatedText, isExtended);\n}\nfunction getSummaryDescription(\n  lang: OldLangFn,\n  mediaContent: MediaContent,\n  statefulContent: StatefulMediaContent | undefined,\n  message?: ApiMessage,\n  truncatedText?: string | TeactNode,\n  isExtended = false,\n) {\n  const {\n    text,\n    photo,\n    video,\n    audio,\n    voice,\n    document,\n    sticker,\n    contact,\n    invoice,\n    location,\n    game,\n    storyData,\n    giveaway,\n    giveawayResults,\n    paidMedia,\n  } = mediaContent;\n  const { poll } = statefulContent || {};\n\n  let hasUsedTruncatedText = false;\n  let summary: string | TeactNode | undefined;\n\n  const boughtExtendedMedia = paidMedia?.isBought && paidMedia.extendedMedia;\n  const previewExtendedMedia = paidMedia && !paidMedia.isBought\n    ? paidMedia.extendedMedia as ApiMediaExtendedPreview[] : undefined;\n\n  const isPaidMediaAlbum = paidMedia && paidMedia.extendedMedia.length > 1;\n  const isPaidMediaSingleVideo = !isPaidMediaAlbum\n    && (boughtExtendedMedia?.[0].video || previewExtendedMedia?.[0].duration);\n  const isPaidMediaSinglePhoto = !isPaidMediaAlbum && !isPaidMediaSingleVideo;\n\n  if (message?.groupedId || isPaidMediaAlbum) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('lng_in_dlg_album');\n  }\n\n  if (photo || isPaidMediaSinglePhoto) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('AttachPhoto');\n  }\n\n  if (video || isPaidMediaSingleVideo) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang(video?.isGif ? 'AttachGif' : 'AttachVideo');\n  }\n\n  if (sticker) {\n    summary = lang('AttachSticker').trim();\n  }\n\n  if (audio) {\n    summary = getMessageAudioCaption(mediaContent) || lang('AttachMusic');\n  }\n\n  if (voice) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('AttachAudio');\n  }\n\n  if (document) {\n    hasUsedTruncatedText = !isExtended;\n    summary = isExtended ? document.fileName : (truncatedText || document.fileName);\n  }\n\n  if (contact) {\n    summary = lang('AttachContact');\n  }\n\n  if (poll) {\n    summary = renderTextWithEntities({\n      text: poll.summary.question.text,\n      entities: poll.summary.question.entities,\n      noLineBreaks: true,\n    });\n  }\n\n  if (invoice) {\n    summary = invoice.extendedMedia ? invoice.title : `${lang('PaymentInvoice')}: ${invoice.description}`;\n  }\n\n  if (text) {\n    if (isExtended && summary && !hasUsedTruncatedText) {\n      summary += `\\n${truncatedText}`;\n    } else {\n      summary = truncatedText;\n    }\n  }\n\n  if (location?.mediaType === 'geo' || location?.mediaType === 'venue') {\n    summary = lang('Message.Location');\n  }\n\n  if (location?.mediaType === 'geoLive') {\n    summary = lang('Message.LiveLocation');\n  }\n\n  if (game) {\n    summary = `🎮 ${game.title}`;\n  }\n\n  if (giveaway) {\n    summary = lang('BoostingGiveawayChannelStarted');\n  }\n\n  if (giveawayResults) {\n    summary = lang('Message.GiveawayEndedWinners', giveawayResults.winnersCount);\n  }\n\n  if (storyData) {\n    summary = truncatedText || (message ? lang('ForwardedStory') : lang('Chat.ReplyStory'));\n  }\n\n  if (isExpiredMessageContent(mediaContent)) {\n    const expiredMessageText = getExpiredMessageContentDescription(lang, mediaContent);\n    if (expiredMessageText) {\n      summary = expiredMessageText;\n    }\n  }\n\n  return summary || CONTENT_NOT_SUPPORTED;\n}\n\nexport function generateBrailleSpoiler(length: number) {\n  return new Array(length)\n    .fill(undefined)\n    .map(() => SPOILER_CHARS[Math.floor(Math.random() * SPOILER_CHARS.length)])\n    .join('');\n}\n\nfunction getMessageAudioCaption(mediaContent: MediaContent) {\n  const {\n    audio,\n    text,\n  } = mediaContent;\n\n  return (audio && [audio.title, audio.performer].filter(Boolean)\n    .join(' — ')) || (text?.text);\n}\n","import type {\n  ApiAttachment,\n  ApiMessage,\n  ApiMessageEntityTextUrl,\n  ApiPeer,\n  ApiStory,\n  ApiTypeStory,\n} from '../../api/types';\nimport type {\n  ApiPoll, MediaContainer, MediaContent, StatefulMediaContent,\n} from '../../api/types/messages';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport type { CustomPeer, ThreadId } from '../../types';\nimport type { LangFn } from '../../util/localization';\nimport type { GlobalState } from '../types';\nimport { ApiMessageEntityTypes, MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  CONTENT_NOT_SUPPORTED,\n  LOTTIE_STICKER_MIME_TYPE,\n  RE_LINK_TEMPLATE,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  SUPPORTED_AUDIO_CONTENT_TYPES,\n  SUPPORTED_PHOTO_CONTENT_TYPES,\n  SUPPORTED_VIDEO_CONTENT_TYPES,\n  TME_LINK_PREFIX,\n  VERIFICATION_CODES_USER_ID,\n  VIDEO_STICKER_MIME_TYPE,\n} from '../../config';\nimport { areSortedArraysIntersecting, unique } from '../../util/iteratees';\nimport { isLocalMessageId } from '../../util/keys/messageKey';\nimport { getServerTime } from '../../util/serverTime';\nimport { getGlobal } from '../index';\nimport {\n  getChatTitle, getCleanPeerId, isPeerUser, isUserId,\n} from './chats';\nimport { getMainUsername, getUserFirstOrLastName, getUserFullName } from './users';\n\nconst RE_LINK = new RegExp(RE_LINK_TEMPLATE, 'i');\n\nexport function getMessageHtmlId(messageId: number, index?: number) {\n  const parts = ['message', messageId.toString().replace('.', '-'), index].filter(Boolean);\n  return parts.join('-');\n}\n\nexport function getMessageOriginalId(message: ApiMessage) {\n  return message.previousLocalId || message.id;\n}\n\nexport function getMessageTranscription(message: ApiMessage) {\n  const { transcriptionId } = message;\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  const global = getGlobal();\n\n  return transcriptionId && global.transcriptions[transcriptionId]?.text;\n}\n\nexport function hasMessageText(message: MediaContainer) {\n  const {\n    text, sticker, photo, video, audio, voice, document, pollId, webPage, contact, invoice, location,\n    game, action, storyData, giveaway, giveawayResults, isExpiredVoice, paidMedia,\n  } = message.content;\n\n  return Boolean(text) || !(\n    sticker || photo || video || audio || voice || document || contact || pollId || webPage || invoice || location\n    || game || action?.phoneCall || storyData || giveaway || giveawayResults || isExpiredVoice || paidMedia\n  );\n}\n\nexport function getMessageStatefulContent(global: GlobalState, message: ApiMessage): StatefulMediaContent {\n  const poll = message.content.pollId ? global.messages.pollById[message.content.pollId] : undefined;\n\n  const { peerId: storyPeerId, id: storyId } = message.content.storyData || {};\n  const story = storyId && storyPeerId ? global.stories.byPeerId[storyPeerId]?.byId[storyId] : undefined;\n\n  return groupStatetefulContent({ poll, story });\n}\n\nexport function groupStatetefulContent({\n  poll,\n  story,\n} : {\n  poll?: ApiPoll;\n  story?: ApiTypeStory;\n}) {\n  return {\n    poll,\n    story: story && 'content' in story ? story : undefined,\n  };\n}\n\nexport function getMessageText(message: MediaContainer) {\n  return hasMessageText(message) ? message.content.text?.text || CONTENT_NOT_SUPPORTED : undefined;\n}\n\nexport function getMessageCustomShape(message: ApiMessage): boolean {\n  const {\n    text, sticker, photo, video, audio, voice,\n    document, pollId, webPage, contact, action,\n    game, invoice, location, storyData,\n  } = message.content;\n\n  if (sticker || (video?.isRound)) {\n    return true;\n  }\n\n  if (!text || photo || video || audio || voice || document || pollId || webPage || contact || action || game || invoice\n    || location || storyData) {\n    return false;\n  }\n\n  const hasOtherFormatting = text?.entities?.some((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji);\n\n  return Boolean(message.emojiOnlyCount && !hasOtherFormatting);\n}\n\nexport function getMessageSingleRegularEmoji(message: ApiMessage) {\n  const { text } = message.content;\n\n  if (text?.entities?.length || message.emojiOnlyCount !== 1) {\n    return undefined;\n  }\n\n  return text!.text;\n}\n\nexport function getMessageSingleCustomEmoji(message: ApiMessage): string | undefined {\n  const { text } = message.content;\n\n  if (text?.entities?.length !== 1\n    || text.entities[0].type !== ApiMessageEntityTypes.CustomEmoji\n    || message.emojiOnlyCount !== 1) {\n    return undefined;\n  }\n\n  return text.entities[0].documentId;\n}\n\nexport function getFirstLinkInMessage(message: ApiMessage) {\n  const { text } = message.content;\n\n  let match: RegExpMatchArray | null | undefined;\n  if (text?.entities) {\n    const firstTextUrl = text.entities.find((entity): entity is ApiMessageEntityTextUrl => (\n      entity.type === ApiMessageEntityTypes.TextUrl\n    ));\n    if (firstTextUrl) {\n      match = firstTextUrl.url.match(RE_LINK);\n    }\n\n    if (!match) {\n      const firstUrl = text.entities.find((entity) => entity.type === ApiMessageEntityTypes.Url);\n      if (firstUrl) {\n        const { offset, length } = firstUrl;\n        match = text.text.substring(offset, offset + length).match(RE_LINK);\n      }\n    }\n  }\n\n  if (!match && text) {\n    match = text.text.match(RE_LINK);\n  }\n\n  if (!match) {\n    return undefined;\n  }\n\n  return {\n    url: match[0],\n    domain: match[3],\n  };\n}\n\nexport function matchLinkInMessageText(message: ApiMessage) {\n  const { text } = message.content;\n  const match = text && text.text.match(RE_LINK);\n\n  if (!match) {\n    return undefined;\n  }\n\n  return {\n    url: match[0],\n    domain: match[3],\n  };\n}\n\nexport function isOwnMessage(message: ApiMessage) {\n  return message.isOutgoing;\n}\n\nexport function isReplyToMessage(message: ApiMessage) {\n  return Boolean(message.replyInfo?.type === 'message');\n}\n\nexport function isForwardedMessage(message: ApiMessage) {\n  return Boolean(message.forwardInfo || message.content.storyData);\n}\n\nexport function isActionMessage(message: ApiMessage) {\n  return Boolean(message.content.action) || isExpiredMessage(message);\n}\n\nexport function isServiceNotificationMessage(message: ApiMessage) {\n  return message.chatId === SERVICE_NOTIFICATIONS_USER_ID && Math.round(message.id) !== message.id;\n}\n\nexport function isAnonymousOwnMessage(message: ApiMessage) {\n  return Boolean(message.senderId) && !isUserId(message.senderId) && isOwnMessage(message);\n}\n\nexport function getPeerTitle(lang: OldLangFn | LangFn, peer: ApiPeer | CustomPeer) {\n  if (!peer) return undefined;\n  if ('isCustomPeer' in peer) {\n    // TODO: Remove any after full migration to new lang\n    return peer.titleKey ? lang(peer.titleKey as any) : peer.title;\n  }\n  return isPeerUser(peer) ? getUserFirstOrLastName(peer) : getChatTitle(lang, peer);\n}\n\nexport function getPeerFullTitle(lang: OldLangFn | LangFn, peer: ApiPeer | CustomPeer) {\n  if (!peer) return undefined;\n  if ('isCustomPeer' in peer) {\n    // TODO: Remove any after full migration to new lang\n    return peer.titleKey ? lang(peer.titleKey as any) : peer.title;\n  }\n  return isPeerUser(peer) ? getUserFullName(peer) : getChatTitle(lang, peer);\n}\n\nexport function getSendingState(message: ApiMessage) {\n  if (!message.sendingState) {\n    return 'succeeded';\n  }\n\n  return message.sendingState === 'messageSendingStateFailed' ? 'failed' : 'pending';\n}\n\nexport function isMessageLocal(message: ApiMessage) {\n  return isLocalMessageId(message.id);\n}\n\nexport function isMessageFailed(message: ApiMessage) {\n  return message.sendingState === 'messageSendingStateFailed';\n}\n\nexport function isHistoryClearMessage(message: ApiMessage) {\n  return message.content.action && message.content.action.type === 'historyClear';\n}\n\nexport function isGeoLiveExpired(message: ApiMessage) {\n  const { location } = message.content;\n  if (location?.mediaType !== 'geoLive') return false;\n  return getServerTime() - (message.date || 0) >= location.period;\n}\n\nexport function isMessageTranslatable(message: ApiMessage, allowOutgoing?: boolean) {\n  const { text, game } = message.content;\n\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isAction = isActionMessage(message);\n\n  return Boolean(text?.text.length && !message.emojiOnlyCount && !game && (allowOutgoing || !message.isOutgoing)\n    && !isLocal && !isServiceNotification && !isAction && !message.isScheduled);\n}\n\nexport function getMessageSingleInlineButton(message: ApiMessage) {\n  return message.inlineButtons?.length === 1\n    && message.inlineButtons[0].length === 1\n    && message.inlineButtons[0][0];\n}\n\nexport function orderHistoryIds(listedIds: number[]) {\n  return listedIds.sort((a, b) => a - b);\n}\n\nexport function orderPinnedIds(pinnedIds: number[]) {\n  return pinnedIds.sort((a, b) => b - a);\n}\n\nexport function mergeIdRanges(ranges: number[][], idsUpdate: number[]): number[][] {\n  let hasIntersection = false;\n  let newOutlyingLists = ranges.length ? ranges.map((list) => {\n    if (areSortedArraysIntersecting(list, idsUpdate) && !hasIntersection) {\n      hasIntersection = true;\n      return orderHistoryIds(unique(list.concat(idsUpdate)));\n    }\n    return list;\n  }) : [idsUpdate];\n\n  if (!hasIntersection) {\n    newOutlyingLists = newOutlyingLists.concat([idsUpdate]);\n  }\n\n  newOutlyingLists.sort((a, b) => a[0] - b[0]);\n\n  let length = newOutlyingLists.length;\n  for (let i = 0; i < length; i++) {\n    const array = newOutlyingLists[i];\n    const prevArray = newOutlyingLists[i - 1];\n\n    if (prevArray && (prevArray.includes(array[0]) || prevArray.includes(array[0] - 1))) {\n      newOutlyingLists[i - 1] = orderHistoryIds(unique(array.concat(prevArray)));\n      newOutlyingLists.splice(i, 1);\n\n      length--;\n      i--;\n    }\n  }\n\n  return newOutlyingLists;\n}\n\nexport function extractMessageText(message: ApiMessage | ApiStory, inChatList = false) {\n  const contentText = message.content.text;\n  if (!contentText) return undefined;\n\n  const { text } = contentText;\n  let { entities } = contentText;\n\n  if (text && 'chatId' in message) {\n    if (message.chatId === SERVICE_NOTIFICATIONS_USER_ID) {\n      const authCode = text.match(/^\\D*([\\d-]{5,7})\\D/)?.[1];\n      if (authCode) {\n        entities = [\n          ...entities || [],\n          {\n            type: inChatList ? ApiMessageEntityTypes.Spoiler : ApiMessageEntityTypes.Code,\n            offset: text.indexOf(authCode),\n            length: authCode.length,\n          },\n        ];\n        entities.sort((a, b) => (a.offset > b.offset ? 1 : -1));\n      }\n    }\n\n    if (inChatList && message.chatId === VERIFICATION_CODES_USER_ID && entities) {\n      // Wrap code entities in spoiler\n      const hasCodeEntities = entities.some((entity) => entity.type === ApiMessageEntityTypes.Code);\n      if (hasCodeEntities) {\n        const oldEntities = entities;\n        entities = [];\n\n        for (let i = 0; i < oldEntities.length; i++) {\n          const entity = oldEntities[i];\n          if (entity.type === ApiMessageEntityTypes.Code) {\n            entities.push({\n              type: ApiMessageEntityTypes.Spoiler,\n              offset: entity.offset,\n              length: entity.length,\n            });\n          }\n          entities.push(entity);\n        }\n      }\n    }\n  }\n\n  return { text, entities };\n}\n\nexport function getExpiredMessageDescription(langFn: OldLangFn, message: ApiMessage): string | undefined {\n  return getExpiredMessageContentDescription(langFn, message.content);\n}\nexport function getExpiredMessageContentDescription(langFn: OldLangFn, mediaContent: MediaContent): string | undefined {\n  const { isExpiredVoice, isExpiredRoundVideo } = mediaContent;\n  if (isExpiredVoice) {\n    return langFn('Message.VoiceMessageExpired');\n  } else if (isExpiredRoundVideo) {\n    return langFn('Message.VideoMessageExpired');\n  }\n  return undefined;\n}\n\nexport function isExpiredMessage(message: ApiMessage) {\n  return isExpiredMessageContent(message.content);\n}\n\nexport function isExpiredMessageContent(content: MediaContent) {\n  const { isExpiredVoice, isExpiredRoundVideo } = content ?? {};\n  return Boolean(isExpiredVoice || isExpiredRoundVideo);\n}\n\nexport function hasMessageTtl(message: ApiMessage) {\n  return message.content?.ttlSeconds !== undefined;\n}\n\nexport function isJoinedChannelMessage(message: ApiMessage) {\n  return message.content.action && message.content.action.type === 'joinedChannel';\n}\n\nexport function getAttachmentMediaType(attachment: ApiAttachment) {\n  if (SUPPORTED_AUDIO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'audio';\n  }\n\n  if (attachment.shouldSendAsFile) return 'file';\n\n  if (SUPPORTED_PHOTO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'photo';\n  }\n\n  if (SUPPORTED_VIDEO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'video';\n  }\n\n  return 'file';\n}\n\nexport function isUploadingFileSticker(attachment: ApiAttachment) {\n  return attachment ? (attachment.mimeType === 'image/webp' || attachment.mimeType === LOTTIE_STICKER_MIME_TYPE\n    || attachment.mimeType === VIDEO_STICKER_MIME_TYPE) : undefined;\n}\n\nexport function getMessageLink(peer: ApiPeer, topicId?: ThreadId, messageId?: number) {\n  const chatUsername = getMainUsername(peer);\n\n  const normalizedId = getCleanPeerId(peer.id);\n\n  const chatPart = chatUsername || `c/${normalizedId}`;\n  const topicPart = topicId && topicId !== MAIN_THREAD_ID ? `/${topicId}` : '';\n  const messagePart = messageId ? `/${messageId}` : '';\n  return `${TME_LINK_PREFIX}${chatPart}${topicPart}${messagePart}`;\n}\n\nexport function splitMessagesForForwarding(messages: ApiMessage[], limit: number): ApiMessage[][] {\n  const result: ApiMessage[][] = [];\n  let currentArr: ApiMessage[] = [];\n\n  // Group messages by `groupedId`\n  messages.reduce<ApiMessage[][]>((acc, message) => {\n    const lastGroup = acc[acc.length - 1];\n    if (message.groupedId && lastGroup?.[0]?.groupedId === message.groupedId) {\n      lastGroup.push(message);\n      return acc;\n    }\n\n    acc.push([message]);\n    return acc;\n  }, []).forEach((batch) => {\n    // Fit them into `limit` size\n    if (currentArr.length + batch.length > limit) {\n      result.push(currentArr);\n      currentArr = [];\n    }\n\n    currentArr.push(...batch);\n  });\n\n  if (currentArr.length) {\n    result.push(currentArr);\n  }\n\n  return result;\n}\n","import type { ThreadId } from '../../types';\n\nexport function buildChatThreadKey(chatId: string, threadId: ThreadId) {\n  return `${chatId}_${threadId}`;\n}\n","import type { ApiMessage, ApiMessageReplyInfo, ApiStoryReplyInfo } from '../../api/types';\n\nexport function getMessageReplyInfo(message: ApiMessage): ApiMessageReplyInfo | undefined {\n  const { replyInfo } = message;\n  if (!replyInfo || replyInfo.type !== 'message') return undefined;\n  return replyInfo;\n}\n\nexport function getStoryReplyInfo(message: ApiMessage): ApiStoryReplyInfo | undefined {\n  const { replyInfo } = message;\n  if (!replyInfo || replyInfo.type !== 'story') return undefined;\n  return replyInfo;\n}\n","import type { ApiFormattedText } from '../../api/types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nexport function getStickerHashById(stickerId: string, isPreview?: boolean) {\n  const base = `sticker${stickerId}`;\n  return !isPreview ? base : `${base}?size=m`;\n}\n\nexport function containsCustomEmoji(formattedText: ApiFormattedText) {\n  return formattedText.entities?.some((e) => e.type === ApiMessageEntityTypes.CustomEmoji);\n}\n\nexport function stripCustomEmoji(text: ApiFormattedText): ApiFormattedText {\n  if (!text.entities) return text;\n\n  const entities = text.entities.filter((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji);\n  return { ...text, entities };\n}\n","import type { ApiPeer, ApiUser, ApiUserStatus } from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\n\nimport { ANONYMOUS_USER_ID, SERVICE_NOTIFICATIONS_USER_ID } from '../../config';\nimport { formatFullDate, formatTime } from '../../util/dates/dateFormat';\nimport { DAY } from '../../util/dates/units';\nimport { orderBy } from '../../util/iteratees';\nimport { formatPhoneNumber } from '../../util/phoneNumber';\nimport { prepareSearchWordsForNeedle } from '../../util/searchWords';\nimport { getServerTime, getServerTimeOffset } from '../../util/serverTime';\n\nexport function getUserFirstOrLastName(user?: ApiUser) {\n  if (!user) {\n    return undefined;\n  }\n\n  switch (user.type) {\n    case 'userTypeBot':\n      return user.firstName;\n    case 'userTypeRegular': {\n      return user.firstName || user.lastName;\n    }\n\n    case 'userTypeDeleted':\n    case 'userTypeUnknown': {\n      return 'Deleted';\n    }\n\n    default:\n      return undefined;\n  }\n}\n\nexport function getUserFullName(user?: ApiUser) {\n  if (!user) {\n    return undefined;\n  }\n\n  if (isDeletedUser(user)) {\n    return 'Deleted Account';\n  }\n\n  switch (user.type) {\n    case 'userTypeBot':\n    case 'userTypeRegular': {\n      if (user.firstName && user.lastName) {\n        return `${user.firstName} ${user.lastName}`;\n      }\n\n      if (user.firstName) {\n        return user.firstName;\n      }\n\n      if (user.lastName) {\n        return user.lastName;\n      }\n\n      if (user.phoneNumber) {\n        return `+${formatPhoneNumber(user.phoneNumber)}`;\n      }\n\n      break;\n    }\n  }\n\n  return undefined;\n}\n\nexport function getUserStatus(\n  lang: OldLangFn, user: ApiUser, userStatus: ApiUserStatus | undefined,\n) {\n  if (user.id === SERVICE_NOTIFICATIONS_USER_ID) {\n    return lang('ServiceNotifications');\n  }\n\n  if (user.isSupport) {\n    return lang('SupportStatus');\n  }\n\n  if (user.type && user.type === 'userTypeBot') {\n    if (user.botActiveUsers) {\n      return lang('BotUsers', user.botActiveUsers, 'i');\n    }\n    return lang('Bot');\n  }\n\n  if (!userStatus) {\n    return '';\n  }\n\n  switch (userStatus.type) {\n    case 'userStatusEmpty': {\n      return lang('ALongTimeAgo');\n    }\n\n    case 'userStatusLastMonth': {\n      return lang('WithinAMonth');\n    }\n\n    case 'userStatusLastWeek': {\n      return lang('WithinAWeek');\n    }\n\n    case 'userStatusOffline': {\n      const { wasOnline } = userStatus;\n\n      if (!wasOnline) return lang('LastSeen.Offline');\n\n      const serverTimeOffset = getServerTimeOffset();\n      const now = new Date(Date.now() + serverTimeOffset * 1000);\n      const wasOnlineDate = new Date(wasOnline * 1000);\n\n      if (wasOnlineDate >= now) {\n        return lang('LastSeen.JustNow');\n      }\n\n      const diff = new Date(now.getTime() - wasOnlineDate.getTime());\n\n      // within a minute\n      if (diff.getTime() / 1000 < 60) {\n        return lang('LastSeen.JustNow');\n      }\n\n      // within an hour\n      if (diff.getTime() / 1000 < 60 * 60) {\n        const minutes = Math.floor(diff.getTime() / 1000 / 60);\n        return lang('LastSeen.MinutesAgo', minutes);\n      }\n\n      // today\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      const serverToday = new Date(today.getTime() + serverTimeOffset * 1000);\n      if (wasOnlineDate > serverToday) {\n        // up to 6 hours ago\n        if (diff.getTime() / 1000 < 6 * 60 * 60) {\n          const hours = Math.floor(diff.getTime() / 1000 / 60 / 60);\n          return lang('LastSeen.HoursAgo', hours);\n        }\n\n        // other\n        return lang('LastSeen.TodayAt', formatTime(lang, wasOnlineDate));\n      }\n\n      // yesterday\n      const yesterday = new Date();\n      yesterday.setDate(now.getDate() - 1);\n      yesterday.setHours(0, 0, 0, 0);\n      const serverYesterday = new Date(yesterday.getTime() + serverTimeOffset * 1000);\n      if (wasOnlineDate > serverYesterday) {\n        return lang('LastSeen.YesterdayAt', formatTime(lang, wasOnlineDate));\n      }\n\n      return lang('LastSeen.AtDate', formatFullDate(lang, wasOnlineDate));\n    }\n\n    case 'userStatusOnline': {\n      return lang('Online');\n    }\n\n    case 'userStatusRecently': {\n      return lang('Lately');\n    }\n\n    default:\n      return undefined;\n  }\n}\n\nexport function isUserOnline(user: ApiUser, userStatus?: ApiUserStatus, withSelfOnline = false) {\n  const { id, type } = user;\n\n  if (!userStatus) {\n    return false;\n  }\n\n  if (id === SERVICE_NOTIFICATIONS_USER_ID) {\n    return false;\n  }\n\n  if (user.isSelf && !withSelfOnline) {\n    return false;\n  }\n\n  return userStatus.type === 'userStatusOnline' && type !== 'userTypeBot';\n}\n\nexport function isDeletedUser(user: ApiUser) {\n  return (user.type === 'userTypeDeleted' || user.type === 'userTypeUnknown')\n    && user.id !== SERVICE_NOTIFICATIONS_USER_ID;\n}\n\nexport function isUserBot(user: ApiUser) {\n  return user.type === 'userTypeBot';\n}\n\nexport function getCanAddContact(user: ApiUser) {\n  return !user.isSelf && !user.isContact && !isUserBot(user) && user.id !== ANONYMOUS_USER_ID;\n}\n\nexport function sortUserIds(\n  userIds: string[],\n  usersById: Record<string, ApiUser>,\n  userStatusesById: Record<string, ApiUserStatus>,\n  priorityIds?: string[],\n) {\n  return orderBy(userIds, (id) => {\n    const now = getServerTime();\n\n    if (priorityIds && priorityIds.includes(id)) {\n      // Assuming that online status expiration date can't be as far as two days from now,\n      // this should place prioritized on top of the list.\n      // Then we subtract index of `id` in `priorityIds` to preserve selected order\n      return now + (48 * 60 * 60) - (priorityIds.length - priorityIds.indexOf(id));\n    }\n\n    const user = usersById[id];\n    const userStatus = userStatusesById[id];\n    if (!user || !userStatus) {\n      return 0;\n    }\n\n    if (userStatus.type === 'userStatusOnline') {\n      return userStatus.expires;\n    } else if (userStatus.type === 'userStatusOffline' && userStatus.wasOnline) {\n      return userStatus.wasOnline;\n    }\n\n    switch (userStatus.type) {\n      case 'userStatusRecently':\n        return now - DAY;\n      case 'userStatusLastWeek':\n        return now - DAY * 7;\n      case 'userStatusLastMonth':\n        return now - DAY * 7 * 30;\n      default:\n        return 0;\n    }\n  }, 'desc');\n}\n\nexport function filterUsersByName(\n  userIds: string[],\n  usersById: Record<string, ApiUser>,\n  query?: string,\n  currentUserId?: string,\n  savedMessagesLang?: string,\n) {\n  if (!query) {\n    return userIds;\n  }\n\n  const searchWords = prepareSearchWordsForNeedle(query);\n\n  return userIds.filter((id) => {\n    const user = usersById[id];\n    if (!user) {\n      return false;\n    }\n\n    const name = id === currentUserId ? savedMessagesLang : getUserFullName(user);\n\n    return (name && searchWords(name)) || Boolean(user.usernames?.find(({ username }) => searchWords(username)));\n  });\n}\n\nexport function getMainUsername(userOrChat: ApiPeer) {\n  return userOrChat.usernames?.find((u) => u.isActive)?.username;\n}\n\nexport function getPeerStoryHtmlId(userId: string) {\n  return `peer-story${userId}`;\n}\n","import type { ActionOptions } from '../lib/teact/teactn';\nimport { typify } from '../lib/teact/teactn';\n\nimport type {\n  ActionPayloads, GlobalState, RequiredActionPayloads, RequiredGlobalState,\n} from './types';\n\nconst typed = typify<GlobalState, ActionPayloads & RequiredActionPayloads>();\n\ntype ProjectActionTypes =\n  ActionPayloads\n  & RequiredActionPayloads;\n\ntype ProjectActionNames = keyof ProjectActionTypes;\n\ntype Helper<T, E> = Exclude<T, E> extends never ? {} : Exclude<T, E>;\n// `Required` actions are called from actions to ensure the `tabId` is always provided if needed.\n// There are three types of actions:\n// 1. With tabId, which is made required when calling action from another action handler\n// 2. Without payload (= undefined), hence made the payload not required\n// 3. With payload, hence made the payload required\nexport type RequiredGlobalActions = {\n  [ActionName in ProjectActionNames]: 'tabId' extends keyof Helper<ProjectActionTypes[ActionName], undefined> ? ((\n    payload: ProjectActionTypes[ActionName] & { tabId: number },\n    options?: ActionOptions,\n  ) => void) :\n    (undefined extends ProjectActionTypes[ActionName] ? (\n      (payload?: ProjectActionTypes[ActionName], options?: ActionOptions) => void\n    ) : (\n      (payload: ProjectActionTypes[ActionName], options?: ActionOptions) => void\n    ))\n} & { _: never };\n\ntype ActionHandlers = {\n  [ActionName in keyof ProjectActionTypes]: (\n    global: RequiredGlobalState,\n    actions: RequiredGlobalActions,\n    payload: ProjectActionTypes[ActionName],\n  ) => GlobalState | void | Promise<void>;\n};\n\nexport const getGlobal = typed.getGlobal;\nexport const setGlobal = typed.setGlobal;\nexport const getActions = typed.getActions;\nexport const addActionHandler = typed.addActionHandler as <ActionName extends ProjectActionNames>(\n  name: ActionName,\n  handler: ActionHandlers[ActionName],\n) => void;\nexport const withGlobal = typed.withGlobal;\nexport type GlobalActions = ReturnType<typeof getActions>;\n","import type { PerformanceType } from '../types';\nimport type { GlobalState, TabState } from './types';\nimport { NewChatMembersProgress } from '../types';\n\nimport {\n  ANIMATION_LEVEL_DEFAULT,\n  DARK_THEME_PATTERN_COLOR,\n  DEFAULT_MESSAGE_TEXT_SIZE_PX,\n  DEFAULT_PATTERN_COLOR,\n  DEFAULT_PLAYBACK_RATE,\n  DEFAULT_VOLUME,\n  IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX,\n  MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX,\n} from '../config';\nimport { IS_IOS, IS_MAC_OS } from '../util/windowEnvironment';\n\nexport const INITIAL_PERFORMANCE_STATE_MAX: PerformanceType = {\n  animatedEmoji: true,\n  autoplayGifs: true,\n  autoplayVideos: true,\n  contextMenuAnimations: true,\n  contextMenuBlur: true,\n  loopAnimatedStickers: true,\n  mediaViewerAnimations: true,\n  messageComposerAnimations: true,\n  messageSendingAnimations: true,\n  pageTransitions: true,\n  reactionEffects: true,\n  rightColumnAnimations: true,\n  stickerEffects: true,\n  storyRibbonAnimations: true,\n  snapEffect: true,\n};\n\nexport const INITIAL_PERFORMANCE_STATE_MID: PerformanceType = {\n  animatedEmoji: true,\n  autoplayGifs: true,\n  autoplayVideos: true,\n  contextMenuAnimations: true,\n  contextMenuBlur: true,\n  loopAnimatedStickers: true,\n  mediaViewerAnimations: true,\n  messageComposerAnimations: true,\n  messageSendingAnimations: true,\n  pageTransitions: true,\n  reactionEffects: true,\n  rightColumnAnimations: false,\n  stickerEffects: false,\n  storyRibbonAnimations: false,\n  snapEffect: false,\n};\n\nexport const INITIAL_PERFORMANCE_STATE_MIN: PerformanceType = {\n  animatedEmoji: false,\n  autoplayGifs: false,\n  autoplayVideos: false,\n  contextMenuAnimations: false,\n  contextMenuBlur: false,\n  loopAnimatedStickers: false,\n  mediaViewerAnimations: false,\n  messageComposerAnimations: false,\n  messageSendingAnimations: false,\n  pageTransitions: false,\n  reactionEffects: false,\n  rightColumnAnimations: false,\n  stickerEffects: false,\n  storyRibbonAnimations: false,\n  snapEffect: false,\n};\n\nexport const INITIAL_GLOBAL_STATE: GlobalState = {\n  isInited: true,\n  attachMenu: { bots: {} },\n  passcode: {},\n  twoFaSettings: {},\n  isAppUpdateAvailable: false,\n  isElectronUpdateAvailable: false,\n  shouldShowContextMenuHint: true,\n\n  audioPlayer: {\n    lastPlaybackRate: DEFAULT_PLAYBACK_RATE,\n  },\n\n  mediaViewer: {\n    lastPlaybackRate: DEFAULT_PLAYBACK_RATE,\n  },\n\n  authRememberMe: true,\n  countryList: {\n    phoneCodes: [],\n    general: [],\n  },\n\n  blocked: {\n    ids: [],\n    totalCount: 0,\n  },\n\n  users: {\n    byId: {},\n    statusesById: {},\n    fullInfoById: {},\n    previewMediaByBotId: {},\n    commonChatsById: {},\n    botAppPermissionsById: {},\n  },\n\n  peers: {\n    giftsById: {},\n    profilePhotosById: {},\n  },\n\n  chats: {\n    listIds: {},\n    isFullyLoaded: {},\n    orderedPinnedIds: {},\n    totalCount: {},\n    lastMessageIds: {},\n    byId: {},\n    fullInfoById: {},\n    similarChannelsById: {},\n    similarBotsById: {},\n    topicsInfoById: {},\n    loadingParameters: {\n      active: {},\n      archived: {},\n      saved: {},\n    },\n  },\n\n  messages: {\n    byChatId: {},\n    sponsoredByChatId: {},\n    pollById: {},\n  },\n\n  stories: {\n    byPeerId: {},\n    orderedPeerIds: {\n      archived: [],\n      active: [],\n    },\n    hasNext: true,\n    hasNextInArchive: true,\n    stealthMode: {},\n  },\n\n  groupCalls: {\n    byId: {},\n  },\n\n  attachmentSettings: {\n    shouldCompress: true,\n    shouldSendGrouped: true,\n    isInvertedMedia: undefined,\n    webPageMediaSize: undefined,\n  },\n\n  scheduledMessages: {\n    byChatId: {},\n  },\n\n  quickReplies: {\n    byId: {},\n    messagesById: {},\n  },\n\n  chatFolders: {\n    byId: {},\n    invites: {},\n  },\n\n  fileUploads: {\n    byMessageKey: {},\n  },\n\n  recentEmojis: ['grinning', 'kissing_heart', 'christmas_tree', 'brain', 'trophy', 'duck', 'cherries'],\n  recentCustomEmojis: ['5377305978079288312'],\n\n  reactions: {\n    defaultTags: [],\n    topReactions: [],\n    recentReactions: [],\n    effectReactions: [],\n    hash: {},\n  },\n  availableEffectById: {},\n\n  stickers: {\n    setsById: {},\n    added: {},\n    recent: {\n      stickers: [],\n    },\n    favorite: {\n      stickers: [],\n    },\n    greeting: {\n      stickers: [],\n    },\n    premium: {\n      stickers: [],\n    },\n    featured: {\n      setIds: [],\n    },\n    effect: {\n      stickers: [],\n      emojis: [],\n    },\n    forEmoji: {},\n  },\n\n  customEmojis: {\n    lastRendered: [],\n    byId: {},\n    added: {},\n    forEmoji: {},\n    statusRecent: {},\n  },\n\n  emojiKeywords: {},\n\n  gifs: {\n    saved: {},\n  },\n\n  topPeers: {},\n\n  topInlineBots: {},\n  topBotApps: {},\n\n  activeSessions: {\n    byHash: {},\n    orderedHashes: [],\n  },\n\n  activeWebSessions: {\n    byHash: {},\n    orderedHashes: [],\n  },\n\n  settings: {\n    byKey: {\n      theme: 'light',\n      shouldUseSystemTheme: true,\n      messageTextSize: IS_IOS\n        ? IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX\n        : (IS_MAC_OS ? MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX : DEFAULT_MESSAGE_TEXT_SIZE_PX),\n      animationLevel: ANIMATION_LEVEL_DEFAULT,\n      messageSendKeyCombo: 'enter',\n      canAutoLoadPhotoFromContacts: true,\n      canAutoLoadPhotoInPrivateChats: true,\n      canAutoLoadPhotoInGroups: true,\n      canAutoLoadPhotoInChannels: true,\n      canAutoLoadVideoFromContacts: true,\n      canAutoLoadVideoInPrivateChats: true,\n      canAutoLoadVideoInGroups: true,\n      canAutoLoadVideoInChannels: true,\n      canAutoLoadFileFromContacts: false,\n      canAutoLoadFileInPrivateChats: false,\n      canAutoLoadFileInGroups: false,\n      canAutoLoadFileInChannels: false,\n      autoLoadFileMaxSizeMb: 10,\n      hasWebNotifications: true,\n      hasPushNotifications: true,\n      notificationSoundVolume: 5,\n      shouldSuggestStickers: true,\n      shouldSuggestCustomEmoji: true,\n      shouldSkipWebAppCloseConfirmation: false,\n      shouldUpdateStickerSetOrder: true,\n      language: 'en',\n      timeFormat: '24h',\n      wasTimeFormatSetManually: false,\n      isConnectionStatusMinimized: true,\n      shouldArchiveAndMuteNewNonContact: false,\n      shouldNewNonContactPeersRequirePremium: false,\n      shouldHideReadMarks: false,\n      canTranslate: false,\n      canTranslateChats: true,\n      doNotTranslate: [],\n      canDisplayChatInTitle: true,\n      shouldAllowHttpTransport: true,\n      shouldWarnAboutSvg: true,\n    },\n    themes: {\n      light: {\n        isBlurred: true,\n        patternColor: DEFAULT_PATTERN_COLOR,\n      },\n      dark: {\n        isBlurred: true,\n        patternColor: DARK_THEME_PATTERN_COLOR,\n      },\n    },\n    performance: INITIAL_PERFORMANCE_STATE_MAX,\n    privacy: {},\n    notifyExceptions: {},\n    botVerificationShownPeerIds: [],\n  },\n\n  serviceNotifications: [],\n  trustedBotIds: [],\n\n  transcriptions: {},\n  translations: {\n    byChatId: {},\n  },\n\n  byTabId: {},\n\n  archiveSettings: {\n    isMinimized: false,\n    isHidden: false,\n  },\n};\n\nexport const INITIAL_TAB_STATE: TabState = {\n  id: 0,\n  isMasterTab: false,\n  isLeftColumnShown: true,\n  isChatInfoShown: false,\n  newChatMembersProgress: NewChatMembersProgress.Closed,\n  uiReadyState: 0,\n  shouldInit: true,\n\n  gifSearch: {},\n  stickerSearch: {},\n\n  messageLists: [],\n  activeChatFolder: 0,\n  tabThreads: {},\n\n  inlineBots: {\n    isLoading: false,\n    byUsername: {},\n  },\n\n  webApps: {\n    openedWebApps: {},\n    openedOrderedKeys: [],\n    sessionKeys: [],\n    modalState: 'maximized',\n    isModalOpen: false,\n    isMoreAppsTabActive: false,\n  },\n\n  globalSearch: {},\n\n  userSearch: {},\n\n  middleSearch: {\n    byChatThreadKey: {},\n  },\n\n  sharedMediaSearch: {\n    byChatThreadKey: {},\n  },\n\n  chatMediaSearch: {\n    byChatThreadKey: {},\n  },\n\n  management: {\n    byChatId: {},\n  },\n\n  storyViewer: {\n    isMuted: true,\n    isRibbonShown: false,\n  },\n\n  mediaViewer: {\n    volume: DEFAULT_VOLUME,\n    playbackRate: DEFAULT_PLAYBACK_RATE,\n    isMuted: false,\n  },\n\n  audioPlayer: {\n    volume: DEFAULT_VOLUME,\n    playbackRate: DEFAULT_PLAYBACK_RATE,\n    isMuted: false,\n  },\n\n  isShareMessageModalShown: false,\n\n  isWebAppsCloseConfirmationModalOpen: false,\n\n  forwardMessages: {},\n\n  replyingMessage: {},\n\n  pollResults: {},\n\n  payment: {},\n  starsPayment: {},\n\n  notifications: [],\n\n  dialogs: [],\n\n  activeReactions: {},\n\n  activeDownloads: {},\n\n  statistics: {\n    byChatId: {},\n  },\n\n  pollModal: {\n    isOpen: false,\n  },\n\n  requestedTranslations: {\n    byChatId: {},\n  },\n};\n","import type {\n  ApiChat, ApiChatFullInfo, ApiChatMember,\n} from '../../api/types';\nimport type { ChatListType } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { ARCHIVED_FOLDER_ID } from '../../config';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport {\n  areSortedArraysEqual, buildCollectionByKey, omit, omitUndefined, pick, unique,\n} from '../../util/iteratees';\nimport { selectChatFullInfo } from '../selectors';\n\nconst DEFAULT_CHAT_LISTS: ChatListType[] = ['active', 'archived'];\n\nexport function replaceChatListIds<T extends GlobalState>(\n  global: T,\n  type: ChatListType,\n  newIds: string[] | undefined,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      listIds: {\n        ...global.chats.listIds,\n        [type]: newIds,\n      },\n    },\n  };\n}\n\nexport function replaceChatListLoadingParameters<T extends GlobalState>(\n  global: T, type: ChatListType, nextOffsetId?: number, nextOffsetPeerId?: string, nextOffsetDate?: number,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      loadingParameters: {\n        ...global.chats.loadingParameters,\n        [type]: {\n          nextOffsetId,\n          nextOffsetPeerId,\n          nextOffsetDate,\n        },\n      },\n    },\n  };\n}\n\nexport function updateChatLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, lastMessageId: number, listType?: ChatListType,\n): T {\n  const key = listType === 'saved' ? 'saved' : 'all';\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      lastMessageIds: {\n        ...global.chats.lastMessageIds,\n        [key]: {\n          ...global.chats.lastMessageIds[key],\n          [chatId]: lastMessageId,\n        },\n      },\n    },\n  };\n}\n\nexport function updateChatsLastMessageId<T extends GlobalState>(\n  global: T, messageIds: Record<string, number>, listType?: ChatListType,\n): T {\n  const key = listType === 'saved' ? 'saved' : 'all';\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      lastMessageIds: {\n        ...global.chats.lastMessageIds,\n        [key]: {\n          ...global.chats.lastMessageIds[key],\n          ...messageIds,\n        },\n      },\n    },\n  };\n}\n\nexport function addChatListIds<T extends GlobalState>(\n  global: T, type: ChatListType, idsUpdate: string[],\n): T {\n  const { [type]: listIds } = global.chats.listIds;\n  const newIds = listIds?.length\n    ? idsUpdate.filter((id) => !listIds.includes(id))\n    : idsUpdate;\n\n  if (listIds && !newIds.length) {\n    return global;\n  }\n\n  return replaceChatListIds(global, type, [\n    ...(listIds || []),\n    ...newIds,\n  ]);\n}\n\nexport function replaceChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      byId: newById,\n    },\n  };\n}\n\nexport function addUnreadMentions<T extends GlobalState>(\n  global: T, chatId: string, chat: ApiChat, ids: number[], shouldUpdateCount: boolean = false,\n): T {\n  const prevChatUnreadMentions = (chat.unreadMentions || []);\n  const updatedUnreadMentions = unique([...prevChatUnreadMentions, ...ids]).sort((a, b) => b - a);\n  global = updateChat(global, chatId, {\n    unreadMentions: updatedUnreadMentions,\n  });\n\n  if (shouldUpdateCount) {\n    const updatedUnreadMentionsCount = (chat.unreadMentionsCount || 0)\n    + Math.max(0, updatedUnreadMentions.length - prevChatUnreadMentions.length);\n\n    global = updateChat(global, chatId, {\n      unreadMentionsCount: updatedUnreadMentionsCount,\n    });\n  }\n  return global;\n}\n\nexport function removeUnreadMentions<T extends GlobalState>(\n  global: T, chatId: string, chat: ApiChat, ids: number[], shouldUpdateCount: boolean = false,\n): T {\n  const prevChatUnreadMentions = (chat.unreadMentions || []);\n  const updatedUnreadMentions = prevChatUnreadMentions?.filter((id) => !ids.includes(id));\n\n  global = updateChat(global, chatId, {\n    unreadMentions: updatedUnreadMentions,\n  });\n\n  if (shouldUpdateCount && chat.unreadMentionsCount) {\n    const removedCount = prevChatUnreadMentions.length - updatedUnreadMentions.length;\n    const updatedUnreadMentionsCount = Math.max(chat.unreadMentionsCount - removedCount, 0) || undefined;\n\n    global = updateChat(global, chatId, {\n      unreadMentionsCount: updatedUnreadMentionsCount,\n    });\n  }\n  return global;\n}\n\nexport function updateChat<T extends GlobalState>(\n  global: T, chatId: string, chatUpdate: Partial<ApiChat>, noOmitUnreadReactionCount = false, withDeepCheck = false,\n): T {\n  const { byId } = global.chats;\n\n  const chat = byId[chatId];\n  if (withDeepCheck && chat) {\n    const updateKeys = Object.keys(chatUpdate) as (keyof ApiChat)[];\n    if (areDeepEqual(pick(chat, updateKeys), chatUpdate)) {\n      return global;\n    }\n  }\n\n  const updatedChat = getUpdatedChat(global, chatId, chatUpdate, noOmitUnreadReactionCount);\n  if (!updatedChat) {\n    return global;\n  }\n\n  return replaceChats(global, {\n    ...byId,\n    [chatId]: updatedChat,\n  });\n}\n\nexport function updateChatFullInfo<T extends GlobalState>(\n  global: T, chatId: string, fullInfoUpdate: Partial<ApiChatFullInfo>,\n): T {\n  const currentFullInfo = selectChatFullInfo(global, chatId);\n  const updatedFullInfo = {\n    ...currentFullInfo,\n    ...fullInfoUpdate,\n  };\n\n  if (areDeepEqual(currentFullInfo, updatedFullInfo)) {\n    return global;\n  }\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      fullInfoById: {\n        ...global.chats.fullInfoById,\n        [chatId]: updatedFullInfo,\n      },\n    },\n  };\n}\n\nexport function replaceChatFullInfo<T extends GlobalState>(global: T, chatId: string, fullInfo: ApiChatFullInfo): T {\n  const currentFullInfo = selectChatFullInfo(global, chatId);\n\n  if (areDeepEqual(currentFullInfo, fullInfo)) {\n    return global;\n  }\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      fullInfoById: {\n        ...global.chats.fullInfoById,\n        [chatId]: fullInfo,\n      },\n    },\n  };\n}\n\nexport function updateChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  const updatedById = Object.keys(newById).reduce((acc: Record<string, ApiChat>, id) => {\n    const updatedChat = getUpdatedChat(global, id, newById[id]);\n    if (updatedChat) {\n      acc[id] = updatedChat;\n    }\n\n    return acc;\n  }, {});\n\n  global = replaceChats(global, {\n    ...global.chats.byId,\n    ...updatedById,\n  });\n\n  return global;\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  const { byId } = global.chats;\n  let isUpdated = false;\n\n  const addedById = Object.keys(newById).reduce<Record<string, ApiChat>>((acc, id) => {\n    const existingChat = byId[id];\n    const newChat = newById[id];\n\n    const membersCountChanged = !existingChat?.membersCount && newChat.membersCount;\n\n    if (existingChat && !existingChat.isMin && !membersCountChanged\n        && (newChat.isMin || existingChat.accessHash === newChat.accessHash)) {\n      return acc;\n    }\n\n    const updatedChat = getUpdatedChat(global, id, newChat);\n    if (updatedChat) {\n      acc[id] = updatedChat;\n      if (!isUpdated) {\n        isUpdated = true;\n      }\n    }\n\n    return acc;\n  }, {});\n\n  if (!isUpdated) {\n    return global;\n  }\n\n  global = replaceChats(global, {\n    ...byId,\n    ...addedById,\n  });\n\n  return global;\n}\n\n// @optimization Don't spread/unspread global for each element, do it in a batch\nfunction getUpdatedChat<T extends GlobalState>(\n  global: T, chatId: string, chatUpdate: Partial<ApiChat>,\n  noOmitUnreadReactionCount = false,\n) {\n  const { byId } = global.chats;\n  const chat = byId[chatId];\n  const omitProps: (keyof ApiChat)[] = [];\n\n  if (chatUpdate.isMin && chat && !chat.isMin) {\n    return undefined; // Do not apply updates from min constructor\n  }\n\n  if (!noOmitUnreadReactionCount) {\n    omitProps.push('unreadReactionsCount');\n  }\n\n  if (areDeepEqual(chat?.usernames, chatUpdate.usernames)) {\n    omitProps.push('usernames');\n  }\n\n  const updatedChat: ApiChat = {\n    ...chat,\n    ...omit(chatUpdate, omitProps),\n  } as ApiChat;\n\n  if (!updatedChat.id || !updatedChat.type) {\n    return undefined;\n  }\n\n  return omitUndefined(updatedChat);\n}\n\nexport function updateChatListType<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  folderId?: number,\n): T {\n  const listType = folderId === ARCHIVED_FOLDER_ID ? 'archived' : 'active';\n\n  let currentListIds = global.chats.listIds;\n  (Object.keys(currentListIds) as Array<keyof typeof currentListIds>).forEach((listTypeKey) => {\n    const currentFolderList = currentListIds[listTypeKey] || [];\n    if (listTypeKey === listType && !currentFolderList.includes(chatId)) {\n      currentListIds = {\n        ...currentListIds,\n        [listTypeKey]: [...currentFolderList, chatId],\n      };\n    } else if (listTypeKey !== listType && currentFolderList.includes(chatId)) {\n      currentListIds = {\n        ...currentListIds,\n        [listTypeKey]: currentFolderList.filter((id) => id !== chatId),\n      };\n    }\n  });\n\n  global = {\n    ...global,\n    chats: {\n      ...global.chats,\n      listIds: currentListIds,\n    },\n  };\n\n  global = updateChat(global, chatId, { folderId: folderId || undefined });\n\n  return global;\n}\n\nexport function updateChatListSecondaryInfo<T extends GlobalState>(\n  global: T,\n  type: ChatListType,\n  info: {\n    orderedPinnedIds?: string[];\n    totalChatCount: number;\n  },\n): T {\n  const totalCountKey = type === 'active' ? 'all' : type;\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      ...(info.orderedPinnedIds && {\n        orderedPinnedIds: {\n          ...global.chats.orderedPinnedIds,\n          [type]: info.orderedPinnedIds,\n        },\n      }),\n      totalCount: {\n        ...global.chats.totalCount,\n        [totalCountKey]: info.totalChatCount,\n      },\n    },\n  };\n}\n\nexport function leaveChat<T extends GlobalState>(global: T, leftChatId: string): T {\n  global = removeChatFromChatLists(global, leftChatId);\n\n  global = updateChat(global, leftChatId, { isNotJoined: true });\n  global = updateChatFullInfo(global, leftChatId, { joinInfo: undefined });\n\n  return global;\n}\n\nexport function removeChatFromChatLists<T extends GlobalState>(\n  global: T, chatId: string, type: 'all' | 'saved' = 'all',\n): T {\n  const chatLists = type === 'all' ? DEFAULT_CHAT_LISTS : [type];\n  chatLists.forEach((listType) => {\n    global = replaceChatListIds(global, listType, global.chats.listIds[listType]?.filter((id) => id !== chatId));\n  });\n\n  return global;\n}\n\nexport function addChatMembers<T extends GlobalState>(global: T, chat: ApiChat, membersToAdd: ApiChatMember[]): T {\n  const currentMembers = selectChatFullInfo(global, chat.id)?.members;\n  const newMemberIds = new Set(membersToAdd.map((m) => m.userId));\n  const updatedMembers = [\n    ...currentMembers?.filter(({ userId }) => !newMemberIds.has(userId)) || [],\n    ...membersToAdd,\n  ];\n  const currentIds = currentMembers?.map(({ userId }) => userId) || [];\n  const updatedIds = updatedMembers.map(({ userId }) => userId);\n\n  if (areSortedArraysEqual(currentIds, updatedIds)) {\n    return global;\n  }\n\n  const adminMembers = updatedMembers.filter(({ isAdmin, isOwner }) => isAdmin || isOwner);\n\n  return updateChatFullInfo(global, chat.id, {\n    members: updatedMembers,\n    adminMembersById: buildCollectionByKey(adminMembers, 'userId'),\n  });\n}\n\nexport function addSimilarChannels<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  similarChannelIds: string[],\n  count?: number,\n  shouldShowInChat = true,\n) {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarChannelsById: {\n        ...global.chats.similarChannelsById,\n        [chatId]: {\n          similarChannelIds,\n          count: count || similarChannelIds.length,\n          shouldShowInChat,\n        },\n      },\n    },\n  };\n}\n\nexport function toggleSimilarChannels<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  const similarChannels = global.chats.similarChannelsById[chatId];\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarChannelsById: {\n        ...global.chats.similarChannelsById,\n        [chatId]: {\n          ...similarChannels,\n          shouldShowInChat: !similarChannels.shouldShowInChat,\n        },\n      },\n    },\n  };\n}\n\nexport function addSimilarBots<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  similarBotsIds: string[],\n  count?: number,\n) {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarBotsById: {\n        ...global.chats.similarBotsById,\n        [chatId]: {\n          similarBotsIds,\n          count,\n        },\n      },\n    },\n  };\n}\n","import type { ApiSticker, ApiStickerSet, ApiVideo } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { buildCollectionByKey, unique } from '../../util/iteratees';\nimport { selectCustomEmojiForEmoji, selectStickersForEmoji, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateStickerSearch<T extends GlobalState>(\n  global: T,\n  hash: string,\n  resultIds?: string[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    stickerSearch: {\n      ...selectTabState(global, tabId).stickerSearch,\n      hash,\n      resultIds,\n    },\n  }, tabId);\n}\n\nexport function updateStickerSets<T extends GlobalState>(\n  global: T,\n  category: 'added' | 'featured' | 'search',\n  hash: string,\n  sets: ApiStickerSet[],\n): T {\n  const updatedSets = sets.map((stickerSet) => {\n    const existing = global.stickers.setsById[stickerSet.id];\n    if (!existing) {\n      return stickerSet;\n    }\n\n    return {\n      ...existing,\n      ...stickerSet,\n    };\n  });\n\n  const regularSetIds = sets.map((set) => set.id);\n\n  if (category === 'search') {\n    return {\n      ...global,\n      stickers: {\n        ...global.stickers,\n        setsById: {\n          ...global.stickers.setsById,\n          ...buildCollectionByKey(updatedSets, 'id'),\n        },\n      },\n    };\n  }\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      setsById: {\n        ...global.stickers.setsById,\n        ...buildCollectionByKey(updatedSets, 'id'),\n      },\n      [category]: {\n        ...global.stickers[category],\n        hash,\n        setIds: [\n          ...(global.stickers[category].setIds || []),\n          ...regularSetIds,\n        ],\n      },\n    },\n  };\n}\n\nexport function updateCustomEmojiSets<T extends GlobalState>(\n  global: T,\n  hash: string,\n  sets: ApiStickerSet[],\n): T {\n  const updatedSets = sets.map((stickerSet) => {\n    const existing = global.stickers.setsById[stickerSet.id];\n    if (!existing) {\n      return stickerSet;\n    }\n\n    return {\n      ...existing,\n      ...stickerSet,\n    };\n  });\n\n  const customEmojis = sets.map((set) => set.stickers).flat().filter(Boolean);\n  const addedSetIds = sets.map((set) => set.id);\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      setsById: {\n        ...global.stickers.setsById,\n        ...buildCollectionByKey(updatedSets, 'id'),\n      },\n    },\n    customEmojis: {\n      ...global.customEmojis,\n      added: {\n        ...global.customEmojis.added,\n        hash,\n        setIds: [\n          ...(global.customEmojis.added.setIds || []),\n          ...addedSetIds,\n        ],\n      },\n      byId: {\n        ...global.customEmojis.byId,\n        ...buildCollectionByKey(customEmojis, 'id'),\n      },\n    },\n  };\n}\n\nexport function updateStickerSet<T extends GlobalState>(\n  global: T, stickerSetId: string, update: Partial<ApiStickerSet>,\n): T {\n  const currentStickerSet = global.stickers.setsById[stickerSetId] || {};\n  const isCustomEmoji = update.isEmoji || currentStickerSet.isEmoji;\n  const addedSets = (isCustomEmoji ? global.customEmojis.added.setIds : global.stickers.added.setIds) || [];\n  let setIds: string[] = addedSets;\n  if (update.installedDate && !update.isArchived && addedSets && !addedSets.includes(stickerSetId)) {\n    setIds = [stickerSetId, ...setIds];\n  }\n\n  if (!update.installedDate && addedSets?.includes(stickerSetId)) {\n    setIds = setIds.filter((id) => id !== stickerSetId);\n  }\n\n  const customEmojiById = isCustomEmoji && update.stickers && buildCollectionByKey(update.stickers, 'id');\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      added: {\n        ...global.stickers.added,\n        ...(!isCustomEmoji && { setIds }),\n      },\n      setsById: {\n        ...global.stickers.setsById,\n        [stickerSetId]: {\n          ...currentStickerSet,\n          ...update,\n        },\n      },\n    },\n    customEmojis: {\n      ...global.customEmojis,\n      byId: {\n        ...global.customEmojis.byId,\n        ...customEmojiById,\n      },\n      added: {\n        ...global.customEmojis.added,\n        ...(isCustomEmoji && { setIds }),\n      },\n    },\n  };\n}\n\nexport function updateGifSearch<T extends GlobalState>(\n  global: T, isNew: boolean, results: ApiVideo[], nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { results: currentResults } = selectTabState(global, tabId).gifSearch;\n\n  let newResults!: ApiVideo[];\n  if (isNew || !currentResults) {\n    newResults = results;\n  } else {\n    const currentIds = new Set(currentResults.map((gif) => gif.id));\n    newResults = [\n      ...currentResults,\n      ...results.filter((gif) => !currentIds.has(gif.id)),\n    ];\n  }\n\n  return updateTabState(global, {\n    gifSearch: {\n      ...selectTabState(global, tabId).gifSearch,\n      offset: nextOffset,\n      results: newResults,\n    },\n  }, tabId);\n}\n\nexport function replaceAnimatedEmojis<T extends GlobalState>(global: T, stickerSet: ApiStickerSet): T {\n  return {\n    ...global,\n    animatedEmojis: stickerSet,\n  };\n}\n\nexport function updateStickersForEmoji<T extends GlobalState>(\n  global: T, emoji: string, remoteStickers?: ApiSticker[], hash?: string,\n): T {\n  const localStickers = selectStickersForEmoji(global, emoji);\n  const allStickers = [...localStickers, ...(remoteStickers || [])];\n  const uniqueIds = unique(allStickers.map(({ id }) => id));\n  const byId = buildCollectionByKey(allStickers, 'id');\n  const stickers = uniqueIds.map((id) => byId[id]);\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      forEmoji: {\n        emoji,\n        stickers,\n        hash,\n      },\n    },\n  };\n}\n\nexport function updateCustomEmojiForEmoji<T extends GlobalState>(\n  global: T, emoji: string,\n): T {\n  const localStickers = selectCustomEmojiForEmoji(global, emoji);\n  const uniqueIds = unique(localStickers.map(({ id }) => id));\n  const byId = buildCollectionByKey(localStickers, 'id');\n  const stickers = uniqueIds.map((id) => byId[id]);\n\n  return {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      forEmoji: {\n        emoji,\n        stickers,\n      },\n    },\n  };\n}\n\nexport function updateRecentStatusCustomEmojis<T extends GlobalState>(\n  global: T, hash: string, emojis: ApiSticker[],\n): T {\n  return {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      statusRecent: {\n        ...global.customEmojis.statusRecent,\n        hash,\n        emojis,\n      },\n    },\n  };\n}\n\nexport function rebuildStickersForEmoji<T extends GlobalState>(global: T): T {\n  if (global.stickers.forEmoji) {\n    const { emoji, stickers, hash } = global.stickers.forEmoji;\n    if (!emoji) {\n      return global;\n    }\n\n    return updateStickersForEmoji(global, emoji, stickers, hash);\n  }\n\n  if (global.customEmojis.forEmoji) {\n    const { emoji } = global.customEmojis.forEmoji;\n    if (!emoji) {\n      return global;\n    }\n\n    return updateCustomEmojiForEmoji(global, emoji);\n  }\n\n  return global;\n}\n","import type {\n  ApiMissingInvitedUser,\n  ApiSavedStarGift,\n  ApiUser,\n  ApiUserCommonChats,\n  ApiUserFullInfo,\n  ApiUserStatus,\n} from '../../api/types';\nimport type { BotAppPermissions } from '../../types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { omit, omitUndefined, unique } from '../../util/iteratees';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport { selectTabState } from '../selectors';\nimport { updateChat } from './chats';\nimport { updateTabState } from './tabs';\n\nexport function replaceUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      byId: newById,\n    },\n  };\n}\n\nfunction updateContactList<T extends GlobalState>(global: T, updatedUsers: ApiUser[]): T {\n  const { userIds: contactUserIds } = global.contactList || {};\n\n  if (!contactUserIds) return global;\n\n  const contactUserIdsFromUpdate = updatedUsers\n    .filter((user) => user?.isContact)\n    .map((user) => user.id);\n\n  if (contactUserIdsFromUpdate.length === 0) return global;\n\n  return {\n    ...global,\n    contactList: {\n      userIds: unique([\n        ...contactUserIdsFromUpdate,\n        ...contactUserIds,\n      ]),\n    },\n  };\n}\n\nexport function updateUser<T extends GlobalState>(global: T, userId: string, userUpdate: Partial<ApiUser>): T {\n  const { byId } = global.users;\n\n  const updatedUser = getUpdatedUser(global, userId, userUpdate);\n  if (!updatedUser) {\n    return global;\n  }\n\n  global = updateContactList(global, [updatedUser]);\n\n  return replaceUsers(global, {\n    ...byId,\n    [userId]: updatedUser,\n  });\n}\n\nexport function updateUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  const updatedById = Object.keys(newById).reduce((acc: Record<string, ApiUser>, id) => {\n    const updatedUser = getUpdatedUser(global, id, newById[id]);\n    if (updatedUser) {\n      acc[id] = updatedUser;\n    }\n\n    return acc;\n  }, {});\n\n  global = replaceUsers(global, {\n    ...global.users.byId,\n    ...updatedById,\n  });\n\n  global = updateContactList(global, Object.values(updatedById));\n\n  return global;\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  const { byId } = global.users;\n  let isUpdated = false;\n\n  const addedById = Object.keys(newById).reduce<Record<string, ApiUser>>((acc, id) => {\n    const existingUser = byId[id];\n    const newUser = newById[id];\n\n    if (existingUser && !existingUser.isMin && (newUser.isMin || existingUser.accessHash === newUser.accessHash)) {\n      return acc;\n    }\n\n    const updatedUser = getUpdatedUser(global, id, newUser);\n    if (updatedUser) {\n      acc[id] = updatedUser;\n      if (!isUpdated) {\n        isUpdated = true;\n      }\n    }\n\n    return acc;\n  }, {});\n\n  if (!isUpdated) {\n    return global;\n  }\n\n  global = replaceUsers(global, {\n    ...byId,\n    ...addedById,\n  });\n\n  global = updateContactList(global, Object.values(addedById));\n\n  return global;\n}\n\n// @optimization Don't spread/unspread global for each element, do it in a batch\nfunction getUpdatedUser(global: GlobalState, userId: string, userUpdate: Partial<ApiUser>) {\n  const { byId } = global.users;\n  const user = byId[userId];\n  const omitProps: (keyof ApiUser)[] = [];\n\n  if (userUpdate.isMin && user && !user.isMin) {\n    return undefined; // Do not apply updates from min constructor\n  }\n\n  if (areDeepEqual(user?.usernames, userUpdate.usernames)) {\n    omitProps.push('usernames');\n  }\n\n  const updatedUser = {\n    ...user,\n    ...omit(userUpdate, omitProps),\n  } as ApiUser;\n\n  if (!updatedUser.id || !updatedUser.type) {\n    return undefined;\n  }\n\n  return omitUndefined(updatedUser);\n}\n\nexport function deleteContact<T extends GlobalState>(global: T, userId: string): T {\n  const { byId } = global.users;\n  const { userIds } = global.contactList || {};\n\n  global = {\n    ...global,\n    contactList: {\n      userIds: userIds ? userIds.filter((id) => id !== userId) : MEMO_EMPTY_ARRAY,\n    },\n  };\n\n  global = replaceUsers(global, {\n    ...byId,\n    [userId]: {\n      ...byId[userId],\n      isContact: undefined,\n    },\n  });\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      orderedPeerIds: {\n        active: global.stories.orderedPeerIds.active.filter((id) => id !== userId),\n        archived: global.stories.orderedPeerIds.archived.filter((id) => id !== userId),\n      },\n    },\n  };\n\n  return updateChat(global, userId, {\n    settings: undefined,\n  });\n}\n\nexport function updateUserSearch<T extends GlobalState>(\n  global: T,\n  searchStatePartial: Partial<TabState['userSearch']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    userSearch: {\n      ...selectTabState(global, tabId).userSearch,\n      ...searchStatePartial,\n    },\n  }, tabId);\n}\n\nexport function updateUserSearchFetchingStatus<T extends GlobalState>(\n  global: T, newState: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateUserSearch(global, {\n    fetchingStatus: newState,\n  }, tabId);\n}\n\nexport function updateUserBlockedState<T extends GlobalState>(global: T, userId: string, isBlocked: boolean): T {\n  const { fullInfoById } = global.users;\n  const fullInfo = fullInfoById[userId];\n  if (!fullInfo) {\n    return global;\n  }\n\n  return updateUserFullInfo(global, userId, { isBlocked });\n}\n\nexport function replaceUserStatuses<T extends GlobalState>(global: T, newById: Record<string, ApiUserStatus>): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      statusesById: newById,\n    },\n  };\n}\n\nexport function updateUserFullInfo<T extends GlobalState>(\n  global: T, userId: string, fullInfo: Partial<ApiUserFullInfo>,\n): T {\n  const userFullInfo = global.users.fullInfoById[userId];\n\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      fullInfoById: {\n        ...global.users.fullInfoById,\n        [userId]: {\n          ...userFullInfo,\n          ...fullInfo,\n        },\n      },\n    },\n  };\n}\n\nexport function updateUserCommonChats<T extends GlobalState>(\n  global: T, userId: string, commonChats: ApiUserCommonChats,\n): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      commonChatsById: {\n        ...global.users.commonChatsById,\n        [userId]: commonChats,\n      },\n    },\n  };\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addUserStatuses<T extends GlobalState>(global: T, newById: Record<string, ApiUserStatus>): T {\n  const { statusesById } = global.users;\n\n  global = replaceUserStatuses(global, {\n    ...statusesById,\n    ...newById,\n  });\n\n  return global;\n}\n\nexport function closeNewContactDialog<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    newContact: undefined,\n  }, tabId);\n}\n\nexport function updateMissingInvitedUsers<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  missingUsers: ApiMissingInvitedUser[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!missingUsers.length) {\n    return updateTabState(global, {\n      inviteViaLinkModal: undefined,\n    }, tabId);\n  }\n\n  return updateTabState(global, {\n    inviteViaLinkModal: {\n      missingUsers,\n      chatId,\n    },\n  }, tabId);\n}\n\nexport function updateBotAppPermissions<T extends GlobalState>(\n  global: T,\n  botId: string,\n  permissions: BotAppPermissions,\n): T {\n  const { botAppPermissionsById } = global.users;\n\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      botAppPermissionsById: {\n        ...botAppPermissionsById,\n        [botId]: {\n          ...botAppPermissionsById[botId],\n          ...permissions,\n        },\n      },\n    },\n  };\n}\n\nexport function replacePeerSavedGifts<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  gifts: ApiSavedStarGift[],\n  nextOffset?: string,\n): T {\n  global = {\n    ...global,\n    peers: {\n      ...global.peers,\n      giftsById: {\n        ...global.peers.giftsById,\n        [peerId]: {\n          gifts,\n          nextOffset,\n        },\n      },\n    },\n  };\n\n  return global;\n}\n","import type { ApiGlobalMessageSearchType, ApiMessage } from '../../api/types';\nimport type { GlobalSearchContent } from '../../types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { areSortedArraysEqual } from '../../util/iteratees';\nimport { getSearchResultKey } from '../../util/keys/searchResultKey';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateGlobalSearch<T extends GlobalState>(\n  global: T,\n  searchStatePartial: Partial<TabState['globalSearch']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    globalSearch: {\n      ...selectTabState(global, tabId).globalSearch,\n      ...searchStatePartial,\n    },\n  }, tabId);\n}\n\nexport function updateGlobalSearchContent<T extends GlobalState>(\n  global: T,\n  currentContent: GlobalSearchContent | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateGlobalSearch(global, { currentContent }, tabId);\n}\n\nexport function updateGlobalSearchResults<T extends GlobalState>(\n  global: T,\n  newFoundMessages: ApiMessage[],\n  totalCount: number,\n  type: ApiGlobalMessageSearchType,\n  nextOffsetRate?: number,\n  nextOffsetId?: number,\n  nextOffsetPeerId?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { resultsByType } = selectTabState(global, tabId).globalSearch || {};\n  const newFoundMessagesById = newFoundMessages.reduce((result, message) => {\n    result[getSearchResultKey(message)] = message;\n\n    return result;\n  }, {} as Record<string, ApiMessage>);\n  const foundIdsForType = resultsByType?.[type]?.foundIds;\n\n  if (foundIdsForType !== undefined\n    && Object.keys(newFoundMessagesById).every(\n      (newId) => foundIdsForType.includes(getSearchResultKey(newFoundMessagesById[newId])),\n    )\n  ) {\n    global = updateGlobalSearchFetchingStatus(global, { messages: false }, tabId);\n    return updateGlobalSearch(global, {\n      resultsByType: {\n        ...(selectTabState(global, tabId).globalSearch || {}).resultsByType,\n        [type]: {\n          foundIds: foundIdsForType,\n          totalCount,\n          nextOffsetId,\n          nextOffsetRate,\n          nextOffsetPeerId,\n        },\n      },\n    }, tabId);\n  }\n\n  const prevFoundIds = foundIdsForType || [];\n  const newFoundIds = newFoundMessages\n    .map((message) => getSearchResultKey(message))\n    .filter((id) => !prevFoundIds.includes(id));\n  const foundIds = Array.prototype.concat(prevFoundIds, newFoundIds);\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  global = updateGlobalSearchFetchingStatus(global, { messages: false }, tabId);\n\n  return updateGlobalSearch(global, {\n    resultsByType: {\n      ...(selectTabState(global, tabId).globalSearch || {}).resultsByType,\n      [type]: {\n        totalCount,\n        nextOffsetId,\n        nextOffsetRate,\n        nextOffsetPeerId,\n        foundIds: foundOrPrevFoundIds,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateGlobalSearchFetchingStatus<T extends GlobalState>(\n  global: T, newState: { chats?: boolean; messages?: boolean; botApps?: boolean },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateGlobalSearch(global, {\n    fetchingStatus: {\n      ...selectTabState(global, tabId).globalSearch.fetchingStatus,\n      ...newState,\n    },\n  }, tabId);\n}\n","import type { ManagementProgress, ManagementState } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateManagementProgress<T extends GlobalState>(\n  global: T, progress: ManagementProgress,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    management: {\n      ...selectTabState(global, tabId).management,\n      progress,\n    },\n  }, tabId);\n}\n\nexport function updateManagement<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<ManagementState>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { management } = selectTabState(global, tabId);\n  return updateTabState(global, {\n    management: {\n      ...management,\n      byChatId: {\n        ...management.byChatId,\n        [chatId]: {\n          ...(management.byChatId[chatId] || {}),\n          ...update,\n        },\n      },\n    },\n  }, tabId);\n}\n","import type { ApiNotifyException } from '../../api/types';\nimport type {\n  ISettings, IThemeSettings, NotifyException,\n  ThemeKey,\n} from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { updateUserBlockedState } from './users';\n\nexport function replaceSettings<T extends GlobalState>(global: T, newSettings?: Partial<ISettings>): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      byKey: {\n        ...global.settings.byKey,\n        ...newSettings,\n      },\n    },\n  };\n}\n\nexport function replaceThemeSettings<T extends GlobalState>(\n  global: T, theme: ThemeKey, newSettings?: Partial<IThemeSettings>,\n): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      themes: {\n        ...global.settings.themes,\n        [theme]: {\n          ...(global.settings.themes[theme] || {}),\n          ...newSettings,\n        },\n      },\n    },\n  };\n}\n\nexport function addNotifyExceptions<T extends GlobalState>(\n  global: T, notifyExceptions: ApiNotifyException[],\n): T {\n  notifyExceptions.forEach((notifyException) => {\n    const { chatId, ...exceptionData } = notifyException;\n    global = addNotifyException(global, chatId, exceptionData);\n  });\n\n  return global;\n}\n\nexport function addNotifyException<T extends GlobalState>(\n  global: T, id: string, notifyException: NotifyException,\n): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      notifyExceptions: {\n        ...global.settings.notifyExceptions,\n        [id]: notifyException,\n      },\n    },\n  };\n}\n\n// eslint-disable-next-line consistent-return\nexport function updateNotifySettings<T extends GlobalState>(\n  global: T, peerType: 'contact' | 'group' | 'broadcast', isSilent?: boolean, shouldShowPreviews?: boolean,\n): T {\n  switch (peerType) {\n    case 'contact':\n      return replaceSettings(global, {\n        ...(typeof isSilent !== 'undefined' && { hasPrivateChatsNotifications: !isSilent }),\n        ...(typeof shouldShowPreviews !== 'undefined' && { hasPrivateChatsMessagePreview: shouldShowPreviews }),\n      });\n    case 'group':\n      return replaceSettings(global, {\n        ...(typeof isSilent !== 'undefined' && { hasGroupNotifications: !isSilent }),\n        ...(typeof shouldShowPreviews !== 'undefined' && { hasGroupMessagePreview: shouldShowPreviews }),\n      });\n    case 'broadcast':\n      return replaceSettings(global, {\n        ...(typeof isSilent !== 'undefined' && { hasBroadcastNotifications: !isSilent }),\n        ...(typeof shouldShowPreviews !== 'undefined' && { hasBroadcastMessagePreview: shouldShowPreviews }),\n      });\n  }\n}\n\nexport function addBlockedUser<T extends GlobalState>(global: T, contactId: string): T {\n  global = updateUserBlockedState(global, contactId, true);\n\n  return {\n    ...global,\n    blocked: {\n      ...global.blocked,\n      ids: [contactId, ...global.blocked.ids],\n      totalCount: global.blocked.totalCount + 1,\n    },\n  };\n}\n\nexport function removeBlockedUser<T extends GlobalState>(global: T, contactId: string): T {\n  global = updateUserBlockedState(global, contactId, false);\n\n  return {\n    ...global,\n    blocked: {\n      ...global.blocked,\n      ids: global.blocked.ids.filter((id) => id !== contactId),\n      totalCount: global.blocked.totalCount - 1,\n    },\n  };\n}\n","import type { GlobalState } from '../types';\n\nexport function updateTwoFaSettings<T extends GlobalState>(\n  global: T,\n  update: GlobalState['twoFaSettings'],\n): T {\n  return {\n    ...global,\n    twoFaSettings: {\n      ...global.twoFaSettings,\n      ...update,\n    },\n  };\n}\n","import type { GlobalState, TabState } from '../types';\n\nimport { INITIAL_GLOBAL_STATE, INITIAL_TAB_STATE } from '../initialState';\n\nexport function updatePasscodeSettings<T extends GlobalState>(\n  global: T,\n  update: GlobalState['passcode'],\n): T {\n  return {\n    ...global,\n    passcode: {\n      ...global.passcode,\n      ...update,\n    },\n  };\n}\n\nexport function clearPasscodeSettings<T extends GlobalState>(global: T): T {\n  return {\n    ...global,\n    passcode: {},\n  };\n}\n\nexport function clearGlobalForLockScreen<T extends GlobalState>(global: T, withTabState = true): T {\n  const {\n    theme,\n    shouldUseSystemTheme,\n    animationLevel,\n    language,\n  } = global.settings.byKey;\n\n  return {\n    ...INITIAL_GLOBAL_STATE,\n    passcode: global.passcode,\n    settings: {\n      ...INITIAL_GLOBAL_STATE.settings,\n      byKey: {\n        ...INITIAL_GLOBAL_STATE.settings.byKey,\n        theme,\n        shouldUseSystemTheme,\n        animationLevel,\n        language,\n      },\n    },\n    ...(withTabState && {\n      byTabId: Object.values(global.byTabId).reduce((acc, { id: tabId, isMasterTab }) => {\n        acc[tabId] = { ...INITIAL_TAB_STATE, isMasterTab, id: tabId };\n        return acc;\n      }, {} as Record<number, TabState>),\n    }),\n  } as T;\n}\n","import type {\n  ApiReceiptRegular,\n  ApiReceiptStars,\n  ApiStarsAmount,\n  ApiStarsSubscription,\n  ApiStarsTransaction,\n} from '../../api/types';\nimport type {\n  PaymentStep,\n  ShippingOption,\n  StarsSubscriptions,\n  StarsTransactionType,\n} from '../../types';\nimport type {\n  GlobalState, TabArgs, TabState,\n} from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectStarsPayment, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updatePayment<T extends GlobalState>(\n  global: T, update: Partial<TabState['payment']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    payment: {\n      ...selectTabState(global, tabId).payment,\n      ...update,\n    },\n  }, tabId);\n}\n\nexport function updateStarsPayment<T extends GlobalState>(\n  global: T, update: Partial<TabState['starsPayment']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const starPayment = selectStarsPayment(global, tabId);\n  if (!starPayment) {\n    return global;\n  }\n\n  return updateTabState(global, {\n    starsPayment: {\n      ...starPayment,\n      ...update,\n    },\n  }, tabId);\n}\n\nexport function updateShippingOptions<T extends GlobalState>(\n  global: T,\n  shippingOptions: ShippingOption[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n\n): T {\n  return updatePayment(global, { shippingOptions }, tabId);\n}\n\nexport function setRequestInfoId<T extends GlobalState>(\n  global: T, id: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { requestId: id }, tabId);\n}\n\nexport function setPaymentStep<T extends GlobalState>(\n  global: T, step: PaymentStep,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { step }, tabId);\n}\n\nexport function setStripeCardInfo<T extends GlobalState>(\n  global: T, cardInfo: { type: string; id: string },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { stripeCredentials: { ...cardInfo } }, tabId);\n}\n\nexport function setSmartGlocalCardInfo<T extends GlobalState>(\n  global: T,\n  cardInfo: { type: string; token: string },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { smartGlocalCredentials: { ...cardInfo } }, tabId);\n}\n\nexport function setConfirmPaymentUrl<T extends GlobalState>(\n  global: T, url?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { confirmPaymentUrl: url }, tabId);\n}\n\nexport function setReceipt<T extends GlobalState>(\n  global: T,\n  receipt?: ApiReceiptRegular,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!receipt) {\n    return updatePayment(global, { receipt: undefined }, tabId);\n  }\n\n  return updatePayment(global, {\n    receipt,\n  }, tabId);\n}\n\nexport function clearPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    payment: {},\n  }, tabId);\n}\n\nexport function clearStarPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    starsPayment: {},\n  }, tabId);\n}\n\nexport function closeInvoice<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  global = updatePayment(global, {\n    isPaymentModalOpen: undefined,\n    isExtendedMedia: undefined,\n  }, tabId);\n  return global;\n}\n\nexport function updateStarsBalance<T extends GlobalState>(\n  global: T, balance: ApiStarsAmount,\n): T {\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      balance,\n    },\n  };\n}\n\nexport function appendStarsTransactions<T extends GlobalState>(\n  global: T,\n  type: StarsTransactionType,\n  transactions: ApiStarsTransaction[],\n  nextOffset?: string,\n): T {\n  const history = global.stars?.history;\n  if (!history) {\n    return global;\n  }\n\n  const newTypeObject = {\n    transactions: (history[type]?.transactions || []).concat(transactions),\n    nextOffset,\n  };\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      history: {\n        ...history,\n        [type]: newTypeObject,\n      },\n    },\n  };\n}\n\nexport function appendStarsSubscriptions<T extends GlobalState>(\n  global: T,\n  subscriptions: ApiStarsSubscription[],\n  nextOffset?: string,\n): T {\n  if (!global.stars) {\n    return global;\n  }\n\n  const newObject = {\n    list: (global.stars.subscriptions?.list || []).concat(subscriptions),\n    nextOffset,\n  } satisfies StarsSubscriptions;\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      subscriptions: newObject,\n    },\n  };\n}\n\nexport function updateStarsSubscriptionLoading<T extends GlobalState>(\n  global: T, isLoading: boolean,\n): T {\n  const subscriptions = global.stars?.subscriptions;\n  if (!subscriptions) {\n    return global;\n  }\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      subscriptions: {\n        ...subscriptions,\n        isLoading,\n      },\n    },\n  };\n}\n\nexport function openStarsTransactionModal<T extends GlobalState>(\n  global: T, transaction: ApiStarsTransaction, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    starsTransactionModal: {\n      transaction,\n    },\n  }, tabId);\n}\n\nexport function openStarsTransactionFromReceipt<T extends GlobalState>(\n  global: T, receipt: ApiReceiptStars, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const transaction: ApiStarsTransaction = {\n    id: receipt.transactionId,\n    peer: {\n      type: 'peer',\n      id: receipt.botId,\n    },\n    stars: {\n      amount: receipt.totalAmount,\n      nanos: 0,\n    },\n    date: receipt.date,\n    title: receipt.title,\n    description: receipt.description,\n    photo: receipt.photo,\n  };\n\n  return openStarsTransactionModal(global, transaction, tabId);\n}\n","import type {\n  ApiChannelMonetizationStatistics,\n  ApiChannelStatistics, ApiGroupStatistics, ApiPostStatistics, StatisticsGraph,\n} from '../../api/types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateStatistics<T extends GlobalState>(\n  global: T, chatId: string, statistics: ApiChannelStatistics | ApiGroupStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      byChatId: {\n        ...selectTabState(global, tabId).statistics.byChatId,\n        [chatId]: statistics,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateMessageStatistics<T extends GlobalState>(\n  global: T, statistics: ApiPostStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      currentMessage: statistics,\n      currentStory: undefined,\n    },\n  }, tabId);\n}\n\nexport function updateStoryStatistics<T extends GlobalState>(\n  global: T, statistics: ApiPostStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      currentStory: statistics,\n      currentMessage: undefined,\n    },\n  }, tabId);\n}\n\nexport function updateStatisticsGraph<T extends GlobalState>(\n  global: T, chatId: string, name: string, update: StatisticsGraph,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { statistics } = selectTabState(global, tabId);\n  return updateTabState(global, {\n    statistics: {\n      ...statistics,\n      byChatId: {\n        ...statistics.byChatId,\n        [chatId]: {\n          ...(statistics.byChatId[chatId] || {}),\n          [name]: update,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateChannelMonetizationStatistics<T extends GlobalState>(\n  global: T, statistics: ApiChannelMonetizationStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      monetization: statistics,\n    },\n  }, tabId);\n}\n\nexport function updateVerifyMonetizationModal<T extends GlobalState>(\n  global: T, update: Partial<TabState['monetizationVerificationModal']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  if (!tabState.monetizationVerificationModal) {\n    return global;\n  }\n\n  return updateTabState(global, {\n    monetizationVerificationModal: {\n      ...tabState.monetizationVerificationModal,\n      ...update,\n    },\n  }, tabId);\n}\n","import type {\n  ApiChat, ApiChatFullInfo, ApiPeerPhotos, ApiPhoto, ApiUser, ApiUserFullInfo,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { omit, uniqueByField } from '../../util/iteratees';\nimport { isChatChannel, isUserId } from '../helpers';\nimport {\n  selectChatFullInfo,\n  selectPeer,\n  selectPeerPhotos,\n  selectUserFullInfo,\n} from '../selectors';\nimport { updateChat, updateChatFullInfo } from './chats';\nimport { updateUser, updateUserFullInfo } from './users';\n\n// `type` has different types in ApiChat and ApiUser\ntype ApiPeerSharedFields = Omit<CommonProperties<ApiChat, ApiUser>, 'type'>;\ntype ApiPeerFullInfoSharedFields = CommonProperties<ApiChatFullInfo, ApiUserFullInfo>;\n\nexport function updatePeer<T extends GlobalState>(\n  global: T, peerId: string, peerUpdate: Partial<ApiPeerSharedFields>,\n) {\n  if (isUserId(peerId)) {\n    return updateUser(global, peerId, peerUpdate);\n  }\n\n  return updateChat(global, peerId, peerUpdate);\n}\n\nexport function updatePeerFullInfo<T extends GlobalState>(\n  global: T, peerId: string, peerFullInfoUpdate: Partial<ApiPeerFullInfoSharedFields>,\n) {\n  if (isUserId(peerId)) {\n    return updateUserFullInfo(global, peerId, peerFullInfoUpdate);\n  }\n\n  return updateChatFullInfo(global, peerId, peerFullInfoUpdate);\n}\n\nexport function updatePeerPhotosIsLoading<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isLoading: boolean,\n) {\n  const profilePhotos = selectPeerPhotos(global, peerId);\n  if (!profilePhotos) {\n    return global;\n  }\n\n  return replacePeerPhotos(global, peerId, {\n    ...profilePhotos,\n    isLoading,\n  });\n}\n\nexport function replacePeerPhotos<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  value?: ApiPeerPhotos,\n) {\n  if (!value) {\n    return {\n      ...global,\n      peers: {\n        ...global.peers,\n        profilePhotosById: omit(global.peers.profilePhotosById, [peerId]),\n      },\n    };\n  }\n\n  return {\n    ...global,\n    peers: {\n      ...global.peers,\n      profilePhotosById: {\n        ...global.peers.profilePhotosById,\n        [peerId]: value,\n      },\n    },\n  };\n}\n\nexport function updatePeerPhotos<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  update: {\n    newPhotos: ApiPhoto[];\n    count: number;\n    nextOffset?: number;\n    fullInfo: ApiChatFullInfo | ApiUserFullInfo;\n    shouldInvalidateCache?: boolean;\n  },\n) {\n  const profilePhotos = selectPeerPhotos(global, peerId);\n\n  const {\n    newPhotos, count, nextOffset, fullInfo, shouldInvalidateCache,\n  } = update;\n  const currentPhotos = profilePhotos;\n  const profilePhoto = fullInfo.profilePhoto;\n  const fallbackPhoto = 'fallbackPhoto' in fullInfo ? fullInfo.fallbackPhoto : undefined;\n  const personalPhoto = 'personalPhoto' in fullInfo ? fullInfo.personalPhoto : undefined;\n\n  if (!currentPhotos || shouldInvalidateCache) {\n    // In some channels, last service message with photo change is deleted, so we need to patch it in\n    if (profilePhoto && profilePhoto.id !== newPhotos[0]?.id) {\n      newPhotos.unshift(profilePhoto);\n    }\n\n    if (personalPhoto && personalPhoto.id !== newPhotos[0]?.id) {\n      newPhotos.unshift(personalPhoto);\n    }\n\n    if (fallbackPhoto) {\n      newPhotos.push(fallbackPhoto);\n    }\n\n    return replacePeerPhotos(global, peerId, {\n      fallbackPhoto,\n      personalPhoto,\n      photos: newPhotos,\n      count,\n      nextOffset,\n      isLoading: false,\n    });\n  }\n\n  const hasFallbackPhoto = currentPhotos.photos[currentPhotos.photos.length - 1].id === fallbackPhoto?.id;\n  const currentPhotoArray = hasFallbackPhoto ? currentPhotos.photos.slice(0, -1) : currentPhotos.photos;\n\n  const photos = uniqueByField([...currentPhotoArray, ...newPhotos, fallbackPhoto].filter(Boolean), 'id');\n  return replacePeerPhotos(global, peerId, {\n    fallbackPhoto,\n    personalPhoto,\n    photos,\n    count,\n    nextOffset,\n    isLoading: false,\n  });\n}\n\nexport function deletePeerPhoto<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  photoId: string,\n  isFromActionMessage?: boolean,\n) {\n  const peer = selectPeer(global, peerId);\n  const profilePhotos = selectPeerPhotos(global, peerId);\n  if (!peer || !profilePhotos) {\n    return global;\n  }\n  const isChannel = 'title' in peer && isChatChannel(peer);\n\n  const userFullInfo = selectUserFullInfo(global, peerId);\n  const chatFullInfo = selectChatFullInfo(global, peerId);\n\n  const isAvatar = peer.avatarPhotoId === photoId && (!isChannel || isFromActionMessage);\n  const nextAvatarPhoto = isAvatar ? profilePhotos.photos[1] : undefined;\n\n  if (userFullInfo) {\n    const newFallbackPhoto = userFullInfo.fallbackPhoto?.id === photoId ? undefined : userFullInfo.fallbackPhoto;\n    const newPersonalPhoto = userFullInfo.personalPhoto?.id === photoId ? undefined : userFullInfo.personalPhoto;\n    const newProfilePhoto = userFullInfo.profilePhoto?.id === photoId ? nextAvatarPhoto : userFullInfo.profilePhoto;\n    global = updateUserFullInfo(global, peerId, {\n      fallbackPhoto: newFallbackPhoto,\n      personalPhoto: newPersonalPhoto,\n      profilePhoto: newProfilePhoto,\n    });\n  }\n\n  if (chatFullInfo) {\n    const newProfilePhoto = chatFullInfo.profilePhoto?.id === photoId ? nextAvatarPhoto : chatFullInfo.profilePhoto;\n    global = updateChatFullInfo(global, peerId, {\n      profilePhoto: newProfilePhoto,\n    });\n  }\n\n  const avatarPhotoId = isAvatar ? nextAvatarPhoto?.id : peer.avatarPhotoId;\n  const shouldKeepInPhotos = isAvatar && 'title' in peer && isChatChannel(peer);\n  const photos = shouldKeepInPhotos\n    ? profilePhotos.photos.filter((photo) => photo.id !== photoId) : profilePhotos.photos.slice();\n\n  global = updatePeer(global, peerId, {\n    avatarPhotoId,\n  });\n\n  global = replacePeerPhotos(global, peerId, avatarPhotoId ? {\n    ...profilePhotos,\n    photos,\n    count: profilePhotos.count - 1,\n  } : undefined);\n\n  return global;\n}\n","import type {\n  ApiPeerStories,\n  ApiReaction,\n  ApiStealthMode,\n  ApiStory,\n  ApiStoryDeleted,\n  ApiStorySkipped,\n  ApiStoryViews,\n  ApiTypeStory,\n  ApiTypeStoryView,\n} from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { compareFields, unique } from '../../util/iteratees';\nimport { getServerTime } from '../../util/serverTime';\nimport { isUserId, updateReactionCount } from '../helpers';\nimport {\n  selectIsChatWithSelf,\n  selectPeer, selectPeerStories, selectPeerStory, selectTabState, selectUser,\n} from '../selectors';\nimport { updatePeer } from './peers';\nimport { updateTabState } from './tabs';\n\nexport function addStories<T extends GlobalState>(global: T, newStoriesByPeerId: Record<string, ApiPeerStories>): T {\n  const updatedByPeerId = Object.entries(newStoriesByPeerId).reduce((acc, [peerId, newPeerStories]) => {\n    if (!acc[peerId]) {\n      acc[peerId] = newPeerStories;\n    } else {\n      acc[peerId].byId = { ...acc[peerId].byId, ...newPeerStories.byId };\n      acc[peerId].orderedIds = unique(newPeerStories.orderedIds.concat(acc[peerId].orderedIds));\n      acc[peerId].profileIds = unique(newPeerStories.profileIds.concat(acc[peerId].profileIds)).sort((a, b) => b - a);\n      acc[peerId].lastUpdatedAt = newPeerStories.lastUpdatedAt;\n      acc[peerId].lastReadId = newPeerStories.lastReadId;\n    }\n\n    return acc;\n  }, global.stories.byPeerId);\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: updatedByPeerId,\n    },\n  };\n\n  return updateOrderedStoriesPeerIds(global, Object.keys(newStoriesByPeerId));\n}\n\nexport function addStoriesForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  newStories: Record<number, ApiTypeStory>,\n  newPinnedIds?: number[],\n  addToArchive?: boolean,\n): T {\n  const {\n    byId, orderedIds, profileIds, archiveIds, pinnedIds,\n  } = global.stories.byPeerId[peerId] || {};\n  const deletedIds = Object.keys(newStories).filter((id) => 'isDeleted' in newStories[Number(id)]).map(Number);\n  const updatedById = { ...byId, ...newStories };\n  let updatedOrderedIds = [...(orderedIds || [])];\n  let updatedArchiveIds = [...(archiveIds || [])];\n  const updatedProfileIds = unique(\n    [...(profileIds || [])].concat(Object.values(newStories).reduce((ids, story) => {\n      if ('isInProfile' in story && story.isInProfile) {\n        ids.push(story.id);\n      }\n\n      return ids;\n    }, [] as number[])),\n  ).sort((a, b) => b - a).filter((storyId) => !deletedIds.includes(storyId));\n\n  updatedOrderedIds = unique(Object.entries(newStories).reduce((acc, [storyId, story]) => {\n    if ('expireDate' in story && story.expireDate && story.expireDate > getServerTime()) {\n      acc.push(Number(storyId));\n    }\n\n    return acc;\n  }, updatedOrderedIds)).filter((storyId) => !deletedIds.includes(storyId));\n\n  if (addToArchive && selectIsChatWithSelf(global, peerId)) {\n    updatedArchiveIds = unique(updatedArchiveIds.concat(Object.keys(newStories).map(Number)))\n      .sort((a, b) => b - a)\n      .filter((storyId) => !deletedIds.includes(storyId));\n  }\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          byId: updatedById,\n          orderedIds: updatedOrderedIds,\n          profileIds: updatedProfileIds,\n          pinnedIds: pinnedIds || newPinnedIds,\n          ...(addToArchive && { archiveIds: updatedArchiveIds }),\n        },\n      },\n    },\n  };\n\n  if (selectIsChatWithSelf(global, peerId)\n    || selectUser(global, peerId)?.isContact\n    || peerId === global.appConfig?.storyChangelogUserId) {\n    global = updatePeerLastUpdatedAt(global, peerId);\n    global = updateOrderedStoriesPeerIds(global, [peerId]);\n  }\n\n  return global;\n}\n\nexport function updateStoriesForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  peerStories: ApiPeerStories,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: peerStories,\n      },\n    },\n  };\n}\n\nexport function updatePeerStoriesFullyLoaded<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isFullyLoaded: boolean,\n  isArchive?: boolean,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          [isArchive ? 'isArchiveFullyLoaded' : 'isFullyLoaded']: isFullyLoaded,\n        },\n      },\n    },\n  };\n}\n\nexport function updateLastReadStoryForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  lastReadId: number,\n): T {\n  const { orderedIds } = selectPeerStories(global, peerId) || {};\n  if (!orderedIds) {\n    return global;\n  }\n\n  if (lastReadId >= orderedIds[orderedIds.length - 1]) {\n    global = updatePeer(global, peerId, {\n      hasUnreadStories: false,\n    });\n  }\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          lastReadId,\n        },\n      },\n    },\n  };\n}\n\nexport function updateLastViewedStoryForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  lastViewedId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { orderedIds } = selectPeerStories(global, peerId) || {};\n  if (!orderedIds || !orderedIds.includes(lastViewedId)) {\n    return global;\n  }\n\n  const { storyViewer } = selectTabState(global, tabId);\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...storyViewer,\n      lastViewedByPeerIds: {\n        ...storyViewer.lastViewedByPeerIds,\n        [peerId]: lastViewedId,\n      },\n    },\n  }, tabId);\n}\n\nexport function updatePeersWithStories<T extends GlobalState>(\n  global: T,\n  storiesByPeerId: Record<string, ApiPeerStories>,\n): T {\n  Object.entries(storiesByPeerId).forEach(([peerId, { lastReadId, orderedIds }]) => {\n    const peer = selectPeer(global, peerId);\n    if (!peer) return;\n\n    global = updatePeer(global, peerId, {\n      hasStories: true,\n      hasUnreadStories: !lastReadId\n        || Boolean(lastReadId && lastReadId < (peer.maxStoryId || orderedIds[orderedIds.length - 1])),\n    });\n  });\n\n  return global;\n}\n\nexport function updateStoryViews<T extends GlobalState>(\n  global: T,\n  storyId: number,\n  views: ApiTypeStoryView[],\n  nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const { viewModal } = tabState.storyViewer;\n  const newViews = viewModal?.storyId === storyId && viewModal.views ? [\n    ...viewModal.views,\n    ...views,\n  ] : views;\n\n  global = updateStoryViewsLoading(global, false, tabId);\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...tabState.storyViewer,\n      viewModal: {\n        ...viewModal,\n        storyId,\n        views: newViews,\n        nextOffset,\n        isLoading: false,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateStoryViewsLoading<T extends GlobalState>(\n  global: T,\n  isLoading: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const { viewModal } = tabState.storyViewer;\n  if (!viewModal) return global;\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...tabState.storyViewer,\n      viewModal: {\n        ...viewModal,\n        isLoading,\n      },\n    },\n  }, tabId);\n}\n\nexport function removePeerStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n): T {\n  const {\n    orderedIds, profileIds, lastReadId, byId,\n  } = selectPeerStories(global, peerId) || { orderedIds: [] as number[], profileIds: [] as number[] };\n\n  const newOrderedIds = orderedIds.filter((id) => id !== storyId);\n  const newProfileIds = profileIds.filter((id) => id !== storyId);\n  const lastStoryId = newOrderedIds.length ? orderedIds[orderedIds.length - 1] : undefined;\n\n  const previousStoryId = orderedIds[orderedIds.indexOf(storyId) - 1];\n  const newLastReadId = lastReadId === storyId ? previousStoryId : lastReadId;\n\n  const newById = {\n    ...byId,\n    [storyId]: { id: storyId, peerId, isDeleted: true } as ApiStoryDeleted,\n  };\n  const lastUpdatedAt = lastStoryId ? (newById[lastStoryId] as ApiStory | undefined)?.date : undefined;\n  const hasStories = Boolean(newOrderedIds.length);\n\n  global = updatePeer(global, peerId, {\n    hasStories,\n    hasUnreadStories: Boolean(hasStories && lastReadId && lastStoryId && lastReadId < lastStoryId),\n  });\n\n  global = updateStoriesForPeer(global, peerId, {\n    byId: newById,\n    orderedIds: newOrderedIds,\n    profileIds: newProfileIds,\n    lastUpdatedAt,\n    lastReadId: newLastReadId,\n  });\n\n  Object.values(global.byTabId).forEach((tab) => {\n    if (tab.storyViewer.lastViewedByPeerIds?.[peerId] === storyId) {\n      global = updateLastViewedStoryForPeer(global, peerId, previousStoryId, tab.id);\n    }\n  });\n\n  if (!hasStories) {\n    global = {\n      ...global,\n      stories: {\n        ...global.stories,\n        orderedPeerIds: {\n          active: global.stories.orderedPeerIds.active.filter((id) => id !== peerId),\n          archived: global.stories.orderedPeerIds.archived.filter((id) => id !== peerId),\n        },\n      },\n    };\n  }\n\n  return global;\n}\n\nexport function updateSentStoryReaction<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  reaction: ApiReaction | undefined,\n): T {\n  const story = selectPeerStory(global, peerId, storyId);\n  if (!story || !('content' in story)) return global;\n\n  const { views } = story;\n  const reactionsCount = views?.reactionsCount || 0;\n  const hasReaction = views?.reactions?.some((r) => r.chosenOrder !== undefined);\n  const reactions = updateReactionCount(views?.reactions || [], [reaction].filter(Boolean));\n\n  const countDiff = !reaction ? -1 : hasReaction ? 0 : 1;\n  const newReactionsCount = reactionsCount + countDiff;\n\n  global = updatePeerStory(global, peerId, storyId, {\n    sentReaction: reaction,\n    views: {\n      ...views,\n      reactionsCount: newReactionsCount,\n      reactions,\n    },\n  });\n\n  return global;\n}\n\nexport function updatePeerStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  storyUpdate: Partial<ApiStory>,\n): T {\n  const peerStories = selectPeerStories(global, peerId) || {\n    byId: {}, orderedIds: [], profileIds: [], archiveIds: [],\n  };\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          byId: {\n            ...peerStories.byId,\n            [storyId]: {\n              ...peerStories.byId[storyId],\n              ...storyUpdate,\n            },\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function updatePeerStoryViews<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  viewsUpdate: Partial<ApiStoryViews>,\n): T {\n  const story = selectPeerStory(global, peerId, storyId);\n  if (!story || !('content' in story)) return global;\n\n  const { views } = story;\n\n  return updatePeerStory(global, peerId, storyId, {\n    views: {\n      ...views,\n      ...viewsUpdate,\n    },\n  });\n}\n\nexport function updatePeerProfileStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  isInProfile?: boolean,\n): T {\n  const peerStories = selectPeerStories(global, peerId) || {\n    byId: {}, orderedIds: [], profileIds: [], archiveIds: [],\n  };\n\n  const newProfileIds = isInProfile\n    ? unique(peerStories.profileIds.concat(storyId)).sort((a, b) => b - a)\n    : peerStories.profileIds.filter((id) => storyId !== id);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          profileIds: newProfileIds,\n        },\n      },\n    },\n  };\n}\n\nexport function updatePeerStoriesHidden<T extends GlobalState>(global: T, peerId: string, areHidden: boolean) {\n  const peer = selectPeer(global, peerId);\n  if (!peer) return global;\n\n  const currentState = peer.areStoriesHidden;\n  if (currentState === areHidden) return global; // `updateOrderedStoriesPeerIds` is computationally expensive\n\n  global = updatePeer(global, peerId, {\n    areStoriesHidden: areHidden,\n  });\n\n  return updateOrderedStoriesPeerIds(global, [peerId]);\n}\n\nfunction updateOrderedStoriesPeerIds<T extends GlobalState>(global: T, updatePeerIds: string[]): T {\n  const { currentUserId, stories: { byPeerId, orderedPeerIds } } = global;\n\n  const allPeerIds = orderedPeerIds.active.concat(orderedPeerIds.archived).concat(updatePeerIds);\n  const newOrderedPeerIds = allPeerIds.reduce<{ active: string[]; archived: string[] }>((acc, peerId) => {\n    if (!byPeerId[peerId]?.orderedIds?.length) return acc;\n    const peer = selectPeer(global, peerId);\n\n    if (peer?.areStoriesHidden) {\n      acc.archived.push(peerId);\n    } else {\n      acc.active.push(peerId);\n    }\n\n    return acc;\n  }, { active: [], archived: [] });\n\n  function compare(peerIdA: string, peerIdB: string) {\n    const peerA = selectPeer(global, peerIdA)!;\n    const peerB = selectPeer(global, peerIdB)!;\n\n    const diffCurrentUser = compareFields(currentUserId === peerIdA, currentUserId === peerIdB);\n    if (diffCurrentUser) return diffCurrentUser;\n\n    const { lastUpdatedAt: luaA = 0, orderedIds: orderedA, lastReadId: lriA = 0 } = byPeerId[peerIdA] || {};\n    const hasUnreadA = lriA < orderedA?.[orderedA.length - 1];\n    const { lastUpdatedAt: luaB = 0, orderedIds: orderedB, lastReadId: lriB = 0 } = byPeerId[peerIdB] || {};\n    const hasUnreadB = lriB < orderedB?.[orderedB.length - 1];\n\n    const diffUnread = compareFields(hasUnreadA, hasUnreadB);\n    if (diffUnread) return diffUnread;\n\n    const diffPremium = compareFields('isPremium' in peerA, 'isPremium' in peerB);\n    if (diffPremium) return diffPremium;\n\n    const diffType = compareFields(isUserId(peerIdA), isUserId(peerIdB));\n    if (diffType) return diffType;\n\n    return compareFields(luaA, luaB);\n  }\n\n  newOrderedPeerIds.archived = unique(newOrderedPeerIds.archived)\n    .filter((peerId) => byPeerId[peerId]?.orderedIds?.length)\n    .sort(compare);\n  newOrderedPeerIds.active = unique(newOrderedPeerIds.active)\n    .filter((peerId) => byPeerId[peerId]?.orderedIds?.length)\n    .sort(compare);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      orderedPeerIds: newOrderedPeerIds,\n    },\n  };\n}\n\nfunction updatePeerLastUpdatedAt<T extends GlobalState>(global: T, peerId: string): T {\n  const peerStories = global.stories.byPeerId[peerId];\n  const lastUpdatedAt = peerStories.orderedIds.reduce<number | undefined>((acc, storyId) => {\n    const { date } = peerStories.byId[storyId] as ApiStorySkipped || {};\n    if (date && (!acc || acc < date)) {\n      acc = date;\n    }\n\n    return acc;\n  }, undefined);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          lastUpdatedAt,\n        },\n      },\n    },\n  };\n}\n\nexport function updateStealthMode<T extends GlobalState>(\n  global: T,\n  stealthMode: ApiStealthMode,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      stealthMode,\n    },\n  };\n}\n","import type { ApiTopic } from '../../api/types';\nimport type { TopicsInfo } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { buildCollectionByKey, omit, unique } from '../../util/iteratees';\nimport {\n  selectChat, selectTopic, selectTopics,\n  selectTopicsInfo,\n} from '../selectors';\nimport { updateThread, updateThreadInfo } from './messages';\n\nfunction updateTopicsStore<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<TopicsInfo>,\n) {\n  const info = global.chats.topicsInfoById[chatId] || {};\n\n  global = {\n    ...global,\n    chats: {\n      ...global.chats,\n      topicsInfoById: {\n        ...global.chats.topicsInfoById,\n        [chatId]: {\n          ...info,\n          ...update,\n        },\n      },\n    },\n  };\n\n  return global;\n}\n\nexport function updateListedTopicIds<T extends GlobalState>(\n  global: T, chatId: string, topicIds: number[],\n): T {\n  const listedIds = selectTopicsInfo(global, chatId)?.listedTopicIds || [];\n  return updateTopicsStore(global, chatId, {\n    listedTopicIds: unique([\n      ...listedIds,\n      ...topicIds,\n    ]),\n  });\n}\n\nexport function updateTopics<T extends GlobalState>(\n  global: T, chatId: string, topicsCount: number, topics: ApiTopic[],\n): T {\n  const oldTopics = selectTopics(global, chatId);\n  const newTopics = buildCollectionByKey(topics, 'id');\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: {\n      ...oldTopics,\n      ...newTopics,\n    },\n    totalCount: topicsCount,\n  });\n\n  topics.forEach((topic) => {\n    global = updateThread(global, chatId, topic.id, {\n      firstMessageId: topic.id,\n    });\n\n    global = updateThreadInfo(global, chatId, topic.id, {\n      lastMessageId: topic.lastMessageId,\n      threadId: topic.id,\n      chatId,\n    });\n  });\n\n  return global;\n}\n\nexport function updateTopic<T extends GlobalState>(\n  global: T, chatId: string, topicId: number, update: Partial<ApiTopic>,\n): T {\n  const chat = selectChat(global, chatId);\n\n  if (!chat) return global;\n\n  const topic = selectTopic(global, chatId, topicId);\n  const oldTopics = selectTopics(global, chatId);\n\n  const updatedTopic = {\n    ...topic,\n    ...update,\n  } as ApiTopic;\n\n  if (!updatedTopic.id) return global;\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: {\n      ...oldTopics,\n      [topicId]: updatedTopic,\n    },\n  });\n\n  global = updateThread(global, chatId, updatedTopic.id, {\n    firstMessageId: updatedTopic.id,\n  });\n\n  global = updateThreadInfo(global, chatId, updatedTopic.id, {\n    lastMessageId: updatedTopic.lastMessageId,\n    threadId: updatedTopic.id,\n    chatId,\n  });\n\n  return global;\n}\n\nexport function deleteTopic<T extends GlobalState>(\n  global: T, chatId: string, topicId: number,\n) {\n  const topics = selectTopics(global, chatId);\n  if (!topics) return global;\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: omit(topics, [topicId]),\n  });\n\n  return global;\n}\n\nexport function updateTopicLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, threadId: number, lastMessageId: number,\n) {\n  return updateTopic(global, chatId, threadId, {\n    lastMessageId,\n  });\n}\n\nexport function replacePinnedTopicIds<T extends GlobalState>(\n  global: T, chatId: string, pinnedTopicIds: number[],\n) {\n  return updateTopicsStore(global, chatId, {\n    orderedPinnedTopicIds: pinnedTopicIds,\n  });\n}\n","import type { MediaContent } from '../../api/types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport parseEmojiOnlyString from '../../util/emoji/parseEmojiOnlyString';\n\nexport function getEmojiOnlyCountForMessage(content: MediaContent, groupedId?: string): number | undefined {\n  if (!content.text) return undefined;\n  return (\n    !groupedId\n    && Object.keys(content).length === 1 // Only text is present\n    && !content.text.entities?.some((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji)\n    && parseEmojiOnlyString(content.text.text)\n  ) || undefined;\n}\n","import type {\n  ApiMessage, ApiPoll, ApiPollResult, ApiQuickReply, ApiSponsoredMessage, ApiThreadInfo,\n} from '../../api/types';\nimport type {\n  FocusDirection,\n  MessageList,\n  MessageListType,\n  ScrollTargetPosition,\n  TabThread,\n  Thread,\n  ThreadId,\n} from '../../types';\nimport type {\n  GlobalState, TabArgs, TabState,\n} from '../types';\nimport { MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  IS_MOCKED_CLIENT, IS_TEST, MESSAGE_LIST_SLICE, MESSAGE_LIST_VIEWPORT_LIMIT, TMP_CHAT_ID,\n} from '../../config';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  areSortedArraysEqual, excludeSortedArray, omit, pick, pickTruthy, unique,\n} from '../../util/iteratees';\nimport { isLocalMessageId, type MessageKey } from '../../util/keys/messageKey';\nimport {\n  hasMessageTtl, isMediaLoadableInViewer, mergeIdRanges, orderHistoryIds, orderPinnedIds,\n} from '../helpers';\nimport { getEmojiOnlyCountForMessage } from '../helpers/getEmojiOnlyCountForMessage';\nimport {\n  selectChatMessage,\n  selectChatMessages,\n  selectChatScheduledMessages,\n  selectCurrentMessageIds,\n  selectCurrentMessageList,\n  selectListedIds,\n  selectMessageIdsByGroupId,\n  selectOutlyingLists,\n  selectPinnedIds,\n  selectPoll,\n  selectQuickReplyMessage,\n  selectScheduledIds,\n  selectScheduledMessage,\n  selectTabState,\n  selectThreadIdFromMessage,\n  selectThreadInfo,\n  selectViewportIds,\n} from '../selectors';\nimport { removeIdFromSearchResults } from './middleSearch';\nimport { updateTabState } from './tabs';\nimport { clearMessageTranslation } from './translations';\n\ntype MessageStoreSections = GlobalState['messages']['byChatId'][string];\n\nexport function updateCurrentMessageList<T extends GlobalState>(\n  global: T,\n  chatId: string | undefined,\n  threadId: ThreadId = MAIN_THREAD_ID,\n  type: MessageListType = 'thread',\n  shouldReplaceHistory?: boolean,\n  shouldReplaceLast?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { messageLists } = selectTabState(global, tabId);\n  let newMessageLists: MessageList[] = messageLists;\n  if (shouldReplaceHistory || (IS_TEST && !IS_MOCKED_CLIENT)) {\n    newMessageLists = chatId ? [{ chatId, threadId, type }] : [];\n  } else if (chatId) {\n    const current = messageLists[messageLists.length - 1];\n    if (current?.chatId === chatId && current.threadId === threadId && current.type === type) {\n      return global;\n    }\n\n    if (current && (current.chatId === TMP_CHAT_ID || shouldReplaceLast)) {\n      newMessageLists = [...messageLists.slice(0, -1), { chatId, threadId, type }];\n    } else {\n      const previous = messageLists[messageLists.length - 2];\n\n      if (previous?.chatId === chatId && previous.threadId === threadId && previous.type === type) {\n        newMessageLists = messageLists.slice(0, -1);\n      } else {\n        newMessageLists = [...messageLists, { chatId, threadId, type }];\n      }\n    }\n  } else {\n    newMessageLists = messageLists.slice(0, -1);\n  }\n\n  return updateTabState(global, {\n    messageLists: newMessageLists,\n  }, tabId);\n}\n\nfunction replaceChatMessages<T extends GlobalState>(global: T, chatId: string, newById: Record<number, ApiMessage>): T {\n  return updateMessageStore(global, chatId, {\n    byId: newById,\n  });\n}\n\nexport function updateTabThread<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, threadUpdate: Partial<TabThread>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const current = tabState.tabThreads[chatId]?.[threadId] || {};\n\n  return updateTabState(global, {\n    tabThreads: {\n      ...tabState.tabThreads,\n      [chatId]: {\n        ...tabState.tabThreads[chatId],\n        [threadId]: {\n          ...current,\n          ...threadUpdate,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateThread<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, threadUpdate: Partial<Thread> | undefined,\n): T {\n  if (!threadUpdate) {\n    return updateMessageStore(global, chatId, {\n      threadsById: omit(global.messages.byChatId[chatId]?.threadsById, [threadId]),\n    });\n  }\n\n  const current = global.messages.byChatId[chatId];\n\n  return updateMessageStore(global, chatId, {\n    threadsById: {\n      ...(current?.threadsById),\n      [threadId]: {\n        ...(current?.threadsById[threadId]),\n        ...threadUpdate,\n      },\n    },\n  });\n}\n\nexport function updateMessageStore<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<MessageStoreSections>,\n): T {\n  const current = global.messages.byChatId[chatId] || { byId: {}, threadsById: {} };\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      byChatId: {\n        ...global.messages.byChatId,\n        [chatId]: {\n          ...current,\n          ...update,\n        },\n      },\n    },\n  };\n}\n\nexport function replaceTabThreadParam<T extends GlobalState, K extends keyof TabThread>(\n  global: T, chatId: string, threadId: ThreadId, paramName: K, newValue: TabThread[K] | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (paramName === 'viewportIds') {\n    global = replaceThreadParam(\n      global, chatId, threadId, 'lastViewportIds', newValue as number[] | undefined,\n    );\n  }\n  return updateTabThread(global, chatId, threadId, { [paramName]: newValue }, tabId);\n}\n\nexport function replaceThreadParam<T extends GlobalState, K extends keyof Thread>(\n  global: T, chatId: string, threadId: ThreadId, paramName: K, newValue: Thread[K] | undefined,\n) {\n  return updateThread(global, chatId, threadId, { [paramName]: newValue });\n}\n\nexport function addMessages<T extends GlobalState>(\n  global: T, messages: ApiMessage[],\n): T {\n  const addedByChatId = messages.reduce((messagesByChatId, message: ApiMessage) => {\n    if (!messagesByChatId[message.chatId]) {\n      messagesByChatId[message.chatId] = {};\n    }\n    messagesByChatId[message.chatId][message.id] = message;\n\n    return messagesByChatId;\n  }, {} as Record<string, Record<number, ApiMessage>>);\n\n  Object.keys(addedByChatId).forEach((chatId) => {\n    global = addChatMessagesById(global, chatId, addedByChatId[chatId]);\n  });\n\n  return global;\n}\n\nexport function replaceMessages<T extends GlobalState>(\n  global: T, messages: ApiMessage[],\n): T {\n  const updatedByChatId = messages.reduce((messagesByChatId, message: ApiMessage) => {\n    if (!messagesByChatId[message.chatId]) {\n      messagesByChatId[message.chatId] = {};\n    }\n    messagesByChatId[message.chatId][message.id] = message;\n\n    return messagesByChatId;\n  }, {} as Record<string, Record<number, ApiMessage>>);\n\n  Object.keys(updatedByChatId).forEach((chatId) => {\n    const currentById = selectChatMessages(global, chatId) || {};\n    const newById = {\n      ...currentById,\n      ...updatedByChatId[chatId],\n    };\n    global = replaceChatMessages(global, chatId, newById);\n  });\n\n  return global;\n}\n\nexport function addChatMessagesById<T extends GlobalState>(\n  global: T, chatId: string, newById: Record<number, ApiMessage>,\n): T {\n  const byId = selectChatMessages(global, chatId);\n\n  if (byId && Object.keys(newById).every((newId) => Boolean(byId[Number(newId)]))) {\n    return global;\n  }\n\n  return replaceChatMessages(global, chatId, {\n    ...newById,\n    ...byId,\n  });\n}\n\nexport function updateChatMessage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, messageUpdate: Partial<ApiMessage>, withDeepCheck = false,\n): T {\n  const byId = selectChatMessages(global, chatId) || {};\n  const message = byId[messageId];\n\n  if (withDeepCheck && message) {\n    const updateKeys = Object.keys(messageUpdate) as (keyof ApiMessage)[];\n    if (areDeepEqual(pick(message, updateKeys), messageUpdate)) {\n      return global;\n    }\n  }\n\n  if (message && messageUpdate.isMediaUnread === false && hasMessageTtl(message)) {\n    if (message.content.voice) {\n      messageUpdate.content = {\n        ...messageUpdate.content,\n        voice: undefined,\n        isExpiredVoice: true,\n      };\n    } else if (message.content.video?.isRound) {\n      messageUpdate.content = {\n        ...messageUpdate.content,\n        video: undefined,\n        isExpiredRoundVideo: true,\n      };\n    }\n  }\n\n  let emojiOnlyCount = message?.emojiOnlyCount;\n  if (messageUpdate.content) {\n    emojiOnlyCount = getEmojiOnlyCountForMessage(\n      messageUpdate.content, message?.groupedId || messageUpdate.groupedId,\n    );\n  }\n\n  const updatedMessage = {\n    ...message,\n    ...messageUpdate,\n    emojiOnlyCount,\n  };\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return replaceChatMessages(global, chatId, {\n    ...byId,\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function updateScheduledMessage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, messageUpdate: Partial<ApiMessage>,\n): T {\n  const message = selectScheduledMessage(global, chatId, messageId)!;\n\n  let emojiOnlyCount = message?.emojiOnlyCount;\n  if (messageUpdate.content) {\n    emojiOnlyCount = getEmojiOnlyCountForMessage(\n      messageUpdate.content, message?.groupedId || messageUpdate.groupedId,\n    );\n  }\n\n  const updatedMessage = {\n    ...message,\n    ...messageUpdate,\n    emojiOnlyCount,\n  };\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return updateScheduledMessages(global, chatId, {\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function updateQuickReplyMessage<T extends GlobalState>(\n  global: T, messageId: number, messageUpdate: Partial<ApiMessage>,\n): T {\n  const message = selectQuickReplyMessage(global, messageId);\n  const updatedMessage = {\n    ...message,\n    ...messageUpdate,\n  };\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return updateQuickReplyMessages(global, {\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function deleteQuickReplyMessages<T extends GlobalState>(\n  global: T, messageIds: number[],\n): T {\n  const byId = global.quickReplies.messagesById;\n  const newById = omit(byId, messageIds);\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      messagesById: newById,\n    },\n  };\n}\n\nexport function deleteChatMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n): T {\n  const byId = selectChatMessages(global, chatId);\n  if (!byId) {\n    return global;\n  }\n\n  orderHistoryIds(messageIds);\n  const updatedThreads = new Map<ThreadId, number[]>();\n  updatedThreads.set(MAIN_THREAD_ID, messageIds);\n\n  const mediaIdsToRemove: number[] = [];\n  messageIds.forEach((messageId) => {\n    const message = byId[messageId];\n    if (!message) return;\n    if (isMediaLoadableInViewer(message)) {\n      mediaIdsToRemove.push(messageId);\n    }\n    const threadId = selectThreadIdFromMessage(global, message);\n    if (!threadId || threadId === MAIN_THREAD_ID) {\n      return;\n    }\n    const threadMessages = updatedThreads.get(threadId) || [];\n    threadMessages.push(messageId);\n    updatedThreads.set(threadId, threadMessages);\n    global = clearMessageTranslation(global, chatId, messageId);\n  });\n\n  const deletedForwardedPosts = Object.values(pickTruthy(byId, messageIds)).filter(\n    ({ forwardInfo }) => forwardInfo?.isLinkedChannelPost,\n  );\n\n  updatedThreads.forEach((threadMessageIds, threadId) => {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n\n    let listedIds = selectListedIds(global, chatId, threadId);\n    let pinnedIds = selectPinnedIds(global, chatId, threadId);\n    let outlyingLists = selectOutlyingLists(global, chatId, threadId);\n    let newMessageCount = threadInfo?.messagesCount;\n\n    if (listedIds) {\n      listedIds = excludeSortedArray(listedIds, threadMessageIds);\n    }\n\n    if (outlyingLists) {\n      outlyingLists = outlyingLists.map((list) => excludeSortedArray(list, threadMessageIds));\n    }\n\n    if (pinnedIds) {\n      pinnedIds = excludeSortedArray(pinnedIds, orderPinnedIds(threadMessageIds));\n    }\n\n    const nonLocalMessageCount = threadMessageIds.filter((id) => !isLocalMessageId(id)).length;\n    if (newMessageCount !== undefined) {\n      newMessageCount -= nonLocalMessageCount;\n    }\n\n    Object.values(global.byTabId).forEach(({ id: tabId }) => {\n      const tabState = selectTabState(global, tabId);\n      const activeDownloadsInChat = Object.entries(tabState.activeDownloads).filter(\n        ([, { originChatId, originMessageId }]) => originChatId === chatId && originMessageId,\n      );\n\n      activeDownloadsInChat.forEach(([mediaHash, context]) => {\n        if (messageIds.includes(context.originMessageId!)) {\n          global = cancelMessageMediaDownload(global, [mediaHash], tabId);\n        }\n      });\n\n      mediaIdsToRemove.forEach((mediaId) => {\n        global = removeIdFromSearchResults(global, chatId, threadId, mediaId, tabId);\n      });\n\n      const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n      if (!viewportIds) return;\n\n      const newViewportIds = excludeSortedArray(viewportIds, messageIds);\n      global = replaceTabThreadParam(\n        global,\n        chatId,\n        threadId,\n        'viewportIds',\n        newViewportIds.length === 0 ? undefined : newViewportIds,\n        tabId,\n      );\n    });\n\n    global = replaceThreadParam(global, chatId, threadId, 'listedIds', listedIds);\n    global = replaceThreadParam(global, chatId, threadId, 'outlyingLists', outlyingLists);\n    global = replaceThreadParam(global, chatId, threadId, 'pinnedIds', pinnedIds);\n\n    if (threadInfo && newMessageCount !== undefined) {\n      global = updateThreadInfo(global, chatId, threadId, {\n        messagesCount: newMessageCount,\n      });\n    }\n  });\n\n  if (deletedForwardedPosts.length) {\n    Object.values(global.byTabId).forEach(({ id: tabId }) => {\n      const currentMessageList = selectCurrentMessageList(global, tabId);\n      const canDeleteCurrentThread = currentMessageList && currentMessageList.chatId === chatId\n        && currentMessageList.type === 'thread';\n      const currentThreadId = currentMessageList?.threadId;\n\n      deletedForwardedPosts.forEach((message) => {\n        const { fromChatId, fromMessageId } = message.forwardInfo!;\n        const originalPost = selectChatMessage(global, fromChatId!, fromMessageId!);\n\n        if (canDeleteCurrentThread && currentThreadId === message.id) {\n          global = updateCurrentMessageList(global, chatId, undefined, undefined, undefined, undefined, tabId);\n        }\n        if (originalPost) {\n          global = updateThread(global, fromChatId!, fromMessageId!, undefined);\n        }\n      });\n    });\n  }\n\n  const newById = omit(byId, messageIds);\n  global = replaceChatMessages(global, chatId, newById);\n\n  return global;\n}\n\nexport function deleteChatScheduledMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n): T {\n  const byId = selectChatScheduledMessages(global, chatId);\n  if (!byId) {\n    return global;\n  }\n  const newById = omit(byId, messageIds);\n\n  let scheduledIds = selectScheduledIds(global, chatId, MAIN_THREAD_ID);\n  if (scheduledIds) {\n    messageIds.forEach((messageId) => {\n      if (scheduledIds!.includes(messageId)) {\n        scheduledIds = scheduledIds!.filter((id) => id !== messageId);\n      }\n    });\n    global = replaceThreadParam(global, chatId, MAIN_THREAD_ID, 'scheduledIds', scheduledIds);\n\n    Object.entries(global.messages.byChatId[chatId].threadsById).forEach(([threadId, thread]) => {\n      if (thread.scheduledIds) {\n        const newScheduledIds = thread.scheduledIds.filter((id) => !messageIds.includes(id));\n        global = replaceThreadParam(global, chatId, Number(threadId), 'scheduledIds', newScheduledIds);\n      }\n    });\n  }\n\n  global = {\n    ...global,\n    scheduledMessages: {\n      byChatId: {\n        ...global.scheduledMessages.byChatId,\n        [chatId]: {\n          byId: newById,\n        },\n      },\n    },\n  };\n\n  return global;\n}\n\nexport function updateListedIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  idsUpdate: number[],\n): T {\n  const listedIds = selectListedIds(global, chatId, threadId);\n  const newIds = listedIds?.length\n    ? idsUpdate.filter((id) => !listedIds.includes(id))\n    : idsUpdate;\n\n  if (listedIds && !newIds.length) {\n    return global;\n  }\n\n  return replaceThreadParam(global, chatId, threadId, 'listedIds', orderHistoryIds([\n    ...(listedIds || []),\n    ...newIds,\n  ]));\n}\n\nexport function removeOutlyingList<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  list: number[],\n): T {\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  if (!outlyingLists) {\n    return global;\n  }\n\n  const newOutlyingLists = outlyingLists.filter((l) => l !== list);\n\n  return replaceThreadParam(global, chatId, threadId, 'outlyingLists', newOutlyingLists);\n}\n\nexport function updateOutlyingLists<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  idsUpdate: number[],\n): T {\n  if (!idsUpdate.length) return global;\n\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n\n  const newOutlyingLists = mergeIdRanges(outlyingLists || [], idsUpdate);\n\n  return replaceThreadParam(global, chatId, threadId, 'outlyingLists', newOutlyingLists);\n}\n\nexport function addViewportId<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId) || [];\n  if (viewportIds.includes(newId)) {\n    return global;\n  }\n\n  const newIds = orderHistoryIds([\n    ...(\n      viewportIds.length < MESSAGE_LIST_VIEWPORT_LIMIT\n        ? viewportIds\n        : viewportIds.slice(-(MESSAGE_LIST_SLICE / 2))\n    ),\n    newId,\n  ]);\n\n  return replaceTabThreadParam(global, chatId, threadId, 'viewportIds', newIds, tabId);\n}\n\nexport function safeReplaceViewportIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newViewportIds: number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const currentIds = selectViewportIds(global, chatId, threadId, tabId) || [];\n  const newIds = orderHistoryIds(newViewportIds);\n\n  return replaceTabThreadParam(\n    global,\n    chatId,\n    threadId,\n    'viewportIds',\n    areSortedArraysEqual(currentIds, newIds) ? currentIds : newIds,\n    tabId,\n  );\n}\n\nexport function safeReplacePinnedIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newPinnedIds: number[],\n): T {\n  const currentIds = selectPinnedIds(global, chatId, threadId) || [];\n  const newIds = orderPinnedIds(newPinnedIds);\n\n  return replaceThreadParam(\n    global,\n    chatId,\n    threadId,\n    'pinnedIds',\n    areSortedArraysEqual(currentIds, newIds) ? currentIds : newIds,\n  );\n}\n\nexport function updateThreadInfo<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, update: Partial<ApiThreadInfo> | undefined,\n  doNotUpdateLinked?: boolean,\n): T {\n  const newThreadInfo = {\n    ...(selectThreadInfo(global, chatId, threadId) as ApiThreadInfo),\n    ...update,\n  } as ApiThreadInfo;\n\n  if (!doNotUpdateLinked && !newThreadInfo.isCommentsInfo) {\n    const linkedUpdate = pick(newThreadInfo, ['messagesCount', 'lastMessageId', 'lastReadInboxMessageId']);\n    if (newThreadInfo.fromChannelId && newThreadInfo.fromMessageId) {\n      global = updateThreadInfo(\n        global, newThreadInfo.fromChannelId, newThreadInfo.fromMessageId, linkedUpdate, true,\n      );\n    }\n  }\n\n  return replaceThreadParam(global, chatId, threadId, 'threadInfo', newThreadInfo);\n}\n\nexport function updateThreadInfos<T extends GlobalState>(\n  global: T, updates: Partial<ApiThreadInfo>[],\n): T {\n  updates.forEach((update) => {\n    global = updateThreadInfo(\n      global,\n      update.isCommentsInfo ? update.originChannelId! : update.chatId!,\n      update.isCommentsInfo ? update.originMessageId! : update.threadId!,\n      update,\n    );\n  });\n\n  return global;\n}\n\nexport function updateScheduledMessages<T extends GlobalState>(\n  global: T, chatId: string, newById: Record<number, ApiMessage>,\n): T {\n  const current = global.scheduledMessages.byChatId[chatId] || { byId: {}, hash: 0 };\n\n  return {\n    ...global,\n    scheduledMessages: {\n      byChatId: {\n        ...global.scheduledMessages.byChatId,\n        [chatId]: {\n          ...current,\n          byId: {\n            ...current.byId,\n            ...newById,\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function updateQuickReplyMessages<T extends GlobalState>(\n  global: T, update: Record<number, ApiMessage>,\n): T {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      messagesById: {\n        ...global.quickReplies.messagesById,\n        ...update,\n      },\n    },\n  };\n}\n\nexport function updateFocusedMessage<T extends GlobalState>(\n  {\n    global,\n    chatId,\n    messageId,\n    threadId = MAIN_THREAD_ID,\n    noHighlight = false,\n    isResizingContainer = false,\n    quote,\n    scrollTargetPosition,\n  }: {\n    global: T;\n    chatId?: string;\n    messageId?: number;\n    threadId?: ThreadId;\n    noHighlight?: boolean;\n    isResizingContainer?: boolean;\n    quote?: string;\n    scrollTargetPosition?: ScrollTargetPosition;\n  },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    focusedMessage: {\n      ...selectTabState(global, tabId).focusedMessage,\n      chatId,\n      threadId,\n      messageId,\n      noHighlight,\n      isResizingContainer,\n      quote,\n      scrollTargetPosition,\n    },\n  }, tabId);\n}\n\nexport function updateSponsoredMessage<T extends GlobalState>(\n  global: T, chatId: string, message: ApiSponsoredMessage,\n): T {\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      sponsoredByChatId: {\n        ...global.messages.sponsoredByChatId,\n        [chatId]: message,\n      },\n    },\n  };\n}\n\nexport function deleteSponsoredMessage<T extends GlobalState>(\n  global: T, chatId: string,\n): T {\n  const byChatId = global.messages.sponsoredByChatId;\n  if (!byChatId[chatId]) {\n    return global;\n  }\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      sponsoredByChatId: omit(byChatId, [chatId]),\n    },\n  };\n}\n\nexport function updateFocusDirection<T extends GlobalState>(\n  global: T, direction?: FocusDirection,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    focusedMessage: {\n      ...selectTabState(global, tabId).focusedMessage,\n      direction,\n    },\n  }, tabId);\n}\n\nexport function enterMessageSelectMode<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageId?: number | number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const messageIds = messageId ? Array.prototype.concat([], messageId) : [];\n\n  return updateTabState(global, {\n    selectedMessages: {\n      chatId,\n      messageIds,\n    },\n  }, tabId);\n}\n\nexport function toggleMessageSelection<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  messageListType: MessageListType,\n  messageId: number,\n  groupedId?: string,\n  childMessageIds?: number[],\n  withShift = false,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { selectedMessages: oldSelectedMessages } = selectTabState(global, tabId);\n  if (groupedId) {\n    childMessageIds = selectMessageIdsByGroupId(global, chatId, groupedId);\n  }\n  const selectedMessageIds = childMessageIds || [messageId];\n  if (!oldSelectedMessages) {\n    return enterMessageSelectMode(global, chatId, selectedMessageIds, tabId);\n  }\n\n  const { messageIds } = oldSelectedMessages;\n\n  let newMessageIds;\n  const newSelectedMessageIds = selectedMessageIds.filter((id) => !messageIds.includes(id));\n  if (newSelectedMessageIds && !newSelectedMessageIds.length) {\n    newMessageIds = messageIds.filter((id) => !selectedMessageIds.includes(id));\n  } else if (withShift && messageIds.length) {\n    const viewportIds = selectCurrentMessageIds(global, chatId, threadId, messageListType, tabId)!;\n    const prevIndex = viewportIds.indexOf(messageIds[messageIds.length - 1]);\n    const currentIndex = viewportIds.indexOf(messageId);\n    const from = Math.min(prevIndex, currentIndex);\n    const to = Math.max(prevIndex, currentIndex);\n    const slice = viewportIds.slice(from, to + 1);\n    newMessageIds = unique([...messageIds, ...slice]);\n  } else {\n    newMessageIds = [...messageIds, ...newSelectedMessageIds];\n  }\n\n  if (!newMessageIds.length) {\n    return exitMessageSelectMode(global, tabId);\n  }\n\n  return updateTabState(global, {\n    selectedMessages: {\n      ...oldSelectedMessages,\n      messageIds: newMessageIds,\n    },\n  }, tabId);\n}\n\nexport function exitMessageSelectMode<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    selectedMessages: undefined,\n  }, tabId);\n}\n\nexport function updateThreadUnreadFromForwardedMessage<T extends GlobalState>(\n  global: T,\n  originMessage: ApiMessage,\n  chatId: string,\n  lastMessageId: number,\n  isDeleting?: boolean,\n): T {\n  const { channelPostId, fromChatId } = originMessage.forwardInfo || {};\n  if (channelPostId && fromChatId) {\n    const threadInfoOld = selectThreadInfo(global, chatId, channelPostId);\n    if (threadInfoOld) {\n      global = replaceThreadParam(global, chatId, channelPostId, 'threadInfo', {\n        ...threadInfoOld,\n        lastMessageId,\n        messagesCount: (threadInfoOld.messagesCount || 0) + (isDeleting ? -1 : 1),\n      });\n    }\n  }\n  return global;\n}\n\nexport function addActiveMediaDownload<T extends GlobalState>(\n  global: T,\n  mediaHash: string,\n  metadata: TabState['activeDownloads'][string],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  global = updateTabState(global, {\n    activeDownloads: {\n      ...tabState.activeDownloads,\n      [mediaHash]: metadata,\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function cancelMessageMediaDownload<T extends GlobalState>(\n  global: T,\n  mediaHashes: string[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  const newActiveDownloads = omit(tabState.activeDownloads, mediaHashes);\n\n  global = updateTabState(global, {\n    activeDownloads: newActiveDownloads,\n  }, tabId);\n\n  return global;\n}\n\nexport function updateUploadByMessageKey<T extends GlobalState>(\n  global: T,\n  messageKey: MessageKey,\n  progress: number | undefined,\n) {\n  return {\n    ...global,\n    fileUploads: {\n      byMessageKey: progress !== undefined\n        ? {\n          ...global.fileUploads.byMessageKey,\n          [messageKey]: { progress },\n        }\n        : omit(global.fileUploads.byMessageKey, [messageKey]),\n    },\n  };\n}\n\nexport function updateQuickReplies<T extends GlobalState>(\n  global: T,\n  quickRepliesUpdate: Record<number, ApiQuickReply>,\n) {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      byId: {\n        ...global.quickReplies.byId,\n        ...quickRepliesUpdate,\n      },\n    },\n  };\n}\n\nexport function deleteQuickReply<T extends GlobalState>(\n  global: T,\n  quickReplyId: number,\n) {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      byId: omit(global.quickReplies.byId, [quickReplyId]),\n    },\n  };\n}\n\nexport function updatePoll<T extends GlobalState>(\n  global: T,\n  pollId: string,\n  pollUpdate: Partial<ApiPoll>,\n) {\n  const poll = selectPoll(global, pollId);\n\n  const oldResults = poll?.results;\n  let newResults = oldResults || pollUpdate.results;\n  if (poll && pollUpdate.results?.results) {\n    if (!poll.results || !pollUpdate.results.isMin) {\n      newResults = pollUpdate.results;\n    } else if (oldResults.results) {\n      // Update voters counts, but keep local `isChosen` values\n      newResults = {\n        ...pollUpdate.results,\n        results: pollUpdate.results.results.map((result) => ({\n          ...result,\n          isChosen: oldResults.results!.find((r) => r.option === result.option)?.isChosen,\n        })),\n        isMin: undefined,\n      };\n    }\n  }\n\n  const updatedPoll = {\n    ...poll,\n    ...pollUpdate,\n    results: newResults,\n  } satisfies ApiPoll;\n  if (!updatedPoll.id) {\n    return global;\n  }\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      pollById: {\n        ...global.messages.pollById,\n        [pollId]: updatedPoll,\n      },\n    },\n  };\n}\n\nexport function updatePollVote<T extends GlobalState>(\n  global: T,\n  pollId: string,\n  peerId: string,\n  options: string[],\n) {\n  const poll = selectPoll(global, pollId);\n  if (!poll) {\n    return global;\n  }\n\n  const { recentVoterIds, totalVoters, results } = poll.results;\n  const newRecentVoterIds = recentVoterIds ? [...recentVoterIds] : [];\n  const newTotalVoters = totalVoters ? totalVoters + 1 : 1;\n  const newResults = results ? [...results] : [];\n\n  newRecentVoterIds.push(peerId);\n\n  options.forEach((option) => {\n    const targetOptionIndex = newResults.findIndex((result) => result.option === option);\n    const targetOption = newResults[targetOptionIndex];\n    const updatedOption: ApiPollResult = targetOption ? { ...targetOption } : { option, votersCount: 0 };\n\n    updatedOption.votersCount += 1;\n    if (peerId === global.currentUserId) {\n      updatedOption.isChosen = true;\n    }\n\n    if (targetOptionIndex) {\n      newResults[targetOptionIndex] = updatedOption;\n    } else {\n      newResults.push(updatedOption);\n    }\n  });\n\n  return updatePoll(global, pollId, {\n    results: {\n      ...poll.results,\n      recentVoterIds: newRecentVoterIds,\n      totalVoters: newTotalVoters,\n      results: newResults,\n    },\n  });\n}\n","import type { ApiMessage, ApiMessageSearchType } from '../../api/types';\nimport type {\n  ChatMediaSearchParams,\n  ChatMediaSearchSegment,\n  LoadingState,\n  MiddleSearchParams,\n  MiddleSearchResults,\n  SharedMediaType,\n  ThreadId,\n} from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  areSortedArraysEqual, areSortedArraysIntersecting, omit, unique,\n} from '../../util/iteratees';\nimport { buildChatThreadKey, isMediaLoadableInViewer } from '../helpers';\nimport { selectTabState } from '../selectors';\nimport { selectChatMediaSearch } from '../selectors/middleSearch';\nimport { updateTabState } from './tabs';\n\ninterface SharedMediaSearchParams {\n  currentType?: SharedMediaType;\n  resultsByType?: Partial<Record<SharedMediaType, {\n    totalCount?: number;\n    nextOffsetId: number;\n    foundIds: number[];\n  }>>;\n}\n\nfunction replaceMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatThreadKey: string,\n  searchParams?: MiddleSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const current = selectTabState(global, tabId).middleSearch.byChatThreadKey;\n  if (!searchParams) {\n    return updateTabState(global, {\n      middleSearch: {\n        byChatThreadKey: omit(current, [chatThreadKey]),\n      },\n    }, tabId);\n  }\n\n  const { type = 'chat', ...rest } = searchParams;\n  return updateTabState(global, {\n    middleSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).middleSearch.byChatThreadKey,\n        [chatThreadKey]: {\n          type,\n          ...rest,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  update: Partial<MiddleSearchParams>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const currentSearch = selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey];\n\n  const updated = {\n    type: 'chat',\n    ...currentSearch,\n    ...update,\n  } satisfies MiddleSearchParams;\n\n  if (!updated.isHashtag) {\n    updated.type = 'chat';\n  }\n\n  if (currentSearch && (currentSearch.type !== updated.type || currentSearch.savedTag !== updated.savedTag)) {\n    updated.results = undefined;\n  }\n\n  return replaceMiddleSearch(global, chatThreadKey, updated, tabId);\n}\n\nexport function resetMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return replaceMiddleSearch(global, buildChatThreadKey(chatId, threadId), {\n    type: 'chat',\n  }, tabId);\n}\n\nfunction replaceMiddleSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  results: MiddleSearchResults,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateMiddleSearch(global, chatId, threadId, {\n    results,\n    fetchingQuery: undefined,\n  }, tabId);\n}\n\nexport function updateMiddleSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  update: MiddleSearchResults,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const { results } = selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey] || {};\n  const prevQuery = (results?.query) || '';\n  if (update.query !== prevQuery) {\n    return replaceMiddleSearchResults(global, chatId, threadId, update, tabId);\n  }\n\n  const prevFoundIds = (results?.foundIds) || [];\n  const {\n    query, foundIds: newFoundIds, totalCount, nextOffsetId, nextOffsetPeerId, nextOffsetRate,\n  } = update;\n  const foundIds = unique(Array.prototype.concat(prevFoundIds, newFoundIds));\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  return replaceMiddleSearchResults(\n    global, chatId, threadId, {\n      query,\n      foundIds: foundOrPrevFoundIds,\n      totalCount,\n      nextOffsetId,\n      nextOffsetRate,\n      nextOffsetPeerId,\n    }, tabId,\n  );\n}\n\nexport function closeMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceMiddleSearch(global, chatThreadKey, undefined, tabId);\n}\n\nfunction replaceSharedMediaSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  searchParams: SharedMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return updateTabState(global, {\n    sharedMediaSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey,\n        [chatThreadKey]: searchParams,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateSharedMediaSearchType<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentType: SharedMediaType | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceSharedMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey],\n    currentType,\n  }, tabId);\n}\n\nexport function replaceSharedMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  type: ApiMessageSearchType,\n  foundIds?: number[],\n  totalCount?: number,\n  nextOffsetId?: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceSharedMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey],\n    resultsByType: {\n      ...(selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey] || {}).resultsByType,\n      [type]: {\n        foundIds,\n        totalCount,\n        nextOffsetId,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateSharedMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  type: SharedMediaType,\n  newFoundIds: number[],\n  totalCount?: number,\n  nextOffsetId?: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  const { resultsByType } = selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey] || {};\n  const prevFoundIds = resultsByType?.[type] ? resultsByType[type]!.foundIds : [];\n  const foundIds = orderFoundIdsByDescending(unique(Array.prototype.concat(prevFoundIds, newFoundIds)));\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  return replaceSharedMediaSearchResults(\n    global,\n    chatId,\n    threadId,\n    type,\n    foundOrPrevFoundIds,\n    totalCount,\n    nextOffsetId,\n    tabId,\n  );\n}\n\nfunction orderFoundIdsByDescending(listedIds: number[]) {\n  return listedIds.sort((a, b) => b - a);\n}\n\nfunction orderFoundIdsByAscending(array: number[]) {\n  return array.sort((a, b) => a - b);\n}\n\nexport function mergeWithChatMediaSearchSegment(\n  foundIds: number[],\n  loadingState: LoadingState,\n  segment?: ChatMediaSearchSegment,\n)\n  : ChatMediaSearchSegment {\n  if (!segment) {\n    return {\n      foundIds,\n      loadingState,\n    };\n  }\n  const mergedFoundIds = orderFoundIdsByAscending(unique(Array.prototype.concat(segment.foundIds, foundIds)));\n  if (!areSortedArraysEqual(segment.foundIds, foundIds)) {\n    segment.foundIds = mergedFoundIds;\n  }\n  const mergedLoadingState : LoadingState = {\n    areAllItemsLoadedForwards: loadingState.areAllItemsLoadedForwards\n    || segment.loadingState.areAllItemsLoadedForwards,\n    areAllItemsLoadedBackwards: loadingState.areAllItemsLoadedBackwards\n    || segment.loadingState.areAllItemsLoadedBackwards,\n  };\n  segment.loadingState = mergedLoadingState;\n  return segment;\n}\n\nfunction mergeChatMediaSearchSegments(currentSegment: ChatMediaSearchSegment, segments: ChatMediaSearchSegment[]) {\n  return segments.reduce((acc, segment) => {\n    const hasIntersection = areSortedArraysIntersecting(segment.foundIds, currentSegment.foundIds);\n    if (hasIntersection) {\n      currentSegment = mergeWithChatMediaSearchSegment(\n        currentSegment.foundIds,\n        currentSegment.loadingState,\n        segment,\n      );\n    } else {\n      acc.push(segment);\n    }\n    return acc;\n  }, [] as ChatMediaSearchSegment[]);\n}\n\nexport function updateChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentSegment: ChatMediaSearchSegment,\n  searchParams: ChatMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const segments = mergeChatMediaSearchSegments(currentSegment, searchParams.segments);\n\n  return replaceChatMediaSearchResults(\n    global,\n    chatId,\n    threadId,\n    currentSegment,\n    segments,\n    tabId,\n  );\n}\n\nfunction removeIdFromSegment(id: number, segment: ChatMediaSearchSegment): ChatMediaSearchSegment {\n  const foundIds = segment.foundIds.filter((foundId) => foundId !== id);\n\n  return {\n    ...segment,\n    foundIds,\n  };\n}\n\nfunction removeIdsFromChatMediaSearchParams(\n  id: number,\n  searchParams: ChatMediaSearchParams,\n): ChatMediaSearchParams {\n  const currentSegment = removeIdFromSegment(id, searchParams.currentSegment);\n  const segments = searchParams.segments.map((segment) => removeIdFromSegment(id, segment));\n\n  return {\n    ...searchParams,\n    currentSegment,\n    segments,\n  };\n}\n\nexport function removeIdFromSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  id: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const searchParams = selectChatMediaSearch(global, chatId, threadId, tabId);\n  if (!searchParams) return global;\n\n  const updatedSearchParams = removeIdsFromChatMediaSearchParams(id, searchParams);\n\n  return replaceChatMediaSearch(\n    global,\n    chatId,\n    threadId,\n    updatedSearchParams,\n    tabId,\n  );\n}\n\nfunction resetForwardsLoadingStateInParams(\n  searchParams: ChatMediaSearchParams,\n) {\n  searchParams.currentSegment.loadingState.areAllItemsLoadedForwards = false;\n  searchParams.segments.forEach((segment) => {\n    segment.loadingState.areAllItemsLoadedForwards = false;\n  });\n}\n\nexport function updateChatMediaLoadingState<T extends GlobalState>(\n  global: T,\n  newMessage: ApiMessage,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!isMediaLoadableInViewer(newMessage)) {\n    return global;\n  }\n  const searchParams = selectChatMediaSearch(global, chatId, threadId, tabId);\n  if (!searchParams) return global;\n  resetForwardsLoadingStateInParams(searchParams);\n\n  return replaceChatMediaSearch(\n    global,\n    chatId,\n    threadId,\n    searchParams,\n    tabId,\n  );\n}\n\nexport function initializeChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const loadingState: LoadingState = {\n    areAllItemsLoadedForwards: false,\n    areAllItemsLoadedBackwards: false,\n  };\n  const currentSegment: ChatMediaSearchSegment = {\n    foundIds: [],\n    loadingState,\n  };\n  const segments: ChatMediaSearchSegment[] = [];\n\n  const isLoading = false;\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    currentSegment,\n    segments,\n    isLoading,\n  }, tabId);\n}\n\nexport function setChatMediaSearchLoading<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  isLoading: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const searchParams = selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n\n  if (!searchParams) {\n    return global;\n  }\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    ...searchParams,\n    isLoading,\n  }, tabId);\n}\n\nexport function replaceChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentSegment: ChatMediaSearchSegment,\n  segments: ChatMediaSearchSegment[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey],\n    currentSegment,\n    segments,\n  }, tabId);\n}\n\nfunction replaceChatMediaSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  searchParams: ChatMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return updateTabState(global, {\n    chatMediaSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).chatMediaSearch.byChatThreadKey,\n        [chatThreadKey]: searchParams,\n      },\n    },\n  }, tabId);\n}\n","import type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\n\nexport function updateTabState<T extends GlobalState>(\n  global: T,\n  tabStatePartial: Partial<TabState>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return {\n    ...global,\n    byTabId: {\n      ...global.byTabId,\n      [tabId]: {\n        ...global.byTabId[tabId],\n        ...tabStatePartial,\n      },\n    },\n  };\n}\n","import type { ApiFormattedText } from '../../api/types';\nimport type { TranslatedMessage } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { omit } from '../../util/iteratees';\nimport { selectMessageTranslations, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, toLanguageCode: string, translation: Partial<TranslatedMessage>,\n) {\n  const translatedMessages = selectMessageTranslations(global, chatId, toLanguageCode);\n\n  return {\n    ...global,\n    translations: {\n      ...global.translations,\n      byChatId: {\n        ...global.translations.byChatId,\n        [chatId]: {\n          ...global.translations.byChatId[chatId],\n          byLangCode: {\n            ...global.translations.byChatId[chatId]?.byLangCode,\n            [toLanguageCode]: {\n              ...translatedMessages,\n              [messageId]: {\n                ...translatedMessages[messageId],\n                ...translation,\n              },\n            },\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function clearMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number,\n) {\n  const chatTranslations = global.translations.byChatId[chatId];\n  if (!chatTranslations) return global;\n\n  const { byLangCode } = chatTranslations;\n  const newByLangCode = Object.keys(byLangCode).reduce((acc, langCode) => {\n    const newTranslatedMessages = omit(byLangCode[langCode], [messageId]);\n    if (Object.keys(newTranslatedMessages).length) {\n      acc[langCode] = newTranslatedMessages;\n    }\n\n    return acc;\n  }, {} as Record<string, Record<number, TranslatedMessage>>);\n\n  return {\n    ...global,\n    translations: {\n      ...global.translations,\n      byChatId: {\n        ...global.translations.byChatId,\n        [chatId]: {\n          ...chatTranslations,\n          byLangCode: newByLangCode,\n        },\n      },\n    },\n  };\n}\n\nexport function updateMessageTranslations<T extends GlobalState>(\n  global: T, chatId: string, messageIds: number[], toLanguageCode: string, translations: ApiFormattedText[],\n) {\n  messageIds.forEach((messageId, index) => {\n    global = updateMessageTranslation(global, chatId, messageId, toLanguageCode, {\n      text: translations[index],\n      isPending: false,\n    });\n  });\n\n  return global;\n}\n\nexport function updateRequestedChatTranslation<T extends GlobalState>(\n  global: T, chatId: string, toLanguageCode?: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          toLanguage: toLanguageCode,\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function removeRequestedChatTranslation<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: omit(tabState.requestedTranslations.byChatId, [chatId]),\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function updateRequestedMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, toLanguageCode: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          ...tabState.requestedTranslations.byChatId[chatId],\n          manualMessages: {\n            ...tabState.requestedTranslations.byChatId[chatId]?.manualMessages,\n            [messageId]: toLanguageCode,\n          },\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function removeRequestedMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  const manualMessages = tabState.requestedTranslations.byChatId[chatId]?.manualMessages;\n  if (!manualMessages) return global;\n\n  const newManualMessages = omit(manualMessages, [messageId]);\n\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          ...tabState.requestedTranslations.byChatId[chatId],\n          manualMessages: newManualMessages,\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n","import type {\n  ApiChat, ApiChatFullInfo, ApiChatType,\n} from '../../api/types';\nimport type { ChatListType } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport {\n  ALL_FOLDER_ID, ARCHIVED_FOLDER_ID, MEMBERS_LOAD_SLICE, SAVED_FOLDER_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { IS_TRANSLATION_SUPPORTED } from '../../util/windowEnvironment';\nimport {\n  getHasAdminRight,\n  getPrivateChatUserId,\n  isChatChannel,\n  isChatSuperGroup,\n  isHistoryClearMessage,\n  isUserBot,\n  isUserId,\n  isUserOnline,\n} from '../helpers';\nimport { selectTabState } from './tabs';\nimport {\n  selectBot, selectIsCurrentUserPremium, selectUser, selectUserFullInfo,\n} from './users';\n\nexport function selectChat<T extends GlobalState>(global: T, chatId: string): ApiChat | undefined {\n  return global.chats.byId[chatId];\n}\n\nexport function selectChatFullInfo<T extends GlobalState>(global: T, chatId: string): ApiChatFullInfo | undefined {\n  return global.chats.fullInfoById[chatId];\n}\n\nexport function selectPeerFullInfo<T extends GlobalState>(global: T, peerId: string) {\n  if (isUserId(peerId)) return selectUserFullInfo(global, peerId);\n  return selectChatFullInfo(global, peerId);\n}\n\nexport function selectChatListLoadingParameters<T extends GlobalState>(\n  global: T, listType: ChatListType,\n) {\n  return global.chats.loadingParameters[listType];\n}\n\nexport function selectChatUser<T extends GlobalState>(global: T, chat: ApiChat) {\n  const userId = getPrivateChatUserId(chat);\n  if (!userId) {\n    return false;\n  }\n\n  return selectUser(global, userId);\n}\n\nexport function selectIsChatWithSelf<T extends GlobalState>(global: T, chatId: string) {\n  return chatId === global.currentUserId;\n}\n\nexport function selectIsChatWithBot<T extends GlobalState>(global: T, chat: ApiChat) {\n  const user = selectChatUser(global, chat);\n  return user && isUserBot(user);\n}\n\nexport function selectSupportChat<T extends GlobalState>(global: T) {\n  return Object.values(global.chats.byId).find(({ isSupport }: ApiChat) => isSupport);\n}\n\nexport function selectChatOnlineCount<T extends GlobalState>(global: T, chat: ApiChat) {\n  const fullInfo = selectChatFullInfo(global, chat.id);\n  if (isUserId(chat.id) || isChatChannel(chat) || !fullInfo) {\n    return undefined;\n  }\n\n  if (!fullInfo.members || fullInfo.members.length === MEMBERS_LOAD_SLICE) {\n    return fullInfo.onlineCount;\n  }\n\n  return fullInfo.members.reduce((onlineCount, { userId }) => {\n    if (\n      !selectIsChatWithSelf(global, userId)\n      && global.users.byId[userId]\n      && isUserOnline(global.users.byId[userId], global.users.statusesById[userId])\n    ) {\n      return onlineCount + 1;\n    }\n\n    return onlineCount;\n  }, 0);\n}\n\nexport function selectIsTrustedBot<T extends GlobalState>(global: T, botId: string) {\n  return global.trustedBotIds.includes(botId);\n}\n\nexport function selectChatType<T extends GlobalState>(global: T, chatId: string) : ApiChatType | undefined {\n  const bot = selectBot(global, chatId);\n  if (bot) {\n    return 'bots';\n  }\n\n  const user = selectUser(global, chatId);\n  if (user) {\n    return 'users';\n  }\n\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n\n  if (isChatChannel(chat)) {\n    return 'channels';\n  }\n\n  return 'chats';\n}\n\nexport function selectIsChatBotNotStarted<T extends GlobalState>(global: T, chatId: string) {\n  const bot = selectBot(global, chatId);\n  if (!bot) {\n    return false;\n  }\n\n  const lastMessage = selectChatLastMessage(global, chatId);\n  if (lastMessage && isHistoryClearMessage(lastMessage)) {\n    return true;\n  }\n\n  return Boolean(!lastMessage);\n}\n\nexport function selectAreActiveChatsLoaded<T extends GlobalState>(global: T): boolean {\n  return Boolean(global.chats.listIds.active);\n}\n\nexport function selectIsChatListed<T extends GlobalState>(\n  global: T, chatId: string, type?: ChatListType,\n): boolean {\n  const { listIds } = global.chats;\n  if (type) {\n    const targetList = listIds[type];\n    return Boolean(targetList && targetList.includes(chatId));\n  }\n\n  return Object.values(listIds).some((list) => list && list.includes(chatId));\n}\n\nexport function selectChatListType<T extends GlobalState>(\n  global: T, chatId: string,\n): 'active' | 'archived' | undefined {\n  const chat = selectChat(global, chatId);\n  if (!chat || !selectIsChatListed(global, chatId)) {\n    return undefined;\n  }\n\n  return chat.folderId === ARCHIVED_FOLDER_ID ? 'archived' : 'active';\n}\n\nexport function selectChatFolder<T extends GlobalState>(global: T, folderId: number) {\n  return global.chatFolders.byId[folderId];\n}\n\nexport function selectTotalChatCount<T extends GlobalState>(global: T, listType: 'active' | 'archived'): number {\n  const { totalCount } = global.chats;\n  const allChatsCount = totalCount.all;\n  const archivedChatsCount = totalCount.archived || 0;\n\n  if (listType === 'archived') {\n    return archivedChatsCount;\n  }\n\n  return allChatsCount ? allChatsCount - archivedChatsCount : 0;\n}\n\nexport function selectIsChatPinned<T extends GlobalState>(\n  global: T, chatId: string, folderId = ALL_FOLDER_ID,\n): boolean {\n  const { active, archived, saved } = global.chats.orderedPinnedIds;\n\n  if (folderId === ALL_FOLDER_ID) {\n    return Boolean(active?.includes(chatId));\n  }\n\n  if (folderId === ARCHIVED_FOLDER_ID) {\n    return Boolean(archived?.includes(chatId));\n  }\n\n  if (folderId === SAVED_FOLDER_ID) {\n    return Boolean(saved?.includes(chatId));\n  }\n\n  const { byId: chatFoldersById } = global.chatFolders;\n\n  const { pinnedChatIds } = chatFoldersById[folderId] || {};\n  return Boolean(pinnedChatIds?.includes(chatId));\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectChatByUsername<T extends GlobalState>(global: T, username: string) {\n  const usernameLowered = username.toLowerCase();\n  return Object.values(global.chats.byId).find(\n    (chat) => chat.usernames?.some((c) => c.username.toLowerCase() === usernameLowered),\n  );\n}\n\nexport function selectIsServiceChatReady<T extends GlobalState>(global: T) {\n  return Boolean(selectChat(global, SERVICE_NOTIFICATIONS_USER_ID));\n}\n\nexport function selectSendAs<T extends GlobalState>(global: T, chatId: string) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n\n  const id = selectChatFullInfo(global, chatId)?.sendAsId;\n  if (!id) return undefined;\n\n  return selectUser(global, id) || selectChat(global, id);\n}\n\nexport function selectRequestedDraft<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedDraft } = selectTabState(global, tabId);\n  if (requestedDraft?.chatId === chatId && !requestedDraft.files?.length) {\n    return requestedDraft.text;\n  }\n  return undefined;\n}\n\nexport function selectRequestedDraftFiles<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedDraft } = selectTabState(global, tabId);\n  if (requestedDraft?.chatId === chatId) {\n    return requestedDraft.files;\n  }\n  return undefined;\n}\n\nexport function filterChatIdsByType<T extends GlobalState>(\n  global: T, chatIds: string[], filter: readonly ApiChatType[],\n) {\n  return chatIds.filter((id) => {\n    const type = selectChatType(global, id);\n    if (!type) {\n      return false;\n    }\n    return filter.includes(type);\n  });\n}\n\nexport function selectCanInviteToChat<T extends GlobalState>(global: T, chatId: string) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  // https://github.com/TelegramMessenger/Telegram-iOS/blob/5126be83b3b9578fb014eb52ca553da9e7a8b83a/submodules/TelegramCore/Sources/TelegramEngine/Peers/Communities.swift#L6\n  return !chat.migratedTo && Boolean(!isUserId(chatId) && ((isChatChannel(chat) || isChatSuperGroup(chat)) ? (\n    chat.isCreator || getHasAdminRight(chat, 'inviteUsers')\n    || (chat.usernames?.length && !chat.isJoinRequest)\n  ) : (chat.isCreator || getHasAdminRight(chat, 'inviteUsers'))));\n}\n\nexport function selectCanShareFolder<T extends GlobalState>(global: T, folderId: number) {\n  const folder = selectChatFolder(global, folderId);\n  if (!folder) return false;\n\n  const {\n    bots, groups, channels, contacts, nonContacts, includedChatIds, pinnedChatIds,\n    excludeArchived, excludeMuted, excludeRead, excludedChatIds,\n  } = folder;\n\n  return !bots && !groups && !channels && !contacts && !nonContacts\n    && !excludeArchived && !excludeMuted && !excludeRead && !excludedChatIds?.length\n    && (pinnedChatIds?.length || includedChatIds.length)\n    && folder.includedChatIds.concat(folder.pinnedChatIds || []).some((chatId) => {\n      return selectCanInviteToChat(global, chatId);\n    });\n}\n\nexport function selectShouldDetectChatLanguage<T extends GlobalState>(\n  global: T, chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n  const { canTranslateChats } = global.settings.byKey;\n\n  const isPremium = selectIsCurrentUserPremium(global);\n  const isSavedMessages = selectIsChatWithSelf(global, chatId);\n\n  return IS_TRANSLATION_SUPPORTED && canTranslateChats && isPremium && !isSavedMessages;\n}\n\nexport function selectCanTranslateChat<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  const requestedTranslation = selectRequestedChatTranslationLanguage(global, chatId, tabId);\n  if (requestedTranslation) return true; // Prevent translation dropping on reevaluation\n\n  const isLanguageDetectable = selectShouldDetectChatLanguage(global, chatId);\n  const detectedLanguage = chat.detectedLanguage;\n\n  const { doNotTranslate } = global.settings.byKey;\n\n  return Boolean(isLanguageDetectable && detectedLanguage && !doNotTranslate.includes(detectedLanguage));\n}\n\nexport function selectRequestedChatTranslationLanguage<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedTranslations } = selectTabState(global, tabId);\n\n  return requestedTranslations.byChatId[chatId]?.toLanguage;\n}\n\nexport function selectSimilarChannelIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  return global.chats.similarChannelsById[chatId];\n}\n\nexport function selectSimilarBotsIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  return global.chats.similarBotsById[chatId];\n}\n\nexport function selectChatLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, listType: 'all' | 'saved' = 'all',\n) {\n  return global.chats.lastMessageIds[listType]?.[chatId];\n}\n\nexport function selectChatLastMessage<T extends GlobalState>(\n  global: T, chatId: string, listType: 'all' | 'saved' = 'all',\n) {\n  const id = selectChatLastMessageId(global, chatId, listType);\n  if (!id) return undefined;\n\n  const realChatId = listType === 'saved' ? global.currentUserId! : chatId;\n  return global.messages.byChatId[realChatId]?.byId[id];\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  getCanAddContact,\n  isAnonymousForwardsChat,\n  isChatAdmin, isChatGroup, isUserBot, isUserId,\n} from '../helpers';\nimport { selectChat, selectIsChatWithSelf } from './chats';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\nimport { selectBot, selectUser } from './users';\n\nexport function selectManagement<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).management.byChatId[chatId];\n}\n\nexport function selectCurrentManagement<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const currentManagement = selectTabState(global, tabId).management.byChatId[chatId];\n  if (!currentManagement?.isActive) {\n    return undefined;\n  }\n\n  return currentManagement;\n}\n\nexport function selectCurrentManagementType<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatBot = selectBot(global, chatId);\n  if (chatBot) {\n    return 'bot';\n  }\n\n  if (isUserId(chatId)) {\n    return 'user';\n  }\n\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  if (isChatGroup(chat)) {\n    return 'group';\n  }\n\n  return 'channel';\n}\n\nexport function selectCanManage<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat || chat.isRestricted) return false;\n\n  const isPrivate = isUserId(chat.id);\n  const user = isPrivate ? selectUser(global, chatId) : undefined;\n  const canAddContact = user && getCanAddContact(user);\n\n  const isBot = user && isUserBot(user);\n  return Boolean(\n    !canAddContact\n    && chat\n    && !selectIsChatWithSelf(global, chat.id)\n    && !isAnonymousForwardsChat(chat.id)\n    // chat.isCreator is for Basic Groups\n    && (isUserId(chat.id) || ((isChatAdmin(chat) || chat.isCreator) && !chat.isNotJoined))\n    && !isBot,\n  );\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectChatFullInfo } from './chats';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\n\nexport function selectStatistics<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).statistics.byChatId[chatId];\n}\n\nexport function selectIsStatisticsShown<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (!selectTabState(global, tabId).isStatisticsShown) {\n    return false;\n  }\n\n  const { chatId: currentChatId } = selectCurrentMessageList(global, tabId) || {};\n\n  return currentChatId ? selectChatFullInfo(global, currentChatId)?.canViewStatistics : undefined;\n}\n","import type { ApiMessage, ApiSponsoredMessage } from '../../api/types';\nimport type { PerformanceTypeKey } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\nimport { NewChatMembersProgress, RightColumnContent } from '../../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { IS_SNAP_EFFECT_SUPPORTED } from '../../util/windowEnvironment';\nimport { getMessageVideo, getMessageWebPageVideo } from '../helpers/messageMedia';\nimport { selectCurrentManagement } from './management';\nimport { selectIsStatisticsShown } from './statistics';\nimport { selectTabState } from './tabs';\n\nexport function selectIsMediaViewerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const {\n    mediaViewer: {\n      chatId,\n      messageId,\n      isAvatarView,\n      standaloneMedia,\n      isSponsoredMessage,\n    },\n  } = selectTabState(global, tabId);\n  return Boolean(standaloneMedia || (chatId && (isAvatarView || messageId || isSponsoredMessage)));\n}\n\nexport function selectRightColumnContentKey<T extends GlobalState>(\n  global: T,\n  isMobile?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  return tabState.editTopicPanel ? (\n    RightColumnContent.EditTopic\n  ) : tabState.createTopicPanel ? (\n    RightColumnContent.CreateTopic\n  ) : tabState.pollResults.messageId ? (\n    RightColumnContent.PollResults\n  ) : selectCurrentManagement(global, tabId) ? (\n    RightColumnContent.Management\n  ) : tabState.isStatisticsShown && tabState.statistics.currentMessageId ? (\n    RightColumnContent.MessageStatistics\n  ) : tabState.isStatisticsShown && tabState.statistics.currentStoryId ? (\n    RightColumnContent.StoryStatistics\n  ) : selectIsStatisticsShown(global, tabId) ? (\n    RightColumnContent.Statistics\n  ) : tabState.boostStatistics ? (\n    RightColumnContent.BoostStatistics\n  ) : tabState.monetizationStatistics ? (\n    RightColumnContent.MonetizationStatistics\n  ) : tabState.stickerSearch.query !== undefined ? (\n    RightColumnContent.StickerSearch\n  ) : tabState.gifSearch.query !== undefined ? (\n    RightColumnContent.GifSearch\n  ) : tabState.newChatMembersProgress !== NewChatMembersProgress.Closed ? (\n    RightColumnContent.AddingMembers\n  ) : tabState.isChatInfoShown && tabState.messageLists.length ? (\n    RightColumnContent.ChatInfo\n  ) : undefined;\n}\n\nexport function selectIsRightColumnShown<T extends GlobalState>(\n  global: T,\n  isMobile?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectRightColumnContentKey(global, isMobile, tabId) !== undefined;\n}\n\nexport function selectTheme<T extends GlobalState>(global: T) {\n  const { theme } = global.settings.byKey;\n\n  return theme;\n}\n\nexport function selectIsForumPanelOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  return Boolean(tabState.forumPanelChatId) && (\n    tabState.globalSearch.query === undefined || Boolean(tabState.globalSearch.isClosing)\n  );\n}\n\nexport function selectIsForumPanelClosed<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return !selectIsForumPanelOpen(global, tabId);\n}\n\nexport function selectIsReactionPickerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { reactionPicker } = selectTabState(global, tabId);\n  return Boolean(reactionPicker?.position);\n}\n\nexport function selectPerformanceSettings<T extends GlobalState>(global: T) {\n  return global.settings.performance;\n}\n\nexport function selectPerformanceSettingsValue<T extends GlobalState>(\n  global: T,\n  key: PerformanceTypeKey,\n) {\n  return global.settings.performance[key];\n}\n\nexport function selectCanAutoPlayMedia<T extends GlobalState>(global: T, message: ApiMessage | ApiSponsoredMessage) {\n  const video = getMessageVideo(message) || getMessageWebPageVideo(message);\n  if (!video) {\n    return undefined;\n  }\n\n  const canAutoPlayVideos = selectPerformanceSettingsValue(global, 'autoplayVideos');\n  const canAutoPlayGifs = selectPerformanceSettingsValue(global, 'autoplayGifs');\n\n  const asGif = video.isGif || video.isRound;\n\n  return (canAutoPlayVideos && !asGif) || (canAutoPlayGifs && asGif);\n}\n\nexport function selectShouldLoopStickers<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'loopAnimatedStickers');\n}\n\nexport function selectCanPlayAnimatedEmojis<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'animatedEmoji');\n}\n\nexport function selectCanAnimateInterface<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'pageTransitions');\n}\n\nexport function selectIsContextMenuTranslucent<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'contextMenuBlur');\n}\n\nexport function selectIsSynced<T extends GlobalState>(global: T) {\n  return global.isSynced;\n}\n\nexport function selectCanAnimateSnapEffect<T extends GlobalState>(global: T) {\n  return IS_SNAP_EFFECT_SUPPORTED && selectPerformanceSettingsValue(global, 'snapEffect');\n}\n\nexport function selectWebApp<T extends GlobalState>(\n  global: T, key: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).webApps.openedWebApps[key];\n}\n\nexport function selectActiveWebApp<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const activeWebAppKey = selectTabState(global, tabId).webApps.activeWebAppKey;\n  if (!activeWebAppKey) return undefined;\n\n  return selectWebApp(global, activeWebAppKey, tabId);\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentGlobalSearchQuery<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).globalSearch.query;\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from './tabs';\n\nexport function selectPaymentInputInvoice<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.inputInvoice;\n}\n\nexport function selectPaymentForm<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form;\n}\n\nexport function selectStarsPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).starsPayment;\n}\n\nexport function selectPaymentRequestId<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.requestId;\n}\n\nexport function selectProviderPublishableKey<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form?.nativeParams.publishableKey;\n}\n\nexport function selectProviderPublicToken<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form?.nativeParams.publicToken;\n}\n\nexport function selectStripeCredentials<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.stripeCredentials;\n}\n\nexport function selectSmartGlocalCredentials<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.smartGlocalCredentials;\n}\n","import type { GlobalState } from '../types';\n\nexport function selectNotifySettings<T extends GlobalState>(global: T) {\n  return global.settings.byKey;\n}\n\nexport function selectNotifyExceptions<T extends GlobalState>(global: T) {\n  return global.settings.notifyExceptions;\n}\n\nexport function selectLanguageCode<T extends GlobalState>(global: T) {\n  return global.settings.byKey.language.replace('-raw', '');\n}\n\nexport function selectCanSetPasscode<T extends GlobalState>(global: T) {\n  return global.authRememberMe && global.isCacheApiSupported;\n}\n\nexport function selectTranslationLanguage<T extends GlobalState>(global: T) {\n  return global.settings.byKey.translationLanguage || selectLanguageCode(global);\n}\n\nexport function selectNewNoncontactPeersRequirePremium<T extends GlobalState>(global: T) {\n  return global.settings.byKey.shouldNewNonContactPeersRequirePremium;\n}\n\nexport function selectShouldHideReadMarks<T extends GlobalState>(global: T) {\n  return global.settings.byKey.shouldHideReadMarks;\n}\n","import type {\n  ApiChat,\n  ApiInputMessageReplyInfo,\n  ApiMessage,\n  ApiMessageEntityCustomEmoji,\n  ApiMessageForwardInfo,\n  ApiMessageOutgoingStatus,\n  ApiPeer, ApiSponsoredMessage,\n  ApiStickerSetInfo,\n} from '../../api/types';\nimport type {\n  ChatTranslatedMessages,\n  MessageListType,\n  TabThread,\n  Thread,\n  ThreadId,\n} from '../../types';\nimport type { IAllowedAttachmentOptions } from '../helpers';\nimport type {\n  GlobalState, TabArgs,\n} from '../types';\nimport { ApiMessageEntityTypes, MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  ANONYMOUS_USER_ID, API_GENERAL_ID_LIMIT, GENERAL_TOPIC_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { findLast } from '../../util/iteratees';\nimport { getMessageKey, isLocalMessageId } from '../../util/keys/messageKey';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport { getServerTime } from '../../util/serverTime';\nimport { IS_TRANSLATION_SUPPORTED } from '../../util/windowEnvironment';\nimport {\n  canSendReaction,\n  getAllowedAttachmentOptions,\n  getCanPostInChat,\n  getHasAdminRight,\n  getIsSavedDialog,\n  getMessageAudio,\n  getMessageDocument,\n  getMessageLink,\n  getMessagePaidMedia,\n  getMessagePhoto,\n  getMessageVideo,\n  getMessageVoice,\n  getMessageWebPagePhoto,\n  getMessageWebPageVideo,\n  getSendingState,\n  hasMessageTtl,\n  isActionMessage,\n  isChatBasicGroup,\n  isChatChannel,\n  isChatGroup,\n  isChatSuperGroup,\n  isCommonBoxChat,\n  isExpiredMessage,\n  isForwardedMessage,\n  isMessageDocumentSticker,\n  isMessageFailed,\n  isMessageLocal,\n  isMessageTranslatable,\n  isOwnMessage,\n  isServiceNotificationMessage,\n  isUserId,\n  isUserRightBanned,\n} from '../helpers';\nimport { getMessageReplyInfo } from '../helpers/replies';\nimport {\n  selectChat,\n  selectChatFullInfo,\n  selectChatLastMessageId,\n  selectIsChatWithSelf,\n  selectRequestedChatTranslationLanguage,\n} from './chats';\nimport { selectPeer } from './peers';\nimport { selectPeerStory } from './stories';\nimport { selectIsStickerFavorite } from './symbols';\nimport { selectTabState } from './tabs';\nimport { selectTopic } from './topics';\nimport {\n  selectBot, selectIsCurrentUserPremium, selectUser, selectUserStatus,\n} from './users';\n\nexport function selectCurrentMessageList<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageLists } = selectTabState(global, tabId);\n\n  if (messageLists.length) {\n    return messageLists[messageLists.length - 1];\n  }\n\n  return undefined;\n}\n\nexport function selectCurrentChat<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId } = selectCurrentMessageList(global, tabId) || {};\n\n  return chatId ? selectChat(global, chatId) : undefined;\n}\n\nexport function selectChatMessages<T extends GlobalState>(global: T, chatId: string) {\n  return global.messages.byChatId[chatId]?.byId;\n}\n\nexport function selectChatScheduledMessages<T extends GlobalState>(global: T, chatId: string) {\n  return global.scheduledMessages.byChatId[chatId]?.byId;\n}\n\nexport function selectTabThreadParam<T extends GlobalState, K extends keyof TabThread>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  key: K,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).tabThreads[chatId]?.[threadId]?.[key];\n}\n\nexport function selectThreadParam<T extends GlobalState, K extends keyof Thread>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  key: K,\n) {\n  return selectThread(global, chatId, threadId)?.[key];\n}\n\nexport function selectThread<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n) {\n  const messageInfo = global.messages.byChatId[chatId];\n  if (!messageInfo) {\n    return undefined;\n  }\n\n  const thread = messageInfo.threadsById[threadId];\n  if (!thread) {\n    return undefined;\n  }\n\n  return thread;\n}\n\nexport function selectListedIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'listedIds');\n}\n\nexport function selectOutlyingListByMessageId<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, messageId: number,\n) {\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  if (!outlyingLists) {\n    return undefined;\n  }\n\n  return outlyingLists.find((list) => {\n    return list[0] <= messageId && list[list.length - 1] >= messageId;\n  });\n}\n\nexport function selectOutlyingLists<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n) {\n  return selectThreadParam(global, chatId, threadId, 'outlyingLists');\n}\n\nexport function selectCurrentMessageIds<T extends GlobalState>(\n  global: T,\n  chatId: string, threadId: ThreadId, messageListType: MessageListType,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  switch (messageListType) {\n    case 'thread':\n      return selectViewportIds(global, chatId, threadId, tabId);\n    case 'pinned':\n      return selectPinnedIds(global, chatId, threadId);\n    case 'scheduled':\n      return selectScheduledIds(global, chatId, threadId);\n  }\n\n  return undefined;\n}\n\nexport function selectViewportIds<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'viewportIds', tabId);\n}\n\nexport function selectPinnedIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'pinnedIds');\n}\n\nexport function selectScheduledIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'scheduledIds');\n}\n\nexport function selectScrollOffset<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'scrollOffset', tabId);\n}\n\nexport function selectLastScrollOffset<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'lastScrollOffset');\n}\n\nexport function selectEditingId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'editingId');\n}\n\nexport function selectEditingDraft<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'editingDraft');\n}\n\nexport function selectEditingScheduledId<T extends GlobalState>(global: T, chatId: string) {\n  return selectThreadParam(global, chatId, MAIN_THREAD_ID, 'editingScheduledId');\n}\n\nexport function selectEditingScheduledDraft<T extends GlobalState>(global: T, chatId: string) {\n  return selectThreadParam(global, chatId, MAIN_THREAD_ID, 'editingScheduledDraft');\n}\n\nexport function selectDraft<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'draft');\n}\n\nexport function selectNoWebPage<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'noWebPage');\n}\n\nexport function selectThreadInfo<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'threadInfo');\n}\n\nexport function selectFirstMessageId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'firstMessageId');\n}\n\nexport function selectReplyStack<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'replyStack', tabId);\n}\n\nexport function selectThreadMessagesCount(global: GlobalState, chatId: string, threadId: ThreadId) {\n  const chat = selectChat(global, chatId);\n  const threadInfo = selectThreadInfo(global, chatId, threadId);\n  if (!chat || !threadInfo || threadInfo.messagesCount === undefined) return undefined;\n  // In forum topics first message is ignored, but not in General\n  if (chat.isForum && threadId !== GENERAL_TOPIC_ID) return threadInfo.messagesCount - 1;\n  return threadInfo.messagesCount;\n}\n\nexport function selectThreadByMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const threadId = selectThreadIdFromMessage(global, message);\n  if (!threadId || threadId === MAIN_THREAD_ID) {\n    return undefined;\n  }\n\n  return global.messages.byChatId[message.chatId].threadsById[threadId];\n}\n\nexport function selectIsMessageInCurrentMessageList<T extends GlobalState>(\n  global: T, chatId: string, message: ApiMessage,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const currentMessageList = selectCurrentMessageList(global, tabId);\n  if (!currentMessageList) {\n    return false;\n  }\n\n  const { threadInfo } = selectThreadByMessage(global, message) || {};\n  return (\n    chatId === currentMessageList.chatId\n    && (\n      (currentMessageList.threadId === MAIN_THREAD_ID)\n      || (threadInfo && currentMessageList.threadId === threadInfo.threadId)\n    )\n  );\n}\n\nexport function selectIsViewportNewest<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n  if (!viewportIds || !viewportIds.length) {\n    return true;\n  }\n\n  const isSavedDialog = getIsSavedDialog(chatId, threadId, global.currentUserId);\n\n  let lastMessageId: number;\n\n  if (threadId === MAIN_THREAD_ID) {\n    const id = selectChatLastMessageId(global, chatId);\n    if (!id) {\n      return true;\n    }\n    lastMessageId = id;\n  } else if (isSavedDialog) {\n    const id = selectChatLastMessageId(global, String(threadId), 'saved');\n    if (!id) {\n      return true;\n    }\n    lastMessageId = id;\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo || !threadInfo.lastMessageId) {\n      if (!threadInfo?.threadId) return undefined;\n      // No messages in thread, except for the thread message itself\n      lastMessageId = Number(threadInfo?.threadId);\n    } else {\n      lastMessageId = threadInfo.lastMessageId;\n    }\n  }\n\n  // Edge case: outgoing `lastMessage` is updated with a delay to optimize animation\n  if (isLocalMessageId(lastMessageId) && !selectChatMessage(global, chatId, lastMessageId)) {\n    return true;\n  }\n\n  return viewportIds[viewportIds.length - 1] >= lastMessageId;\n}\n\nexport function selectChatMessage<T extends GlobalState>(global: T, chatId: string, messageId: number) {\n  const chatMessages = selectChatMessages(global, chatId);\n\n  return chatMessages ? chatMessages[messageId] : undefined;\n}\n\nexport function selectScheduledMessage<T extends GlobalState>(global: T, chatId: string, messageId: number) {\n  const chatMessages = selectChatScheduledMessages(global, chatId);\n\n  return chatMessages ? chatMessages[messageId] : undefined;\n}\n\nexport function selectQuickReplyMessage<T extends GlobalState>(global: T, messageId: number) {\n  return global.quickReplies.messagesById[messageId];\n}\n\nexport function selectEditingMessage<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, messageListType: MessageListType,\n) {\n  if (messageListType === 'scheduled') {\n    const messageId = selectEditingScheduledId(global, chatId);\n    return messageId ? selectScheduledMessage(global, chatId, messageId) : undefined;\n  } else {\n    const messageId = selectEditingId(global, chatId, threadId);\n    return messageId ? selectChatMessage(global, chatId, messageId) : undefined;\n  }\n}\n\nexport function selectFocusedMessageId<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId: focusedChatId, messageId } = selectTabState(global, tabId).focusedMessage || {};\n\n  return focusedChatId === chatId ? messageId : undefined;\n}\n\nexport function selectIsMessageFocused<T extends GlobalState>(\n  global: T, message: ApiMessage, currentThreadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const focusedId = selectFocusedMessageId(global, message.chatId, tabId);\n  const threadId = selectTabState(global, tabId).focusedMessage?.threadId;\n\n  if (currentThreadId !== threadId) return false;\n\n  return focusedId ? focusedId === message.id || focusedId === message.previousLocalId : false;\n}\n\nexport function selectIsMessageUnread<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { lastReadOutboxMessageId } = selectChat(global, message.chatId) || {};\n  return isMessageLocal(message) || !lastReadOutboxMessageId || lastReadOutboxMessageId < message.id;\n}\n\nexport function selectOutgoingStatus<T extends GlobalState>(\n  global: T, message: ApiMessage, isScheduledList = false,\n): ApiMessageOutgoingStatus {\n  if (!selectIsMessageUnread(global, message) && !isScheduledList) {\n    return 'read';\n  }\n\n  return getSendingState(message);\n}\n\nexport function selectSender<T extends GlobalState>(global: T, message: ApiMessage): ApiPeer | undefined {\n  const { senderId } = message;\n  const chat = selectChat(global, message.chatId);\n  if (!senderId) {\n    return chat;\n  }\n\n  if (chat && isChatChannel(chat) && !chat.areProfilesShown) return chat;\n\n  return selectPeer(global, senderId);\n}\n\nexport function getSendersFromSelectedMessages<T extends GlobalState>(\n  global: T,\n  chat: ApiChat | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  if (!chat?.id || !selectedMessageIds) {\n    return undefined;\n  }\n\n  return selectedMessageIds.map((id) => {\n    const message = selectChatMessage(global, chat.id, id);\n    return message && selectSender(global, message);\n  });\n}\n\nexport function selectSenderFromMessage<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageId: number,\n): ApiPeer | undefined {\n  const message = selectChatMessage(global, chatId, messageId);\n\n  return message && selectSender(global, message);\n}\n\nexport function selectSenderFromHeader<T extends GlobalState>(\n  global: T,\n  header: ApiMessageForwardInfo,\n) {\n  const { fromId } = header;\n  if (fromId) {\n    return selectPeer(global, fromId);\n  }\n\n  return undefined;\n}\n\nexport function selectForwardedSender<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): ApiPeer | undefined {\n  const isStoryForward = Boolean(message.content.storyData);\n  if (isStoryForward) {\n    const peerId = message.content.storyData!.peerId;\n    return selectPeer(global, peerId);\n  }\n\n  const { forwardInfo } = message;\n  if (!forwardInfo) {\n    return undefined;\n  }\n\n  if (forwardInfo.isChannelPost && forwardInfo.fromChatId) {\n    return selectChat(global, forwardInfo.fromChatId);\n  }\n\n  if (forwardInfo.hiddenUserName) {\n    return undefined;\n  }\n\n  if (forwardInfo.fromId) {\n    return selectPeer(global, forwardInfo.fromId);\n  }\n\n  if (forwardInfo.savedFromPeerId) {\n    return selectPeer(global, forwardInfo.savedFromPeerId);\n  }\n\n  return undefined;\n}\n\nexport function selectPoll<T extends GlobalState>(global: T, pollId: string) {\n  return global.messages.pollById[pollId];\n}\n\nexport function selectPollFromMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  if (!message.content.pollId) return undefined;\n  return selectPoll(global, message.content.pollId);\n}\n\nexport function selectTopicFromMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { chatId } = message;\n  const chat = selectChat(global, chatId);\n  if (!chat?.isForum) return undefined;\n\n  const threadId = selectThreadIdFromMessage(global, message);\n  return selectTopic(global, chatId, threadId);\n}\n\nconst MAX_MESSAGES_TO_DELETE_OWNER_TOPIC = 10;\nexport function selectCanDeleteOwnerTopic<T extends GlobalState>(global: T, chatId: string, topicId: number) {\n  const topic = selectTopic(global, chatId, topicId);\n  if (topic && !topic.isOwner) return false;\n\n  const thread = selectThread(global, chatId, topicId);\n  if (!thread) return false;\n\n  const { listedIds } = thread;\n  if (!listedIds\n    // Plus one for root message\n    || listedIds.length + 1 >= MAX_MESSAGES_TO_DELETE_OWNER_TOPIC) {\n    return false;\n  }\n\n  const hasNotOutgoingMessages = listedIds.some((messageId) => {\n    const message = selectChatMessage(global, chatId, messageId);\n    return !message || !message.isOutgoing;\n  });\n\n  return !hasNotOutgoingMessages;\n}\n\nexport function selectCanDeleteTopic<T extends GlobalState>(global: T, chatId: string, topicId: number) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  if (topicId === GENERAL_TOPIC_ID) return false;\n\n  return chat.isCreator\n    || getHasAdminRight(chat, 'deleteMessages')\n    || (chat.isForum\n      && selectCanDeleteOwnerTopic(global, chat.id, topicId));\n}\n\nexport function selectSavedDialogIdFromMessage<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): string | undefined {\n  const {\n    chatId, senderId, forwardInfo, savedPeerId,\n  } = message;\n\n  if (savedPeerId) return savedPeerId;\n\n  if (chatId !== global.currentUserId) {\n    return undefined;\n  }\n\n  if (forwardInfo?.savedFromPeerId) {\n    return forwardInfo.savedFromPeerId;\n  }\n\n  if (forwardInfo?.fromId) {\n    return forwardInfo.fromId;\n  }\n\n  if (forwardInfo?.hiddenUserName) {\n    return ANONYMOUS_USER_ID;\n  }\n\n  return senderId;\n}\n\nexport function selectThreadIdFromMessage<T extends GlobalState>(global: T, message: ApiMessage): ThreadId {\n  const savedDialogId = selectSavedDialogIdFromMessage(global, message);\n  if (savedDialogId) {\n    return savedDialogId;\n  }\n\n  const chat = selectChat(global, message.chatId);\n  const { content } = message;\n  const { replyToMsgId, replyToTopId, isForumTopic } = getMessageReplyInfo(message) || {};\n  if ('action' in content && content.action?.type === 'topicCreate') {\n    return message.id;\n  }\n\n  if (!chat?.isForum) {\n    if (chat && isChatBasicGroup(chat)) return MAIN_THREAD_ID;\n\n    if (chat && isChatSuperGroup(chat)) {\n      return replyToTopId || replyToMsgId || MAIN_THREAD_ID;\n    }\n    return MAIN_THREAD_ID;\n  }\n  if (!isForumTopic) return GENERAL_TOPIC_ID;\n  return replyToTopId || replyToMsgId || GENERAL_TOPIC_ID;\n}\n\nexport function selectCanReplyToMessage<T extends GlobalState>(global: T, message: ApiMessage, threadId: ThreadId) {\n  const chat = selectChat(global, message.chatId);\n  if (!chat || chat.isRestricted || chat.isForbidden) return false;\n\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n\n  if (isLocal || isServiceNotification) return false;\n\n  const threadInfo = selectThreadInfo(global, message.chatId, threadId);\n  const isMessageThread = Boolean(!threadInfo?.isCommentsInfo && threadInfo?.fromChannelId);\n  const chatFullInfo = selectChatFullInfo(global, chat.id);\n  const topic = selectTopic(global, chat.id, threadId);\n  const canPostInChat = getCanPostInChat(chat, topic, isMessageThread, chatFullInfo);\n  if (!canPostInChat) return false;\n\n  const messageTopic = selectTopicFromMessage(global, message);\n  return !messageTopic || !messageTopic.isClosed || messageTopic.isOwner || getHasAdminRight(chat, 'manageTopics');\n}\n\nexport function selectCanForwardMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isAction = isActionMessage(message);\n  const hasTtl = hasMessageTtl(message);\n  const { content } = message;\n  const story = content.storyData\n    ? selectPeerStory(global, content.storyData.peerId, content.storyData.id)\n    : (content.webPage?.story\n      ? selectPeerStory(global, content.webPage.story.peerId, content.webPage.story.id)\n      : undefined\n    );\n  const isChatProtected = selectIsChatProtected(global, message.chatId);\n  const isStoryForwardForbidden = story && ('isDeleted' in story || ('noForwards' in story && story.noForwards));\n  const canForward = (\n    !isLocal && !isAction && !isChatProtected && !isStoryForwardForbidden\n    && (message.isForwardingAllowed || isServiceNotification) && !hasTtl\n  );\n\n  return canForward;\n}\n\n// This selector is slow and not to be used within lists (e.g. Message component)\nexport function selectAllowedMessageActionsSlow<T extends GlobalState>(\n  global: T, message: ApiMessage, threadId: ThreadId,\n) {\n  const chat = selectChat(global, message.chatId);\n  if (!chat || chat.isRestricted) {\n    return {};\n  }\n\n  const isPrivate = isUserId(chat.id);\n  const isChatWithSelf = selectIsChatWithSelf(global, message.chatId);\n  const isBasicGroup = isChatBasicGroup(chat);\n  const isSuperGroup = isChatSuperGroup(chat);\n  const isChannel = isChatChannel(chat);\n  const isBotChat = Boolean(selectBot(global, chat.id));\n  const isLocal = isMessageLocal(message);\n  const isFailed = isMessageFailed(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isOwn = isOwnMessage(message);\n  const isForwarded = isForwardedMessage(message);\n  const isAction = isActionMessage(message);\n  const hasTtl = hasMessageTtl(message);\n  const { content } = message;\n  const isDocumentSticker = isMessageDocumentSticker(message);\n  const isBoostMessage = message.content.action?.type === 'chatBoost';\n\n  const hasChatPinPermission = (chat.isCreator\n    || (!isChannel && !isUserRightBanned(chat, 'pinMessages'))\n    || getHasAdminRight(chat, 'pinMessages'));\n\n  const hasPinPermission = isPrivate || hasChatPinPermission;\n\n  // https://github.com/telegramdesktop/tdesktop/blob/335095a332607c41a8d20b47e61f5bbd66366d4b/Telegram/SourceFiles/data/data_peer.cpp#L653\n  const canEditMessagesIndefinitely = (() => {\n    if (isPrivate) return isChatWithSelf;\n    if (isBasicGroup) return false;\n    if (isSuperGroup) return hasChatPinPermission;\n    if (isChannel) return chat.isCreator || getHasAdminRight(chat, 'editMessages');\n    return false;\n  })();\n\n  const isMessageEditable = (\n    (\n      canEditMessagesIndefinitely\n      || getServerTime() - message.date < (global.config?.editTimeLimit || Infinity)\n    ) && !(\n      content.sticker || content.contact || content.pollId || content.action\n      || (content.video?.isRound) || content.location || content.invoice || content.giveaway || content.giveawayResults\n      || isDocumentSticker\n    )\n    && !isForwarded\n    && !message.viaBotId\n    && !chat.isForbidden\n  );\n\n  const isSavedDialog = getIsSavedDialog(chat.id, threadId, global.currentUserId);\n\n  const canReply = selectCanReplyToMessage(global, message, threadId);\n  const canReplyGlobally = canReply || (!isSavedDialog && !isLocal && !isServiceNotification\n    && (isSuperGroup || isBasicGroup || isChatChannel(chat)));\n\n  let canPin = !isLocal && !isServiceNotification && !isAction && hasPinPermission && !isSavedDialog;\n  let canUnpin = false;\n\n  const pinnedMessageIds = selectPinnedIds(global, chat.id, threadId);\n\n  if (canPin) {\n    canUnpin = Boolean(pinnedMessageIds && pinnedMessageIds.includes(message.id));\n    canPin = !canUnpin;\n  }\n\n  const canNotDeleteBoostMessage = isBoostMessage && isOwn\n    && !chat.isCreator && !getHasAdminRight(chat, 'deleteMessages');\n\n  const canDelete = (!isLocal || isFailed) && !isServiceNotification && !canNotDeleteBoostMessage && (\n    isPrivate\n    || isOwn\n    || isBasicGroup\n    || chat.isCreator\n    || getHasAdminRight(chat, 'deleteMessages')\n  );\n\n  const canReport = !isPrivate && !isOwn;\n\n  const canDeleteForAll = canDelete && !chat.isForbidden && (\n    (isPrivate && !isChatWithSelf && !isBotChat)\n    || (isBasicGroup && (\n      isOwn || getHasAdminRight(chat, 'deleteMessages') || chat.isCreator\n    ))\n  );\n\n  const hasMessageEditRight = isOwn || (isChannel && (chat.isCreator || getHasAdminRight(chat, 'editMessages')));\n\n  const canEdit = !isLocal && !isAction && isMessageEditable && hasMessageEditRight;\n\n  const hasSticker = Boolean(message.content.sticker);\n  const hasFavoriteSticker = hasSticker && selectIsStickerFavorite(global, message.content.sticker!);\n  const canFaveSticker = !isAction && hasSticker && !hasFavoriteSticker;\n  const canUnfaveSticker = !isAction && hasFavoriteSticker;\n  const canCopy = !isAction;\n  const canCopyLink = !isLocal && !isAction && (isChannel || isSuperGroup);\n  const canSelect = !isLocal && !isAction;\n\n  const canDownload = Boolean(content.webPage?.document || content.webPage?.video || content.webPage?.photo\n      || content.audio || content.voice || content.photo || content.video || content.document || content.sticker)\n    && !hasTtl;\n\n  const canSaveGif = message.content.video?.isGif;\n\n  const poll = content.pollId ? selectPoll(global, content.pollId) : undefined;\n  const canRevote = !poll?.summary.closed && !poll?.summary.quiz && poll?.results.results?.some((r) => r.isChosen);\n  const canClosePoll = hasMessageEditRight && poll && !poll.summary.closed && !isForwarded;\n\n  const noOptions = [\n    canReply,\n    canReplyGlobally,\n    canEdit,\n    canPin,\n    canUnpin,\n    canReport,\n    canDelete,\n    canDeleteForAll,\n    canFaveSticker,\n    canUnfaveSticker,\n    canCopy,\n    canCopyLink,\n    canSelect,\n    canDownload,\n    canSaveGif,\n    canRevote,\n    canClosePoll,\n  ].every((ability) => !ability);\n\n  return {\n    noOptions,\n    canReply,\n    canReplyGlobally,\n    canEdit,\n    canPin,\n    canUnpin,\n    canReport,\n    canDelete,\n    canDeleteForAll,\n    canFaveSticker,\n    canUnfaveSticker,\n    canCopy,\n    canCopyLink,\n    canSelect,\n    canDownload,\n    canSaveGif,\n    canRevote,\n    canClosePoll,\n  };\n}\n\n// This selector always returns a new object which can not be safely used in shallow-equal checks\nexport function selectCanDeleteSelectedMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const chatMessages = chatId && selectChatMessages(global, chatId);\n  if (!chatMessages || !selectedMessageIds || !threadId) {\n    return {};\n  }\n\n  if (selectedMessageIds.length > API_GENERAL_ID_LIMIT) return {};\n\n  const messageActions = selectedMessageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return {\n    canDelete: messageActions.every((actions) => actions.canDelete),\n    canDeleteForAll: messageActions.every((actions) => actions.canDeleteForAll),\n  };\n}\n\nexport function selectCanReportSelectedMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const chatMessages = chatId && selectChatMessages(global, chatId);\n  if (!chatMessages || !selectedMessageIds || !threadId) {\n    return false;\n  }\n\n  const messageActions = selectedMessageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return messageActions.every((actions) => actions.canReport);\n}\n\nexport function selectCanDownloadSelectedMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const chatMessages = chatId && selectChatMessages(global, chatId);\n  if (!chatMessages || !selectedMessageIds || !threadId) {\n    return false;\n  }\n\n  const messageActions = selectedMessageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return messageActions.some((actions) => actions.canDownload);\n}\n\nexport function selectActiveDownloads<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).activeDownloads;\n}\n\nexport function selectUploadProgress<T extends GlobalState>(global: T, message: ApiMessage) {\n  return global.fileUploads.byMessageKey[getMessageKey(message)]?.progress;\n}\n\nexport function selectRealLastReadId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  if (threadId === MAIN_THREAD_ID) {\n    const chat = selectChat(global, chatId);\n    if (!chat) {\n      return undefined;\n    }\n\n    // `lastReadInboxMessageId` is empty for new chats\n    if (!chat.lastReadInboxMessageId) {\n      return undefined;\n    }\n\n    const lastMessageId = selectChatLastMessageId(global, chatId);\n\n    if (!lastMessageId || chat.unreadCount) {\n      return chat.lastReadInboxMessageId;\n    }\n\n    return lastMessageId;\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo) {\n      return undefined;\n    }\n\n    if (!threadInfo.lastReadInboxMessageId) {\n      return Number(threadInfo.threadId);\n    }\n\n    // Some previously read messages may be deleted\n    return Math.min(threadInfo.lastReadInboxMessageId, threadInfo.lastMessageId || Infinity);\n  }\n}\n\nexport function selectFirstUnreadId<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n) {\n  const chat = selectChat(global, chatId);\n\n  if (threadId === MAIN_THREAD_ID) {\n    if (!chat) {\n      return undefined;\n    }\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo\n      || (threadInfo.lastMessageId !== undefined && threadInfo.lastMessageId === threadInfo.lastReadInboxMessageId)) {\n      return undefined;\n    }\n  }\n\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  const listedIds = selectListedIds(global, chatId, threadId);\n  const byId = selectChatMessages(global, chatId);\n  if (!byId || !(outlyingLists?.length || listedIds)) {\n    return undefined;\n  }\n\n  const lastReadId = selectRealLastReadId(global, chatId, threadId);\n  if (!lastReadId && chat && chat.isNotJoined) {\n    return undefined;\n  }\n\n  const lastReadServiceNotificationId = chatId === SERVICE_NOTIFICATIONS_USER_ID\n    ? global.serviceNotifications.reduce((max, notification) => {\n      return !notification.isUnread && notification.id > max ? notification.id : max;\n    }, -1)\n    : -1;\n\n  function findAfterLastReadId(listIds: number[]) {\n    return listIds.find((id) => {\n      return (\n        (!lastReadId || id > lastReadId)\n        && byId[id]\n        // For some reason outgoing topic actions are not marked as read, thus we need to mark them as read\n        // when the edit message hits the viewport\n        && ((!byId[id].isOutgoing || byId[id].content.action?.isTopicAction) || byId[id].isFromScheduled)\n        && id > lastReadServiceNotificationId\n      );\n    });\n  }\n\n  if (outlyingLists?.length) {\n    const found = outlyingLists.map((list) => findAfterLastReadId(list)).filter(Boolean)[0];\n    if (found) {\n      return found;\n    }\n  }\n\n  if (listedIds) {\n    const found = findAfterLastReadId(listedIds);\n    if (found) {\n      return found;\n    }\n  }\n\n  return undefined;\n}\n\nexport function selectIsForwardModalOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { isShareMessageModalShown } = selectTabState(global, tabId);\n  return Boolean(isShareMessageModalShown);\n}\n\nexport function selectCommonBoxChatId<T extends GlobalState>(global: T, messageId: number) {\n  const fromLastMessage = Object.values(global.chats.byId).find((chat) => (\n    isCommonBoxChat(chat) && selectChatLastMessageId(global, chat.id) === messageId\n  ));\n  if (fromLastMessage) {\n    return fromLastMessage.id;\n  }\n\n  const { byChatId } = global.messages;\n  return Object.keys(byChatId).find((chatId) => {\n    const chat = selectChat(global, chatId);\n    return chat && isCommonBoxChat(chat) && byChatId[chat.id].byId[messageId];\n  });\n}\n\nexport function selectIsInSelectMode<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { selectedMessages } = selectTabState(global, tabId);\n\n  return Boolean(selectedMessages);\n}\n\nexport function selectIsMessageSelected<T extends GlobalState>(\n  global: T, messageId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds } = selectTabState(global, tabId).selectedMessages || {};\n  if (!messageIds) {\n    return false;\n  }\n\n  return messageIds.includes(messageId);\n}\n\nexport function selectForwardedMessageIdsByGroupId<T extends GlobalState>(\n  global: T, chatId: string, groupedId: string,\n) {\n  const chatMessages = selectChatMessages(global, chatId);\n  if (!chatMessages) {\n    return undefined;\n  }\n\n  return Object.values(chatMessages)\n    .filter((message) => message.groupedId === groupedId && message.forwardInfo)\n    .map(({ forwardInfo }) => forwardInfo!.fromMessageId);\n}\n\nexport function selectMessageIdsByGroupId<T extends GlobalState>(global: T, chatId: string, groupedId: string) {\n  const chatMessages = selectChatMessages(global, chatId);\n  if (!chatMessages) {\n    return undefined;\n  }\n\n  return Object.keys(chatMessages)\n    .map(Number)\n    .filter((id) => chatMessages[id].groupedId === groupedId);\n}\n\nexport function selectIsDocumentGroupSelected<T extends GlobalState>(\n  global: T, chatId: string, groupedId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedIds } = selectTabState(global, tabId).selectedMessages || {};\n  if (!selectedIds) {\n    return false;\n  }\n\n  const groupIds = selectMessageIdsByGroupId(global, chatId, groupedId);\n  return groupIds && groupIds.every((id) => selectedIds.includes(id));\n}\n\nexport function selectSelectedMessagesCount<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds } = selectTabState(global, tabId).selectedMessages || {};\n\n  return messageIds ? messageIds.length : 0;\n}\n\nexport function selectNewestMessageWithBotKeyboardButtons<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId = MAIN_THREAD_ID,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): ApiMessage | undefined {\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  const chatMessages = selectChatMessages(global, chatId);\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n  if (!chatMessages || !viewportIds) {\n    return undefined;\n  }\n\n  const messageId = findLast(viewportIds, (id) => {\n    const message = chatMessages[id];\n    return message && selectShouldDisplayReplyKeyboard(global, message);\n  });\n\n  const replyHideMessageId = findLast(viewportIds, (id) => {\n    const message = chatMessages[id];\n    return message && selectShouldHideReplyKeyboard(global, message);\n  });\n\n  if (messageId && replyHideMessageId && replyHideMessageId > messageId) {\n    return undefined;\n  }\n\n  return messageId ? chatMessages[messageId] : undefined;\n}\n\nfunction selectShouldHideReplyKeyboard<T extends GlobalState>(global: T, message: ApiMessage) {\n  const {\n    shouldHideKeyboardButtons,\n    isHideKeyboardSelective,\n    isMentioned,\n  } = message;\n  if (!shouldHideKeyboardButtons) return false;\n\n  const replyToMessageId = getMessageReplyInfo(message)?.replyToMsgId;\n\n  if (isHideKeyboardSelective) {\n    if (isMentioned) return true;\n    if (!replyToMessageId) return false;\n\n    const replyMessage = selectChatMessage(global, message.chatId, replyToMessageId);\n    return Boolean(replyMessage?.senderId === global.currentUserId);\n  }\n  return true;\n}\n\nfunction selectShouldDisplayReplyKeyboard<T extends GlobalState>(global: T, message: ApiMessage) {\n  const {\n    keyboardButtons,\n    shouldHideKeyboardButtons,\n    isKeyboardSelective,\n    isMentioned,\n  } = message;\n  if (!keyboardButtons || shouldHideKeyboardButtons) return false;\n\n  const replyToMessageId = getMessageReplyInfo(message)?.replyToMsgId;\n\n  if (isKeyboardSelective) {\n    if (isMentioned) return true;\n    if (!replyToMessageId) return false;\n\n    const replyMessage = selectChatMessage(global, message.chatId, replyToMessageId);\n    return Boolean(replyMessage?.senderId === global.currentUserId);\n  }\n\n  return true;\n}\n\nexport function selectCanAutoLoadMedia<T extends GlobalState>(\n  global: T, message: ApiMessage | ApiSponsoredMessage,\n) {\n  const chat = selectChat(global, message.chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  const sender = 'id' in message ? selectSender(global, message) : undefined;\n\n  const isPhoto = Boolean(getMessagePhoto(message) || getMessageWebPagePhoto(message));\n  const isVideo = Boolean(getMessageVideo(message) || getMessageWebPageVideo(message));\n  const isFile = Boolean(getMessageAudio(message) || getMessageVoice(message) || getMessageDocument(message));\n\n  const {\n    canAutoLoadPhotoFromContacts,\n    canAutoLoadPhotoInPrivateChats,\n    canAutoLoadPhotoInGroups,\n    canAutoLoadPhotoInChannels,\n    canAutoLoadVideoFromContacts,\n    canAutoLoadVideoInPrivateChats,\n    canAutoLoadVideoInGroups,\n    canAutoLoadVideoInChannels,\n    canAutoLoadFileFromContacts,\n    canAutoLoadFileInPrivateChats,\n    canAutoLoadFileInGroups,\n    canAutoLoadFileInChannels,\n  } = global.settings.byKey;\n\n  if (isPhoto) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadPhotoFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadPhotoInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadPhotoInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadPhotoInChannels,\n    });\n  }\n\n  if (isVideo) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadVideoFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadVideoInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadVideoInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadVideoInChannels,\n    });\n  }\n\n  if (isFile) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadFileFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadFileInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadFileInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadFileInChannels,\n    });\n  }\n\n  return true;\n}\n\nfunction canAutoLoadMedia<T extends GlobalState>({\n  global,\n  chat,\n  sender,\n  canAutoLoadMediaFromContacts,\n  canAutoLoadMediaInPrivateChats,\n  canAutoLoadMediaInGroups,\n  canAutoLoadMediaInChannels,\n}: {\n  global: T;\n  chat: ApiChat;\n  canAutoLoadMediaFromContacts: boolean;\n  canAutoLoadMediaInPrivateChats: boolean;\n  canAutoLoadMediaInGroups: boolean;\n  canAutoLoadMediaInChannels: boolean;\n  sender?: ApiPeer;\n}) {\n  const isMediaFromContact = Boolean(sender && (\n    selectIsChatWithSelf(global, sender.id) || selectUser(global, sender.id)?.isContact\n  ));\n\n  return Boolean(\n    (isMediaFromContact && canAutoLoadMediaFromContacts)\n    || (!isMediaFromContact && canAutoLoadMediaInPrivateChats && isUserId(chat.id))\n    || (canAutoLoadMediaInGroups && isChatGroup(chat))\n    || (canAutoLoadMediaInChannels && isChatChannel(chat)),\n  );\n}\n\nexport function selectLastServiceNotification<T extends GlobalState>(global: T) {\n  const { serviceNotifications } = global;\n  const maxId = Math.max(...serviceNotifications.map(({ id }) => id));\n\n  return serviceNotifications.find(({ id, isDeleted }) => !isDeleted && id === maxId);\n}\n\nexport function selectIsMessageProtected<T extends GlobalState>(global: T, message?: ApiMessage) {\n  return Boolean(message && (\n    message.isProtected || selectIsChatProtected(global, message.chatId) || hasMessageTtl(message)\n    || getMessagePaidMedia(message)\n  ));\n}\n\nexport function selectIsChatProtected<T extends GlobalState>(global: T, chatId: string) {\n  return selectChat(global, chatId)?.isProtected || false;\n}\n\nexport function selectHasProtectedMessage<T extends GlobalState>(global: T, chatId: string, messageIds?: number[]) {\n  if (selectChat(global, chatId)?.isProtected) {\n    return true;\n  }\n\n  if (!messageIds) {\n    return false;\n  }\n\n  const messages = selectChatMessages(global, chatId);\n\n  return messageIds.some((messageId) => messages[messageId]?.isProtected);\n}\n\nexport function selectCanForwardMessages<T extends GlobalState>(global: T, chatId: string, messageIds?: number[]) {\n  if (selectChat(global, chatId)?.isProtected) {\n    return false;\n  }\n\n  if (!messageIds) {\n    return false;\n  }\n\n  const messages = selectChatMessages(global, chatId);\n\n  return messageIds\n    .map((id) => messages[id])\n    .every((message) => message && !hasMessageTtl(message)\n      && (message.isForwardingAllowed || isServiceNotificationMessage(message)));\n}\n\nexport function selectSponsoredMessage<T extends GlobalState>(global: T, chatId: string) {\n  const message = global.messages.sponsoredByChatId[chatId];\n\n  return message && message.expiresAt >= Math.round(Date.now() / 1000) ? message : undefined;\n}\n\nexport function selectDefaultReaction<T extends GlobalState>(global: T, chatId: string) {\n  if (chatId === SERVICE_NOTIFICATIONS_USER_ID) return undefined;\n\n  const isPrivate = isUserId(chatId);\n  const defaultReaction = global.config?.defaultReaction;\n  if (!defaultReaction) {\n    return undefined;\n  }\n\n  if (isPrivate) {\n    return defaultReaction;\n  }\n\n  const chatReactions = selectChatFullInfo(global, chatId)?.enabledReactions;\n  if (!chatReactions || !canSendReaction(defaultReaction, chatReactions)) {\n    return undefined;\n  }\n\n  return defaultReaction;\n}\n\nexport function selectMaxUserReactions<T extends GlobalState>(global: T): number {\n  const isPremium = selectIsCurrentUserPremium(global);\n  const { maxUserReactionsPremium = 3, maxUserReactionsDefault = 1 } = global.appConfig || {};\n  return isPremium ? maxUserReactionsPremium : maxUserReactionsDefault;\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectVisibleUsers<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const messageIds = selectTabThreadParam(global, chatId, threadId, 'viewportIds', tabId);\n  if (!messageIds) {\n    return undefined;\n  }\n\n  return messageIds.map((messageId) => {\n    const { senderId } = selectChatMessage(global, chatId, messageId) || {};\n    return senderId ? selectUser(global, senderId) : undefined;\n  }).filter(Boolean);\n}\n\nexport function selectShouldSchedule<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectCurrentMessageList(global, tabId)?.type === 'scheduled';\n}\n\nexport function selectCanScheduleUntilOnline<T extends GlobalState>(global: T, id: string) {\n  const isChatWithSelf = selectIsChatWithSelf(global, id);\n  const chatBot = selectBot(global, id);\n  return Boolean(\n    !isChatWithSelf && !chatBot && isUserId(id) && selectUserStatus(global, id)?.wasOnline,\n  );\n}\n\nexport function selectCustomEmojis(message: ApiMessage) {\n  const entities = message.content.text?.entities;\n  return entities?.filter((entity): entity is ApiMessageEntityCustomEmoji => (\n    entity.type === ApiMessageEntityTypes.CustomEmoji\n  ));\n}\n\nexport function selectMessageCustomEmojiSets<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): ApiStickerSetInfo[] | undefined {\n  const customEmojis = selectCustomEmojis(message);\n  if (!customEmojis) return MEMO_EMPTY_ARRAY;\n  const documents = customEmojis.map((entity) => global.customEmojis.byId[entity.documentId]);\n  // If some emoji still loading, do not return empty array\n  if (!documents.every(Boolean)) return undefined;\n  const sets = documents.map((doc) => doc.stickerSetInfo);\n\n  return sets.reduce((acc, set) => {\n    if ('shortName' in set) {\n      if (acc.some((s) => 'shortName' in s && s.shortName === set.shortName)) {\n        return acc;\n      }\n    }\n\n    if ('id' in set) {\n      if (acc.some((s) => 'id' in s && s.id === set.id)) {\n        return acc;\n      }\n    }\n    acc.push(set); // Optimization\n    return acc;\n  }, [] as ApiStickerSetInfo[]);\n}\n\nexport function selectForwardsContainVoiceMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds, fromChatId } = selectTabState(global, tabId).forwardMessages;\n  if (!messageIds) return false;\n  const chatMessages = selectChatMessages(global, fromChatId!);\n  return messageIds.some((messageId) => {\n    const message = chatMessages[messageId];\n    return Boolean(message.content.voice) || Boolean(message.content.video?.isRound);\n  });\n}\n\nexport function selectChatTranslations<T extends GlobalState>(\n  global: T, chatId: string,\n): ChatTranslatedMessages {\n  return global.translations.byChatId[chatId];\n}\n\nexport function selectMessageTranslations<T extends GlobalState>(\n  global: T, chatId: string, toLanguageCode: string,\n) {\n  return selectChatTranslations(global, chatId)?.byLangCode[toLanguageCode] || {};\n}\n\nexport function selectRequestedMessageTranslationLanguage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): string | undefined {\n  const requestedInChat = selectTabState(global, tabId).requestedTranslations.byChatId[chatId];\n  return requestedInChat?.toLanguage || requestedInChat?.manualMessages?.[messageId];\n}\nexport function selectReplyCanBeSentToChat<T extends GlobalState>(\n  global: T,\n  toChatId: string,\n  fromChatId: string,\n  replyInfo: ApiInputMessageReplyInfo,\n) {\n  if (!replyInfo.replyToMsgId) return false;\n  const fromRealChatId = replyInfo?.replyToPeerId ?? fromChatId;\n  if (toChatId === fromRealChatId) return true;\n  const chatMessages = selectChatMessages(global, fromRealChatId!);\n  const message = chatMessages[replyInfo.replyToMsgId];\n\n  return !isExpiredMessage(message);\n}\nexport function selectForwardsCanBeSentToChat<T extends GlobalState>(\n  global: T,\n  toChatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds, storyId, fromChatId } = selectTabState(global, tabId).forwardMessages;\n  const chat = selectChat(global, toChatId);\n  if ((!messageIds && !storyId) || !chat) return false;\n\n  if (storyId) {\n    return true;\n  }\n\n  const chatFullInfo = selectChatFullInfo(global, toChatId);\n  const chatMessages = selectChatMessages(global, fromChatId!);\n  const options = getAllowedAttachmentOptions(chat, chatFullInfo);\n  return !messageIds!.some((messageId) => сheckMessageSendingDenied(chatMessages[messageId], options));\n}\nfunction сheckMessageSendingDenied(message: ApiMessage, options: IAllowedAttachmentOptions) {\n  const isVoice = message.content.voice;\n  const isRoundVideo = message.content.video?.isRound;\n  const isPhoto = message.content.photo;\n  const isGif = message.content.video?.isGif;\n  const isVideo = message.content.video && !isRoundVideo && !isGif;\n  const isAudio = message.content.audio;\n  const isDocument = message.content.document;\n  const isSticker = message.content.sticker;\n  const isPlainText = message.content.text\n    && !isVoice && !isRoundVideo && !isSticker && !isDocument && !isAudio && !isVideo && !isPhoto && !isGif;\n\n  return (isVoice && !options.canSendVoices)\n    || (isRoundVideo && !options.canSendRoundVideos)\n    || (isSticker && !options.canSendStickers)\n    || (isDocument && !options.canSendDocuments)\n    || (isAudio && !options.canSendAudios)\n    || (isVideo && !options.canSendVideos)\n    || (isPhoto && !options.canSendPhotos)\n    || (isGif && !options.canSendGifs)\n    || (isPlainText && !options.canSendPlainText);\n}\n\nexport function selectCanTranslateMessage<T extends GlobalState>(\n  global: T, message: ApiMessage, detectedLanguage?: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { canTranslate: isTranslationEnabled, doNotTranslate } = global.settings.byKey;\n\n  const canTranslateLanguage = !detectedLanguage || !doNotTranslate.includes(detectedLanguage);\n\n  const isTranslatable = isMessageTranslatable(message);\n\n  // Separate translations are disabled when chat translation enabled\n  const chatRequestedLanguage = selectRequestedChatTranslationLanguage(global, message.chatId, tabId);\n\n  return IS_TRANSLATION_SUPPORTED && isTranslationEnabled && canTranslateLanguage && isTranslatable\n    && !chatRequestedLanguage;\n}\n\nexport function selectTopicLink<T extends GlobalState>(\n  global: T, chatId: string, topicId?: ThreadId,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat || !chat?.isForum) {\n    return undefined;\n  }\n\n  return getMessageLink(chat, topicId);\n}\n\nexport function selectMessageReplyInfo<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, additionalReplyInfo?: ApiInputMessageReplyInfo,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n  const isMainThread = threadId === MAIN_THREAD_ID;\n  if (!additionalReplyInfo && isMainThread) return undefined;\n\n  const replyInfo: ApiInputMessageReplyInfo = {\n    type: 'message',\n    ...additionalReplyInfo,\n    replyToMsgId: additionalReplyInfo?.replyToMsgId || Number(threadId),\n    replyToTopId: additionalReplyInfo?.replyToTopId || (!isMainThread ? Number(threadId) : undefined),\n  };\n\n  return replyInfo;\n}\n","import type { ThreadId } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { buildChatThreadKey } from '../helpers/middleSearch';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentMiddleSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectCurrentSharedMediaSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectCurrentChatMediaSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectChatMediaSearch<T extends GlobalState>(\n  global: T, chatId?: string, threadId?: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n}\n","import type { ApiPeer } from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { SERVICE_NOTIFICATIONS_USER_ID } from '../../config';\nimport { selectChat, selectChatFullInfo } from './chats';\nimport { selectBot, selectIsPremiumPurchaseBlocked, selectUser } from './users';\n\nexport function selectPeer<T extends GlobalState>(global: T, peerId: string): ApiPeer | undefined {\n  return selectUser(global, peerId) || selectChat(global, peerId);\n}\n\nexport function selectPeerPhotos<T extends GlobalState>(global: T, peerId: string) {\n  return global.peers.profilePhotosById[peerId];\n}\n\nexport function selectCanGift<T extends GlobalState>(global: T, peerId: string) {\n  const bot = selectBot(global, peerId);\n  const user = selectUser(global, peerId);\n\n  const areStarGiftsAvailable = selectChatFullInfo(global, peerId)?.areStarGiftsAvailable || user;\n\n  return Boolean(!selectIsPremiumPurchaseBlocked(global) && !bot && peerId !== SERVICE_NOTIFICATIONS_USER_ID\n    && areStarGiftsAvailable);\n}\n","import type { ApiPeerStories, ApiTypeStory } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectPeer } from './peers';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentViewedStory<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { storyViewer: { peerId, storyId } } = selectTabState(global, tabId);\n\n  return { peerId, storyId };\n}\n\nexport function selectIsStoryViewerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { peerId, storyId } = selectCurrentViewedStory(global, tabId);\n\n  return Boolean(peerId) && Boolean(storyId);\n}\n\nexport function selectPeerStories<T extends GlobalState>(\n  global: T, peerId: string,\n): ApiPeerStories | undefined {\n  return global.stories.byPeerId[peerId];\n}\n\nexport function selectPeerStory<T extends GlobalState>(\n  global: T, peerId: string, storyId: number,\n): ApiTypeStory | undefined {\n  return selectPeerStories(global, peerId)?.byId[storyId];\n}\n\nexport function selectPinnedStories<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const stories = selectPeerStories(global, peerId);\n  if (!stories?.pinnedIds?.length) return undefined;\n  return stories.pinnedIds.map((id) => stories.byId[id]).filter((s) => (\n    s && 'isInProfile' in s && s.isInProfile\n  ));\n}\n\nexport function selectPeerFirstUnreadStoryId<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const peerStories = selectPeerStories(global, peerId);\n  if (!peerStories) {\n    return undefined;\n  }\n\n  if (!peerStories.lastReadId) {\n    return peerStories.orderedIds?.[0];\n  }\n\n  const lastReadIndex = peerStories.orderedIds.findIndex((id) => id === peerStories.lastReadId);\n\n  return peerStories.orderedIds?.[lastReadIndex + 1];\n}\n\nexport function selectPeerFirstStoryId<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  return selectPeerStories(global, peerId)?.orderedIds?.[0];\n}\n\nexport function selectStoryListForViewer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId?: number,\n  isSingleStory?: boolean,\n  isSinglePeer?: boolean,\n  isPrivate?: boolean,\n  isArchive?: boolean,\n): {\n    peerIds: string[];\n    storyIdsByPeerId: Record<string, number[]>;\n  } | undefined {\n  const currentStoryId = storyId\n    || selectPeerFirstUnreadStoryId(global, peerId)\n    || selectPeerFirstStoryId(global, peerId);\n  if (!currentStoryId) {\n    return undefined;\n  }\n\n  if (isSingleStory) {\n    return {\n      peerIds: [peerId],\n      storyIdsByPeerId: { [peerId]: [currentStoryId] },\n    };\n  }\n\n  const peer = selectPeer(global, peerId);\n  const story = selectPeerStory(global, peerId, currentStoryId);\n  if (!peer || !story) {\n    return undefined;\n  }\n\n  const isUnread = (global.stories.byPeerId[peerId].lastReadId || 0) < story.id;\n\n  if (isSinglePeer) {\n    const storyIds = getPeerStoryIdsForViewer(global, peerId, isUnread, isArchive, isPrivate);\n\n    return storyIds?.length\n      ? { peerIds: [peerId], storyIdsByPeerId: { [peerId]: storyIds } }\n      : undefined;\n  }\n\n  const { orderedPeerIds: { active, archived } } = global.stories;\n  const orderedPeerIds = (peer.areStoriesHidden ? archived : active) ?? [];\n  const peerIds: string[] = [];\n  const storyIdsByPeerId: Record<string, number[]> = {};\n\n  for (const currentPeerId of orderedPeerIds) {\n    const storyIds = getPeerStoryIdsForViewer(global, currentPeerId, isUnread, isArchive, isPrivate);\n    if (storyIds?.length) {\n      peerIds.push(currentPeerId);\n      storyIdsByPeerId[currentPeerId] = storyIds;\n    }\n  }\n\n  return peerIds.length ? { peerIds, storyIdsByPeerId } : undefined;\n}\n\nfunction getPeerStoryIdsForViewer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isUnread?: boolean,\n  isArchive?: boolean,\n  isPrivate?: boolean,\n): number[] | undefined {\n  const peerStories = selectPeerStories(global, peerId);\n  const storySourceProp = isArchive ? 'archiveIds' : isPrivate ? 'profileIds' : 'orderedIds';\n  const storyIds = peerStories?.[storySourceProp];\n\n  if (!peerStories || !storyIds?.length) {\n    return undefined;\n  }\n\n  if (!peerStories.lastReadId || !isUnread) {\n    return storyIds.slice();\n  }\n\n  const lastReadIndex = storyIds.indexOf(peerStories.lastReadId);\n  return (storyIds.length > lastReadIndex + 1)\n    ? storyIds.slice(lastReadIndex + 1)\n    : undefined;\n}\n","import type { ApiSticker, ApiStickerSet, ApiStickerSetInfo } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { RESTRICTED_EMOJI_SET_ID } from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from './tabs';\nimport { selectIsCurrentUserPremium } from './users';\n\n// https://github.com/DrKLO/Telegram/blob/c319639e9a4dff2f22da6762dcebd12d49f5afa1/TMessagesProj/src/main/java/org/telegram/ui/Components/Premium/boosts/cells/msg/GiveawayMessageCell.java#L59\nconst MONTH_EMOTICON: Record<number, string> = {\n  1: `${1}\\u{FE0F}\\u20E3`,\n  3: `${2}\\u{FE0F}\\u20E3`,\n  6: `${3}\\u{FE0F}\\u20E3`,\n  12: `${4}\\u{FE0F}\\u20E3`,\n  24: `${5}\\u{FE0F}\\u20E3`,\n};\n\nconst STAR_EMOTICON: Record<number, string> = {\n  1000: `${2}\\u{FE0F}\\u20E3`,\n  2500: `${3}\\u{FE0F}\\u20E3`,\n  5000: `${4}\\u{FE0F}\\u20E3`,\n};\n\nexport function selectIsStickerFavorite<T extends GlobalState>(global: T, sticker: ApiSticker) {\n  const { stickers } = global.stickers.favorite;\n  return stickers && stickers.some(({ id }) => id === sticker.id);\n}\n\nexport function selectCurrentStickerSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).stickerSearch;\n}\n\nexport function selectCurrentGifSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).gifSearch;\n}\n\nexport function selectStickerSet<T extends GlobalState>(global: T, id: string | ApiStickerSetInfo) {\n  if (typeof id === 'string') {\n    return global.stickers.setsById[id];\n  }\n\n  if ('id' in id) {\n    return global.stickers.setsById[id.id];\n  }\n\n  if ('isMissing' in id) return undefined;\n\n  return Object.values(global.stickers.setsById).find(({ shortName }) => (\n    shortName.toLowerCase() === id.shortName.toLowerCase()\n  ));\n}\n\nexport function selectStickersForEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const addedSets = global.stickers.added.setIds;\n  let stickersForEmoji: ApiSticker[] = [];\n  // Favorites\n  global.stickers.favorite.stickers.forEach((sticker) => {\n    if (sticker.emoji === emoji) stickersForEmoji.push(sticker);\n  });\n\n  // Added sets\n  addedSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n\n    stickersForEmoji = stickersForEmoji.concat(packs[emoji] || [], packs[cleanEmoji(emoji)] || []);\n  });\n  return stickersForEmoji;\n}\n\nexport function selectCustomEmojiForEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const isCurrentUserPremium = selectIsCurrentUserPremium(global);\n  const addedCustomSets = global.customEmojis.added.setIds;\n  let customEmojiForEmoji: ApiSticker[] = [];\n\n  // Added sets\n  addedCustomSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n\n    customEmojiForEmoji = customEmojiForEmoji.concat(packs[emoji] || [], packs[cleanEmoji(emoji)] || []);\n  });\n  return isCurrentUserPremium ? customEmojiForEmoji : customEmojiForEmoji.filter(({ isFree }) => isFree);\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectCustomEmojiForEmojis<T extends GlobalState>(global: T, emojis: string[]) {\n  const isCurrentUserPremium = selectIsCurrentUserPremium(global);\n  const addedCustomSets = global.customEmojis.added.setIds;\n  let customEmojiForEmoji: ApiSticker[] = [];\n\n  // Added sets\n  addedCustomSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n    const customEmojis = Object.entries(packs).filter(([emoji]) => (\n      emojis.includes(emoji) || emojis.includes(cleanEmoji(emoji))\n    )).flatMap(([, stickers]) => stickers);\n    customEmojiForEmoji = customEmojiForEmoji.concat(customEmojis);\n  });\n  return isCurrentUserPremium ? customEmojiForEmoji : customEmojiForEmoji.filter(({ isFree }) => isFree);\n}\n\nexport function selectIsSetPremium(stickerSet: Pick<ApiStickerSet, 'stickers' | 'isEmoji'>) {\n  return stickerSet.isEmoji && stickerSet.stickers?.some((sticker) => !sticker.isFree);\n}\n\nfunction cleanEmoji(emoji: string) {\n  // Some emojis (❤️ for example) with a service symbol 'VARIATION SELECTOR-16' are not recognized as animated\n  return emoji.replace('\\ufe0f', '');\n}\n\nexport function selectAnimatedEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const { animatedEmojis } = global;\n  if (!animatedEmojis || !animatedEmojis.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return animatedEmojis.stickers.find((sticker) => sticker.emoji === emoji || sticker.emoji === cleanedEmoji);\n}\n\nexport function selectRestrictedEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const { restrictedEmoji } = global;\n  if (!restrictedEmoji || !restrictedEmoji.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return restrictedEmoji.stickers.find((sticker) => {\n    if (!sticker.emoji) return undefined;\n    const cleanedStickerEmoji = cleanEmoji(sticker.emoji);\n    return cleanedStickerEmoji === cleanedEmoji;\n  });\n}\n\nexport function selectAnimatedEmojiEffect<T extends GlobalState>(global: T, emoji: string) {\n  const { animatedEmojiEffects } = global;\n  if (!animatedEmojiEffects || !animatedEmojiEffects.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return animatedEmojiEffects.stickers.find((sticker) => sticker.emoji === emoji || sticker.emoji === cleanedEmoji);\n}\n\nexport function selectAnimatedEmojiSound<T extends GlobalState>(global: T, emoji: string) {\n  return global?.appConfig?.emojiSounds[cleanEmoji(emoji)];\n}\n\nexport function selectIsAlwaysHighPriorityEmoji<T extends GlobalState>(\n  global: T, stickerSet: ApiStickerSetInfo | ApiStickerSet,\n) {\n  if (!('id' in stickerSet)) return false;\n  return stickerSet.id === global.appConfig?.defaultEmojiStatusesStickerSetId\n    || stickerSet.id === RESTRICTED_EMOJI_SET_ID;\n}\n\nexport function selectGiftStickerForDuration<T extends GlobalState>(global: T, duration = 1) {\n  const stickers = global.premiumGifts?.stickers;\n  if (!stickers) return undefined;\n  const emoji = MONTH_EMOTICON[duration];\n  return stickers.find((sticker) => sticker.emoji === emoji) || stickers[0];\n}\n\nexport function selectGiftStickerForStars<T extends GlobalState>(global: T, starCount?: number) {\n  const stickers = global.premiumGifts?.stickers;\n\n  if (!stickers || !starCount) return undefined;\n\n  let emoji;\n  if (starCount <= 1000) {\n    emoji = STAR_EMOTICON[1000];\n  } else if (starCount < 2500) {\n    emoji = STAR_EMOTICON[2500];\n  } else {\n    emoji = STAR_EMOTICON[5000];\n  }\n\n  return stickers.find((sticker) => sticker.emoji === emoji) || stickers[0];\n}\n","import type {\n  GlobalState, TabArgs,\n  TabState,\n} from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\n\nexport function selectTabState<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): TabState {\n  return global.byTabId[tabId];\n}\n","import type { ThreadId, TopicsInfo } from '../../types';\nimport type { GlobalState } from '../types';\n\nexport function selectTopicsInfo<T extends GlobalState>(global: T, chatId: string): TopicsInfo | undefined {\n  return global.chats.topicsInfoById[chatId];\n}\n\nexport function selectTopics<T extends GlobalState>(global: T, chatId: string) {\n  return selectTopicsInfo(global, chatId)?.topicsById;\n}\n\nexport function selectTopic<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectTopicsInfo(global, chatId)?.topicsById?.[threadId];\n}\n","import type {\n  ApiUser, ApiUserCommonChats,\n  ApiUserFullInfo, ApiUserStatus,\n} from '../../api/types';\nimport type { BotAppPermissions } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { isUserBot } from '../helpers';\nimport { Contest } from '../../contest/contest';\n\nexport function selectUser<T extends GlobalState>(global: T, userId: string): ApiUser | undefined {\n  return global.users.byId[userId];\n}\n\nexport function selectUserStatus<T extends GlobalState>(global: T, userId: string): ApiUserStatus | undefined {\n  return global.users.statusesById[userId];\n}\n\nexport function selectUserFullInfo<T extends GlobalState>(global: T, userId: string): ApiUserFullInfo | undefined {\n  return global.users.fullInfoById[userId];\n}\n\nexport function selectUserCommonChats<T extends GlobalState>(\n  global: T, userId: string,\n): ApiUserCommonChats | undefined {\n  return global.users.commonChatsById[userId];\n}\n\nexport function selectIsUserBlocked<T extends GlobalState>(global: T, userId: string) {\n  return selectUserFullInfo(global, userId)?.isBlocked;\n}\n\nexport function selectIsCurrentUserPremium<T extends GlobalState>(global: T) {\n  // ! FOR TEST\n  if (Contest.isTestMode()) return Contest.Test().isTestUserPremium();\n  if (!global.currentUserId) return false;\n\n  return Boolean(global.users.byId[global.currentUserId].isPremium);\n}\n\nexport function selectIsPremiumPurchaseBlocked<T extends GlobalState>(global: T) {\n  return global.appConfig?.isPremiumPurchaseBlocked ?? true;\n}\n\nexport function selectIsGiveawayGiftsPurchaseAvailable<T extends GlobalState>(global: T) {\n  return global.appConfig?.isGiveawayGiftsPurchaseAvailable ?? true;\n}\n\n/**\n * Slow, not to be used in `withGlobal`\n */\nexport function selectUserByPhoneNumber<T extends GlobalState>(global: T, phoneNumber: string) {\n  const phoneNumberCleaned = phoneNumber.replace(/[^0-9]/g, '');\n\n  return Object.values(global.users.byId).find((user) => user?.phoneNumber === phoneNumberCleaned);\n}\n\nexport function selectBot<T extends GlobalState>(global: T, userId: string): ApiUser | undefined {\n  const user = selectUser(global, userId);\n  if (!user || !isUserBot(user)) {\n    return undefined;\n  }\n\n  return user;\n}\n\nexport function selectBotAppPermissions<T extends GlobalState>(\n  global: T, userId: string,\n): BotAppPermissions | undefined {\n  return global.users.botAppPermissionsById[userId];\n}\n","import type { GlobalState } from '../../global/types';\n\nimport useDerivedState from '../useDerivedState';\nimport useSelectorSignal from './useSelectorSignal';\n\ntype Selector<T extends unknown> = (global: GlobalState) => T;\n\nexport default function useSelector<T extends unknown>(selector: Selector<T>) {\n  const selectorSignal = useSelectorSignal(selector);\n  return useDerivedState(selectorSignal);\n}\n","import { addCallback } from '../../lib/teact/teactn';\nimport { getGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\nimport type { Signal, SignalSetter } from '../../util/signals';\n\nimport { createSignal } from '../../util/signals';\nimport useSyncEffect from '../useSyncEffect';\n\n/*\n  This hook is a more performant variation of the standard React `useSelector` hook. It allows to:\n  a) Avoid multiple subscriptions to global updates by leveraging a single selector reference.\n  b) Return a signal instead of forcing a component update right away.\n */\n\ntype Selector<T extends unknown> = (global: GlobalState) => T;\n\ninterface State<T extends unknown> {\n  clientsCount: number;\n  getter: Signal<T>;\n  setter: SignalSetter;\n}\n\nconst bySelector = new Map<Selector<unknown>, State<unknown>>();\n\naddCallback((global: GlobalState) => {\n  for (const [selector, { setter }] of bySelector) {\n    setter(selector(global));\n  }\n});\n\nfunction useSelectorSignal<T extends unknown>(selector: Selector<T>): Signal<T> {\n  let state = bySelector.get(selector);\n  if (!state) {\n    const [getter, setter] = createSignal(selector(getGlobal()));\n    state = { clientsCount: 0, getter, setter };\n    bySelector.set(selector, state);\n  }\n\n  useSyncEffect(() => {\n    const state2 = bySelector.get(selector)!;\n\n    state2.clientsCount++;\n\n    return () => {\n      state2.clientsCount--;\n\n      if (!state2.clientsCount) {\n        bySelector.delete(selector);\n      }\n    };\n  }, [selector]);\n\n  return state.getter as Signal<T>;\n}\n\nexport default useSelectorSignal;\n","import type { RefObject } from 'react';\nimport {\n  useEffect, useLayoutEffect, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport { requestForcedReflow, requestMeasure, requestMutation } from '../../lib/fasterdom/fasterdom';\nimport calcTextLineHeightAndCount from '../../util/element/calcTextLineHeightAndCount';\nimport useDebouncedCallback from '../useDebouncedCallback';\nimport useLastCallback from '../useLastCallback';\nimport useWindowSize from '../window/useWindowSize';\n\nconst WINDOW_RESIZE_LINE_RECALC_DEBOUNCE = 200;\n\nexport default function useCollapsibleLines<T extends HTMLElement, C extends HTMLElement>(\n  ref: RefObject<T>,\n  maxLinesBeforeCollapse: number,\n  cutoutRef?: RefObject<C>,\n  isDisabled?: boolean,\n  isInEditMode?: boolean\n) {\n  const isFirstRenderRef = useRef(true);\n  const cutoutHeightRef = useRef<number | undefined>();\n  const [isCollapsible, setIsCollapsible] = useState(!isDisabled);\n  const [isCollapsed, setIsCollapsed] = useState(isCollapsible);\n\n  useLayoutEffect(() => {\n    const element = (cutoutRef || ref).current;\n    if (isDisabled || !element || isFirstRenderRef.current) return;\n\n    requestMutation(() => {\n      element.style.maxHeight = isCollapsed ? `${cutoutHeightRef.current}px` : '';\n    });\n  }, [cutoutRef, isCollapsed, isDisabled, ref]);\n\n  const recalculateTextLines = useLastCallback(() => {\n    if (isDisabled || !ref.current) {\n      return;\n    }\n    const element = ref.current;\n\n    const { lineHeight, totalLines } = calcTextLineHeightAndCount(element);\n    if (totalLines > maxLinesBeforeCollapse) {\n      cutoutHeightRef.current = lineHeight * maxLinesBeforeCollapse;\n      setIsCollapsible(true);\n    } else {\n      setIsCollapsible(false);\n      setIsCollapsed(false);\n    }\n  });\n\n  const debouncedRecalcTextLines = useDebouncedCallback(\n    () => requestMeasure(recalculateTextLines),\n    [recalculateTextLines],\n    WINDOW_RESIZE_LINE_RECALC_DEBOUNCE,\n  );\n\n  // useLayoutEffect(() => {\n  //   if (!isDisabled && isFirstRenderRef.current) {\n  //     requestForcedReflow(() => {\n  //       recalculateTextLines();\n\n  //       return () => {\n  //         isFirstRenderRef.current = false;\n  //         const element = (cutoutRef || ref).current;\n  //         if (!element) return;\n  //         element.style.maxHeight = cutoutHeightRef.current ? `${cutoutHeightRef.current}px` : '';\n  //       };\n  //     });\n  //   }\n  // }, [cutoutRef, isDisabled, recalculateTextLines, ref]);\n\n  // Parent resize is triggered on every collapse/expand, so we do recalculation only on window resize to save resources\n  const { width: windowWidth } = useWindowSize();\n  useEffect(() => {\n    if (!isDisabled) {\n      // if (isFirstRenderRef.current) return;\n\n      debouncedRecalcTextLines();\n    } else {\n      setIsCollapsible(false);\n      setIsCollapsed(false);\n    }\n  }, [debouncedRecalcTextLines, isDisabled, windowWidth]);\n\n  // Recalculate text lines when content changes in edit mode\n  useEffect(() => {\n    if (!isInEditMode || !ref.current) return;\n    const observer = new MutationObserver(() => {\n      requestMeasure(recalculateTextLines);\n    });\n    observer.observe(ref.current, {\n      childList: true,\n      subtree: true,\n      characterData: true,\n    });\n    return () => {\n      observer.disconnect();\n    };\n  }, [isInEditMode, ref]);\n\n  return {\n    isCollapsed,\n    isCollapsible,\n    setIsCollapsed,\n  };\n}\n","import React, { useEffect } from '../../lib/teact/teact';\n\nimport { SVG_NAMESPACE } from '../../config';\nimport { addSvgDefinition, removeSvgDefinition } from '../../util/svgController';\nimport { hexToRgb } from '../../util/switchTheme';\n\nconst SVG_MAP = new Map<string, SvgColorFilter>();\n\nclass SvgColorFilter {\n  public filterId: string;\n\n  private referenceCount = 0;\n\n  constructor(public color: string) {\n    this.filterId = `color-filter-${color.slice(1)}`;\n\n    const rgbColor = hexToRgb(color);\n    addSvgDefinition(\n      <filter color-interpolation-filters=\"sRGB\" xmlns={SVG_NAMESPACE}>\n        <feColorMatrix\n          type=\"matrix\"\n          values={`0 0 0 0 ${rgbColor.r / 255} 0 0 0 0 ${rgbColor.g / 255} 0 0 0 0 ${rgbColor.b / 255} 0 0 0 1 0`}\n        />\n      </filter>,\n      this.filterId,\n    );\n  }\n\n  public getFilterId() {\n    this.referenceCount += 1;\n    return this.filterId;\n  }\n\n  public removeReference() {\n    this.referenceCount -= 1;\n    if (this.referenceCount === 0) {\n      removeSvgDefinition(this.filterId);\n    }\n  }\n\n  public isUsed() {\n    return this.referenceCount > 0;\n  }\n}\n\nexport default function useColorFilter(color?: string, asValue?: boolean) {\n  useEffect(() => {\n    if (!color) return undefined;\n\n    return () => {\n      const colorFilter = SVG_MAP.get(color);\n      if (colorFilter) {\n        colorFilter.removeReference();\n        if (!colorFilter.isUsed()) {\n          SVG_MAP.delete(colorFilter.color);\n        }\n      }\n    };\n  }, [color]);\n\n  if (!color) return undefined;\n\n  if (SVG_MAP.has(color)) {\n    const svg = SVG_MAP.get(color)!;\n    return prepareStyle(svg.getFilterId(), asValue);\n  }\n\n  const svg = new SvgColorFilter(color);\n  SVG_MAP.set(color, svg);\n\n  return prepareStyle(svg.getFilterId(), asValue);\n}\n\nfunction prepareStyle(filterId: string, asValue?: boolean) {\n  if (asValue) {\n    return `url(#${filterId})`;\n  }\n\n  return `filter: url(#${filterId});`;\n}\n","import { useEffect, useLayoutEffect, useState } from '../../lib/teact/teact';\n\nimport { getPropertyHexColor } from '../../util/themeStyle';\nimport useLastCallback from '../useLastCallback';\nimport useResizeObserver from '../useResizeObserver';\n\n// Transition required to detect `color` property change.\n// Duration parameter describes a delay between color change and color state update.\n// Small values may cause large amount of re-renders.\nconst TRANSITION_PROPERTY = 'color';\nconst TRANSITION_STYLE = `50ms ${TRANSITION_PROPERTY} linear`;\n\nexport default function useDynamicColorListener(ref: React.RefObject<HTMLElement>,\n  isDisabled?: boolean) {\n  const [hexColor, setHexColor] = useState<string | undefined>();\n\n  const updateColor = useLastCallback(() => {\n    if (!ref.current || isDisabled) {\n      setHexColor(undefined);\n      return;\n    }\n\n    const currentHexColor = getPropertyHexColor(getComputedStyle(ref.current), TRANSITION_PROPERTY);\n    setHexColor(currentHexColor);\n  });\n\n  // Element does not receive `transitionend` event if parent has `display: none`.\n  // We will receive `resize` event when parent is shown again.\n  useResizeObserver(ref, updateColor, isDisabled);\n\n  useLayoutEffect(() => {\n    const el = ref.current;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    el.style.setProperty('transition', TRANSITION_STYLE, 'important');\n\n    return () => {\n      el.style.removeProperty('transition');\n    };\n  }, [isDisabled, ref]);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el) {\n      return undefined;\n    }\n\n    updateColor();\n\n    if (isDisabled) {\n      return undefined;\n    }\n\n    function handleTransitionEnd(e: TransitionEvent) {\n      if (e.propertyName !== TRANSITION_PROPERTY) return;\n      updateColor();\n    }\n\n    el.addEventListener('transitionend', handleTransitionEnd);\n\n    return () => {\n      el.removeEventListener('transitionend', handleTransitionEnd);\n    };\n  }, [isDisabled, ref, updateColor]);\n\n  return hexColor;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport {\n  MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN,\n  MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT,\n  MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH,\n  MOBILE_SCREEN_MAX_WIDTH,\n} from '../config';\nimport { createCallbackManager } from '../util/callbacks';\nimport { IS_IOS } from '../util/windowEnvironment';\nimport { updateSizes } from '../util/windowSize';\nimport useForceUpdate from './useForceUpdate';\n\ntype MediaQueryCacheKey = 'mobile' | 'tablet' | 'landscape' | 'touch';\n\nconst mediaQueryCache = new Map<MediaQueryCacheKey, MediaQueryList>();\nconst callbacks = createCallbackManager();\n\nlet isMobile: boolean | undefined;\nlet isTablet: boolean | undefined;\nlet isLandscape: boolean | undefined;\nlet isTouchScreen: boolean | undefined;\n\nexport function getIsMobile() {\n  return isMobile;\n}\n\nexport function getIsTablet() {\n  return isTablet;\n}\n\nexport function getIsWebAppsFullscreenSupported() {\n  return !getIsMobile();\n}\n\nfunction handleMediaQueryChange() {\n  isMobile = mediaQueryCache.get('mobile')?.matches || false;\n  isTablet = !isMobile && (mediaQueryCache.get('tablet')?.matches || false);\n  isLandscape = mediaQueryCache.get('landscape')?.matches || false;\n  isTouchScreen = mediaQueryCache.get('touch')?.matches || false;\n  updateSizes();\n  callbacks.runCallbacks();\n}\n\nfunction initMediaQueryCache() {\n  const mobileQuery = window.matchMedia(`(max-width: ${MOBILE_SCREEN_MAX_WIDTH}px), \\\n  (max-width: ${MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH}px and max-height: ${MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT}px)`);\n  mediaQueryCache.set('mobile', mobileQuery);\n  mobileQuery.addEventListener('change', handleMediaQueryChange);\n\n  const tabletQuery = window.matchMedia(`(max-width: ${MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN}px)`);\n  mediaQueryCache.set('tablet', tabletQuery);\n  tabletQuery.addEventListener('change', handleMediaQueryChange);\n\n  const landscapeQuery = window.matchMedia(\n    IS_IOS\n      ? '(orientation: landscape)'\n      // Source: https://web.archive.org/web/20160509220835/http://blog.abouthalf.com/development/orientation-media-query-challenges-in-android-browsers/\n      // Feature is marked as deprecated now, but it is still supported\n      // https://developer.mozilla.org/en-US/docs/Web/CSS/@media/device-aspect-ratio#browser_compatibility\n      : 'screen and (min-device-aspect-ratio: 1/1) and (orientation: landscape)',\n  );\n  mediaQueryCache.set('landscape', landscapeQuery);\n  landscapeQuery.addEventListener('change', handleMediaQueryChange);\n\n  const isTouchScreenQuery = window.matchMedia('(pointer: coarse)');\n  mediaQueryCache.set('touch', isTouchScreenQuery);\n  isTouchScreenQuery.addEventListener('change', handleMediaQueryChange);\n}\n\ninitMediaQueryCache();\nhandleMediaQueryChange();\n\nexport default function useAppLayout() {\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => callbacks.addCallback(forceUpdate), [forceUpdate]);\n\n  return {\n    isMobile,\n    isTablet,\n    isLandscape,\n    isDesktop: !isMobile && !isTablet,\n    isTouchScreen,\n  };\n}\n","import { useEffect, useState } from '../lib/teact/teact';\n\nconst useAsync = <T>(fn: () => Promise<T>, deps: any[], defaultValue?: T) => {\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [error, setError] = useState<Error | undefined>();\n  const [result, setResult] = useState<T | undefined>(defaultValue);\n  useEffect(() => {\n    setIsLoading(true);\n    let wasCancelled = false;\n    fn().then((res) => {\n      if (wasCancelled) return;\n      setIsLoading(false);\n      setResult(res);\n    }, (err) => {\n      if (wasCancelled) return;\n      setIsLoading(false);\n      setError(err);\n    });\n    return () => {\n      wasCancelled = true;\n    };\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, deps);\n  return { isLoading, error, result };\n};\n\nexport default useAsync;\n","import type React from '../lib/teact/teact';\nimport { useMemo, useState } from '../lib/teact/teact';\n\nimport { areDeepEqual } from '../util/areDeepEqual';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport { debounce } from '../util/schedulers';\nimport useLastCallback from './useLastCallback';\n\ntype BufferingEvent = (e: Event | React.SyntheticEvent<HTMLMediaElement>) => void;\n\nconst MIN_READY_STATE = 3;\n// Avoid flickering when re-mounting previously buffered video\nconst DEBOUNCE = 200;\nconst MIN_ALLOWED_MEDIA_DURATION = 0.1; // Some video emojis have weird duration of 0.04 causing extreme amount of events\n\n/**\n * Time range relative to the duration [0, 1]\n */\nexport type BufferedRange = { start: number; end: number };\n\nconst useBuffering = (noInitiallyBuffered = false, onTimeUpdate?: AnyToVoidFunction, onBroken?: AnyToVoidFunction) => {\n  const [isBuffered, setIsBuffered] = useState(!noInitiallyBuffered);\n  const [isReady, setIsReady] = useState(false);\n  const [bufferedProgress, setBufferedProgress] = useState(0);\n  const [bufferedRanges, setBufferedRanges] = useState<BufferedRange[]>([]);\n\n  const setIsBufferedDebounced = useMemo(() => {\n    return debounce(setIsBuffered, DEBOUNCE, false, true);\n  }, []);\n\n  const handleBuffering = useLastCallback<BufferingEvent>((e) => {\n    const media = e.currentTarget as HTMLMediaElement;\n\n    if (media.duration < MIN_ALLOWED_MEDIA_DURATION) {\n      onBroken?.();\n      return;\n    }\n\n    if (e.type === 'timeupdate') {\n      onTimeUpdate?.(e);\n    }\n\n    if (!isSafariPatchInProgress(media)) {\n      if (media.buffered.length) {\n        const ranges = getTimeRanges(media.buffered, media.duration);\n        const bufferedLength = ranges.reduce((acc, { start, end }) => acc + end - start, 0);\n        setBufferedProgress(bufferedLength / media.duration);\n        setBufferedRanges((currentRanges) => {\n          return areDeepEqual(currentRanges, ranges) ? currentRanges : ranges;\n        });\n      }\n\n      setIsBufferedDebounced(media.readyState >= MIN_READY_STATE || media.currentTime > 0);\n      setIsReady((current) => current || media.readyState > MIN_READY_STATE);\n    }\n  });\n\n  const bufferingHandlers = {\n    onPLay: handleBuffering,\n    onLoadedData: handleBuffering,\n    onPlaying: handleBuffering,\n    onLoadStart: handleBuffering, // Needed for Safari to start\n    onPause: handleBuffering, // Needed for Chrome when seeking\n    onTimeUpdate: handleBuffering, // Needed for audio buffering progress\n    onProgress: handleBuffering, // Needed for video buffering progress\n  };\n\n  return {\n    isReady,\n    isBuffered,\n    bufferedProgress,\n    bufferedRanges,\n    bufferingHandlers,\n    checkBuffering(element: HTMLMediaElement) {\n      setIsBufferedDebounced(element.readyState >= MIN_READY_STATE);\n    },\n  };\n};\n\nfunction getTimeRanges(ranges: TimeRanges, duration: number) {\n  const result: BufferedRange[] = [];\n  for (let i = 0; i < ranges.length; i++) {\n    result.push({\n      start: ranges.start(i) / duration,\n      end: ranges.end(i) / duration,\n    });\n  }\n  return result;\n}\n\nexport default useBuffering;\n","import {\n  useEffect, useMemo, useState,\n} from '../lib/teact/teact';\n\nimport { round } from '../util/math';\nimport useLastCallback from './useLastCallback';\nimport useResizeObserver from './useResizeObserver';\nimport useSharedIntersectionObserver from './useSharedIntersectionObserver';\nimport useThrottledCallback from './useThrottledCallback';\n\nconst THROTTLE_MS = 150;\n\nexport default function useCoordsInSharedCanvas(\n  containerRef: React.RefObject<HTMLDivElement>,\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>,\n) {\n  const [x, setX] = useState<number>();\n  const [y, setY] = useState<number>();\n\n  const recalculate = useLastCallback(() => {\n    const container = containerRef.current;\n    const canvas = sharedCanvasRef?.current;\n    if (!container || !canvas) {\n      return;\n    }\n\n    // Wait until elements are properly mounted\n    if (!canvas.offsetWidth || !canvas.offsetHeight) {\n      return;\n    }\n\n    const target = container.classList.contains('sticker-set-cover') || container.classList.contains('sticker-reaction')\n      ? container\n      : container.querySelector('img')!;\n    if (!target) {\n      return;\n    }\n\n    const targetBounds = target.getBoundingClientRect();\n    const canvasBounds = canvas.getBoundingClientRect();\n\n    // Factor coords are used to support rendering while being rescaled (e.g. message appearance animation)\n    setX(round((targetBounds.left - canvasBounds.left) / canvasBounds.width, 4) || 0);\n    setY(round((targetBounds.top - canvasBounds.top) / canvasBounds.height, 4) || 0);\n  });\n\n  useEffect(recalculate, [recalculate]);\n\n  const throttledRecalculate = useThrottledCallback(recalculate, [recalculate], THROTTLE_MS);\n  useResizeObserver(sharedCanvasRef, throttledRecalculate);\n  useSharedIntersectionObserver(sharedCanvasRef, throttledRecalculate);\n\n  return useMemo(() => (x !== undefined && y !== undefined ? { x, y } : undefined), [x, y]);\n}\n","import usePreviousDeprecated from './usePreviousDeprecated';\n\nexport default function useCurrentOrPrev<T extends any>(\n  current: T, shouldSkipUndefined = false, shouldForceCurrent = false,\n): T | undefined {\n  const prev = usePreviousDeprecated(current, shouldSkipUndefined);\n\n  // eslint-disable-next-line no-null/no-null\n  return shouldForceCurrent || (current !== null && current !== undefined) ? current : prev;\n}\n","import { useCallback, useMemo } from '../lib/teact/teact';\n\nimport { debounce } from '../util/schedulers';\n\nexport default function useDebouncedCallback<T extends AnyToVoidFunction>(\n  fn: T,\n  deps: any[],\n  ms: number,\n  noFirst = false,\n  noLast = false,\n) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(fn, deps);\n\n  return useMemo(() => {\n    return debounce(fnMemo, ms, !noFirst, !noLast);\n  }, [fnMemo, ms, noFirst, noLast]);\n}\n","import { useSignal } from '../lib/teact/teact';\n\nimport type { Signal } from '../util/signals';\n\nimport { useSignalEffect } from './useSignalEffect';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\n\ntype SyncResolver<T> = () => T;\ntype AsyncResolver<T> = (setter: (newValue: T) => void) => void;\ntype Resolver<T> =\n  SyncResolver<T>\n  | AsyncResolver<T>;\n\nfunction useDerivedSignal<T>(resolver: SyncResolver<T>, dependencies: readonly any[]): Signal<T>;\nfunction useDerivedSignal<T>(resolver: AsyncResolver<T>, dependencies: readonly any[], isAsync: true): Signal<T>;\nfunction useDerivedSignal<T>(dependency: T): Signal<T>;\n\nfunction useDerivedSignal<T>(resolverOrDependency: Resolver<T> | T, dependencies?: readonly any[], isAsync = false) {\n  const resolver = dependencies ? resolverOrDependency as Resolver<T> : () => (resolverOrDependency as T);\n  dependencies ??= [resolverOrDependency];\n\n  const [getValue, setValue] = useSignal<T>();\n  const resolverRef = useStateRef(resolver);\n\n  function runCurrentResolver() {\n    const currentResolver = resolverRef.current;\n    if (isAsync) {\n      (currentResolver as AsyncResolver<T>)(setValue);\n    } else {\n      setValue((currentResolver as SyncResolver<T>)());\n    }\n  }\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSyncEffect(runCurrentResolver, dependencies);\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSignalEffect(runCurrentResolver, dependencies);\n\n  return getValue as Signal<T>;\n}\n\nexport default useDerivedSignal;\n","import { useRef } from '../lib/teact/teact';\n\nimport type { Signal } from '../util/signals';\n\nimport useForceUpdate from './useForceUpdate';\nimport { useSignalEffect } from './useSignalEffect';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\n\ntype SyncResolver<T> = () => T;\ntype AsyncResolver<T> = (setter: (newValue: T) => void) => void;\ntype Resolver<T> =\n  SyncResolver<T>\n  | AsyncResolver<T>;\n\nfunction useDerivedState<T>(resolver: SyncResolver<T>, dependencies: readonly any[]): T;\nfunction useDerivedState<T>(resolver: AsyncResolver<T>, dependencies: readonly any[], isAsync: true): T;\nfunction useDerivedState<T>(signal: Signal<T>): T;\n\nfunction useDerivedState<T>(resolverOrSignal: Resolver<T> | T, dependencies?: readonly any[], isAsync = false) {\n  const resolver = dependencies ? resolverOrSignal as Resolver<T> : () => ((resolverOrSignal as Signal<T>)());\n  dependencies ??= [resolverOrSignal];\n\n  const valueRef = useRef<T>();\n  const forceUpdate = useForceUpdate();\n  const resolverRef = useStateRef(resolver);\n\n  function runCurrentResolver(isSync = false) {\n    const currentResolver = resolverRef.current;\n    if (isAsync) {\n      (currentResolver as AsyncResolver<T>)((newValue) => {\n        if (valueRef.current !== newValue) {\n          valueRef.current = newValue;\n          forceUpdate();\n        }\n      });\n    } else {\n      const newValue = (currentResolver as SyncResolver<T>)();\n      if (valueRef.current !== newValue) {\n        valueRef.current = newValue;\n\n        if (!isSync) {\n          forceUpdate();\n        }\n      }\n    }\n  }\n\n  useSyncEffect(() => {\n    runCurrentResolver(true);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSignalEffect(runCurrentResolver, dependencies);\n\n  return valueRef.current as T;\n}\n\nexport default useDerivedState;\n","import { useEffect } from '../lib/teact/teact';\n\nfunction useEffectOnce(effect: React.EffectCallback) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useEffect(effect, []);\n}\n\nexport default useEffectOnce;\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nconst useEffectWithPrevDeps = <const T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T, debugKey?: string,\n) => {\n  const prevDepsRef = useRef<T>();\n\n  return useEffect(() => {\n    const prevDeps = prevDepsRef.current;\n    prevDepsRef.current = dependencies;\n\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies, debugKey);\n};\n\nexport default useEffectWithPrevDeps;\n","import type { RefObject } from 'react';\nimport { useEffect, useRef } from '../lib/teact/teact';\n\nimport { IS_ELECTRON, IS_MAC_OS } from '../util/windowEnvironment';\n\nconst DRAG_DISTANCE_THRESHOLD = 5;\n\nconst useElectronDrag = (ref: RefObject<HTMLDivElement>) => {\n  const isDragging = useRef(false);\n\n  const x = useRef(window.screenX);\n  const y = useRef(window.screenY);\n  const distance = useRef(0);\n\n  useEffect(() => {\n    const element: HTMLDivElement | null = ref.current;\n    if (!element || !(IS_ELECTRON && IS_MAC_OS)) return undefined;\n\n    const handleClick = (event: MouseEvent) => {\n      distance.current = 0;\n\n      if (isDragging.current) {\n        event.preventDefault();\n        event.stopPropagation();\n        isDragging.current = false;\n      }\n    };\n\n    const handleMousedown = (event: MouseEvent) => {\n      if (isDragging.current) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    };\n\n    const handleDrag = (event: MouseEvent) => {\n      if (event.buttons === 1) {\n        distance.current += Math.sqrt((x.current - window.screenX) ** 2 + (y.current - window.screenY) ** 2);\n\n        x.current = window.screenX;\n        y.current = window.screenY;\n\n        if (!isDragging.current && distance.current > DRAG_DISTANCE_THRESHOLD) {\n          isDragging.current = true;\n        }\n      }\n    };\n\n    const handleDoubleClick = (event: MouseEvent) => {\n      if (event.currentTarget === event.target) {\n        window.electron?.handleDoubleClick();\n      }\n    };\n\n    element.addEventListener('click', handleClick);\n    element.addEventListener('mousedown', handleMousedown);\n    element.addEventListener('mousemove', handleDrag);\n    element.addEventListener('dblclick', handleDoubleClick);\n\n    return () => {\n      element.removeEventListener('click', handleClick);\n      element.removeEventListener('mouseup', handleMousedown);\n      element.removeEventListener('mousemove', handleDrag);\n      element.removeEventListener('dblclick', handleDoubleClick);\n    };\n  }, [ref]);\n};\n\nexport default useElectronDrag;\n","import { useCallback, useState } from '../lib/teact/teact';\n\nconst useFlag = (initial = false, debugKey?: string): [boolean, NoneToVoidFunction, NoneToVoidFunction] => {\n  const [value, setValue] = useState(initial, debugKey);\n\n  const setTrue = useCallback(() => {\n    setValue(true);\n  }, []);\n\n  const setFalse = useCallback(() => {\n    setValue(false);\n  }, []);\n\n  return [value, setTrue, setFalse];\n};\n\nexport default useFlag;\n","import { useCallback, useState } from '../lib/teact/teact';\n\nconst useForceUpdate = () => {\n  const [, setTrigger] = useState<boolean>(false);\n\n  return useCallback(() => {\n    setTrigger((trigger) => !trigger);\n  }, []);\n};\n\nexport default useForceUpdate;\n","import {\n  getIsHeavyAnimating,\n  useCallback, useEffect, useMemo, useRef,\n} from '../lib/teact/teact';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nexport const startCallbacks = createCallbackManager();\nexport const endCallbacks = createCallbackManager();\n\ngetIsHeavyAnimating.subscribe(() => {\n  if (getIsHeavyAnimating()) {\n    startCallbacks.runCallbacks();\n  } else {\n    endCallbacks.runCallbacks();\n  }\n});\n\nexport default function useHeavyAnimation(\n  onStart?: AnyToVoidFunction,\n  onEnd?: AnyToVoidFunction,\n  isDisabled = false,\n) {\n  const lastOnStart = useLastCallback(onStart);\n  const lastOnEnd = useLastCallback(onEnd);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (getIsHeavyAnimating()) {\n      lastOnStart();\n    }\n\n    startCallbacks.addCallback(lastOnStart);\n    endCallbacks.addCallback(lastOnEnd);\n\n    return () => {\n      endCallbacks.removeCallback(lastOnEnd);\n      startCallbacks.removeCallback(lastOnStart);\n    };\n  }, [isDisabled, lastOnEnd, lastOnStart]);\n}\n\n// TODO → `onFullyIdle`?\nexport function useThrottleForHeavyAnimation<T extends AnyToVoidFunction>(afterHeavyAnimation: T, deps: unknown[]) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(afterHeavyAnimation, deps);\n\n  const isScheduledRef = useRef(false);\n\n  return useMemo(() => {\n    return (...args: Parameters<T>) => {\n      if (!isScheduledRef.current) {\n        if (!getIsHeavyAnimating()) {\n          fnMemo(...args);\n          return;\n        }\n\n        isScheduledRef.current = true;\n\n        const removeCallback = endCallbacks.addCallback(() => {\n          fnMemo(...args);\n          removeCallback();\n          isScheduledRef.current = false;\n        });\n      }\n    };\n  }, [fnMemo]);\n}\n","import { useCallback, useRef } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport { IS_TEST } from '../config';\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport { IS_IOS } from '../util/windowEnvironment';\nimport useEffectOnce from './useEffectOnce';\nimport useLastCallback from './useLastCallback';\nimport useSyncEffect from './useSyncEffect';\n\nconst PATH_BASE = `${window.location.pathname}${window.location.search}`;\n// Carefully selected by swiping and observing visual changes\n// TODO: may be different on other devices such as iPad, maybe take dpi into account?\nconst SAFARI_EDGE_BACK_GESTURE_LIMIT = 300;\nconst SAFARI_EDGE_BACK_GESTURE_DURATION = 350;\n\ntype HistoryRecord = {\n  index: number;\n  // Should this record be replaced by the next record (for example Menu)\n  shouldBeReplaced?: boolean;\n  // Mark this record as replaced by the next record. Only used to check if needed to perform effectBack\n  markReplaced?: VoidFunction;\n  onBack?: VoidFunction;\n  // Set if the element is closed in the UI, but not in the real history\n  isClosed?: boolean;\n};\n\ntype HistoryOperationGo = {\n  type: 'go';\n  delta: number;\n};\n\ntype HistoryOperationState = {\n  type: 'pushState' | 'replaceState';\n  data: any;\n  hash?: string;\n};\n\ntype HistoryOperation = HistoryOperationGo | HistoryOperationState;\n\n// Needed to dismiss any 'trashed' history records from the previous page reloads.\nconst historyUniqueSessionId = Number(new Date());\n// Reflects real history state, but also contains information on which records should be replaced by the next record and\n// which records are deferred to close on the next operation\nlet historyState: HistoryRecord[];\n// Reflects current real history index\nlet historyCursor: number;\n// If we alter real history programmatically, the popstate event will be fired, which we don't need\nlet isAlteringHistory = false;\n// Unfortunately Safari doesn't really like when there's 2+ consequent history operations in one frame, so we need\n// to delay them to the next raf\nlet deferredHistoryOperations: HistoryOperation[] = [];\nlet deferredPopstateOperations: HistoryOperationState[] = [];\nlet isSafariGestureAnimation = false;\n\n// Do not remove: used for history unit tests\nif (IS_TEST) {\n  (window as any).TEST_getHistoryState = () => historyState;\n  (window as any).TEST_getHistoryCursor = () => historyCursor;\n}\n\nfunction handleTouchStart(event: TouchEvent) {\n  const x = event.touches[0].pageX;\n\n  if (x <= SAFARI_EDGE_BACK_GESTURE_LIMIT || x >= window.innerWidth - SAFARI_EDGE_BACK_GESTURE_LIMIT) {\n    isSafariGestureAnimation = true;\n  }\n}\n\nfunction handleTouchEnd() {\n  if (!isSafariGestureAnimation) {\n    return;\n  }\n\n  setTimeout(() => {\n    isSafariGestureAnimation = false;\n  }, SAFARI_EDGE_BACK_GESTURE_DURATION);\n}\n\nif (IS_IOS) {\n  window.addEventListener('touchstart', handleTouchStart);\n  window.addEventListener('touchend', handleTouchEnd);\n  window.addEventListener('popstate', handleTouchEnd);\n}\n\nfunction applyDeferredHistoryOperations() {\n  const goOperations = deferredHistoryOperations.filter((op) => op.type === 'go') as HistoryOperationGo[];\n  const stateOperations = deferredHistoryOperations.filter((op) => op.type !== 'go') as HistoryOperationState[];\n  const goCount = goOperations.reduce((acc, op) => acc + op.delta, 0);\n\n  deferredHistoryOperations = [];\n\n  if (goCount) {\n    window.history.go(goCount);\n\n    // If we have some `state` operations after the `go` operations, we need to wait until the popstate event\n    // so the order of operations is correctly preserved\n    if (stateOperations.length) {\n      deferredPopstateOperations.push(...stateOperations);\n      return;\n    }\n  }\n\n  processStateOperations(stateOperations);\n}\n\nfunction processStateOperations(stateOperations: HistoryOperationState[]) {\n  stateOperations.forEach((op) => window.history[op.type](op.data, '', op.hash));\n}\n\nfunction deferHistoryOperation(historyOperation: HistoryOperation) {\n  if (!deferredHistoryOperations.length) {\n    requestMeasure(applyDeferredHistoryOperations);\n  }\n\n  deferredHistoryOperations.push(historyOperation);\n}\n\n// Resets history to the `root` state\nfunction resetHistory() {\n  historyCursor = 0;\n  historyState = [{\n    index: 0,\n    onBack: () => window.history.back(),\n  }];\n\n  window.history.replaceState({ index: 0, historyUniqueSessionId }, '', PATH_BASE);\n}\n\nresetHistory();\n\nfunction cleanupClosed(alreadyClosedCount = 1) {\n  let countClosed = alreadyClosedCount;\n  for (let i = historyCursor - 1; i > 0; i--) {\n    if (!historyState[i].isClosed) break;\n    countClosed++;\n  }\n  if (countClosed) {\n    isAlteringHistory = true;\n    deferHistoryOperation({\n      type: 'go',\n      delta: -countClosed,\n    });\n  }\n  return countClosed;\n}\n\nfunction cleanupTrashedState() {\n  // Navigation to previous page reload, state of which was trashed by reload\n  let isAnimationDisabled = false;\n  for (let i = historyState.length - 1; i > 0; i--) {\n    if (historyState[i].isClosed) {\n      continue;\n    }\n    // TODO[history]: probably we should not call this inside the loop\n    if (!isAnimationDisabled && isSafariGestureAnimation) {\n      getActions().disableHistoryAnimations();\n      isAnimationDisabled = true;\n    }\n    historyState[i].onBack?.();\n  }\n\n  resetHistory();\n}\n\nwindow.addEventListener('popstate', ({ state }: PopStateEvent) => {\n  if (isAlteringHistory) {\n    isAlteringHistory = false;\n    if (deferredPopstateOperations.length) {\n      processStateOperations(deferredPopstateOperations);\n      deferredPopstateOperations = [];\n    }\n    return;\n  }\n\n  if (!state) {\n    cleanupTrashedState();\n\n    if (!window.location.hash) {\n      return;\n    }\n    return;\n  }\n\n  const { index, historyUniqueSessionId: previousUniqueSessionId } = state;\n  if (previousUniqueSessionId !== historyUniqueSessionId) {\n    cleanupTrashedState();\n    return;\n  }\n\n  // New real history state matches the old virtual one. Not possible in theory, but in practice we have Safari\n  if (index === historyCursor) {\n    return;\n  }\n\n  if (index < historyCursor) {\n    // Navigating back\n    let alreadyClosedCount = 0;\n    let isAnimationDisabled = false;\n    for (let i = historyCursor; i > index - alreadyClosedCount; i--) {\n      if (historyState[i].isClosed) {\n        alreadyClosedCount++;\n        continue;\n      }\n      // TODO[history]: probably we should not call this inside the loop\n      if (!isAnimationDisabled && isSafariGestureAnimation) {\n        getActions().disableHistoryAnimations();\n        isAnimationDisabled = true;\n      }\n      historyState[i].onBack?.();\n    }\n\n    const countClosed = cleanupClosed(alreadyClosedCount);\n    historyCursor += index - historyCursor - countClosed;\n\n    // Can happen when we have deferred a real back for some element (for example Menu), closed via UI,\n    // pressed back button and caused a pushState.\n    if (historyCursor < 0) {\n      historyCursor = 0;\n    }\n  } else if (index > historyCursor) {\n    // Forward navigation is not yet supported\n    isAlteringHistory = true;\n    deferHistoryOperation({\n      type: 'go',\n      delta: -(index - historyCursor),\n    });\n  }\n});\n\nexport default function useHistoryBack({\n  isActive,\n  shouldBeReplaced,\n  shouldResetUrlHash,\n  hash,\n  onBack,\n}: {\n  isActive?: boolean;\n  shouldBeReplaced?: boolean;\n  hash?: string;\n  shouldResetUrlHash?: boolean;\n  onBack: VoidFunction;\n}) {\n  const lastOnBack = useLastCallback(onBack);\n\n  // Active index of the record\n  const indexRef = useRef<number>();\n  const wasReplaced = useRef(false);\n\n  const isFirstRender = useRef(true);\n\n  const pushState = useCallback((forceReplace = false) => {\n    // Check if the old state should be replaced\n    const shouldReplace = forceReplace || historyState[historyCursor].shouldBeReplaced;\n    indexRef.current = shouldReplace ? historyCursor : ++historyCursor;\n\n    historyCursor = indexRef.current;\n\n    // Mark the previous record as replaced so effectBack doesn't perform back operation on the new record\n    const previousRecord = historyState[indexRef.current];\n    if (previousRecord && !previousRecord.isClosed) {\n      previousRecord.markReplaced?.();\n    }\n\n    historyState[indexRef.current] = {\n      index: indexRef.current,\n      onBack: lastOnBack,\n      shouldBeReplaced,\n      markReplaced: () => {\n        wasReplaced.current = true;\n      },\n    };\n\n    deferHistoryOperation({\n      type: shouldReplace ? 'replaceState' : 'pushState',\n      data: {\n        index: indexRef.current,\n        historyUniqueSessionId,\n      },\n      // Space is a hack to make the browser completely remove the hash\n      hash: hash ? `#${hash}` : (shouldResetUrlHash ? ' ' : undefined),\n    });\n  }, [hash, shouldBeReplaced, shouldResetUrlHash]);\n\n  const processBack = useCallback(() => {\n    // Only process back on open records\n    if (indexRef.current && historyState[indexRef.current] && !wasReplaced.current) {\n      historyState[indexRef.current].isClosed = true;\n      wasReplaced.current = true;\n      if (indexRef.current === historyCursor && !shouldBeReplaced) {\n        historyCursor -= cleanupClosed();\n      }\n    }\n  }, [shouldBeReplaced]);\n\n  // Process back navigation when element is unmounted\n  useEffectOnce(() => {\n    isFirstRender.current = false;\n    return () => {\n      if (!isActive || wasReplaced.current) return;\n      processBack();\n    };\n  });\n\n  useSyncEffect(([prevIsActive]) => {\n    if (prevIsActive === isActive) return;\n    if (isFirstRender.current && !isActive) return;\n\n    if (isActive) {\n      pushState();\n    } else {\n      processBack();\n    }\n  }, [isActive, processBack, pushState]);\n}\n","import type { RefObject } from 'react';\nimport { useEffect, useRef, useState } from '../lib/teact/teact';\n\nimport type { Scheduler } from '../util/schedulers';\n\nimport { type CallbackManager, createCallbackManager } from '../util/callbacks';\nimport {\n  debounce, throttle, throttleWith,\n} from '../util/schedulers';\nimport useHeavyAnimation from './useHeavyAnimation';\nimport useLastCallback from './useLastCallback';\n\ntype TargetCallback = (entry: IntersectionObserverEntry) => void;\ntype RootCallback = (entries: IntersectionObserverEntry[]) => void;\ntype ObserveCleanup = NoneToVoidFunction;\nexport type ObserveFn = (target: HTMLElement, targetCallback?: TargetCallback) => ObserveCleanup;\n\ninterface IntersectionController {\n  observer: IntersectionObserver;\n  addCallback: (element: HTMLElement, callback: TargetCallback) => void;\n  removeCallback: (element: HTMLElement, callback: TargetCallback) => void;\n  destroy: NoneToVoidFunction;\n}\n\ninterface Response {\n  observe: ObserveFn;\n  freeze: NoneToVoidFunction;\n  unfreeze: NoneToVoidFunction;\n}\n\nexport function useIntersectionObserver({\n  rootRef,\n  throttleMs,\n  throttleScheduler,\n  debounceMs,\n  shouldSkipFirst,\n  margin,\n  threshold,\n  isDisabled,\n}: {\n  rootRef: RefObject<HTMLDivElement>;\n  throttleMs?: number;\n  throttleScheduler?: Scheduler;\n  debounceMs?: number;\n  shouldSkipFirst?: boolean;\n  margin?: number;\n  threshold?: number | number[];\n  isDisabled?: boolean;\n}, rootCallback?: RootCallback): Response {\n  const controllerRef = useRef<IntersectionController>();\n  const rootCallbackRef = useRef<RootCallback>();\n  const freezeFlagsRef = useRef(0);\n  const onUnfreezeRef = useRef<NoneToVoidFunction>();\n\n  rootCallbackRef.current = rootCallback;\n\n  const freeze = useLastCallback(() => {\n    freezeFlagsRef.current++;\n  });\n\n  const unfreeze = useLastCallback(() => {\n    if (!freezeFlagsRef.current) {\n      return;\n    }\n\n    freezeFlagsRef.current--;\n\n    if (!freezeFlagsRef.current && onUnfreezeRef.current) {\n      onUnfreezeRef.current();\n      onUnfreezeRef.current = undefined;\n    }\n  });\n\n  useHeavyAnimation(freeze, unfreeze);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    return () => {\n      if (controllerRef.current) {\n        controllerRef.current.observer.disconnect();\n        controllerRef.current.destroy();\n        controllerRef.current = undefined;\n      }\n    };\n  }, [isDisabled]);\n\n  function initController() {\n    const callbacks = new Map<HTMLElement, CallbackManager<TargetCallback>>();\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n\n    let observerCallback: typeof observerCallbackSync;\n    if (typeof throttleScheduler === 'function') {\n      observerCallback = throttleWith(throttleScheduler, observerCallbackSync);\n    } else if (throttleMs) {\n      observerCallback = throttle(observerCallbackSync, throttleMs, !shouldSkipFirst);\n    } else if (debounceMs) {\n      observerCallback = debounce(observerCallbackSync, debounceMs, !shouldSkipFirst);\n    } else {\n      observerCallback = observerCallbackSync;\n    }\n\n    function observerCallbackSync() {\n      if (freezeFlagsRef.current) {\n        onUnfreezeRef.current = observerCallback;\n        return;\n      }\n\n      const entries = Array.from(entriesAccumulator.values());\n\n      entries.forEach((entry: IntersectionObserverEntry) => {\n        const callbackManager = callbacks.get(entry.target as HTMLElement);\n        callbackManager?.runCallbacks(entry);\n      });\n\n      if (rootCallbackRef.current) {\n        rootCallbackRef.current(entries);\n      }\n\n      entriesAccumulator.clear();\n    }\n\n    function addCallback(element: HTMLElement, callback: TargetCallback) {\n      if (!callbacks.get(element)) {\n        callbacks.set(element, createCallbackManager<TargetCallback>());\n      }\n\n      const callbackManager = callbacks.get(element)!;\n      callbackManager.addCallback(callback);\n    }\n\n    function removeCallback(element: HTMLElement, callback: TargetCallback) {\n      const callbackManager = callbacks.get(element);\n      if (!callbackManager) return;\n      callbackManager.removeCallback(callback);\n\n      if (!callbackManager.hasCallbacks()) {\n        callbacks.delete(element);\n      }\n    }\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          entriesAccumulator.set(entry.target, entry);\n        });\n\n        if (freezeFlagsRef.current) {\n          onUnfreezeRef.current = observerCallback;\n        } else {\n          observerCallback();\n        }\n      },\n      {\n        root: rootRef.current,\n        rootMargin: margin ? `${margin}px` : undefined,\n        threshold,\n      },\n    );\n\n    function destroy() {\n      callbacks.clear();\n      observer.disconnect();\n    }\n\n    controllerRef.current = {\n      observer,\n      addCallback,\n      removeCallback,\n      destroy,\n    };\n  }\n\n  const observe = useLastCallback((target, targetCallback) => {\n    if (!controllerRef.current) {\n      initController();\n    }\n\n    const controller = controllerRef.current!;\n    controller.observer.observe(target);\n\n    if (targetCallback) {\n      controller.addCallback(target, targetCallback);\n    }\n\n    return () => {\n      if (targetCallback) {\n        controller.removeCallback(target, targetCallback);\n      }\n\n      controller.observer.unobserve(target);\n    };\n  });\n\n  return { observe, freeze, unfreeze };\n}\n\nexport function useOnIntersect(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const lastCallback = useLastCallback(callback);\n\n  useEffect(() => {\n    return observe ? observe(targetRef.current!, lastCallback) : undefined;\n  }, [lastCallback, observe, targetRef]);\n}\n\nexport function useIsIntersecting(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const [isIntersecting, setIsIntersecting] = useState(!observe);\n\n  useOnIntersect(targetRef, observe, (entry) => {\n    setIsIntersecting(entry.isIntersecting);\n\n    if (callback) {\n      callback(entry);\n    }\n  });\n\n  return isIntersecting;\n}\n","import type { RefObject } from 'react';\nimport { useEffect, useState } from '../lib/teact/teact';\n\nimport { requestMeasure, requestMutation } from '../lib/fasterdom/fasterdom';\nimport useLastCallback from './useLastCallback';\n\nconst useKeyboardListNavigation = (\n  elementRef: RefObject<HTMLElement>,\n  isOpen: boolean,\n  onSelectWithEnter?: (index: number) => void,\n  itemSelector?: string,\n  noCaptureFocus?: boolean,\n) => {\n  const [focusedIndex, setFocusedIndex] = useState(-1);\n\n  useEffect(() => {\n    setFocusedIndex(-1);\n\n    const element = elementRef.current;\n    if (isOpen && element && !noCaptureFocus) {\n      requestMutation(() => { element.tabIndex = -1; });\n      requestMeasure(() => element.focus());\n    }\n  }, [elementRef, isOpen, noCaptureFocus]);\n\n  return useLastCallback((e: React.KeyboardEvent<any>) => {\n    const element = elementRef.current;\n\n    if (!element) {\n      return;\n    }\n\n    if (e.keyCode === 13 && onSelectWithEnter) {\n      onSelectWithEnter(focusedIndex);\n      return;\n    }\n\n    if (e.keyCode !== 38 && e.keyCode !== 40) {\n      return;\n    }\n\n    const focusedElement = document.activeElement;\n    const elementChildren = Array.from(itemSelector ? element.querySelectorAll(itemSelector) : element.children);\n\n    let newIndex = (focusedElement && elementChildren.indexOf(focusedElement)) || focusedIndex;\n\n    if (e.keyCode === 38 && newIndex > 0) {\n      newIndex--;\n    } else if (e.keyCode === 40 && newIndex < elementChildren.length - 1) {\n      newIndex++;\n    } else if (elementChildren.length === 1) {\n      newIndex = 0;\n    } else {\n      return;\n    }\n\n    const item = elementChildren[newIndex] as HTMLElement;\n    if (item) {\n      setFocusedIndex(newIndex);\n      item.focus();\n    }\n  });\n};\n\nexport default useKeyboardListNavigation;\n","import {\n  addLocalizationCallback,\n  getTranslationFn,\n  type LangFn,\n} from '../util/localization';\nimport useEffectOnce from './useEffectOnce';\nimport useForceUpdate from './useForceUpdate';\n\nconst useLang = (): LangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    return addLocalizationCallback(forceUpdate);\n  });\n\n  return getTranslationFn();\n};\n\nexport default useLang;\n","import { useCallback } from '../lib/teact/teact';\n\nimport { useStateRef } from './useStateRef';\n\nexport default function useLastCallback<T extends AnyFunction>(callback?: T) {\n  const ref = useStateRef(callback);\n\n  // No need for ref dependency\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  return useCallback((...args: Parameters<T>) => ref.current?.(...args), []) as T;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport { ApiMediaFormat } from '../api/types';\n\nimport { selectIsSynced } from '../global/selectors';\nimport * as mediaLoader from '../util/mediaLoader';\nimport useSelector from './data/useSelector';\nimport useForceUpdate from './useForceUpdate';\n\nconst useMedia = (\n  mediaHash: string | false | undefined,\n  noLoad = false,\n  mediaFormat = ApiMediaFormat.BlobUrl,\n  delay?: number | false,\n) => {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory(mediaHash) : undefined;\n  const forceUpdate = useForceUpdate();\n  const isSynced = useSelector(selectIsSynced);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash && !mediaData) {\n      const startedAt = Date.now();\n\n      mediaLoader.fetch(mediaHash, mediaFormat).then(() => {\n        const spentTime = Date.now() - startedAt;\n        if (!delay || spentTime >= delay) {\n          forceUpdate();\n        } else {\n          setTimeout(forceUpdate, delay - spentTime);\n        }\n      });\n    }\n  }, [noLoad, mediaHash, mediaData, mediaFormat, delay, isSynced]);\n\n  return mediaData;\n};\n\nexport default useMedia;\n","import useShowTransition, { type HookParams } from './useShowTransition';\n\nexport default function useMediaTransition<RefType extends HTMLElement = HTMLDivElement>(\n  mediaData?: unknown,\n  options?: Partial<HookParams<RefType>>,\n) {\n  const isMediaReady = Boolean(mediaData);\n\n  const { ref } = useShowTransition<RefType>({\n    isOpen: isMediaReady,\n    noMountTransition: isMediaReady,\n    className: 'slow',\n    ...options,\n  });\n\n  return ref;\n}\n","import useShowTransitionDeprecated from './useShowTransitionDeprecated';\n\nexport default function useMediaTransitionDeprecated(mediaData?: unknown) {\n  const isMediaReady = Boolean(mediaData);\n  const { transitionClassNames } = useShowTransitionDeprecated(isMediaReady, undefined, isMediaReady, 'slow');\n\n  return transitionClassNames;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport type { BundleModules, Bundles } from '../util/moduleLoader';\n\nimport { addLoadListener, getModuleFromMemory, loadModule } from '../util/moduleLoader';\nimport useForceUpdate from './useForceUpdate';\n\nconst useModuleLoader = <B extends Bundles, M extends BundleModules<B>>(\n  bundleName: B, moduleName: M, noLoad = false, autoUpdate = false,\n) => {\n  const module = getModuleFromMemory(bundleName, moduleName);\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    if (!autoUpdate) {\n      return undefined;\n    }\n\n    return addLoadListener(forceUpdate);\n  }, [autoUpdate, forceUpdate]);\n\n  useEffect(() => {\n    if (!noLoad && !module) {\n      loadModule(bundleName).then(forceUpdate);\n    }\n  }, [bundleName, forceUpdate, module, moduleName, noLoad]);\n\n  return module;\n};\n\nexport default useModuleLoader;\n","import * as langProvider from '../util/oldLangProvider';\nimport useEffectOnce from './useEffectOnce';\nimport useForceUpdate from './useForceUpdate';\n\nexport type OldLangFn = langProvider.LangFn;\n/**\n * @deprecated\n */\nconst useOldLang = (): OldLangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    return langProvider.addCallback(forceUpdate);\n  });\n\n  return langProvider.getTranslationFn();\n};\n\nexport default useOldLang;\n","import { useRef } from '../lib/teact/teact';\n\n/**\n * @deprecated\n */\nfunction usePreviousDeprecated<T extends any>(next: T): T | undefined;\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined: true): Exclude<T, undefined> | undefined;\n// eslint-disable-next-line max-len\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined?: boolean): Exclude<T, undefined> | undefined;\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined?: boolean) {\n  const ref = useRef<T>();\n  const { current } = ref;\n  if (!shouldSkipUndefined || next !== undefined) {\n    ref.current = next;\n  }\n\n  return current;\n}\n\nexport default usePreviousDeprecated;\n","import { useEffect } from '../lib/teact/teact';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nconst startCallbacks = createCallbackManager();\nconst endCallbacks = createCallbackManager();\n\nlet timeout: number | undefined;\nlet isActive = false;\n\nconst usePriorityPlaybackCheck = (\n  onStart?: AnyToVoidFunction,\n  onEnd?: AnyToVoidFunction,\n  isDisabled = false,\n) => {\n  const lastOnStart = useLastCallback(onStart);\n  const lastOnEnd = useLastCallback(onEnd);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (isActive) {\n      lastOnStart();\n    }\n\n    startCallbacks.addCallback(lastOnStart);\n    endCallbacks.addCallback(lastOnEnd);\n\n    return () => {\n      endCallbacks.removeCallback(lastOnEnd);\n      startCallbacks.removeCallback(lastOnStart);\n    };\n  }, [isDisabled, lastOnStart, lastOnEnd]);\n};\n\nexport function isPriorityPlaybackActive() {\n  return isActive;\n}\n\nexport function dispatchPriorityPlaybackEvent() {\n  if (!isActive) {\n    isActive = true;\n    startCallbacks.runCallbacks();\n  }\n\n  if (timeout) {\n    clearTimeout(timeout);\n    timeout = undefined;\n  }\n\n  // Race condition may happen if another `dispatchPriorityPlaybackEvent` is called before `onEnd`\n  function onEnd() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = undefined;\n    }\n\n    isActive = false;\n    endCallbacks.runCallbacks();\n  }\n\n  return onEnd;\n}\n\nexport default usePriorityPlaybackCheck;\n","import { useEffect } from '../lib/teact/teact';\n\nimport type { CallbackManager } from '../util/callbacks';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport { useStateRef } from './useStateRef';\n\nconst elementObserverMap = new Map<HTMLElement, [ResizeObserver, CallbackManager]>();\n\nexport default function useResizeObserver(\n  ref: React.RefObject<HTMLElement> | undefined,\n  onResize: (entry: ResizeObserverEntry) => void,\n  isDisabled = false,\n) {\n  const onResizeRef = useStateRef(onResize);\n\n  useEffect(() => {\n    const el = ref?.current;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    const callback: ResizeObserverCallback = ([entry]) => {\n      // Ignore updates when element is not properly mounted (`display: none`)\n      if (entry.contentRect.width === 0 && entry.contentRect.height === 0) {\n        return;\n      }\n\n      onResizeRef.current(entry);\n    };\n\n    let [observer, callbackManager] = elementObserverMap.get(el) || [undefined, undefined];\n    if (!observer) {\n      callbackManager = createCallbackManager();\n      observer = new ResizeObserver(callbackManager.runCallbacks);\n      elementObserverMap.set(el, [observer, callbackManager]);\n      observer.observe(el);\n    }\n    callbackManager!.addCallback(callback);\n\n    return () => {\n      callbackManager!.removeCallback(callback);\n      if (!callbackManager!.hasCallbacks()) {\n        observer!.unobserve(el);\n        observer!.disconnect();\n        elementObserverMap.delete(el);\n      }\n    };\n  }, [isDisabled, onResizeRef, ref]);\n}\n","import { getIsHeavyAnimating, useEffect } from '../lib/teact/teact';\n\nimport type { CallbackManager } from '../util/callbacks';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nconst elementObserverMap = new Map<HTMLElement, [IntersectionObserver, CallbackManager]>();\n\nexport default function useSharedIntersectionObserver(\n  refOrElement: React.RefObject<HTMLElement> | HTMLElement | undefined,\n  onIntersectionChange: (entry: IntersectionObserverEntry) => void,\n  isDisabled = false,\n) {\n  const onIntersectionChangeLast = useLastCallback(onIntersectionChange);\n\n  useEffect(() => {\n    const el = refOrElement && 'current' in refOrElement ? refOrElement.current : refOrElement;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n\n    function flush() {\n      for (const entry of entriesAccumulator.values()) {\n        // Ignore updates when element is not properly mounted (`display: none`)\n        if (!(entry.target as HTMLElement).offsetParent) {\n          continue;\n        }\n\n        onIntersectionChangeLast(entry);\n      }\n\n      entriesAccumulator.clear();\n    }\n\n    const callback: IntersectionObserverCallback = ([entry]) => {\n      entriesAccumulator.set(entry.target, entry);\n\n      if (!getIsHeavyAnimating()) {\n        flush();\n      } else {\n        getIsHeavyAnimating.once(() => {\n          requestMeasure(flush);\n        });\n      }\n    };\n\n    let [observer, callbackManager] = elementObserverMap.get(el) || [undefined, undefined];\n    if (!observer) {\n      callbackManager = createCallbackManager();\n      observer = new IntersectionObserver(callbackManager.runCallbacks);\n      elementObserverMap.set(el, [observer, callbackManager]);\n      observer.observe(el);\n    }\n    callbackManager!.addCallback(callback);\n\n    return () => {\n      callbackManager!.removeCallback(callback);\n      if (!callbackManager!.hasCallbacks()) {\n        observer!.unobserve(el);\n        observer!.disconnect();\n        elementObserverMap.delete(el);\n      }\n    };\n  }, [isDisabled, refOrElement]);\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport useSyncEffect from './useSyncEffect';\n\nconst useLayoutEffectWithPrevDeps = <const T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T,\n) => {\n  const prevDepsRef = useRef<T>();\n\n  return useSyncEffect(() => {\n    const prevDeps = prevDepsRef.current;\n    prevDepsRef.current = dependencies;\n\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n};\n\nexport default useLayoutEffectWithPrevDeps;\n","import type { RefObject } from '../lib/teact/teact';\nimport { useLayoutEffect, useRef, useSignal } from '../lib/teact/teact';\nimport { addExtraClass, toggleExtraClass } from '../lib/teact/teact-dom';\n\nimport type { Signal } from '../util/signals';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport useDerivedSignal from './useDerivedSignal';\nimport useDerivedState from './useDerivedState';\nimport useLastCallback from './useLastCallback';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\nimport useSyncEffectWithPrevDeps from './useSyncEffectWithPrevDeps';\n\nconst CLOSE_DURATION = 350;\n\ntype BaseHookParams<RefType extends HTMLElement> = {\n  isOpen: boolean | undefined;\n  ref?: RefObject<RefType | null>;\n  noMountTransition?: boolean;\n  noOpenTransition?: boolean;\n  noCloseTransition?: boolean;\n  closeDuration?: number;\n  className?: string | false;\n  prefix?: string;\n  shouldForceOpen?: boolean;\n  onCloseAnimationEnd?: NoneToVoidFunction;\n};\n\nexport type HookParams<RefType extends HTMLElement> = BaseHookParams<RefType> & {\n  withShouldRender?: never;\n};\n\ntype HookParamsWithShouldRender<RefType extends HTMLElement> = BaseHookParams<RefType> & {\n  withShouldRender: true;\n};\n\ntype HookResult<RefType extends HTMLElement> = {\n  ref: RefObject<RefType | null>;\n  getIsClosing: Signal<boolean>;\n};\n\ntype HookResultWithShouldRender<RefType extends HTMLElement> = HookResult<RefType> & {\n  shouldRender: boolean;\n};\n\ntype State =\n  'closed'\n  | 'scheduled-open'\n  | 'open'\n  | 'closing';\n\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParams<RefType>\n): HookResult<RefType>;\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParamsWithShouldRender<RefType>\n): HookResultWithShouldRender<RefType>;\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParams<RefType> | HookParamsWithShouldRender<RefType>,\n): HookResult<RefType> | HookResultWithShouldRender<RefType> {\n  const {\n    isOpen,\n    noMountTransition = false,\n    noOpenTransition = false,\n    noCloseTransition = false,\n    closeDuration = CLOSE_DURATION,\n    className = 'fast',\n    prefix = '',\n    shouldForceOpen,\n    onCloseAnimationEnd,\n  } = params;\n\n  // eslint-disable-next-line no-null/no-null\n  const localRef = useRef<RefType>(null);\n  const ref = params.ref || localRef;\n  const closingTimeoutRef = useRef<number>();\n  const [getState, setState] = useSignal<State | undefined>();\n  const optionsRef = useStateRef({\n    closeDuration, noMountTransition, noOpenTransition, noCloseTransition,\n  });\n  const onCloseEndLast = useLastCallback(onCloseAnimationEnd);\n\n  useSyncEffectWithPrevDeps(([prevIsOpen]) => {\n    const options = optionsRef.current;\n\n    if (shouldForceOpen) {\n      setState('open');\n      return;\n    }\n\n    if (isOpen) {\n      if (closingTimeoutRef.current) {\n        clearTimeout(closingTimeoutRef.current);\n        closingTimeoutRef.current = undefined;\n      }\n\n      if (options.noOpenTransition || (prevIsOpen === undefined && options.noMountTransition)) {\n        setState('open');\n      } else {\n        setState('scheduled-open');\n        requestMeasure(() => {\n          setState('open');\n        });\n      }\n    } else if (prevIsOpen === undefined || options.noCloseTransition) {\n      setState('closed');\n    } else {\n      setState('closing');\n\n      closingTimeoutRef.current = window.setTimeout(() => {\n        setState('closed');\n        onCloseEndLast();\n      }, options.closeDuration);\n    }\n  }, [isOpen, shouldForceOpen]);\n\n  const applyClassNames = useLastCallback(() => {\n    const element = ref.current;\n    if (!element) return;\n\n    if (className !== false) {\n      addExtraClass(element, 'opacity-transition');\n      addExtraClass(element, className);\n    }\n\n    const state = getState();\n    const shouldRender = state !== 'closed';\n    const hasOpenClass = state === 'open';\n    const isClosing = state === 'closing';\n\n    toggleExtraClass(element, `${prefix}shown`, shouldRender);\n    toggleExtraClass(element, `${prefix}not-shown`, !shouldRender);\n    toggleExtraClass(element, `${prefix}open`, hasOpenClass);\n    toggleExtraClass(element, `${prefix}not-open`, !hasOpenClass);\n    toggleExtraClass(element, `${prefix}closing`, isClosing);\n  });\n\n  // Workaround for Chrome causing forced reflow in the middle of mutation phase when unmounting a focused element.\n  // Due to such forced reflow setting initial class names in the first layout effect causes transitions to start.\n  useSyncEffect(() => {\n    ref.onChange = () => {\n      ref.onChange = undefined;\n      applyClassNames();\n    };\n  }, [applyClassNames, ref]);\n\n  useLayoutEffect(applyClassNames, [applyClassNames, getState]);\n\n  const withShouldRender = 'withShouldRender' in params && params.withShouldRender;\n  const shouldRender = useDerivedState(\n    () => (withShouldRender && getState() !== 'closed'),\n    [withShouldRender, getState],\n  );\n\n  const getIsClosing = useDerivedSignal(() => getState() === 'closing', [getState]);\n\n  if (withShouldRender) {\n    return { ref, shouldRender, getIsClosing };\n  }\n\n  return { ref, getIsClosing };\n}\n","import { useRef, useState } from '../lib/teact/teact';\n\nimport buildClassName from '../util/buildClassName';\n\nconst CLOSE_DURATION = 350;\n\nconst useShowTransitionDeprecated = (\n  isOpen = false,\n  onCloseTransitionEnd?: () => void,\n  noFirstOpenTransition = false,\n  className: string | false = 'fast',\n  noCloseTransition = false,\n  closeDuration = CLOSE_DURATION,\n  noOpenTransition = false,\n) => {\n  const [isClosed, setIsClosed] = useState(!isOpen);\n  const closeTimeoutRef = useRef<number>();\n  // СSS class should be added in a separate tick to turn on CSS transition.\n  const [hasOpenClassName, setHasOpenClassName] = useState(isOpen && noFirstOpenTransition);\n\n  if (isOpen) {\n    setIsClosed(false);\n    setHasOpenClassName(true);\n\n    if (closeTimeoutRef.current) {\n      window.clearTimeout(closeTimeoutRef.current);\n\n      closeTimeoutRef.current = undefined;\n    }\n  } else {\n    setHasOpenClassName(false);\n\n    if (!isClosed && !closeTimeoutRef.current) {\n      const exec = () => {\n        setIsClosed(true);\n\n        if (onCloseTransitionEnd) {\n          onCloseTransitionEnd();\n        }\n\n        closeTimeoutRef.current = undefined;\n      };\n\n      if (noCloseTransition) {\n        exec();\n      } else {\n        closeTimeoutRef.current = window.setTimeout(exec, closeDuration);\n      }\n    }\n  }\n\n  // `noCloseTransition`, when set to true, should remove the open class immediately\n  const shouldHaveOpenClassName = (hasOpenClassName && !(noCloseTransition && !isOpen)) || (noOpenTransition && isOpen);\n  const isClosing = Boolean(closeTimeoutRef.current);\n  const shouldRender = isOpen || isClosing;\n  const transitionClassNames = buildClassName(\n    className && 'opacity-transition',\n    className,\n    shouldHaveOpenClassName && 'open',\n    !shouldHaveOpenClassName && 'not-open',\n    shouldRender && 'shown',\n    !shouldRender && 'not-shown',\n    isClosing && 'closing',\n  );\n\n  return {\n    shouldRender,\n    transitionClassNames,\n    hasShownClass: shouldRender,\n    hasOpenClass: shouldHaveOpenClassName,\n    isClosing,\n  };\n};\n\nexport default useShowTransitionDeprecated;\n","import { useRef, useUnmountCleanup } from '../lib/teact/teact';\n\nimport { cleanupEffect, isSignal } from '../util/signals';\n\nexport function useSignalEffect(effect: NoneToVoidFunction, dependencies: readonly any[]) {\n  // The is extracted from `useEffectOnce` to run before all effects\n  const isFirstRun = useRef(true);\n  if (isFirstRun.current) {\n    isFirstRun.current = false;\n\n    dependencies?.forEach((dependency) => {\n      if (isSignal(dependency)) {\n        dependency.subscribe(effect);\n      }\n    });\n  }\n\n  useUnmountCleanup(() => {\n    cleanupEffect(effect);\n  });\n}\n","import { useRef } from '../lib/teact/teact';\n\n// Allows to use state value as \"silent\" dependency in hooks (not causing updates).\n// Also useful for state values that update frequently (such as controlled input value).\nexport function useStateRef<T>(value: T) {\n  const ref = useRef<T>(value);\n  ref.current = value;\n  return ref;\n}\n","import { useRef, useUnmountCleanup } from '../lib/teact/teact';\n\nimport usePreviousDeprecated from './usePreviousDeprecated';\n\nexport default function useSyncEffect<const T extends readonly any[]>(\n  effect: (args: T | readonly []) => NoneToVoidFunction | void,\n  dependencies: T,\n) {\n  const prevDeps = usePreviousDeprecated<T>(dependencies);\n  const cleanupRef = useRef<NoneToVoidFunction>();\n\n  if (!prevDeps || dependencies.some((d, i) => d !== prevDeps[i])) {\n    cleanupRef.current?.();\n    cleanupRef.current = effect(prevDeps || []) ?? undefined;\n  }\n\n  useUnmountCleanup(() => {\n    cleanupRef.current?.();\n  });\n}\n","import { useCallback, useMemo } from '../lib/teact/teact';\n\nimport type { Scheduler } from '../util/schedulers';\n\nimport { throttle, throttleWith } from '../util/schedulers';\n\nexport default function useThrottledCallback<T extends AnyToVoidFunction>(\n  fn: T,\n  deps: any[],\n  msOrSchedulerFn: number | Scheduler,\n  noFirst = false,\n) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(fn, deps);\n\n  return useMemo(() => {\n    if (typeof msOrSchedulerFn === 'number') {\n      return throttle(fnMemo, msOrSchedulerFn, !noFirst);\n    } else {\n      return throttleWith(msOrSchedulerFn, fnMemo);\n    }\n  }, [fnMemo, msOrSchedulerFn, noFirst]);\n}\n","import { useMemo } from '../lib/teact/teact';\nimport { getGlobal } from '../global';\n\nimport type { ApiSticker, MediaContainer } from '../api/types';\n\nimport { getMessageMediaThumbDataUri } from '../global/helpers';\nimport { selectTheme } from '../global/selectors';\n\nexport default function useThumbnail(media?: MediaContainer | ApiSticker) {\n  const isMediaContainer = media && 'content' in media;\n  const thumbDataUri = isMediaContainer ? getMessageMediaThumbDataUri(media) : media?.thumbnail?.dataUri;\n\n  // TODO Find a way to update thumbnail on theme change\n  const theme = selectTheme(getGlobal());\n\n  const dataUri = useMemo(() => {\n    const uri = thumbDataUri;\n    if (!uri || theme !== 'dark') return uri;\n\n    return uri.replace('<svg', '<svg fill=\"white\"');\n  }, [thumbDataUri, theme]);\n\n  return dataUri;\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport generateUniqueId from '../util/generateUniqueId';\n\nexport default function useUniqueId() {\n  const idRef = useRef<string>();\n\n  if (!idRef.current) {\n    idRef.current = generateUniqueId();\n  }\n\n  return idRef.current;\n}\n","import type { RefObject } from 'react';\nimport { resolveEventType } from '../lib/teact/dom-events';\nimport { onFullyIdle, useLayoutEffect } from '../lib/teact/teact';\n\nimport unloadVideo from '../util/browser/unloadVideo';\nimport { useStateRef } from './useStateRef';\n\n// Fix memory leak when unmounting video element\nexport default function useVideoCleanup(videoRef: RefObject<HTMLVideoElement>, handlers?: Record<string, AnyFunction>) {\n  const handlersRef = useStateRef(handlers);\n\n  useLayoutEffect(() => {\n    const videoEl = videoRef.current;\n    if (!videoEl) return undefined;\n\n    return () => {\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      const handlers2 = handlersRef.current;\n      if (handlers2) {\n        Object.entries(handlers2).forEach(([key, value]) => {\n          videoEl.removeEventListener(resolveEventType(key, videoEl), value, false);\n        });\n      }\n\n      // It may be slow (specifically on iOS), so we postpone it after unmounting\n      onFullyIdle(() => {\n        unloadVideo(videoEl);\n      });\n    };\n  }, [handlersRef, videoRef]);\n}\n","import type { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\n\nconst BACKDROP_CLASSNAME = 'backdrop';\n\n// This effect implements closing menus by clicking outside of them\n// without adding extra elements to the DOM\nexport default function useVirtualBackdrop(\n  isOpen: boolean,\n  containerRef: RefObject<HTMLElement>,\n  onClose?: () => void | undefined,\n  ignoreRightClick?: boolean,\n  excludedClosestSelector?: string,\n) {\n  useEffect(() => {\n    if (!isOpen || !onClose) {\n      return undefined;\n    }\n\n    const handleEvent = (e: MouseEvent) => {\n      const container = containerRef.current;\n      const target = e.target as HTMLElement | null;\n      if (!container || !target || (ignoreRightClick && e.button === 2)) {\n        return;\n      }\n\n      if ((\n        !container.contains(e.target as Node | null)\n        || target.classList.contains(BACKDROP_CLASSNAME)\n      ) && !(excludedClosestSelector && (\n        target.matches(excludedClosestSelector) || target.closest(excludedClosestSelector)\n      ))) {\n        e.preventDefault();\n        e.stopPropagation();\n        onClose?.();\n      }\n    };\n\n    document.addEventListener('mousedown', handleEvent);\n\n    return () => {\n      document.removeEventListener('mousedown', handleEvent);\n    };\n  }, [excludedClosestSelector, ignoreRightClick, isOpen, containerRef, onClose]);\n}\n","import { useEffect } from '../../lib/teact/teact';\n\nimport { createCallbackManager } from '../../util/callbacks';\nimport useLastCallback from '../useLastCallback';\n\nconst blurCallbacks = createCallbackManager();\nconst focusCallbacks = createCallbackManager();\n\nlet isFocused = document.hasFocus();\n\nwindow.addEventListener('blur', () => {\n  if (!isFocused) {\n    return;\n  }\n\n  isFocused = false;\n  blurCallbacks.runCallbacks();\n});\n\nwindow.addEventListener('focus', () => {\n  isFocused = true;\n  focusCallbacks.runCallbacks();\n});\n\nexport default function useBackgroundMode(\n  onBlur?: AnyToVoidFunction,\n  onFocus?: AnyToVoidFunction,\n  isDisabled = false,\n) {\n  const lastOnBlur = useLastCallback(onBlur);\n  const lastOnFocus = useLastCallback(onFocus);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (!isFocused) {\n      lastOnBlur();\n    }\n\n    blurCallbacks.addCallback(lastOnBlur);\n    focusCallbacks.addCallback(lastOnFocus);\n\n    return () => {\n      focusCallbacks.removeCallback(lastOnFocus);\n      blurCallbacks.removeCallback(lastOnBlur);\n    };\n  }, [isDisabled, lastOnBlur, lastOnFocus]);\n}\n\nexport function isBackgroundModeActive() {\n  return !isFocused;\n}\n","import { useState } from '../../lib/teact/teact';\n\nimport { createCallbackManager } from '../../util/callbacks';\nimport useEffectOnce from '../useEffectOnce';\n\nconst callbacks = createCallbackManager();\n\nfunction createListener() {\n  window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`)\n    .addEventListener('change', callbacks.runCallbacks, { once: true });\n}\n\nexport default function useDevicePixelRatio() {\n  const [dpr, setDpr] = useState(window.devicePixelRatio);\n\n  useEffectOnce(() => {\n    return callbacks.addCallback(() => {\n      setDpr(window.devicePixelRatio);\n    });\n  });\n\n  return dpr;\n}\n\ncreateListener();\n\n// Set up new listener for the next `devicePixelRatio` change\ncallbacks.addCallback(createListener);\n","import { useEffect, useMemo, useState } from '../../lib/teact/teact';\n\nimport { throttle } from '../../util/schedulers';\nimport windowSize from '../../util/windowSize';\nimport useDebouncedCallback from '../useDebouncedCallback';\n\nconst THROTTLE = 250;\n\nexport default function useWindowSize() {\n  const { width: initialWidth, height: initialHeight } = windowSize.get();\n  const [width, setWidth] = useState(initialWidth);\n  const [height, setHeight] = useState(initialHeight);\n  const [isResizing, setIsResizing] = useState(false);\n  const setIsResizingDebounced = useDebouncedCallback(setIsResizing, [setIsResizing], THROTTLE, true);\n\n  useEffect(() => {\n    const throttledSetIsResizing = throttle(() => {\n      setIsResizing(true);\n    }, THROTTLE, true);\n\n    const throttledSetSize = throttle(() => {\n      const { width: newWidth, height: newHeight } = windowSize.get();\n      setWidth(newWidth);\n      setHeight(newHeight);\n      setIsResizingDebounced(false);\n    }, THROTTLE, false);\n\n    const handleResize = () => {\n      throttledSetIsResizing();\n      throttledSetSize();\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [setIsResizingDebounced]);\n\n  return useMemo(() => ({ width, height, isResizing }), [height, isResizing, width]);\n}\n","import safeExec from '../../util/safeExec';\nimport { fastRaf, throttleWith } from '../../util/schedulers';\nimport { setPhase } from './stricterdom';\n\nlet pendingMeasureTasks: NoneToVoidFunction[] = [];\nlet pendingMutationTasks: NoneToVoidFunction[] = [];\nlet pendingForceReflowTasks: (() => NoneToVoidFunction | void)[] = [];\n\nconst runUpdatePassOnRaf = throttleWithRafFallback(() => {\n  const currentMeasureTasks = pendingMeasureTasks;\n  pendingMeasureTasks = [];\n  currentMeasureTasks.forEach((task) => {\n    safeExec(task);\n  });\n\n  // We use promises to provide correct order for Mutation Observer callback microtasks\n  Promise.resolve()\n    .then(() => {\n      setPhase('mutate');\n\n      const currentMutationTasks = pendingMutationTasks;\n      pendingMutationTasks = [];\n\n      currentMutationTasks.forEach((task) => {\n        safeExec(task);\n      });\n    })\n    .then(() => {\n      setPhase('measure');\n\n      const pendingForceReflowMutationTasks: NoneToVoidFunction[] = [];\n      // Will include tasks created during the loop\n      for (const task of pendingForceReflowTasks) {\n        safeExec(() => {\n          const mutationTask = task();\n          if (mutationTask) {\n            pendingForceReflowMutationTasks.push(mutationTask);\n          }\n        });\n      }\n      pendingForceReflowTasks = [];\n\n      return pendingForceReflowMutationTasks;\n    })\n    .then((pendingForceReflowMutationTasks) => {\n      setPhase('mutate');\n\n      // Will include tasks created during the loop\n      for (const task of pendingForceReflowMutationTasks) {\n        safeExec(task);\n      }\n    })\n    .then(() => {\n      setPhase('measure');\n    });\n});\n\nexport function requestMeasure(cb: NoneToVoidFunction) {\n  pendingMeasureTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nexport function requestMutation(cb: NoneToVoidFunction) {\n  pendingMutationTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nexport function requestNextMutation(cb: () => (NoneToVoidFunction | void)) {\n  requestMeasure(() => {\n    requestMutation(cb);\n  });\n}\n\nexport function requestForcedReflow(cb: () => (NoneToVoidFunction | void)) {\n  pendingForceReflowTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nfunction throttleWithRafFallback<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith((throttledFn: NoneToVoidFunction) => {\n    fastRaf(throttledFn, true);\n  }, fn);\n}\n\nexport * from './stricterdom';\n","// https://gist.github.com/paulirish/5d52fb081b3570c81e3a\n\nexport default {\n  Element: {\n    props: [\n      'clientLeft', 'clientTop', 'clientWidth', 'clientHeight',\n      'scrollWidth', 'scrollHeight', 'scrollLeft', 'scrollTop',\n    ] as const,\n    methods: [\n      'getClientRects', 'getBoundingClientRect',\n      'scrollBy', 'scrollTo', 'scrollIntoView', 'scrollIntoViewIfNeeded',\n    ] as const,\n  },\n  HTMLElement: {\n    props: [\n      'offsetLeft', 'offsetTop', 'offsetWidth', 'offsetHeight', 'offsetParent',\n      'innerText',\n    ] as const,\n    methods: ['focus'] as const,\n  },\n  window: {\n    props: [\n      'scrollX', 'scrollY',\n      'innerHeight', 'innerWidth',\n    ] as const,\n    methods: ['getComputedStyle'] as const,\n  },\n  VisualViewport: {\n    props: [\n      'height', 'width', 'offsetTop', 'offsetLeft',\n    ] as const,\n  },\n  Document: {\n    props: ['scrollingElement'] as const,\n    methods: ['elementFromPoint'] as const,\n  },\n  HTMLInputElement: {\n    methods: ['select'] as const,\n  },\n  MouseEvent: {\n    props: ['layerX', 'layerY', 'offsetX', 'offsetY'] as const,\n  },\n  Range: {\n    methods: ['getClientRects', 'getBoundingClientRect'] as const,\n  },\n};\n","import LAYOUT_CAUSES from './layoutCauses';\n\ntype Entities = keyof typeof LAYOUT_CAUSES;\ntype Phase =\n  'measure'\n  | 'mutate';\ntype ErrorHandler = (error: Error) => any;\n\n// eslint-disable-next-line no-console\nconst DEFAULT_ERROR_HANDLER = console.error;\n\nlet onError: ErrorHandler = DEFAULT_ERROR_HANDLER;\n\nconst nativeMethods = new Map<string, AnyFunction>();\n\nlet phase: Phase = 'measure';\nlet isStrict = false;\nlet observer: MutationObserver | undefined;\n\nexport function setPhase(newPhase: Phase) {\n  phase = newPhase;\n}\n\nexport function getPhase() {\n  return phase;\n}\n\nexport function enableStrict() {\n  if (isStrict) return;\n\n  isStrict = true;\n  setupLayoutDetectors();\n  setupMutationObserver();\n}\n\nexport function disableStrict() {\n  if (!isStrict) return;\n\n  clearMutationObserver();\n  clearLayoutDetectors();\n  isStrict = false;\n}\n\nexport function forceMeasure(cb: () => any) {\n  if (phase !== 'mutate') {\n    throw new Error('The current phase is \\'measure\\'');\n  }\n\n  phase = 'measure';\n  const result = cb();\n  phase = 'mutate';\n\n  return result;\n}\n\nconst forcedMutationAllowedFor = new Set<Node>();\n\nexport function forceMutation(cb: () => any, nodes: Node | Node[]) {\n  if (phase !== 'measure') {\n    throw new Error('The current phase is \\'mutate\\'');\n  }\n\n  if (isStrict) {\n    if (Array.isArray(nodes)) {\n      nodes.forEach((node) => {\n        forcedMutationAllowedFor.add(node);\n      });\n    } else {\n      forcedMutationAllowedFor.add(nodes);\n    }\n  }\n\n  return cb();\n}\n\nexport function setHandler(handler?: ErrorHandler) {\n  onError = handler || DEFAULT_ERROR_HANDLER;\n}\n\nfunction setupLayoutDetectors() {\n  Object.entries(LAYOUT_CAUSES).forEach(([name, causes]) => {\n    const entity = window[name as Entities];\n    if (!entity) return;\n    const prototype = typeof entity === 'object' ? entity : entity.prototype;\n\n    if ('props' in causes) {\n      causes.props.forEach((prop) => {\n        const nativeGetter = Object.getOwnPropertyDescriptor(prototype, prop)?.get;\n        if (!nativeGetter) {\n          return;\n        }\n\n        nativeMethods.set(`${name}#${prop}`, nativeGetter);\n\n        Object.defineProperty(prototype, prop, {\n          get() {\n            onMeasure(prop);\n\n            return nativeGetter.call(this);\n          },\n        });\n      });\n    }\n\n    if ('methods' in causes) {\n      causes.methods.forEach((method) => {\n        const nativeMethod = (prototype as any)[method]!;\n        nativeMethods.set(`${name}#${method}`, nativeMethod);\n\n        // eslint-disable-next-line func-names\n        (prototype as any)[method] = function (...args: any[]) {\n          onMeasure(method);\n\n          return nativeMethod.apply(this, args);\n        };\n      });\n    }\n  });\n}\n\nfunction clearLayoutDetectors() {\n  Object.entries(LAYOUT_CAUSES).forEach(([name, causes]) => {\n    const entity = window[name as Entities];\n    if (!entity) return;\n    const prototype = typeof entity === 'object' ? entity : entity.prototype;\n\n    if ('props' in causes) {\n      causes.props.forEach((prop) => {\n        const nativeGetter = nativeMethods.get(`${name}#${prop}`);\n        if (!nativeGetter) {\n          return;\n        }\n\n        Object.defineProperty(prototype, prop, { get: nativeGetter });\n      });\n    }\n\n    if ('methods' in causes) {\n      causes.methods.forEach((method) => {\n        (prototype as any)[method] = nativeMethods.get(`${name}#${method}`)!;\n      });\n    }\n  });\n\n  nativeMethods.clear();\n}\n\nfunction setupMutationObserver() {\n  observer = new MutationObserver((mutations) => {\n    if (phase !== 'mutate') {\n      mutations.forEach(({ target, type, attributeName }) => {\n        if (!document.contains(target)) {\n          return;\n        }\n\n        if (forcedMutationAllowedFor.has(target)) {\n          return;\n        }\n\n        if (type === 'childList' && target instanceof HTMLElement && target.contentEditable) {\n          return;\n        }\n\n        if (attributeName?.startsWith('data-')) {\n          return;\n        }\n\n        if (attributeName === 'class' && target instanceof HTMLElement && target.dataset.markdownMarker) {\n          return;\n        }\n\n        // eslint-disable-next-line no-console\n        onError(new Error(`Unexpected mutation detected: \\`${type === 'attributes' ? attributeName : type}\\``));\n      });\n    }\n\n    forcedMutationAllowedFor.clear();\n  });\n\n  observer.observe(document.body, {\n    childList: true,\n    attributes: true,\n    subtree: true,\n    characterData: false,\n  });\n}\n\nfunction clearMutationObserver() {\n  observer?.disconnect();\n  observer = undefined;\n}\n\nfunction onMeasure(propName: string) {\n  if (phase !== 'measure') {\n    onError(new Error(`Unexpected measurement detected: \\`${propName}\\``));\n  }\n}\n","import { DEBUG } from '../../config';\n\ntype Handler = (e: Event) => void;\ntype DelegationRegistry = Map<Element, Handler>;\n\nconst NON_BUBBLEABLE_EVENTS = new Set(['scroll', 'mouseenter', 'mouseleave', 'load']);\n\nconst documentEventCounters: Record<string, number> = {};\nconst delegationRegistryByEventType: Record<string, DelegationRegistry> = {};\nconst delegatedEventTypesByElement = new Map<Element, Set<string>>();\n\nexport function addEventListener(element: Element, propName: string, handler: Handler, asCapture = false) {\n  const eventType = resolveEventType(propName, element);\n  if (canUseEventDelegation(eventType, element, asCapture)) {\n    addDelegatedListener(eventType, element, handler);\n  } else {\n    element.addEventListener(eventType, handler, asCapture);\n  }\n}\n\nexport function removeEventListener(element: Element, propName: string, handler: Handler, asCapture = false) {\n  const eventType = resolveEventType(propName, element);\n  if (canUseEventDelegation(eventType, element, asCapture)) {\n    removeDelegatedListener(eventType, element);\n  } else {\n    element.removeEventListener(eventType, handler, asCapture);\n  }\n}\n\nexport function resolveEventType(propName: string, element: Element) {\n  const eventType = propName\n    .replace(/^on/, '')\n    .replace(/Capture$/, '').toLowerCase();\n\n  if (eventType === 'change' && element.tagName !== 'SELECT') {\n    // React behavior repeated here.\n    // https://stackoverflow.com/questions/38256332/in-react-whats-the-difference-between-onchange-and-oninput\n    return 'input';\n  }\n\n  if (eventType === 'doubleclick') {\n    return 'dblclick';\n  }\n\n  // Replace focus/blur by their \"bubbleable\" versions\n  if (eventType === 'focus') {\n    return 'focusin';\n  }\n\n  if (eventType === 'blur') {\n    return 'focusout';\n  }\n\n  return eventType;\n}\n\nfunction canUseEventDelegation(realEventType: string, element: Element, asCapture: boolean) {\n  return (\n    !asCapture\n    && !NON_BUBBLEABLE_EVENTS.has(realEventType)\n    && element.tagName !== 'VIDEO'\n    && element.tagName !== 'IFRAME'\n  );\n}\n\nfunction addDelegatedListener(eventType: string, element: Element, handler: Handler) {\n  if (!documentEventCounters[eventType]) {\n    documentEventCounters[eventType] = 0;\n    document.addEventListener(eventType, handleEvent);\n  }\n\n  resolveDelegationRegistry(eventType).set(element, handler);\n  resolveDelegatedEventTypes(element).add(eventType);\n  documentEventCounters[eventType]++;\n}\n\nfunction removeDelegatedListener(eventType: string, element: Element) {\n  documentEventCounters[eventType]--;\n  if (!documentEventCounters[eventType]) {\n    // Synchronous deletion on 0 will cause perf degradation in the case of 1 element\n    // which is not a real case, so it's ok to do it this way\n    document.removeEventListener(eventType, handleEvent);\n  }\n\n  delegationRegistryByEventType[eventType].delete(element);\n  delegatedEventTypesByElement.get(element)!.delete(eventType);\n}\n\nexport function removeAllDelegatedListeners(element: Element) {\n  const eventTypes = delegatedEventTypesByElement.get(element);\n  if (!eventTypes) {\n    return;\n  }\n\n  eventTypes.forEach((eventType) => removeDelegatedListener(eventType, element));\n  delegatedEventTypesByElement.delete(element);\n}\n\nfunction handleEvent(realEvent: Event) {\n  const events = delegationRegistryByEventType[realEvent.type];\n\n  if (events) {\n    let furtherCallsPrevented = false;\n    let current: Element = realEvent.target as Element;\n\n    const stopPropagation = () => {\n      furtherCallsPrevented = true;\n    };\n\n    const preventDefault = () => {\n      realEvent.preventDefault();\n    };\n\n    // Proxy is a simplest way to provide an access to the event property\n    const event = new Proxy(realEvent, {\n      get(target, p) {\n        if (p === 'currentTarget') {\n          return current;\n        }\n        if (p === 'stopPropagation' || p === 'stopImmediatePropagation') {\n          return stopPropagation;\n        }\n        if (p === 'preventDefault') {\n          // \"this\" is changed to proxy and one can't call methods via it\n          return preventDefault;\n        }\n        return Reflect.get(target, p);\n      },\n    });\n\n    // This can also be limited by teact root\n    while (current && current !== document.body) {\n      const handler = events.get(current);\n      if (handler) {\n        handler(event);\n        if (furtherCallsPrevented) {\n          return;\n        }\n      }\n\n      current = current.parentNode as Element;\n    }\n  }\n}\n\nfunction resolveDelegationRegistry(eventType: string) {\n  if (!delegationRegistryByEventType[eventType]) {\n    delegationRegistryByEventType[eventType] = new Map();\n  }\n\n  return delegationRegistryByEventType[eventType];\n}\n\nfunction resolveDelegatedEventTypes(element: Element) {\n  const existing = delegatedEventTypesByElement.get(element);\n  if (existing) {\n    return existing;\n  }\n\n  const newSet = new Set<string>();\n  delegatedEventTypesByElement.set(element, newSet);\n\n  return newSet;\n}\n\nif (DEBUG) {\n  document.addEventListener('dblclick', () => {\n    const documentListenersCount = Object.keys(documentEventCounters).length;\n    const delegatedHandlersCount1 = Object.values(documentEventCounters)\n      .reduce((acc, counter) => acc + counter, 0);\n    const delegationRegistriesCount = Object.keys(delegationRegistryByEventType).length;\n    const delegatedHandlersCount2 = Object.values(delegationRegistryByEventType)\n      .reduce((acc, delegationRegistry) => acc + delegationRegistry.size, 0);\n    const delegationElementsCount = delegatedEventTypesByElement.size;\n    const delegatedEventTypesCount = Array.from(delegatedEventTypesByElement.values())\n      .reduce((acc, eventTypes) => acc + eventTypes.size, 0);\n\n    // eslint-disable-next-line no-console\n    console.warn('DELEGATED EVENTS STATS', {\n      delegatedHandlersCount1,\n      delegatedHandlersCount2,\n      delegatedEventTypesCount,\n      delegationRegistriesCount,\n      delegationElementsCount,\n      documentListenersCount,\n    });\n  });\n}\n","import { onIdle, throttleWith } from '../../util/schedulers';\nimport { createSignal } from '../../util/signals';\nimport { requestMeasure } from '../fasterdom/fasterdom';\n\nconst AUTO_END_TIMEOUT = 1000;\n\nlet counter = 0;\nlet counterBlocking = 0;\n\nconst [getIsAnimating, setIsAnimating] = createSignal(false);\nconst [getIsBlockingAnimating, setIsBlockingAnimating] = createSignal(false);\n\nexport const getIsHeavyAnimating = getIsAnimating;\nexport { getIsBlockingAnimating };\n\nexport function beginHeavyAnimation(duration = AUTO_END_TIMEOUT, isBlocking = false) {\n  counter++;\n\n  if (counter === 1) {\n    setIsAnimating(true);\n  }\n\n  if (isBlocking) {\n    counterBlocking++;\n\n    if (counterBlocking === 1) {\n      setIsBlockingAnimating(true);\n    }\n  }\n\n  const timeout = window.setTimeout(onEnd, duration);\n\n  let hasEnded = false;\n\n  function onEnd() {\n    if (hasEnded) return;\n    hasEnded = true;\n\n    clearTimeout(timeout);\n\n    counter--;\n\n    if (counter === 0) {\n      setIsAnimating(false);\n    }\n\n    if (isBlocking) {\n      counterBlocking--;\n\n      if (counterBlocking === 0) {\n        setIsBlockingAnimating(false);\n      }\n    }\n  }\n\n  return onEnd;\n}\n\nexport function onFullyIdle(cb: NoneToVoidFunction) {\n  onIdle(() => {\n    if (getIsAnimating()) {\n      requestMeasure(() => {\n        onFullyIdle(cb);\n      });\n    } else {\n      cb();\n    }\n  });\n}\n\nexport function throttleWithFullyIdle<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onFullyIdle, fn);\n}\n","import type { ChangeEvent } from 'react';\n\nimport type { Signal } from '../../util/signals';\nimport type {\n  VirtualElement,\n  VirtualElementChildren,\n  VirtualElementComponent,\n  VirtualElementFragment,\n  VirtualElementParent,\n  VirtualElementReal,\n  VirtualElementTag,\n} from './teact';\n\nimport { DEBUG } from '../../config';\nimport { unique } from '../../util/iteratees';\nimport { addEventListener, removeAllDelegatedListeners, removeEventListener } from './dom-events';\nimport {\n  captureImmediateEffects,\n  hasElementChanged,\n  isParentElement,\n  mountComponent,\n  MountState,\n  renderComponent,\n  unmountComponent,\n  VirtualType,\n} from './teact';\n\ninterface VirtualDomHead {\n  children: [VirtualElement] | [];\n}\n\ninterface SelectionState {\n  selectionStart: number | null;\n  selectionEnd: number | null;\n  isCaretAtEnd: boolean;\n}\n\ntype CurrentContext = Record<string, Signal<unknown>>;\n\ntype DOMElement = HTMLElement | SVGElement;\n\nconst SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\nconst HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n\nconst FILTERED_ATTRIBUTES = new Set(['key', 'ref', 'teactFastList', 'teactOrderKey']);\nconst HTML_ATTRIBUTES = new Set(['dir', 'role', 'form']);\nconst CONTROLLABLE_TAGS = ['INPUT', 'TEXTAREA', 'SELECT'];\nconst MAPPED_ATTRIBUTES: { [k: string]: string } = {\n  autoPlay: 'autoplay',\n  autoComplete: 'autocomplete',\n};\nconst INDEX_KEY_PREFIX = '__indexKey#';\n\nconst headsByElement = new WeakMap<Element, VirtualDomHead>();\nconst extraClasses = new WeakMap<Element, Set<string>>();\nconst extraStyles = new WeakMap<Element, Record<string, string>>();\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet DEBUG_virtualTreeSize = 1;\n\nfunction render($element: VirtualElement | undefined, parentEl: HTMLElement) {\n  if (!headsByElement.has(parentEl)) {\n    headsByElement.set(parentEl, { children: [] });\n  }\n\n  const runImmediateEffects = captureImmediateEffects();\n  const $head = headsByElement.get(parentEl)!;\n  const $renderedChild = renderWithVirtual(parentEl, $head.children[0], $element, $head, {}, 0);\n  runImmediateEffects?.();\n\n  $head.children = $renderedChild ? [$renderedChild] : [];\n\n  if (process.env.APP_ENV === 'perf') {\n    DEBUG_virtualTreeSize = 0;\n    DEBUG_addToVirtualTreeSize($head);\n\n    return DEBUG_virtualTreeSize;\n  }\n\n  return undefined;\n}\n\nfunction renderWithVirtual<T extends VirtualElement | undefined>(\n  parentEl: DOMElement,\n  $current: VirtualElement | undefined,\n  $new: T,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n  options: {\n    skipComponentUpdate?: boolean;\n    nextSibling?: ChildNode;\n    forceMoveToEnd?: boolean;\n    fragment?: DocumentFragment;\n    namespace?: string;\n  } = {},\n): T {\n  const { skipComponentUpdate, fragment } = options;\n  let { nextSibling, namespace } = options;\n\n  const isCurrentComponent = $current?.type === VirtualType.Component;\n  const isNewComponent = $new?.type === VirtualType.Component;\n  const $newAsReal = $new as VirtualElementReal;\n\n  const isCurrentFragment = !isCurrentComponent && $current?.type === VirtualType.Fragment;\n  const isNewFragment = !isNewComponent && $new?.type === VirtualType.Fragment;\n\n  if ($new?.type === VirtualType.Tag) {\n    if ($new.tag === 'svg') namespace = SVG_NAMESPACE;\n    if ($new.props.xmlns) namespace = $new.props.xmlns;\n  }\n\n  if (\n    !skipComponentUpdate\n    && isCurrentComponent && isNewComponent\n    && !hasElementChanged($current!, $new!)\n  ) {\n    $new = updateComponent($current, $new as VirtualElementComponent) as typeof $new;\n  }\n\n  // Parent element may have changed, so we need to update the listener closure.\n  if (\n    !skipComponentUpdate\n    && isNewComponent\n    && ($new as VirtualElementComponent).componentInstance.mountState === MountState.Mounted\n  ) {\n    setupComponentUpdateListener(parentEl, $new as VirtualElementComponent, $parent, currentContext, index);\n  }\n\n  if ($current === $new) {\n    return $new;\n  }\n\n  if (DEBUG && $new) {\n    const newTarget = 'target' in $new && $new.target;\n    if (newTarget && (!$current || ('target' in $current && newTarget !== $current.target))) {\n      throw new Error('[Teact] Cached virtual element was moved within tree');\n    }\n  }\n\n  if (!$current && $new) {\n    if (isNewComponent || isNewFragment) {\n      if (isNewComponent) {\n        $new = initComponent(\n          parentEl, $new as VirtualElementComponent, $parent, currentContext, index,\n        ) as unknown as typeof $new;\n        currentContext = ($new as VirtualElementComponent).componentInstance.context ?? currentContext;\n      }\n\n      mountChildren(parentEl, $new as VirtualElementComponent | VirtualElementFragment, currentContext, {\n        nextSibling, fragment, namespace,\n      });\n    } else {\n      const canSetTextContent = !fragment\n        && !nextSibling\n        && $newAsReal.type === VirtualType.Text\n        && $parent.children.length === 1\n        && !parentEl.firstChild;\n\n      if (canSetTextContent) {\n        parentEl.textContent = $newAsReal.value;\n        $newAsReal.target = parentEl.firstChild!;\n      } else {\n        const node = createNode($newAsReal, currentContext, namespace);\n        $newAsReal.target = node;\n        insertBefore(fragment || parentEl, node, nextSibling);\n\n        if ($newAsReal.type === VirtualType.Tag) {\n          setElementRef($newAsReal, node as DOMElement);\n        }\n      }\n    }\n  } else if ($current && !$new) {\n    remount(parentEl, $current, currentContext, undefined);\n  } else if ($current && $new) {\n    if (hasElementChanged($current, $new)) {\n      if (!nextSibling) {\n        nextSibling = getNextSibling($current);\n      }\n\n      if (isNewComponent || isNewFragment) {\n        if (isNewComponent) {\n          $new = initComponent(\n            parentEl, $new as VirtualElementComponent, $parent, currentContext, index,\n          ) as unknown as typeof $new;\n          currentContext = ($new as VirtualElementComponent).componentInstance.context ?? currentContext;\n        }\n\n        remount(parentEl, $current, currentContext, undefined);\n        mountChildren(parentEl, $new as VirtualElementComponent | VirtualElementFragment, currentContext, {\n          nextSibling, fragment, namespace,\n        });\n      } else {\n        const node = createNode($newAsReal, currentContext, namespace);\n        $newAsReal.target = node;\n        remount(parentEl, $current, currentContext, node, nextSibling);\n\n        if ($newAsReal.type === VirtualType.Tag) {\n          setElementRef($newAsReal, node as DOMElement);\n        }\n      }\n    } else {\n      const isComponent = isCurrentComponent && isNewComponent;\n      const isFragment = isCurrentFragment && isNewFragment;\n\n      if (isComponent || isFragment) {\n        renderChildren(\n          $current,\n          $new as VirtualElementComponent | VirtualElementFragment,\n          currentContext,\n          parentEl,\n          nextSibling,\n          options.forceMoveToEnd,\n        );\n      } else {\n        const $currentAsReal = $current as VirtualElementReal;\n        const currentTarget = $currentAsReal.target!;\n\n        $newAsReal.target = currentTarget;\n        $currentAsReal.target = undefined; // Help GC\n\n        const isTag = $current.type === VirtualType.Tag;\n        if (isTag) {\n          const $newAsTag = $new as VirtualElementTag;\n\n          setElementRef($current, undefined);\n          setElementRef($newAsTag, currentTarget as DOMElement);\n\n          if (nextSibling || options.forceMoveToEnd) {\n            insertBefore(parentEl, currentTarget, nextSibling);\n          }\n\n          updateAttributes($current, $newAsTag, currentTarget as DOMElement, namespace);\n          renderChildren(\n            $current, $newAsTag, currentContext, currentTarget as DOMElement, undefined, undefined, namespace,\n          );\n        }\n      }\n    }\n  }\n\n  return $new;\n}\n\nfunction initComponent(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n) {\n  const { componentInstance } = $element;\n\n  $element.componentInstance.context = currentContext;\n\n  if (componentInstance.mountState === MountState.New) {\n    $element = mountComponent(componentInstance);\n    setupComponentUpdateListener(parentEl, $element, $parent, currentContext, index);\n  }\n\n  return $element;\n}\n\nfunction updateComponent($current: VirtualElementComponent, $new: VirtualElementComponent) {\n  $current.componentInstance.props = $new.componentInstance.props;\n\n  return renderComponent($current.componentInstance);\n}\n\nfunction setupComponentUpdateListener(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n) {\n  const { componentInstance } = $element;\n\n  componentInstance.onUpdate = () => {\n    $parent.children[index] = renderWithVirtual(\n      parentEl,\n      $parent.children[index],\n      componentInstance.$element,\n      $parent,\n      currentContext,\n      index,\n      { skipComponentUpdate: true },\n    );\n  };\n}\n\nfunction mountChildren(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent | VirtualElementFragment,\n  currentContext: CurrentContext,\n  options: {\n    nextSibling?: ChildNode;\n    fragment?: DocumentFragment;\n    namespace?: string;\n  },\n) {\n  const { children } = $element;\n  for (let i = 0, l = children.length; i < l; i++) {\n    const $child = children[i];\n    const $renderedChild = renderWithVirtual(parentEl, undefined, $child, $element, currentContext, i, options);\n    if ($renderedChild !== $child) {\n      children[i] = $renderedChild;\n    }\n  }\n}\n\nfunction unmountChildren(\n  parentEl: DOMElement, $element: VirtualElementComponent | VirtualElementFragment, currentContext: CurrentContext,\n) {\n  for (const $child of $element.children) {\n    renderWithVirtual(parentEl, $child, undefined, $element, currentContext, -1);\n  }\n}\n\nfunction createNode($element: VirtualElementReal, currentContext: CurrentContext, namespace = HTML_NAMESPACE): Node {\n  if ($element.type === VirtualType.Empty) {\n    return document.createTextNode('');\n  }\n\n  if ($element.type === VirtualType.Text) {\n    return document.createTextNode($element.value);\n  }\n\n  const { tag, props, children } = $element;\n  const element = document.createElementNS(namespace, tag) as DOMElement;\n\n  processControlled(tag, props);\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const key in props) {\n    if (!props.hasOwnProperty(key)) continue;\n\n    if (props[key] !== undefined) {\n      setAttribute(element, key, props[key], namespace);\n    }\n  }\n\n  processUncontrolledOnMount(element, props);\n\n  for (let i = 0, l = children.length; i < l; i++) {\n    const $child = children[i];\n    const $renderedChild = renderWithVirtual(element, undefined, $child, $element, currentContext, i, { namespace });\n    if ($renderedChild !== $child) {\n      children[i] = $renderedChild;\n    }\n  }\n\n  return element;\n}\n\nfunction remount(\n  parentEl: DOMElement,\n  $current: VirtualElement,\n  currentContext: CurrentContext,\n  node: Node | undefined,\n  componentNextSibling?: ChildNode,\n) {\n  const isComponent = $current.type === VirtualType.Component;\n  const isFragment = !isComponent && $current.type === VirtualType.Fragment;\n\n  if (isComponent || isFragment) {\n    if (isComponent) {\n      unmountComponent($current.componentInstance);\n    }\n\n    unmountChildren(parentEl, $current, currentContext);\n\n    if (node) {\n      insertBefore(parentEl, node, componentNextSibling);\n    }\n  } else {\n    if (node) {\n      parentEl.replaceChild(node, $current.target!);\n    } else {\n      // ? Error occurs when removing nodes in ContentEditable (e.g., RichTextEditor).\n      // ? Temporarily handle this issue.\n      if ($current.target && parentEl.contains($current.target)) {\n        parentEl.removeChild($current.target!);\n      }\n    }\n\n    unmountRealTree($current);\n  }\n}\n\nfunction unmountRealTree($element: VirtualElement) {\n  if ($element.type === VirtualType.Component) {\n    unmountComponent($element.componentInstance);\n  } else if ($element.type !== VirtualType.Fragment) {\n    if ($element.type === VirtualType.Tag) {\n      extraClasses.delete($element.target!);\n      setElementRef($element, undefined);\n      removeAllDelegatedListeners($element.target!);\n    }\n\n    $element.target = undefined; // Help GC\n\n    if ($element.type !== VirtualType.Tag) {\n      return;\n    }\n  }\n\n  for (const $child of $element.children) {\n    unmountRealTree($child);\n  }\n}\n\nfunction insertBefore(parentEl: DOMElement | DocumentFragment, node: Node, nextSibling?: ChildNode) {\n  if (nextSibling) {\n    parentEl.insertBefore(node, nextSibling);\n  } else {\n    parentEl.appendChild(node);\n  }\n}\n\nfunction getNextSibling($current: VirtualElement): ChildNode | undefined {\n  if ($current.type === VirtualType.Component || $current.type === VirtualType.Fragment) {\n    const lastChild = $current.children[$current.children.length - 1];\n    return getNextSibling(lastChild);\n  }\n\n  return $current.target!.nextSibling || undefined;\n}\n\nfunction renderChildren(\n  $current: VirtualElementParent,\n  $new: VirtualElementParent,\n  currentContext: CurrentContext,\n  currentEl: DOMElement,\n  nextSibling?: ChildNode,\n  forceMoveToEnd = false,\n  namespace?: string,\n) {\n  if (DEBUG) {\n    DEBUG_checkKeyUniqueness($new.children);\n  }\n\n  if (('props' in $new) && $new.props.teactFastList) {\n    renderFastListChildren($current, $new, currentContext, currentEl);\n    return;\n  }\n\n  const currentChildren = $current.children;\n  const newChildren = $new.children;\n\n  const currentChildrenLength = currentChildren.length;\n  const newChildrenLength = newChildren.length;\n  const maxLength = Math.max(currentChildrenLength, newChildrenLength);\n\n  const fragment = newChildrenLength > currentChildrenLength ? document.createDocumentFragment() : undefined;\n  const lastCurrentChild = $current.children[currentChildrenLength - 1];\n  const fragmentNextSibling = fragment && (\n    nextSibling || (lastCurrentChild ? getNextSibling(lastCurrentChild) : undefined)\n  );\n\n  for (let i = 0; i < maxLength; i++) {\n    const $renderedChild = renderWithVirtual(\n      currentEl,\n      currentChildren[i],\n      newChildren[i],\n      $new,\n      currentContext,\n      i,\n      i >= currentChildrenLength ? { fragment, namespace } : { nextSibling, forceMoveToEnd, namespace },\n    );\n\n    if ($renderedChild && $renderedChild !== newChildren[i]) {\n      newChildren[i] = $renderedChild;\n    }\n  }\n\n  if (fragment) {\n    insertBefore(currentEl, fragment, fragmentNextSibling);\n  }\n}\n\n// This function allows to prepend/append a bunch of new DOM nodes to the top/bottom of preserved ones.\n// It also allows to selectively move particular preserved nodes within their DOM list.\nfunction renderFastListChildren(\n  $current: VirtualElementParent, $new: VirtualElementParent, currentContext: CurrentContext, currentEl: DOMElement,\n) {\n  const currentChildren = $current.children;\n  const newChildren = $new.children;\n\n  const newKeys = new Set();\n  for (const $newChild of newChildren) {\n    const key = 'props' in $newChild ? $newChild.props.key : undefined;\n\n    if (DEBUG && isParentElement($newChild)) {\n      // eslint-disable-next-line no-null/no-null\n      if (key === undefined || key === null) {\n        // eslint-disable-next-line no-console\n        console.warn('Missing `key` in `teactFastList`');\n      }\n\n      if ($newChild.type === VirtualType.Fragment) {\n        throw new Error('[Teact] Fragment can not be child of container with `teactFastList`');\n      }\n    }\n\n    newKeys.add(key);\n  }\n\n  // Build a collection of old children that also remain in the new list\n  let currentRemainingIndex = 0;\n  const remainingByKey: Record<string, { $element: VirtualElement; index: number; orderKey?: number }> = {};\n  for (let i = 0, l = currentChildren.length; i < l; i++) {\n    const $currentChild = currentChildren[i];\n\n    let key = 'props' in $currentChild ? $currentChild.props.key : undefined;\n    // eslint-disable-next-line no-null/no-null\n    const isKeyPresent = key !== undefined && key !== null;\n\n    // First we process removed children\n    if (isKeyPresent && !newKeys.has(key)) {\n      renderWithVirtual(currentEl, $currentChild, undefined, $new, currentContext, -1);\n\n      continue;\n    } else if (!isKeyPresent) {\n      const $newChild = newChildren[i];\n      const newChildKey = ($newChild && 'props' in $newChild) ? $newChild.props.key : undefined;\n      // If a non-key element remains at the same index we preserve it with a virtual `key`\n      if ($newChild && !newChildKey) {\n        key = `${INDEX_KEY_PREFIX}${i}`;\n        // Otherwise, we just remove it\n      } else {\n        renderWithVirtual(currentEl, $currentChild, undefined, $new, currentContext, -1);\n\n        continue;\n      }\n    }\n\n    // Then we build up info about remaining children\n    remainingByKey[key] = {\n      $element: $currentChild,\n      index: currentRemainingIndex++,\n      orderKey: 'props' in $currentChild ? $currentChild.props.teactOrderKey : undefined,\n    };\n  }\n\n  let fragmentIndex: number | undefined;\n  let fragmentSize: number | undefined;\n\n  let currentPreservedIndex = 0;\n\n  for (let i = 0, l = newChildren.length; i < l; i++) {\n    const $newChild = newChildren[i];\n    const key = 'props' in $newChild ? $newChild.props.key : `${INDEX_KEY_PREFIX}${i}`;\n    const currentChildInfo = remainingByKey[key];\n\n    if (!currentChildInfo) {\n      if (fragmentSize === undefined) {\n        fragmentIndex = i;\n        fragmentSize = 0;\n      }\n\n      fragmentSize++;\n      continue;\n    }\n\n    // This prepends new children to the top\n    if (fragmentSize) {\n      renderFragment(fragmentIndex!, fragmentSize, currentEl, $new, currentContext);\n      fragmentSize = undefined;\n      fragmentIndex = undefined;\n    }\n\n    // Now we check if a preserved node was moved within preserved list\n    const newOrderKey = 'props' in $newChild ? $newChild.props.teactOrderKey : undefined;\n    // That is indicated by a changed `teactOrderKey` value\n    const shouldMoveNode = (\n      currentChildInfo.index !== currentPreservedIndex && (!newOrderKey || currentChildInfo.orderKey !== newOrderKey)\n    );\n    const isMovingDown = shouldMoveNode && currentPreservedIndex > currentChildInfo.index;\n\n    if (!shouldMoveNode || isMovingDown) {\n      currentPreservedIndex++;\n    }\n\n    const nextSibling = currentEl.childNodes[isMovingDown ? i + 1 : i];\n    const options = shouldMoveNode ? (nextSibling ? { nextSibling } : { forceMoveToEnd: true }) : undefined;\n\n    const $renderedChild = renderWithVirtual(\n      currentEl, currentChildInfo.$element, $newChild, $new, currentContext, i, options,\n    );\n    if ($renderedChild !== $newChild) {\n      newChildren[i] = $renderedChild;\n    }\n  }\n\n  // This appends new children to the bottom\n  if (fragmentSize) {\n    renderFragment(fragmentIndex!, fragmentSize, currentEl, $new, currentContext);\n  }\n}\n\nfunction renderFragment(\n  fragmentIndex: number,\n  fragmentSize: number,\n  parentEl: DOMElement,\n  $parent: VirtualElementParent,\n  currentContext: CurrentContext,\n) {\n  const nextSibling = parentEl.childNodes[fragmentIndex];\n\n  if (fragmentSize === 1) {\n    const $child = $parent.children[fragmentIndex];\n    const $renderedChild = renderWithVirtual(\n      parentEl, undefined, $child, $parent, currentContext, fragmentIndex, { nextSibling },\n    );\n    if ($renderedChild !== $child) {\n      $parent.children[fragmentIndex] = $renderedChild;\n    }\n\n    return;\n  }\n\n  const fragment = document.createDocumentFragment();\n\n  for (let i = fragmentIndex; i < fragmentIndex + fragmentSize; i++) {\n    const $child = $parent.children[i];\n    const $renderedChild = renderWithVirtual(parentEl, undefined, $child, $parent, currentContext, i, { fragment });\n    if ($renderedChild !== $child) {\n      $parent.children[i] = $renderedChild;\n    }\n  }\n\n  insertBefore(parentEl, fragment, nextSibling);\n}\n\nfunction setElementRef($element: VirtualElementTag, element: DOMElement | undefined) {\n  const { ref } = $element.props;\n\n  if (typeof ref === 'object') {\n    ref.current = element;\n    ref.onChange?.();\n  } else if (typeof ref === 'function') {\n    ref(element);\n  }\n}\n\nfunction processControlled(tag: string, props: AnyLiteral) {\n  // TODO Remove after tests\n  if (!props.teactExperimentControlled) {\n    return;\n  }\n\n  const isValueControlled = props.value !== undefined;\n  const isCheckedControlled = props.checked !== undefined;\n  const isControlled = (isValueControlled || isCheckedControlled) && CONTROLLABLE_TAGS.includes(tag.toUpperCase());\n  if (!isControlled) {\n    return;\n  }\n\n  const {\n    value, checked, onInput, onChange,\n  } = props;\n\n  props.onChange = undefined;\n  props.onInput = (e: ChangeEvent<HTMLInputElement>) => {\n    onInput?.(e);\n    onChange?.(e);\n\n    if (value !== undefined && value !== e.currentTarget.value) {\n      const { selectionStart, selectionEnd } = e.currentTarget;\n      const isCaretAtEnd = selectionStart === selectionEnd && selectionEnd === e.currentTarget.value.length;\n\n      e.currentTarget.value = value;\n\n      if (typeof selectionStart === 'number' && typeof selectionEnd === 'number') {\n        e.currentTarget.setSelectionRange(selectionStart, selectionEnd);\n\n        const selectionState: SelectionState = { selectionStart, selectionEnd, isCaretAtEnd };\n        // eslint-disable-next-line no-underscore-dangle\n        e.currentTarget.dataset.__teactSelectionState = JSON.stringify(selectionState);\n      }\n    }\n\n    if (checked !== undefined) {\n      e.currentTarget.checked = checked;\n    }\n  };\n}\n\nfunction processUncontrolledOnMount(element: DOMElement, props: AnyLiteral) {\n  if (!CONTROLLABLE_TAGS.includes(element.tagName)) {\n    return;\n  }\n\n  if (props.defaultValue) {\n    setAttribute(element, 'value', props.defaultValue);\n  }\n\n  if (props.defaultChecked) {\n    setAttribute(element, 'checked', props.defaultChecked);\n  }\n}\n\nfunction updateAttributes(\n  $current: VirtualElementTag, $new: VirtualElementTag, element: DOMElement, namespace?: string,\n) {\n  processControlled(element.tagName, $new.props);\n\n  const currentEntries = Object.entries($current.props);\n  const newEntries = Object.entries($new.props);\n\n  for (const [key, currentValue] of currentEntries) {\n    const newValue = $new.props[key];\n\n    if (\n      currentValue !== undefined\n      && (\n        newValue === undefined\n        || (currentValue !== newValue && key.startsWith('on'))\n      )\n    ) {\n      removeAttribute(element, key, currentValue);\n    }\n  }\n\n  for (const [key, newValue] of newEntries) {\n    const currentValue = $current.props[key];\n\n    if (newValue !== undefined && newValue !== currentValue) {\n      setAttribute(element, key, newValue, namespace);\n    }\n  }\n}\n\nfunction setAttribute(element: DOMElement, key: string, value: any, namespace?: string) {\n  if (key === 'className') {\n    updateClassName(element, value, namespace);\n  } else if (key === 'value') {\n    const inputEl = element as HTMLInputElement;\n\n    if (inputEl.value !== value) {\n      inputEl.value = value;\n\n      // eslint-disable-next-line no-underscore-dangle\n      const selectionStateJson = inputEl.dataset.__teactSelectionState;\n      if (selectionStateJson) {\n        const { selectionStart, selectionEnd, isCaretAtEnd } = JSON.parse(selectionStateJson) as SelectionState;\n\n        if (isCaretAtEnd) {\n          const length = inputEl.value.length;\n          inputEl.setSelectionRange(length, length);\n        } else if (typeof selectionStart === 'number' && typeof selectionEnd === 'number') {\n          inputEl.setSelectionRange(selectionStart, selectionEnd);\n        }\n      }\n    }\n  } else if (key === 'style') {\n    updateStyle(element, value);\n  } else if (key === 'dangerouslySetInnerHTML') {\n    // eslint-disable-next-line no-underscore-dangle\n    element.innerHTML = value.__html;\n  } else if (key.startsWith('on')) {\n    addEventListener(element, key, value, key.endsWith('Capture'));\n  } else if (\n    namespace === SVG_NAMESPACE || key.startsWith('data-') || key.startsWith('aria-') || HTML_ATTRIBUTES.has(key)\n  ) {\n    element.setAttribute(key, value);\n  } else if (!FILTERED_ATTRIBUTES.has(key)) {\n    (element as any)[MAPPED_ATTRIBUTES[key] || key] = value;\n  }\n}\n\nfunction removeAttribute(element: DOMElement, key: string, value: any) {\n  if (key === 'className') {\n    updateClassName(element, '');\n  } else if (key === 'value') {\n    (element as HTMLInputElement).value = '';\n  } else if (key === 'style') {\n    updateStyle(element, '');\n  } else if (key === 'dangerouslySetInnerHTML') {\n    element.innerHTML = '';\n  } else if (key.startsWith('on')) {\n    removeEventListener(element, key, value, key.endsWith('Capture'));\n  } else if (!FILTERED_ATTRIBUTES.has(key)) {\n    element.removeAttribute(key);\n  }\n}\n\nfunction updateClassName(element: DOMElement, value: string, namespace?: string) {\n  if (namespace === SVG_NAMESPACE) {\n    element.setAttribute('class', value);\n    return;\n  }\n\n  const htmlElement = element as HTMLElement;\n  const extra = extraClasses.get(element);\n  if (!extra) {\n    htmlElement.className = value;\n    return;\n  }\n\n  const extraArray = Array.from(extra);\n  if (value) {\n    extraArray.push(value);\n  }\n\n  htmlElement.className = extraArray.join(' ');\n}\n\nfunction updateStyle(element: DOMElement, value: string) {\n  element.style.cssText = value;\n\n  const extraObject = extraStyles.get(element);\n  if (extraObject) {\n    applyExtraStyles(element);\n  }\n}\n\nexport function addExtraClass(element: DOMElement, className: string) {\n  element.classList.add(className);\n\n  const classList = extraClasses.get(element);\n  if (classList) {\n    classList.add(className);\n  } else {\n    extraClasses.set(element, new Set([className]));\n  }\n}\n\nexport function removeExtraClass(element: DOMElement, className: string) {\n  element.classList.remove(className);\n\n  const classList = extraClasses.get(element);\n  if (classList) {\n    classList.delete(className);\n\n    if (!classList.size) {\n      extraClasses.delete(element);\n    }\n  }\n}\n\nexport function toggleExtraClass(element: DOMElement, className: string, force?: boolean) {\n  if (force === true) {\n    addExtraClass(element, className);\n  } else if (force === false) {\n    removeExtraClass(element, className);\n  } else if (extraClasses.get(element)?.has(className)) {\n    removeExtraClass(element, className);\n  } else {\n    addExtraClass(element, className);\n  }\n}\n\nexport function setExtraStyles(element: DOMElement, styles: Partial<CSSStyleDeclaration> & AnyLiteral) {\n  extraStyles.set(element, styles);\n  applyExtraStyles(element);\n}\n\nfunction applyExtraStyles(element: DOMElement) {\n  const standardStyles = Object.entries(extraStyles.get(element)!).reduce<Record<string, string>>(\n    (acc, [prop, value]) => {\n      if (prop.startsWith('--')) {\n        element.style.setProperty(prop, value);\n      } else {\n        acc[prop] = value;\n      }\n\n      return acc;\n    },\n    {},\n  );\n\n  Object.assign(element.style, standardStyles);\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction DEBUG_addToVirtualTreeSize($current: VirtualElementParent | VirtualDomHead) {\n  DEBUG_virtualTreeSize += $current.children.length;\n\n  $current.children.forEach(($child) => {\n    if (isParentElement($child)) {\n      DEBUG_addToVirtualTreeSize($child);\n    }\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction DEBUG_checkKeyUniqueness(children: VirtualElementChildren) {\n  const firstChild = children[0];\n  if (firstChild && 'props' in firstChild && firstChild.props.key !== undefined) {\n    const keys = children.reduce((acc: any[], child) => {\n      if ('props' in child && child.props.key) {\n        acc.push(child.props.key);\n      }\n\n      return acc;\n    }, []);\n\n    if (keys.length !== unique(keys).length) {\n      // eslint-disable-next-line no-console\n      console.warn('[Teact] Duplicated keys:', keys.filter((e, i, a) => a.indexOf(e) !== i), children);\n      throw new Error('[Teact] Children keys are not unique');\n    }\n  }\n}\n\nconst TeactDOM = { render };\nexport default TeactDOM;\n","import { throttle } from './schedulers';\n\nconst KEYS_TO_IGNORE = new Set([\n  'TeactMemoWrapper renders',\n  'TeactNContainer renders',\n  'Button renders',\n]);\nconst MIN_RENDERS_TO_SHOW = 5;\nconst MIN_DURATION_TO_SHOW = 2;\nconst BG_GREEN = ' style=\"background: lightgreen\"';\n\nlet counters: Record<string, {\n  value: number;\n  lastUpdateAt: number;\n}> = {};\n\nconst renderCountersThrottled = throttle(renderCounters, 500, false);\n\nlet loggerEl: HTMLDivElement;\n\nexport function debugToOverlay(text: string) {\n  if (!loggerEl) {\n    setupOverlay();\n  }\n\n  const date = new Date();\n  const dateFormatted = `${date.toLocaleTimeString()}.${date.getMilliseconds()}`;\n  const wasAtBottom = loggerEl.scrollTop + 10 >= loggerEl.scrollHeight - loggerEl.offsetHeight;\n\n  loggerEl.innerHTML += `${dateFormatted}: ${text}<br/>`;\n\n  if (wasAtBottom) {\n    loggerEl.scrollTop = loggerEl.scrollHeight;\n  }\n}\n\nexport function incrementOverlayCounter(key: string, value = 1) {\n  const now = Date.now();\n  if (!counters[key]) {\n    counters[key] = { value, lastUpdateAt: now };\n  } else {\n    counters[key].value += value;\n    counters[key].lastUpdateAt = now;\n  }\n\n  renderCountersThrottled();\n}\n\nexport function renderCounters() {\n  if (!loggerEl) {\n    setupOverlay();\n  }\n\n  const halfSecondAgo = Date.now() - 500;\n  const [maxRenders, maxDuration] = Object.entries(counters).reduce((acc, [key, { value }]) => {\n    if (KEYS_TO_IGNORE.has(key)) {\n      return acc;\n    }\n\n    if (key.includes('renders') && value > acc[0]) {\n      acc[0] = value;\n    }\n\n    if (key.includes('duration') && value > acc[1]) {\n      acc[1] = value;\n    }\n\n    return acc;\n  }, [0, 0]);\n\n  loggerEl.innerHTML = Object\n    .entries(counters)\n    .filter(([key, { value }]) => (\n      (!KEYS_TO_IGNORE.has(key)) && (\n        (key.includes('renders') && value > MIN_RENDERS_TO_SHOW)\n        || (key.includes('duration') && value > MIN_DURATION_TO_SHOW)\n      )\n    ))\n    .sort((a, b) => (\n      b[1].lastUpdateAt - a[1].lastUpdateAt\n    ))\n    .map(([key, { value, lastUpdateAt }]) => ([\n      `<div style=\"background: #ff0000${factorToHex(value / (key.includes('renders') ? maxRenders : maxDuration))}\">`,\n      `  <span${lastUpdateAt > halfSecondAgo ? BG_GREEN : ''}>${key}: ${Math.round(value)}</span>`,\n      '</div>',\n    ].join('\\n')))\n    .join('\\n');\n}\n\nfunction setupOverlay() {\n  loggerEl = document.createElement('div');\n  loggerEl.style.cssText = 'position: absolute; left: 0; bottom: 25px; z-index: 9998; width: 260px; height: 200px;'\n    + ' border: 1px solid #555; background: rgba(255, 255, 255, 0.9); overflow: auto; font-size: 10px;';\n  document.body.appendChild(loggerEl);\n\n  const clearEl = document.createElement('a');\n  clearEl.style.cssText = 'position: absolute; left: 222px; bottom: 198px; z-index: 9999; font-size: 20px; '\n    + 'cursor: pointer;';\n  clearEl.innerText = '🔄';\n  clearEl.addEventListener('click', () => {\n    counters = {};\n    renderCountersThrottled();\n  });\n  document.body.appendChild(clearEl);\n}\n\nfunction factorToHex(factor: number) {\n  return Math.round(255 * factor).toString(16).padStart(2, '0');\n}\n","import type { ReactElement } from 'react';\n\nimport { DEBUG, DEBUG_MORE } from '../../config';\nimport { logUnequalProps } from '../../util/arePropsShallowEqual';\nimport { incrementOverlayCounter } from '../../util/debugOverlay';\nimport { orderBy } from '../../util/iteratees';\nimport safeExec from '../../util/safeExec';\nimport { throttleWith } from '../../util/schedulers';\nimport { createSignal, isSignal, type Signal } from '../../util/signals';\nimport { requestMeasure, requestMutation } from '../fasterdom/fasterdom';\nimport { getIsBlockingAnimating } from './heavyAnimation';\n\nexport { getIsHeavyAnimating, beginHeavyAnimation, onFullyIdle } from './heavyAnimation';\n\nexport type Props = AnyLiteral;\nexport type FC<P extends Props = any> = (props: P) => any;\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport type FC_withDebug =\n  FC\n  & { DEBUG_contentComponentName?: string };\n\nexport enum VirtualType {\n  Empty,\n  Text,\n  Tag,\n  Component,\n  Fragment,\n}\n\ninterface VirtualElementEmpty {\n  type: VirtualType.Empty;\n  target?: Node;\n}\n\ninterface VirtualElementText {\n  type: VirtualType.Text;\n  target?: Node;\n  value: string;\n}\n\nexport interface VirtualElementTag {\n  type: VirtualType.Tag;\n  target?: HTMLElement | SVGElement;\n  tag: string;\n  props: Props;\n  children: VirtualElementChildren;\n}\n\nexport interface VirtualElementComponent {\n  type: VirtualType.Component;\n  componentInstance: ComponentInstance;\n  props: Props;\n  children: VirtualElementChildren;\n}\n\nexport interface VirtualElementFragment {\n  type: VirtualType.Fragment;\n  children: VirtualElementChildren;\n}\n\nexport type StateHookSetter<T> = (newValue: ((current: T) => T) | T) => void;\n\nexport interface RefObject<T = any> {\n  current: T;\n  onChange?: NoneToVoidFunction;\n}\n\nexport enum MountState {\n  New,\n  Mounted,\n  Unmounted,\n}\n\ninterface ComponentInstance {\n  id: number;\n  $element: VirtualElementComponent;\n  Component: FC;\n  name: string;\n  props: Props;\n  renderedValue?: any;\n  mountState: MountState;\n  context?: Record<string, Signal<unknown>>;\n  hooks?: {\n    state?: {\n      cursor: number;\n      byCursor: {\n        value: any;\n        nextValue: any;\n        setter: StateHookSetter<any>;\n      }[];\n    };\n    effects?: {\n      cursor: number;\n      byCursor: {\n        dependencies?: readonly any[];\n        schedule?: NoneToVoidFunction;\n        cleanup?: NoneToVoidFunction;\n        releaseSignals?: NoneToVoidFunction;\n      }[];\n    };\n    memos?: {\n      cursor: number;\n      byCursor: {\n        value: any;\n        dependencies: any[];\n      }[];\n    };\n    refs?: {\n      cursor: number;\n      byCursor: RefObject[];\n    };\n  };\n  prepareForFrame?: () => void;\n  forceUpdate?: () => void;\n  onUpdate?: () => void;\n}\n\nexport type VirtualElement =\n  VirtualElementEmpty\n  | VirtualElementText\n  | VirtualElementTag\n  | VirtualElementComponent\n  | VirtualElementFragment;\nexport type VirtualElementParent =\n  VirtualElementTag\n  | VirtualElementComponent\n  | VirtualElementFragment;\nexport type VirtualElementChildren = VirtualElement[];\nexport type VirtualElementReal = Exclude<VirtualElement, VirtualElementComponent | VirtualElementFragment>;\n\n// Compatibility with JSX types\nexport type TeactNode =\n  ReactElement\n  | string\n  | number\n  | boolean\n  | TeactNode[];\n\ntype Effect = () => (NoneToVoidFunction | void);\ntype EffectCleanup = NoneToVoidFunction;\n\nexport type Context<T> = {\n  defaultValue?: T;\n  contextId: string;\n  Provider: FC<{ value: T; children: TeactNode }>;\n};\n\nconst Fragment = Symbol('Fragment');\n\nconst DEBUG_RENDER_THRESHOLD = 7;\nconst DEBUG_EFFECT_THRESHOLD = 7;\nconst DEBUG_SILENT_RENDERS_FOR = new Set(['TeactMemoWrapper', 'TeactNContainer', 'Button', 'ListItem', 'MenuItem']);\n\nlet contextCounter = 0;\n\nlet lastComponentId = 0;\nlet renderingInstance: ComponentInstance;\n\nexport function isParentElement($element: VirtualElement): $element is VirtualElementParent {\n  return (\n    $element.type === VirtualType.Tag\n    || $element.type === VirtualType.Component\n    || $element.type === VirtualType.Fragment\n  );\n}\n\nfunction createElement(\n  source: string | FC | typeof Fragment,\n  props: Props,\n  ...children: any[]\n): VirtualElementParent | VirtualElementChildren {\n  if (source === Fragment) {\n    return buildFragmentElement(children);\n  } else if (typeof source === 'function') {\n    return createComponentInstance(source, props || {}, children);\n  } else {\n    return buildTagElement(source, props || {}, children);\n  }\n}\n\nfunction buildFragmentElement(children: any[]): VirtualElementFragment {\n  return {\n    type: VirtualType.Fragment,\n    children: buildChildren(children, true),\n  };\n}\n\nfunction createComponentInstance(Component: FC, props: Props, children: any[]): VirtualElementComponent {\n  if (children?.length) {\n    props.children = children.length === 1 ? children[0] : children;\n  }\n\n  const componentInstance: ComponentInstance = {\n    id: -1,\n    $element: undefined as unknown as VirtualElementComponent,\n    Component,\n    name: Component.name,\n    props,\n    mountState: MountState.New,\n  };\n\n  componentInstance.$element = buildComponentElement(componentInstance);\n\n  return componentInstance.$element;\n}\n\nfunction buildComponentElement(\n  componentInstance: ComponentInstance,\n  children?: VirtualElementChildren,\n): VirtualElementComponent {\n  return {\n    type: VirtualType.Component,\n    componentInstance,\n    props: componentInstance.props,\n    children: children ? buildChildren(children, true) : [],\n  };\n}\n\nfunction buildTagElement(tag: string, props: Props, children: any[]): VirtualElementTag {\n  return {\n    type: VirtualType.Tag,\n    tag,\n    props,\n    children: buildChildren(children),\n  };\n}\n\nfunction buildChildren(children: any[], noEmpty = false): VirtualElement[] {\n  const cleanChildren = dropEmptyTail(children, noEmpty);\n  const newChildren = [];\n\n  for (let i = 0, l = cleanChildren.length; i < l; i++) {\n    const child = cleanChildren[i];\n    if (Array.isArray(child)) {\n      newChildren.push(...buildChildren(child, noEmpty));\n    } else {\n      newChildren.push(buildChildElement(child));\n    }\n  }\n\n  return newChildren;\n}\n\n// We only need placeholders in the middle of collection (to ensure other elements order).\nfunction dropEmptyTail(children: any[], noEmpty = false) {\n  let i = children.length - 1;\n\n  for (; i >= 0; i--) {\n    if (!isEmptyPlaceholder(children[i])) {\n      break;\n    }\n  }\n\n  if (i === children.length - 1) {\n    return children;\n  }\n\n  if (i === -1 && noEmpty) {\n    return children.slice(0, 1);\n  }\n\n  return children.slice(0, i + 1);\n}\n\nfunction isEmptyPlaceholder(child: any) {\n  return !child && child !== 0;\n}\n\nfunction buildChildElement(child: any): VirtualElement {\n  if (isEmptyPlaceholder(child)) {\n    return { type: VirtualType.Empty };\n  } else if (isParentElement(child)) {\n    return child;\n  } else {\n    return {\n      type: VirtualType.Text,\n      value: String(child),\n    };\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst DEBUG_components: AnyLiteral = { TOTAL: { name: 'TOTAL', renders: 0 } };\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst DEBUG_memos: Record<string, { key: string; calls: number; misses: number; hitRate: number }> = {};\nconst DEBUG_MEMOS_CALLS_THRESHOLD = 20;\n\ndocument.addEventListener('dblclick', () => {\n  // eslint-disable-next-line no-console\n  console.warn('COMPONENTS', orderBy(\n    Object\n      .values(DEBUG_components)\n      .map(({ avgRenderTime, ...state }) => {\n        return { ...state, ...(avgRenderTime !== undefined && { avgRenderTime: Number(avgRenderTime.toFixed(2)) }) };\n      }),\n    'renders',\n    'desc',\n  ));\n\n  // eslint-disable-next-line no-console\n  console.warn('MEMOS', orderBy(\n    Object\n      .values(DEBUG_memos)\n      .filter(({ calls }) => calls >= DEBUG_MEMOS_CALLS_THRESHOLD)\n      .map((state) => ({ ...state, hitRate: Number(state.hitRate.toFixed(2)) })),\n    'hitRate',\n    'asc',\n  ));\n});\n\nlet instancesPendingUpdate = new Set<ComponentInstance>();\nlet idsToExcludeFromUpdate = new Set<number>();\nlet pendingEffects = new Map<string, Effect>();\nlet pendingCleanups = new Map<string, EffectCleanup>();\nlet pendingLayoutEffects = new Map<string, Effect>();\nlet pendingLayoutCleanups = new Map<string, EffectCleanup>();\nlet areImmediateEffectsCaptured = false;\n\n/*\n  Order:\n  - component effect cleanups\n  - component effects\n  - measure tasks\n  - mutation tasks\n  - component updates\n  - component layout effect cleanups\n  - component layout effects\n  - forced layout measure tasks\n  - forced layout mutation tasks\n */\n\nconst runUpdatePassOnRaf = throttleWith(requestMeasure, () => {\n  if (getIsBlockingAnimating()) {\n    getIsBlockingAnimating.once(runUpdatePassOnRaf);\n    return;\n  }\n\n  const runImmediateEffects = captureImmediateEffects();\n\n  idsToExcludeFromUpdate = new Set();\n  const instancesToUpdate = Array\n    .from(instancesPendingUpdate)\n    .sort((a, b) => a.id - b.id);\n  instancesPendingUpdate = new Set();\n\n  const currentCleanups = pendingCleanups;\n  pendingCleanups = new Map();\n  currentCleanups.forEach((cb) => cb());\n\n  const currentEffects = pendingEffects;\n  pendingEffects = new Map();\n  currentEffects.forEach((cb) => cb());\n\n  requestMutation(() => {\n    instancesToUpdate.forEach(prepareComponentForFrame);\n    instancesToUpdate.forEach((instance) => {\n      if (idsToExcludeFromUpdate!.has(instance.id)) {\n        return;\n      }\n\n      forceUpdateComponent(instance);\n    });\n\n    runImmediateEffects?.();\n  });\n});\n\nexport function captureImmediateEffects() {\n  if (areImmediateEffectsCaptured) {\n    return undefined;\n  }\n\n  areImmediateEffectsCaptured = true;\n  return runCapturedImmediateEffects;\n}\n\nfunction runCapturedImmediateEffects() {\n  const currentLayoutCleanups = pendingLayoutCleanups;\n  pendingLayoutCleanups = new Map();\n  currentLayoutCleanups.forEach((cb) => cb());\n\n  const currentLayoutEffects = pendingLayoutEffects;\n  pendingLayoutEffects = new Map();\n  currentLayoutEffects.forEach((cb) => cb());\n\n  areImmediateEffectsCaptured = false;\n}\n\nexport function renderComponent(componentInstance: ComponentInstance) {\n  idsToExcludeFromUpdate.add(componentInstance.id);\n\n  const { Component, props } = componentInstance;\n  let newRenderedValue: any;\n\n  safeExec(() => {\n    renderingInstance = componentInstance;\n    if (componentInstance.hooks) {\n      if (componentInstance.hooks.state) {\n        componentInstance.hooks.state.cursor = 0;\n      }\n      if (componentInstance.hooks.effects) {\n        componentInstance.hooks.effects.cursor = 0;\n      }\n      if (componentInstance.hooks.memos) {\n        componentInstance.hooks.memos.cursor = 0;\n      }\n      if (componentInstance.hooks.refs) {\n        componentInstance.hooks.refs.cursor = 0;\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    let DEBUG_startAt: number | undefined;\n    if (DEBUG) {\n      const componentName = DEBUG_resolveComponentName(Component);\n      if (!DEBUG_components[componentName]) {\n        DEBUG_components[componentName] = {\n          name: componentName,\n          renders: 0,\n          avgRenderTime: 0,\n        };\n      }\n\n      if (DEBUG_MORE) {\n        if (!DEBUG_SILENT_RENDERS_FOR.has(componentName)) {\n          // eslint-disable-next-line no-console\n          console.log(`[Teact] Render ${componentName}`);\n        }\n      }\n\n      DEBUG_startAt = performance.now();\n    }\n\n    newRenderedValue = Component(props);\n\n    if (DEBUG) {\n      const duration = performance.now() - DEBUG_startAt!;\n      const componentName = DEBUG_resolveComponentName(Component);\n      if (duration > DEBUG_RENDER_THRESHOLD) {\n        // eslint-disable-next-line no-console\n        console.warn(`[Teact] Slow component render: ${componentName}, ${Math.round(duration)} ms`);\n      }\n\n      const { renders, avgRenderTime } = DEBUG_components[componentName];\n      DEBUG_components[componentName].avgRenderTime = (avgRenderTime * renders + duration) / (renders + 1);\n      DEBUG_components[componentName].renders++;\n      DEBUG_components.TOTAL.renders++;\n\n      if (DEBUG_MORE) {\n        incrementOverlayCounter(`${componentName} renders`);\n        incrementOverlayCounter(`${componentName} duration`, duration);\n      }\n    }\n  }, () => {\n    // eslint-disable-next-line no-console\n    console.error(`[Teact] Error while rendering component ${componentInstance.name}`, componentInstance);\n\n    newRenderedValue = componentInstance.renderedValue;\n  });\n\n  if (componentInstance.mountState === MountState.Mounted && newRenderedValue === componentInstance.renderedValue) {\n    return componentInstance.$element;\n  }\n\n  componentInstance.renderedValue = newRenderedValue;\n\n  const children = Array.isArray(newRenderedValue) ? newRenderedValue : [newRenderedValue];\n\n  if (componentInstance.mountState === MountState.New) {\n    componentInstance.$element.children = buildChildren(children, true);\n  } else {\n    componentInstance.$element = buildComponentElement(componentInstance, children);\n  }\n\n  return componentInstance.$element;\n}\n\nexport function hasElementChanged($old: VirtualElement, $new: VirtualElement) {\n  if (typeof $old !== typeof $new) {\n    return true;\n  } else if ($old.type !== $new.type) {\n    return true;\n  } else if ($old.type === VirtualType.Text && $new.type === VirtualType.Text) {\n    return $old.value !== $new.value;\n  } else if ($old.type === VirtualType.Tag && $new.type === VirtualType.Tag) {\n    return ($old.tag !== $new.tag) || ($old.props.key !== $new.props.key);\n  } else if ($old.type === VirtualType.Component && $new.type === VirtualType.Component) {\n    return (\n      $old.componentInstance.Component !== $new.componentInstance.Component\n    ) || (\n      $old.props.key !== $new.props.key\n    );\n  }\n\n  return false;\n}\n\nexport function mountComponent(componentInstance: ComponentInstance) {\n  componentInstance.id = ++lastComponentId;\n  renderComponent(componentInstance);\n  componentInstance.mountState = MountState.Mounted;\n  return componentInstance.$element;\n}\n\nexport function unmountComponent(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState !== MountState.Mounted) {\n    return;\n  }\n\n  idsToExcludeFromUpdate.add(componentInstance.id);\n\n  if (componentInstance.hooks?.effects) {\n    for (const effect of componentInstance.hooks.effects.byCursor) {\n      if (effect.cleanup) {\n        safeExec(effect.cleanup);\n      }\n\n      effect.cleanup = undefined;\n      effect.releaseSignals?.();\n    }\n  }\n\n  componentInstance.mountState = MountState.Unmounted;\n\n  helpGc(componentInstance);\n}\n\n// We need to remove all references to DOM objects. We also clean all other references, just in case\nfunction helpGc(componentInstance: ComponentInstance) {\n  const {\n    effects, state, memos, refs,\n  } = componentInstance.hooks || {};\n\n  if (effects) {\n    for (const hook of effects.byCursor) {\n      hook.schedule = undefined as any;\n      hook.cleanup = undefined as any;\n      hook.releaseSignals = undefined as any;\n      hook.dependencies = undefined;\n    }\n  }\n\n  if (state) {\n    for (const hook of state.byCursor) {\n      hook.value = undefined;\n      hook.nextValue = undefined;\n      hook.setter = undefined as any;\n    }\n  }\n\n  if (memos) {\n    for (const hook of memos.byCursor) {\n      hook.value = undefined as any;\n      hook.dependencies = undefined as any;\n    }\n  }\n\n  if (refs) {\n    for (const hook of refs.byCursor) {\n      hook.current = undefined as any;\n      hook.onChange = undefined as any;\n    }\n  }\n\n  componentInstance.hooks = undefined as any;\n  componentInstance.$element = undefined as any;\n  componentInstance.renderedValue = undefined;\n  componentInstance.Component = undefined as any;\n  componentInstance.props = undefined as any;\n  componentInstance.onUpdate = undefined;\n}\n\nfunction prepareComponentForFrame(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState !== MountState.Mounted) {\n    return;\n  }\n\n  if (componentInstance.hooks?.state) {\n    for (const hook of componentInstance.hooks.state.byCursor) {\n      hook.value = hook.nextValue;\n    }\n  }\n}\n\nfunction forceUpdateComponent(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState !== MountState.Mounted || !componentInstance.onUpdate) {\n    return;\n  }\n\n  const currentElement = componentInstance.$element;\n\n  renderComponent(componentInstance);\n\n  if (componentInstance.$element !== currentElement) {\n    componentInstance.onUpdate();\n  }\n}\n\nexport function useState<T>(): [T | undefined, StateHookSetter<T | undefined>];\nexport function useState<T>(initial: T, debugKey?: string): [T, StateHookSetter<T>];\nexport function useState<T>(initial?: T, debugKey?: string): [T, StateHookSetter<T>] {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.state) {\n    renderingInstance.hooks.state = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.state;\n  const componentInstance = renderingInstance;\n\n  if (byCursor[cursor] === undefined) {\n    byCursor[cursor] = {\n      value: initial,\n      nextValue: initial,\n      setter: (newValue: ((current: T) => T) | T) => {\n        if (componentInstance.mountState === MountState.Unmounted) {\n          return;\n        }\n\n        if (typeof newValue === 'function') {\n          newValue = (newValue as (current: T) => T)(byCursor[cursor].nextValue);\n        }\n\n        if (byCursor[cursor].nextValue === newValue) {\n          return;\n        }\n\n        byCursor[cursor].nextValue = newValue;\n\n        instancesPendingUpdate.add(componentInstance);\n        runUpdatePassOnRaf();\n\n        if (DEBUG_MORE) {\n          // eslint-disable-next-line no-console\n          console.log(\n            '[Teact.useState]',\n            DEBUG_resolveComponentName(componentInstance.Component),\n            `State update at cursor #${cursor}${debugKey ? ` (${debugKey})` : ''}, next value: `,\n            byCursor[cursor].nextValue,\n          );\n        }\n      },\n    };\n  }\n\n  renderingInstance.hooks.state.cursor++;\n\n  return [\n    byCursor[cursor].value,\n    byCursor[cursor].setter,\n  ];\n}\n\nfunction useEffectBase(\n  isLayout: boolean,\n  effect: Effect,\n  dependencies?: readonly any[],\n  debugKey?: string,\n) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n\n  if (!renderingInstance.hooks.effects) {\n    renderingInstance.hooks.effects = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.effects;\n  const effectConfig = byCursor[cursor];\n  const componentInstance = renderingInstance;\n\n  function schedule() {\n    scheduleEffect(componentInstance, cursor, effect, isLayout);\n  }\n\n  if (dependencies && effectConfig?.dependencies) {\n    if (dependencies.some((dependency, i) => dependency !== effectConfig.dependencies![i])) {\n      if (DEBUG && debugKey) {\n        const causedBy = dependencies.reduce((res, newValue, i) => {\n          const prevValue = effectConfig.dependencies![i];\n          if (newValue !== prevValue) {\n            res.push(`${i}: ${prevValue} => ${newValue}`);\n          }\n\n          return res;\n        }, []);\n\n        // eslint-disable-next-line no-console\n        console.log(`[Teact] Effect \"${debugKey}\" caused by dependencies.`, causedBy.join(', '));\n      }\n\n      schedule();\n    }\n  } else {\n    if (debugKey) {\n      // eslint-disable-next-line no-console\n      console.log(`[Teact] Effect \"${debugKey}\" caused by missing dependencies.`);\n    }\n\n    schedule();\n  }\n\n  function setupSignals() {\n    const cleanups = dependencies?.filter(isSignal).map((signal, i) => signal.subscribe(() => {\n      if (debugKey) {\n        // eslint-disable-next-line no-console\n        console.log(`[Teact] Effect \"${debugKey}\" caused by signal #${i} new value:`, signal());\n      }\n\n      byCursor[cursor].schedule!();\n    }));\n\n    if (!cleanups?.length) {\n      return undefined;\n    }\n\n    return () => {\n      for (const cleanup of cleanups) {\n        cleanup();\n      }\n    };\n  }\n\n  byCursor[cursor] = {\n    ...effectConfig,\n    dependencies,\n    schedule,\n  };\n\n  if (!effectConfig) {\n    byCursor[cursor].releaseSignals = setupSignals();\n  }\n\n  renderingInstance.hooks.effects.cursor++;\n}\n\nfunction scheduleEffect(\n  componentInstance: ComponentInstance,\n  cursor: number,\n  effect: Effect,\n  isLayout: boolean,\n) {\n  const { byCursor } = componentInstance.hooks!.effects!;\n  const cleanup = byCursor[cursor]?.cleanup;\n  const cleanupsContainer = isLayout ? pendingLayoutCleanups : pendingCleanups;\n  const effectsContainer = isLayout ? pendingLayoutEffects : pendingEffects;\n  const effectId = `${componentInstance.id}_${cursor}`;\n\n  if (cleanup) {\n    const runEffectCleanup = () => safeExec(() => {\n      if (componentInstance.mountState === MountState.Unmounted) {\n        return;\n      }\n\n      // eslint-disable-next-line @typescript-eslint/naming-convention\n      let DEBUG_startAt: number | undefined;\n      if (DEBUG) {\n        DEBUG_startAt = performance.now();\n      }\n\n      cleanup();\n\n      if (DEBUG) {\n        const duration = performance.now() - DEBUG_startAt!;\n        const componentName = DEBUG_resolveComponentName(componentInstance.Component);\n        if (duration > DEBUG_EFFECT_THRESHOLD) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            `[Teact] Slow cleanup at effect cursor #${cursor}: ${componentName}, ${Math.round(duration)} ms`,\n          );\n        }\n      }\n    }, () => {\n      // eslint-disable-next-line no-console, max-len\n      console.error(`[Teact] Error in effect cleanup at cursor #${cursor} in ${componentInstance.name}`, componentInstance);\n    }, () => {\n      byCursor[cursor].cleanup = undefined;\n    });\n\n    cleanupsContainer.set(effectId, runEffectCleanup);\n  }\n\n  const runEffect = () => safeExec(() => {\n    if (componentInstance.mountState === MountState.Unmounted) {\n      return;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    let DEBUG_startAt: number | undefined;\n    if (DEBUG) {\n      DEBUG_startAt = performance.now();\n    }\n\n    const result = effect();\n    if (typeof result === 'function') {\n      byCursor[cursor].cleanup = result;\n    }\n\n    if (DEBUG) {\n      const duration = performance.now() - DEBUG_startAt!;\n      const componentName = DEBUG_resolveComponentName(componentInstance.Component);\n      if (duration > DEBUG_EFFECT_THRESHOLD) {\n        // eslint-disable-next-line no-console\n        console.warn(`[Teact] Slow effect at cursor #${cursor}: ${componentName}, ${Math.round(duration)} ms`);\n      }\n    }\n  }, () => {\n    // eslint-disable-next-line no-console\n    console.error(`[Teact] Error in effect at cursor #${cursor} in ${componentInstance.name}`, componentInstance);\n  });\n\n  effectsContainer.set(effectId, runEffect);\n\n  runUpdatePassOnRaf();\n}\n\nexport function useEffect(effect: Effect, dependencies?: readonly any[], debugKey?: string) {\n  return useEffectBase(false, effect, dependencies, debugKey);\n}\n\nexport function useLayoutEffect(effect: Effect, dependencies?: readonly any[], debugKey?: string) {\n  return useEffectBase(true, effect, dependencies, debugKey);\n}\n\nexport function useUnmountCleanup(cleanup: NoneToVoidFunction) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n\n  if (!renderingInstance.hooks.effects) {\n    renderingInstance.hooks.effects = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.effects;\n\n  if (!byCursor[cursor]) {\n    byCursor[cursor] = {\n      cleanup,\n    };\n  }\n\n  renderingInstance.hooks.effects.cursor++;\n}\n\nexport function useMemo<T extends any>(\n  resolver: () => T,\n  dependencies: any[],\n  debugKey?: string,\n  debugHitRateKey?: string,\n): T {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.memos) {\n    renderingInstance.hooks.memos = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.memos;\n  let { value } = byCursor[cursor] || {};\n\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  let DEBUG_state: typeof DEBUG_memos[string] | undefined;\n  if (DEBUG && debugHitRateKey) {\n    const instanceKey = `${debugHitRateKey}#${renderingInstance.id}`;\n\n    DEBUG_state = DEBUG_memos[instanceKey];\n    if (!DEBUG_state) {\n      DEBUG_state = {\n        key: instanceKey, calls: 0, misses: 0, hitRate: 0,\n      };\n      DEBUG_memos[instanceKey] = DEBUG_state;\n    }\n\n    DEBUG_state.calls++;\n    DEBUG_state.hitRate = (DEBUG_state.calls - DEBUG_state.misses) / DEBUG_state.calls;\n  }\n\n  if (\n    byCursor[cursor] === undefined\n    || dependencies.length !== byCursor[cursor].dependencies.length\n    || dependencies.some((dependency, i) => dependency !== byCursor[cursor].dependencies[i])\n  ) {\n    if (DEBUG) {\n      if (debugKey) {\n        const msg = `[Teact.useMemo] ${renderingInstance.name} (${debugKey}): Update is caused by:`;\n        if (!byCursor[cursor]) {\n          // eslint-disable-next-line no-console\n          console.log(`${msg} [first render]`);\n        } else {\n          logUnequalProps(byCursor[cursor].dependencies, dependencies, msg, debugKey);\n        }\n      }\n\n      if (DEBUG_state) {\n        DEBUG_state.misses++;\n        DEBUG_state.hitRate = (DEBUG_state.calls - DEBUG_state.misses) / DEBUG_state.calls;\n\n        if (\n          DEBUG_state.calls % 10 === 0\n          && DEBUG_state.calls >= DEBUG_MEMOS_CALLS_THRESHOLD\n          && DEBUG_state.hitRate < 0.25\n        ) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            // eslint-disable-next-line max-len\n            `[Teact] ${DEBUG_state.key}: Hit rate is ${DEBUG_state.hitRate.toFixed(2)} for ${DEBUG_state.calls} calls`,\n          );\n        }\n      }\n    }\n\n    value = resolver();\n  }\n\n  byCursor[cursor] = {\n    value,\n    dependencies,\n  };\n\n  renderingInstance.hooks.memos.cursor++;\n\n  return value;\n}\n\nexport function useCallback<F extends AnyFunction>(newCallback: F, dependencies: any[], debugKey?: string): F {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  return useMemo(() => newCallback, dependencies, debugKey);\n}\n\nexport function useRef<T>(initial: T): RefObject<T>;\nexport function useRef<T>(): RefObject<T | undefined>; // TT way (empty is `undefined`)\nexport function useRef<T>(initial: null): RefObject<T | null>; // React way (empty is `null`)\n// eslint-disable-next-line no-null/no-null\nexport function useRef<T>(initial?: T | null) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.refs) {\n    renderingInstance.hooks.refs = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.refs;\n  if (!byCursor[cursor]) {\n    byCursor[cursor] = {\n      current: initial,\n    };\n  }\n\n  renderingInstance.hooks.refs.cursor++;\n\n  return byCursor[cursor];\n}\n\nexport function createContext<T>(defaultValue?: T): Context<T> {\n  const contextId = String(contextCounter++);\n\n  function TeactContextProvider(props: { value: T; children: TeactNode }) {\n    const [getValue, setValue] = useSignal(props.value ?? defaultValue);\n    // Create a new object to avoid mutations in the parent context\n    renderingInstance.context = { ...renderingInstance.context };\n\n    renderingInstance.context[contextId] = getValue;\n    setValue(props.value);\n    return props.children;\n  }\n\n  TeactContextProvider.DEBUG_contentComponentName = contextId;\n\n  const context = {\n    defaultValue,\n    contextId,\n    Provider: TeactContextProvider,\n  };\n\n  return context;\n}\n\nexport function useContextSignal<T>(context: Context<T>) {\n  const [getDefaultValue] = useSignal(context.defaultValue);\n\n  return renderingInstance.context?.[context.contextId] || getDefaultValue;\n}\n\nexport function useSignal<T>(initial?: T) {\n  const signalRef = useRef<ReturnType<typeof createSignal<T>>>();\n  signalRef.current ??= createSignal<T>(initial);\n  return signalRef.current;\n}\n\nexport function memo<T extends FC_withDebug>(Component: T, debugKey?: string) {\n  function TeactMemoWrapper(props: Props) {\n    return useMemo(\n      () => createElement(Component, props),\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      Object.values(props),\n      debugKey,\n      DEBUG_MORE ? DEBUG_resolveComponentName(renderingInstance.Component) : undefined,\n    );\n  }\n\n  TeactMemoWrapper.DEBUG_contentComponentName = DEBUG_resolveComponentName(Component);\n\n  return TeactMemoWrapper as T;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport function DEBUG_resolveComponentName(Component: FC_withDebug) {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  const { name, DEBUG_contentComponentName } = Component;\n\n  if (name === 'TeactNContainer') {\n    return `container>${DEBUG_contentComponentName}`;\n  }\n\n  if (name === 'TeactMemoWrapper') {\n    return `memo>${DEBUG_contentComponentName}`;\n  }\n\n  if (name === 'TeactContextProvider') {\n    return `context>id${DEBUG_contentComponentName}`;\n  }\n\n  return name + (DEBUG_contentComponentName ? `>${DEBUG_contentComponentName}` : '');\n}\n\nexport default {\n  createElement,\n  Fragment,\n};\n","import type { FC, FC_withDebug, Props } from './teact';\n\nimport { DEBUG, DEBUG_MORE } from '../../config';\nimport arePropsShallowEqual, { logUnequalProps } from '../../util/arePropsShallowEqual';\nimport { handleError } from '../../util/handleError';\nimport { orderBy } from '../../util/iteratees';\nimport { throttleWithTickEnd } from '../../util/schedulers';\nimport React, { DEBUG_resolveComponentName, getIsHeavyAnimating, useUnmountCleanup } from './teact';\n\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport useUniqueId from '../../hooks/useUniqueId';\n\nexport default React;\n\ninterface Container {\n  mapStateToProps: MapStateToProps<any>;\n  activationFn?: ActivationFn<any>;\n  stuckTo?: any;\n  ownProps: Props;\n  mappedProps?: Props;\n  forceUpdate: Function;\n  DEBUG_updates: number;\n  DEBUG_componentName: string;\n}\n\ntype GlobalState =\n  AnyLiteral\n  & { DEBUG_randomId?: number };\ntype ActionNames = string;\ntype ActionPayload = any;\n\nexport interface ActionOptions {\n  forceOnHeavyAnimation?: boolean;\n  // Workaround for iOS gesture history navigation\n  forceSyncOnIOs?: boolean;\n  forceOutdated?: boolean;\n}\n\ntype Actions = Record<ActionNames, (payload?: ActionPayload, options?: ActionOptions) => void>;\n\ntype ActionHandler = (\n  global: GlobalState,\n  actions: Actions,\n  payload: any,\n) => GlobalState | void | Promise<void>;\n\ntype MapStateToProps<OwnProps = undefined> = (global: GlobalState, ownProps: OwnProps) => AnyLiteral;\ntype StickToFirstFn = (value: any) => boolean;\ntype ActivationFn<OwnProps = undefined> = (\n  global: GlobalState, ownProps: OwnProps, stickToFirst: StickToFirstFn,\n) => boolean;\n\nlet currentGlobal = {\n  isInited: false,\n} as GlobalState;\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet DEBUG_currentRandomId: number | undefined;\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst DEBUG_invalidateGlobalOnTickEnd = throttleWithTickEnd(() => {\n  DEBUG_currentRandomId = Math.random();\n});\n\nconst actionHandlers: Record<string, ActionHandler[]> = {};\nconst callbacks: Function[] = [updateContainers];\nconst actions = {} as Actions;\nconst containers = new Map<string, Container>();\n\nconst runCallbacksThrottled = throttleWithTickEnd(runCallbacks);\n\nlet forceOnHeavyAnimation = true;\n\nfunction runCallbacks() {\n  if (forceOnHeavyAnimation) {\n    forceOnHeavyAnimation = false;\n  } else if (getIsHeavyAnimating()) {\n    getIsHeavyAnimating.once(runCallbacksThrottled);\n    return;\n  }\n\n  callbacks.forEach((cb) => cb(currentGlobal));\n}\n\nexport function setUntypedGlobal(newGlobal?: GlobalState, options?: ActionOptions) {\n  if (typeof newGlobal === 'object' && newGlobal !== currentGlobal) {\n    if (DEBUG) {\n      if (\n        !options?.forceOutdated\n        && newGlobal.DEBUG_randomId && newGlobal.DEBUG_randomId !== DEBUG_currentRandomId\n      ) {\n        throw new Error('[TeactN.setGlobal] Attempt to set an outdated global');\n      }\n\n      DEBUG_currentRandomId = Math.random();\n    }\n\n    currentGlobal = newGlobal;\n\n    if (options?.forceSyncOnIOs) {\n      forceOnHeavyAnimation = true;\n      runCallbacks();\n    } else {\n      if (options?.forceOnHeavyAnimation) {\n        forceOnHeavyAnimation = true;\n      }\n\n      runCallbacksThrottled();\n    }\n  }\n}\n\nexport function getUntypedGlobal() {\n  if (DEBUG) {\n    currentGlobal = {\n      ...currentGlobal,\n      DEBUG_randomId: DEBUG_currentRandomId,\n    };\n    DEBUG_invalidateGlobalOnTickEnd();\n  }\n\n  return currentGlobal;\n}\n\nexport function getUntypedActions() {\n  return actions;\n}\n\nexport function forceOnHeavyAnimationOnce() {\n  forceOnHeavyAnimation = true;\n}\n\nlet actionQueue: NoneToVoidFunction[] = [];\n\nfunction handleAction(name: string, payload?: ActionPayload, options?: ActionOptions) {\n  actionQueue.push(() => {\n    actionHandlers[name]?.forEach((handler) => {\n      const response = handler(DEBUG ? getUntypedGlobal() : currentGlobal, actions, payload);\n      if (!response || typeof response.then === 'function') {\n        return;\n      }\n\n      // eslint-disable-next-line eslint-multitab-tt/set-global-only-variable\n      setUntypedGlobal(response as GlobalState, options);\n    });\n  });\n\n  if (actionQueue.length === 1) {\n    try {\n      while (actionQueue.length) {\n        actionQueue[0]();\n        actionQueue.shift();\n      }\n    } finally {\n      actionQueue = [];\n    }\n  }\n}\n\nfunction updateContainers() {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  let DEBUG_startAt: number | undefined;\n  if (DEBUG) {\n    DEBUG_startAt = performance.now();\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const container of containers.values()) {\n    const {\n      mapStateToProps, ownProps, mappedProps, forceUpdate,\n    } = container;\n\n    if (!activateContainer(container, currentGlobal, ownProps)) {\n      continue;\n    }\n\n    let newMappedProps;\n\n    try {\n      newMappedProps = mapStateToProps(currentGlobal, ownProps);\n    } catch (err: any) {\n      handleError(err);\n\n      return;\n    }\n\n    if (DEBUG) {\n      if (Object.values(newMappedProps).some(Number.isNaN)) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          // eslint-disable-next-line max-len\n          `[TeactN] Some of \\`${container.DEBUG_componentName}\\` mappers contain NaN values. This may cause redundant updates because of incorrect equality check.`,\n        );\n      }\n    }\n\n    if (Object.keys(newMappedProps).length && !arePropsShallowEqual(mappedProps!, newMappedProps)) {\n      if (DEBUG_MORE) {\n        logUnequalProps(\n          mappedProps!,\n          newMappedProps,\n          `[TeactN] Will update ${container.DEBUG_componentName} caused by:`,\n        );\n      }\n\n      container.mappedProps = newMappedProps;\n      container.DEBUG_updates++;\n\n      forceUpdate();\n    }\n  }\n\n  if (DEBUG) {\n    const updateTime = performance.now() - DEBUG_startAt!;\n    if (updateTime > 7) {\n      // eslint-disable-next-line no-console\n      console.warn(`[TeactN] Slow containers update: ${Math.round(updateTime)} ms`);\n    }\n  }\n}\n\nexport function addUntypedActionHandler(name: ActionNames, handler: ActionHandler) {\n  if (!actionHandlers[name]) {\n    actionHandlers[name] = [];\n\n    actions[name] = (payload?: ActionPayload, options?: ActionOptions) => {\n      handleAction(name, payload, options);\n    };\n  }\n\n  actionHandlers[name].push(handler);\n}\n\nexport function addCallback(cb: Function) {\n  callbacks.push(cb);\n}\n\nexport function removeCallback(cb: Function) {\n  const index = callbacks.indexOf(cb);\n  if (index !== -1) {\n    callbacks.splice(index, 1);\n  }\n}\n\nexport function withUntypedGlobal<OwnProps extends AnyLiteral>(\n  mapStateToProps: MapStateToProps<OwnProps> = () => ({}),\n  activationFn?: ActivationFn<OwnProps>,\n) {\n  return (Component: FC) => {\n    function TeactNContainer(props: OwnProps) {\n      const id = useUniqueId();\n      const forceUpdate = useForceUpdate();\n\n      useUnmountCleanup(() => {\n        containers.delete(id);\n      });\n\n      let container = containers.get(id)!;\n      if (!container) {\n        container = {\n          mapStateToProps,\n          activationFn,\n          ownProps: props,\n          forceUpdate,\n          DEBUG_updates: 0,\n          DEBUG_componentName: Component.name,\n        };\n\n        containers.set(id, container);\n      }\n\n      if (!container.mappedProps || (\n        !arePropsShallowEqual(container.ownProps, props) && activateContainer(container, currentGlobal, props)\n      )) {\n        try {\n          container.mappedProps = mapStateToProps(currentGlobal, props);\n        } catch (err: any) {\n          handleError(err);\n        }\n      }\n\n      container.ownProps = props;\n\n      // eslint-disable-next-line react/jsx-props-no-spreading\n      return <Component {...container.mappedProps} {...props} />;\n    }\n\n    (TeactNContainer as FC_withDebug).DEBUG_contentComponentName = DEBUG_resolveComponentName(Component);\n\n    return TeactNContainer;\n  };\n}\n\nfunction activateContainer(container: Container, global: GlobalState, props: Props) {\n  const { activationFn, stuckTo } = container;\n  if (!activationFn) {\n    return true;\n  }\n\n  return activationFn(global, props, (stickTo: any) => {\n    if (stickTo && !stuckTo) {\n      container.stuckTo = stickTo;\n    }\n\n    return stickTo && (!stuckTo || stuckTo === stickTo);\n  });\n}\n\nexport function typify<\n  ProjectGlobalState,\n  ActionPayloads,\n>() {\n  type ProjectActionNames = keyof ActionPayloads;\n\n  // When payload is allowed to be `undefined` we consider it optional\n  type ProjectActions = {\n    [ActionName in ProjectActionNames]:\n    (undefined extends ActionPayloads[ActionName] ? (\n      (payload?: ActionPayloads[ActionName], options?: ActionOptions) => void\n    ) : (\n      (payload: ActionPayloads[ActionName], options?: ActionOptions) => void\n    ))\n  };\n\n  type ActionHandlers = {\n    [ActionName in keyof ActionPayloads]: (\n      global: ProjectGlobalState,\n      actions: ProjectActions,\n      payload: ActionPayloads[ActionName],\n    ) => ProjectGlobalState | void | Promise<void>;\n  };\n\n  return {\n    getGlobal: getUntypedGlobal as <T extends ProjectGlobalState>() => T,\n    setGlobal: setUntypedGlobal as (state: ProjectGlobalState, options?: ActionOptions) => void,\n    getActions: getUntypedActions as () => ProjectActions,\n    addActionHandler: addUntypedActionHandler as <ActionName extends ProjectActionNames>(\n      name: ActionName,\n      handler: ActionHandlers[ActionName],\n    ) => void,\n    withGlobal: withUntypedGlobal as <OwnProps extends AnyLiteral>(\n      mapStateToProps: (global: ProjectGlobalState, ownProps: OwnProps) => AnyLiteral,\n      activationFn?: (global: ProjectGlobalState, ownProps: OwnProps, stickToFirst: StickToFirstFn) => boolean,\n    ) => (Component: FC) => FC<OwnProps>,\n  };\n}\n\nif (DEBUG) {\n  (window as any).getGlobal = getUntypedGlobal;\n  (window as any).setGlobal = setUntypedGlobal;\n\n  document.addEventListener('dblclick', () => {\n    // eslint-disable-next-line no-console\n    console.warn(\n      'GLOBAL CONTAINERS',\n      orderBy(\n        Array.from(containers.values())\n          .map(({ DEBUG_componentName, DEBUG_updates }) => ({ DEBUG_componentName, DEBUG_updates })),\n        'DEBUG_updates',\n        'desc',\n      ),\n    );\n  });\n}\n","// Copyright Twitter Inc. Licensed under MIT\n// https://github.com/twitter/twemoji-parser/blob/master/LICENSE.md\n// Emoji 15.0.2 support was taken here https://github.com/mei23/twemoji-parser\n// Version 3d4dedc 15.12.2023\n\nconst vs16RegExp = /\\uFE0F/g;\n// avoid using a string literal like `\\u200D` here because minifiers expand it inline\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\n\nexport function removeVS16s(rawEmoji) {\n  return rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji;\n}\n\n// Default Twemoji regex was modified here.\n// An exception for ascii emoji has been added to the beginning of the regular string: 🅰🅱🅾🅿.\n// UTF-16 endcoding are `\\ud83c\\udd70`, `\\ud83c\\udd71`, `\\ud83c\\udd7e` and `\\ud83c\\udd7f`.\n// These emojis in the graphic version must end with the `\\ufe0f` symbol.\n// Therefore, they should be excluded from the regular expression.\n// You must remove next substring `\\udd70\\udd71\\udd7e\\udd7f` from the middle of the regex on every update.\n\n// This file is generated by source/emoji/scripts/generate.sh\n// eslint-disable-next-line max-len\nexport default /(?:\\ud83c[\\udd70\\udd71\\udd7e\\udd7f]\\ufe0f)|(?:\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\udef1\\ud83c\\udffb\\u200d\\ud83e\\udef2\\ud83c[\\udffc-\\udfff]|\\ud83e\\udef1\\ud83c\\udffc\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\udef1\\ud83c\\udffd\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\udef1\\ud83c\\udffe\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\udef1\\ud83c\\udfff\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1|\\ud83d\\udc6b\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6c\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6d\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc8f\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc91\\ud83c[\\udffb-\\udfff]|\\ud83e\\udd1d\\ud83c[\\udffb-\\udfff]|\\ud83d[\\udc6b-\\udc6d\\udc8f\\udc91]|\\ud83e\\udd1d)|(?:\\ud83c\\udfc3|\\ud83d\\udeb6|\\ud83e\\uddce)(?:\\ud83c[\\udffb-\\udfff])?(?:\\u200d[\\u2640\\u2642]\\ufe0f)?(?:\\u200d\\u27a1\\ufe0f)|(?:\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1)(?:\\ud83c[\\udffb-\\udfff])?\\u200d(?:\\ud83e[\\uddaf\\uddbc\\uddbd])(?:\\u200d\\u27a1\\ufe0f)|(?:\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1)(?:\\ud83c[\\udffb-\\udfff])?\\u200d(?:\\u2695\\ufe0f|\\u2696\\ufe0f|\\u2708\\ufe0f|\\ud83c[\\udf3e\\udf73\\udf7c\\udf84\\udf93\\udfa4\\udfa8\\udfeb\\udfed]|\\ud83d[\\udcbb\\udcbc\\udd27\\udd2c\\ude80\\ude92]|\\ud83e[\\uddaf\\uddaf-\\uddb3\\uddbc\\uddbc\\uddbd\\uddbd])|(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75]|\\u26f9)((?:\\ud83c[\\udffb-\\udfff]|\\ufe0f)\\u200d[\\u2640\\u2642]\\ufe0f)|(?:\\ud83c[\\udfc3\\udfc3\\udfc4\\udfca]|\\ud83d[\\udc6e\\udc70\\udc71\\udc73\\udc77\\udc81\\udc82\\udc86\\udc87\\ude45-\\ude47\\ude4b\\ude4d\\ude4e\\udea3\\udeb4-\\udeb6\\udeb6]|\\ud83e[\\udd26\\udd35\\udd37-\\udd39\\udd3d\\udd3e\\uddb8\\uddb9\\uddcd\\uddce\\uddce\\uddcf\\uddd4\\uddd6-\\udddd])(?:\\ud83c[\\udffb-\\udfff])?\\u200d[\\u2640\\u2642]\\ufe0f|(?:\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83e\\uddd1\\u200d\\ud83e\\uddd1\\u200d\\ud83e\\uddd2\\u200d\\ud83e\\uddd2|\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83e\\uddd1\\u200d\\ud83e\\uddd1\\u200d\\ud83e\\uddd2|\\ud83e\\uddd1\\u200d\\ud83e\\uddd2\\u200d\\ud83e\\uddd2|\\ud83c\\udff3\\ufe0f\\u200d\\u26a7\\ufe0f|\\ud83c\\udff3\\ufe0f\\u200d\\ud83c\\udf08|\\ud83d\\ude36\\u200d\\ud83c\\udf2b\\ufe0f|\\u26d3\\ufe0f\\u200d\\ud83d\\udca5|\\u2764\\ufe0f\\u200d\\ud83d\\udd25|\\u2764\\ufe0f\\u200d\\ud83e\\ude79|\\ud83c\\udf44\\u200d\\ud83d\\udfeb|\\ud83c\\udf4b\\u200d\\ud83d\\udfe9|\\ud83c\\udff4\\u200d\\u2620\\ufe0f|\\ud83d\\udc15\\u200d\\ud83e\\uddba|\\ud83d\\udc26\\u200d\\ud83d\\udd25|\\ud83d\\udc3b\\u200d\\u2744\\ufe0f|\\ud83d\\udc41\\u200d\\ud83d\\udde8|\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc6f\\u200d\\u2640\\ufe0f|\\ud83d\\udc6f\\u200d\\u2642\\ufe0f|\\ud83d\\ude2e\\u200d\\ud83d\\udca8|\\ud83d\\ude35\\u200d\\ud83d\\udcab|\\ud83d\\ude42\\u200d\\u2194\\ufe0f|\\ud83d\\ude42\\u200d\\u2195\\ufe0f|\\ud83e\\udd3c\\u200d\\u2640\\ufe0f|\\ud83e\\udd3c\\u200d\\u2642\\ufe0f|\\ud83e\\uddd1\\u200d\\ud83e\\uddd2|\\ud83e\\uddde\\u200d\\u2640\\ufe0f|\\ud83e\\uddde\\u200d\\u2642\\ufe0f|\\ud83e\\udddf\\u200d\\u2640\\ufe0f|\\ud83e\\udddf\\u200d\\u2642\\ufe0f|\\ud83d\\udc08\\u200d\\u2b1b|\\ud83d\\udc26\\u200d\\u2b1b)|[#*0-9]\\ufe0f?\\u20e3|(?:[©®\\u2122\\u265f]\\ufe0f)|(?:\\ud83c[\\udc04\\ude02\\ude1a\\ude2f\\ude37\\udf21\\udf24-\\udf2c\\udf36\\udf7d\\udf96\\udf97\\udf99-\\udf9b\\udf9e\\udf9f\\udfcd\\udfce\\udfd4-\\udfdf\\udff3\\udff5\\udff7]|\\ud83d[\\udc3f\\udc41\\udcfd\\udd49\\udd4a\\udd6f\\udd70\\udd73\\udd76-\\udd79\\udd87\\udd8a-\\udd8d\\udda5\\udda8\\uddb1\\uddb2\\uddbc\\uddc2-\\uddc4\\uddd1-\\uddd3\\udddc-\\uddde\\udde1\\udde3\\udde8\\uddef\\uddf3\\uddfa\\udecb\\udecd-\\udecf\\udee0-\\udee5\\udee9\\udef0\\udef3]|[\\u203c\\u2049\\u2139\\u2194-\\u2199\\u21a9\\u21aa\\u231a\\u231b\\u2328\\u23cf\\u23ed-\\u23ef\\u23f1\\u23f2\\u23f8-\\u23fa\\u24c2\\u25aa\\u25ab\\u25b6\\u25c0\\u25fb-\\u25fe\\u2600-\\u2604\\u260e\\u2611\\u2614\\u2615\\u2618\\u2620\\u2622\\u2623\\u2626\\u262a\\u262e\\u262f\\u2638-\\u263a\\u2640\\u2642\\u2648-\\u2653\\u2660\\u2663\\u2665\\u2666\\u2668\\u267b\\u267f\\u2692-\\u2697\\u2699\\u269b\\u269c\\u26a0\\u26a1\\u26a7\\u26aa\\u26ab\\u26b0\\u26b1\\u26bd\\u26be\\u26c4\\u26c5\\u26c8\\u26cf\\u26d1\\u26d3\\u26d4\\u26e9\\u26ea\\u26f0-\\u26f5\\u26f8\\u26fa\\u26fd\\u2702\\u2708\\u2709\\u270f\\u2712\\u2714\\u2716\\u271d\\u2721\\u2733\\u2734\\u2744\\u2747\\u2757\\u2763\\u2764\\u27a1\\u2934\\u2935\\u2b05-\\u2b07\\u2b1b\\u2b1c\\u2b50\\u2b55\\u3030\\u303d\\u3297\\u3299])(?:\\ufe0f|(?!\\ufe0e))|(?:(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75\\udd90]|\\ud83e\\udef0|[\\u261d\\u26f7\\u26f9\\u270c\\u270d])(?:\\ufe0f|(?!\\ufe0e))|(?:\\ud83c[\\udf85\\udfc2-\\udfc4\\udfc7\\udfca]|\\ud83d[\\udc42\\udc43\\udc46-\\udc50\\udc66-\\udc69\\udc6e\\udc70-\\udc78\\udc7c\\udc81-\\udc83\\udc85-\\udc87\\udcaa\\udd7a\\udd95\\udd96\\ude45-\\ude47\\ude4b-\\ude4f\\udea3\\udeb4-\\udeb6\\udec0\\udecc]|\\ud83e[\\udd0c\\udd0f\\udd18-\\udd1c\\udd1e\\udd1f\\udd26\\udd30-\\udd39\\udd3d\\udd3e\\udd77\\uddb5\\uddb6\\uddb8\\uddb9\\uddbb\\uddcd-\\uddcf\\uddd1-\\udddd\\udec3-\\udec5\\udef1-\\udef8]|[\\u270a\\u270b]))(?:\\ud83c[\\udffb-\\udfff])?|(?:\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc65\\udb40\\udc6e\\udb40\\udc67\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc73\\udb40\\udc63\\udb40\\udc74\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc77\\udb40\\udc6c\\udb40\\udc73\\udb40\\udc7f|\\ud83c\\udde6\\ud83c[\\udde8-\\uddec\\uddee\\uddf1\\uddf2\\uddf4\\uddf6-\\uddfa\\uddfc\\uddfd\\uddff]|\\ud83c\\udde7\\ud83c[\\udde6\\udde7\\udde9-\\uddef\\uddf1-\\uddf4\\uddf6-\\uddf9\\uddfb\\uddfc\\uddfe\\uddff]|\\ud83c\\udde8\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\uddee\\uddf0-\\uddf5\\uddf7\\uddfa-\\uddff]|\\ud83c\\udde9\\ud83c[\\uddea\\uddec\\uddef\\uddf0\\uddf2\\uddf4\\uddff]|\\ud83c\\uddea\\ud83c[\\udde6\\udde8\\uddea\\uddec\\udded\\uddf7-\\uddfa]|\\ud83c\\uddeb\\ud83c[\\uddee-\\uddf0\\uddf2\\uddf4\\uddf7]|\\ud83c\\uddec\\ud83c[\\udde6\\udde7\\udde9-\\uddee\\uddf1-\\uddf3\\uddf5-\\uddfa\\uddfc\\uddfe]|\\ud83c\\udded\\ud83c[\\uddf0\\uddf2\\uddf3\\uddf7\\uddf9\\uddfa]|\\ud83c\\uddee\\ud83c[\\udde8-\\uddea\\uddf1-\\uddf4\\uddf6-\\uddf9]|\\ud83c\\uddef\\ud83c[\\uddea\\uddf2\\uddf4\\uddf5]|\\ud83c\\uddf0\\ud83c[\\uddea\\uddec-\\uddee\\uddf2\\uddf3\\uddf5\\uddf7\\uddfc\\uddfe\\uddff]|\\ud83c\\uddf1\\ud83c[\\udde6-\\udde8\\uddee\\uddf0\\uddf7-\\uddfb\\uddfe]|\\ud83c\\uddf2\\ud83c[\\udde6\\udde8-\\udded\\uddf0-\\uddff]|\\ud83c\\uddf3\\ud83c[\\udde6\\udde8\\uddea-\\uddec\\uddee\\uddf1\\uddf4\\uddf5\\uddf7\\uddfa\\uddff]|\\ud83c\\uddf4\\ud83c\\uddf2|\\ud83c\\uddf5\\ud83c[\\udde6\\uddea-\\udded\\uddf0-\\uddf3\\uddf7-\\uddf9\\uddfc\\uddfe]|\\ud83c\\uddf6\\ud83c\\udde6|\\ud83c\\uddf7\\ud83c[\\uddea\\uddf4\\uddf8\\uddfa\\uddfc]|\\ud83c\\uddf8\\ud83c[\\udde6-\\uddea\\uddec-\\uddf4\\uddf7-\\uddf9\\uddfb\\uddfd-\\uddff]|\\ud83c\\uddf9\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\udded\\uddef-\\uddf4\\uddf7\\uddf9\\uddfb\\uddfc\\uddff]|\\ud83c\\uddfa\\ud83c[\\udde6\\uddec\\uddf2\\uddf3\\uddf8\\uddfe\\uddff]|\\ud83c\\uddfb\\ud83c[\\udde6\\udde8\\uddea\\uddec\\uddee\\uddf3\\uddfa]|\\ud83c\\uddfc\\ud83c[\\uddeb\\uddf8]|\\ud83c\\uddfd\\ud83c\\uddf0|\\ud83c\\uddfe\\ud83c[\\uddea\\uddf9]|\\ud83c\\uddff\\ud83c[\\udde6\\uddf2\\uddfc]|\\ud83c[\\udccf\\udd8e\\udd91-\\udd9a\\udde6-\\uddff\\ude01\\ude32-\\ude36\\ude38-\\ude3a\\ude50\\ude51\\udf00-\\udf20\\udf2d-\\udf35\\udf37-\\udf7c\\udf7e-\\udf84\\udf86-\\udf93\\udfa0-\\udfc1\\udfc5\\udfc6\\udfc8\\udfc9\\udfcf-\\udfd3\\udfe0-\\udff0\\udff4\\udff8-\\udfff]|\\ud83d[\\udc00-\\udc3e\\udc40\\udc44\\udc45\\udc51-\\udc65\\udc6a\\udc6f\\udc79-\\udc7b\\udc7d-\\udc80\\udc84\\udc88-\\udc8e\\udc90\\udc92-\\udca9\\udcab-\\udcfc\\udcff-\\udd3d\\udd4b-\\udd4e\\udd50-\\udd67\\udda4\\uddfb-\\ude44\\ude48-\\ude4a\\ude80-\\udea2\\udea4-\\udeb3\\udeb7-\\udebf\\udec1-\\udec5\\uded0-\\uded2\\uded5-\\uded7\\udedc-\\udedf\\udeeb\\udeec\\udef4-\\udefc\\udfe0-\\udfeb\\udff0]|\\ud83e[\\udd0d\\udd0e\\udd10-\\udd17\\udd20-\\udd25\\udd27-\\udd2f\\udd3a\\udd3c\\udd3f-\\udd45\\udd47-\\udd76\\udd78-\\uddb4\\uddb7\\uddba\\uddbc-\\uddcc\\uddd0\\uddde-\\uddff\\ude70-\\ude7c\\ude80-\\ude88\\ude90-\\udebd\\udebf-\\udec2\\udece-\\udedb\\udee0-\\udee8]|[\\u23e9-\\u23ec\\u23f0\\u23f3\\u267e\\u26ce\\u2705\\u2728\\u274c\\u274e\\u2753-\\u2755\\u2795-\\u2797\\u27b0\\u27bf\\ue50a])|\\ufe0f/g;\n","import type { TeactNode } from '../lib/teact/teact';\n\nimport type {\n  ApiBotInlineMediaResult,\n  ApiBotInlineResult,\n  ApiBotInlineSwitchPm,\n  ApiBotInlineSwitchWebview,\n  ApiChatInviteImporter,\n  ApiDocument,\n  ApiDraft,\n  ApiExportedInvite,\n  ApiFakeType,\n  ApiFormattedText,\n  ApiLabeledPrice,\n  ApiMediaFormat,\n  ApiMessage,\n  ApiPhoto,\n  ApiReaction,\n  ApiReactionWithPaid,\n  ApiStarGiftRegular,\n  ApiStarsSubscription,\n  ApiStarsTransaction,\n  ApiStickerSet,\n  ApiThreadInfo,\n  ApiTopic,\n  ApiTypingStatus,\n  ApiVideo,\n} from '../api/types';\nimport type { SearchResultKey } from '../util/keys/searchResultKey';\nimport type { IconName } from './icons';\n\nexport type TextPart = TeactNode;\n\nexport enum LoadMoreDirection {\n  Backwards,\n  Forwards,\n  Around,\n}\n\nexport enum FocusDirection {\n  Up,\n  Down,\n  Static,\n}\n\nexport type ScrollTargetPosition = ScrollLogicalPosition | 'centerOrTop';\n\nexport interface IAlbum {\n  albumId: string;\n  messages: ApiMessage[];\n  isPaidMedia?: boolean;\n  mainMessage: ApiMessage;\n  captionMessage?: ApiMessage;\n  hasMultipleCaptions: boolean;\n  commentsMessage?: ApiMessage;\n}\n\nexport type ThreadId = string | number;\n\nexport type ThemeKey = 'light' | 'dark';\nexport type AnimationLevel = 0 | 1 | 2;\nexport type PerformanceTypeKey = (\n  'pageTransitions' | 'messageSendingAnimations' | 'mediaViewerAnimations'\n  | 'messageComposerAnimations' | 'contextMenuAnimations' | 'contextMenuBlur' | 'rightColumnAnimations'\n  | 'animatedEmoji' | 'loopAnimatedStickers' | 'reactionEffects' | 'stickerEffects' | 'autoplayGifs' | 'autoplayVideos'\n  | 'storyRibbonAnimations' | 'snapEffect'\n);\nexport type PerformanceType = {\n  [key in PerformanceTypeKey]: boolean;\n};\n\nexport interface IThemeSettings {\n  background?: string;\n  backgroundColor?: string;\n  patternColor?: string;\n  isBlurred?: boolean;\n}\n\nexport type NotifySettings = {\n  hasPrivateChatsNotifications?: boolean;\n  hasPrivateChatsMessagePreview?: boolean;\n  hasGroupNotifications?: boolean;\n  hasGroupMessagePreview?: boolean;\n  hasBroadcastNotifications?: boolean;\n  hasBroadcastMessagePreview?: boolean;\n  hasContactJoinedNotifications?: boolean;\n  hasWebNotifications: boolean;\n  hasPushNotifications: boolean;\n  notificationSoundVolume: number;\n};\n\nexport type LangCode = (\n  'en' | 'ar' | 'be' | 'ca' | 'nl' | 'fr' | 'de' | 'id' | 'it' | 'ko' | 'ms' | 'fa' | 'pl' | 'pt-br' | 'ru' | 'es'\n  | 'tr' | 'uk' | 'uz'\n);\n\nexport type TimeFormat = '24h' | '12h';\n\nexport interface ISettings extends NotifySettings, Record<string, any> {\n  theme: ThemeKey;\n  shouldUseSystemTheme: boolean;\n  messageTextSize: number;\n  animationLevel: AnimationLevel;\n  messageSendKeyCombo: 'enter' | 'ctrl-enter';\n  canAutoLoadPhotoFromContacts: boolean;\n  canAutoLoadPhotoInPrivateChats: boolean;\n  canAutoLoadPhotoInGroups: boolean;\n  canAutoLoadPhotoInChannels: boolean;\n  canAutoLoadVideoFromContacts: boolean;\n  canAutoLoadVideoInPrivateChats: boolean;\n  canAutoLoadVideoInGroups: boolean;\n  canAutoLoadVideoInChannels: boolean;\n  canAutoLoadFileFromContacts: boolean;\n  canAutoLoadFileInPrivateChats: boolean;\n  canAutoLoadFileInGroups: boolean;\n  canAutoLoadFileInChannels: boolean;\n  autoLoadFileMaxSizeMb: number;\n  shouldSuggestStickers: boolean;\n  shouldSuggestCustomEmoji: boolean;\n  shouldUpdateStickerSetOrder: boolean;\n  hasPassword?: boolean;\n  language: string;\n  isSensitiveEnabled?: boolean;\n  canChangeSensitive?: boolean;\n  timeFormat: TimeFormat;\n  wasTimeFormatSetManually: boolean;\n  isConnectionStatusMinimized: boolean;\n  shouldArchiveAndMuteNewNonContact?: boolean;\n  shouldNewNonContactPeersRequirePremium?: boolean;\n  shouldHideReadMarks?: boolean;\n  canTranslate: boolean;\n  canTranslateChats: boolean;\n  translationLanguage?: string;\n  doNotTranslate: string[];\n  canDisplayChatInTitle: boolean;\n  shouldForceHttpTransport?: boolean;\n  shouldAllowHttpTransport?: boolean;\n  shouldCollectDebugLogs?: boolean;\n  shouldDebugExportedSenders?: boolean;\n  shouldWarnAboutSvg?: boolean;\n  shouldSkipWebAppCloseConfirmation: boolean;\n}\n\nexport type IAnchorPosition = {\n  x: number;\n  y: number;\n};\n\nexport interface ShippingOption {\n  id: string;\n  title: string;\n  amount: number;\n  prices: ApiLabeledPrice[];\n}\n\nexport enum SettingsScreens {\n  Main,\n  EditProfile,\n  Notifications,\n  DataStorage,\n  Language,\n  ActiveSessions,\n  General,\n  GeneralChatBackground,\n  GeneralChatBackgroundColor,\n  Privacy,\n  PrivacyPhoneNumber,\n  PrivacyAddByPhone,\n  PrivacyLastSeen,\n  PrivacyProfilePhoto,\n  PrivacyBio,\n  PrivacyBirthday,\n  PrivacyGifts,\n  PrivacyPhoneCall,\n  PrivacyPhoneP2P,\n  PrivacyForwarding,\n  PrivacyVoiceMessages,\n  PrivacyMessages,\n  PrivacyGroupChats,\n  PrivacyPhoneNumberAllowedContacts,\n  PrivacyPhoneNumberDeniedContacts,\n  PrivacyLastSeenAllowedContacts,\n  PrivacyLastSeenDeniedContacts,\n  PrivacyProfilePhotoAllowedContacts,\n  PrivacyProfilePhotoDeniedContacts,\n  PrivacyBioAllowedContacts,\n  PrivacyBioDeniedContacts,\n  PrivacyBirthdayAllowedContacts,\n  PrivacyBirthdayDeniedContacts,\n  PrivacyGiftsAllowedContacts,\n  PrivacyGiftsDeniedContacts,\n  PrivacyPhoneCallAllowedContacts,\n  PrivacyPhoneCallDeniedContacts,\n  PrivacyPhoneP2PAllowedContacts,\n  PrivacyPhoneP2PDeniedContacts,\n  PrivacyForwardingAllowedContacts,\n  PrivacyForwardingDeniedContacts,\n  PrivacyVoiceMessagesAllowedContacts,\n  PrivacyVoiceMessagesDeniedContacts,\n  PrivacyGroupChatsAllowedContacts,\n  PrivacyGroupChatsDeniedContacts,\n  PrivacyBlockedUsers,\n  Performance,\n  Folders,\n  FoldersCreateFolder,\n  FoldersEditFolder,\n  FoldersEditFolderFromChatList,\n  FoldersEditFolderInvites,\n  FoldersIncludedChats,\n  FoldersIncludedChatsFromChatList,\n  FoldersExcludedChats,\n  FoldersExcludedChatsFromChatList,\n  TwoFaDisabled,\n  TwoFaNewPassword,\n  TwoFaNewPasswordConfirm,\n  TwoFaNewPasswordHint,\n  TwoFaNewPasswordEmail,\n  TwoFaNewPasswordEmailCode,\n  TwoFaEnabled,\n  TwoFaChangePasswordCurrent,\n  TwoFaChangePasswordNew,\n  TwoFaChangePasswordConfirm,\n  TwoFaChangePasswordHint,\n  TwoFaTurnOff,\n  TwoFaRecoveryEmailCurrentPassword,\n  TwoFaRecoveryEmail,\n  TwoFaRecoveryEmailCode,\n  TwoFaCongratulations,\n  ActiveWebsites,\n  PasscodeDisabled,\n  PasscodeNewPasscode,\n  PasscodeNewPasscodeConfirm,\n  PasscodeEnabled,\n  PasscodeChangePasscodeCurrent,\n  PasscodeChangePasscodeNew,\n  PasscodeChangePasscodeConfirm,\n  PasscodeTurnOff,\n  PasscodeCongratulations,\n  Experimental,\n  Stickers,\n  QuickReaction,\n  CustomEmoji,\n  DoNotTranslate,\n  FoldersShare,\n}\n\nexport type StickerSetOrReactionsSetOrRecent = Pick<ApiStickerSet, (\n  'id' | 'accessHash' | 'title' | 'count' | 'stickers' | 'isEmoji' | 'installedDate' | 'isArchived' |\n  'hasThumbnail' | 'hasStaticThumb' | 'hasAnimatedThumb' | 'hasVideoThumb' | 'thumbCustomEmojiId'\n)> & { reactions?: ApiReactionWithPaid[] };\n\nexport enum LeftColumnContent {\n  ChatList,\n  GlobalSearch,\n  Settings,\n  Contacts,\n  Archived,\n  NewChannelStep1,\n  NewChannelStep2,\n  NewGroupStep1,\n  NewGroupStep2,\n}\n\nexport enum GlobalSearchContent {\n  ChatList,\n  ChannelList,\n  BotApps,\n  Media,\n  Links,\n  Files,\n  Music,\n  Voice,\n}\n\nexport enum RightColumnContent {\n  ChatInfo,\n  Management,\n  Statistics,\n  BoostStatistics,\n  MessageStatistics,\n  StoryStatistics,\n  StickerSearch,\n  GifSearch,\n  PollResults,\n  AddingMembers,\n  CreateTopic,\n  EditTopic,\n  MonetizationStatistics,\n}\n\nexport type MediaViewerMedia = ApiPhoto | ApiVideo | ApiDocument;\n\nexport enum MediaViewerOrigin {\n  Inline,\n  ScheduledInline,\n  SharedMedia,\n  ProfileAvatar,\n  SettingsAvatar,\n  MiddleHeaderAvatar,\n  Album,\n  ScheduledAlbum,\n  SearchResult,\n  SuggestedAvatar,\n  StarsTransaction,\n  PreviewMedia,\n  SponsoredMessage,\n}\n\nexport enum StoryViewerOrigin {\n  StoryRibbon,\n  MiddleHeaderAvatar,\n  ChatList,\n  SearchResult,\n}\n\nexport enum AudioOrigin {\n  Inline,\n  SharedMedia,\n  Search,\n  OneTimeModal,\n}\n\nexport enum ChatCreationProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport enum ProfileEditProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport enum ManagementProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport interface ManagementState {\n  isActive: boolean;\n  nextScreen?: ManagementScreens;\n  checkedUsername?: string;\n  isUsernameAvailable?: boolean;\n  error?: string;\n  invites?: ApiExportedInvite[];\n  revokedInvites?: ApiExportedInvite[];\n  editingInvite?: ApiExportedInvite;\n  inviteInfo?: {\n    invite: ApiExportedInvite;\n    importers?: ApiChatInviteImporter[];\n    requesters?: ApiChatInviteImporter[];\n  };\n}\n\nexport enum NewChatMembersProgress {\n  Closed,\n  InProgress,\n  Loading,\n}\n\nexport type ProfileTabType =\n  | 'members'\n  | 'commonChats'\n  | 'media'\n  | 'previewMedia'\n  | 'documents'\n  | 'links'\n  | 'audio'\n  | 'voice'\n  | 'stories'\n  | 'storiesArchive'\n  | 'similarChannels'\n  | 'similarBots'\n  | 'dialogs'\n  | 'gifts';\nexport type SharedMediaType = 'media' | 'documents' | 'links' | 'audio' | 'voice';\nexport type MiddleSearchType = 'chat' | 'myChats' | 'channels';\nexport type MiddleSearchParams = {\n  requestedQuery?: string;\n  savedTag?: ApiReaction;\n  isHashtag?: boolean;\n  fetchingQuery?: string;\n  type: MiddleSearchType;\n  results?: MiddleSearchResults;\n};\nexport type MiddleSearchResults = {\n  query: string;\n  totalCount?: number;\n  nextOffsetId?: number;\n  nextOffsetPeerId?: string;\n  nextOffsetRate?: number;\n  foundIds?: SearchResultKey[];\n};\n\nexport interface LoadingState {\n  areAllItemsLoadedForwards: boolean;\n  areAllItemsLoadedBackwards: boolean;\n}\n\nexport interface ChatMediaSearchSegment {\n  foundIds: number[];\n  loadingState: LoadingState;\n}\n\nexport interface ChatMediaSearchParams {\n  currentSegment: ChatMediaSearchSegment;\n  segments: ChatMediaSearchSegment[];\n  isLoading: boolean;\n}\n\nexport enum ProfileState {\n  Profile,\n  SharedMedia,\n  MemberList,\n  StoryList,\n  SavedDialogs,\n}\n\nexport enum PaymentStep {\n  Checkout,\n  SavedPayments,\n  ConfirmPassword,\n  PaymentInfo,\n  ShippingInfo,\n  Shipping,\n  ConfirmPayment,\n}\n\nexport const UPLOADING_WALLPAPER_SLUG = 'UPLOADING_WALLPAPER_SLUG';\n\nexport enum ManagementScreens {\n  Initial,\n  ChatPrivacyType,\n  Discussion,\n  ChannelSubscribers,\n  GroupType,\n  GroupPermissions,\n  GroupRemovedUsers,\n  ChannelRemovedUsers,\n  GroupUserPermissionsCreate,\n  GroupUserPermissions,\n  ChatAdministrators,\n  GroupRecentActions,\n  ChatAdminRights,\n  ChatNewAdminRights,\n  GroupMembers,\n  GroupAddAdmins,\n  Invites,\n  EditInvite,\n  Reactions,\n  InviteInfo,\n  JoinRequests,\n}\n\nexport type ManagementType = 'user' | 'group' | 'channel' | 'bot';\n\nexport type NotifyException = {\n  isMuted: boolean;\n  isSilent?: boolean;\n  shouldShowPreviews?: boolean;\n};\n\nexport type EmojiKeywords = {\n  isLoading?: boolean;\n  version?: number;\n  keywords?: Record<string, string[]>;\n};\n\nexport type InlineBotSettings = {\n  id: string;\n  help?: string;\n  query?: string;\n  offset?: string;\n  canLoadMore?: boolean;\n  results?: (ApiBotInlineResult | ApiBotInlineMediaResult)[];\n  isGallery?: boolean;\n  switchPm?: ApiBotInlineSwitchPm;\n  switchWebview?: ApiBotInlineSwitchWebview;\n  cacheTime: number;\n};\n\nexport type CustomPeerType = 'premium' | 'toBeDistributed' | 'contacts' | 'nonContacts'\n| 'groups' | 'channels' | 'bots' | 'excludeMuted' | 'excludeArchived' | 'excludeRead' | 'stars';\n\nexport type CustomPeer = {\n  isCustomPeer: true;\n  key?: string | number;\n  subtitleKey?: string;\n  avatarIcon?: IconName;\n  isAvatarSquare?: boolean;\n  peerColorId?: number;\n  isVerified?: boolean;\n  fakeType?: ApiFakeType;\n  emojiStatusId?: string;\n  customPeerAvatarColor?: string;\n  withPremiumGradient?: boolean;\n} & ({\n  titleKey: string;\n  title?: undefined;\n} | {\n  title: string;\n  titleKey?: undefined;\n});\n\nexport type UniqueCustomPeer<T = CustomPeerType> = CustomPeer & {\n  type: T;\n};\n\nexport type MessageListType =\n  'thread'\n  | 'pinned'\n  | 'scheduled';\n\nexport type ChatListType = 'active' | 'archived' | 'saved';\n\nexport interface MessageList {\n  chatId: string;\n  threadId: ThreadId;\n  type: MessageListType;\n}\n\nexport interface ActiveEmojiInteraction {\n  id: number;\n  x: number;\n  y: number;\n  messageId?: number;\n  startSize?: number;\n  animatedEffect?: string;\n  isReversed?: boolean;\n}\n\nexport type ActiveDownloads = Record<string, {\n  format: ApiMediaFormat;\n  filename: string;\n  size: number;\n  originChatId?: string;\n  originMessageId?: number;\n}>;\n\nexport type IDimensions = {\n  width: number;\n  height: number;\n};\n\nexport type StarsTransactionType = 'all' | 'inbound' | 'outbound';\nexport type StarsTransactionHistory = Record<StarsTransactionType, {\n  transactions: ApiStarsTransaction[];\n  nextOffset?: string;\n} | undefined>;\nexport type StarsSubscriptions = {\n  list: ApiStarsSubscription[];\n  nextOffset?: string;\n  isLoading?: boolean;\n};\n\nexport type ConfettiStyle = 'poppers' | 'top-down';\n\nexport type StarGiftInfo = {\n  peerId: string;\n  gift: ApiStarGiftRegular;\n  shouldHideName?: boolean;\n  message?: ApiFormattedText;\n  shouldUpgrade?: boolean;\n};\n\nexport interface TabThread {\n  scrollOffset?: number;\n  replyStack?: number[];\n  viewportIds?: number[];\n}\n\nexport interface Thread {\n  lastScrollOffset?: number;\n  lastViewportIds?: number[];\n  listedIds?: number[];\n  outlyingLists?: number[][];\n  pinnedIds?: number[];\n  scheduledIds?: number[];\n  editingId?: number;\n  editingScheduledId?: number;\n  editingDraft?: ApiFormattedText;\n  editingScheduledDraft?: ApiFormattedText;\n  draft?: ApiDraft;\n  noWebPage?: boolean;\n  threadInfo?: ApiThreadInfo;\n  firstMessageId?: number;\n  typingStatus?: ApiTypingStatus;\n}\n\nexport interface ServiceNotification {\n  id: number;\n  message: ApiMessage;\n  version?: string;\n  isUnread?: boolean;\n  isDeleted?: boolean;\n}\n\nexport interface TopicsInfo {\n  totalCount: number;\n  topicsById: Record<ThreadId, ApiTopic>;\n  listedTopicIds?: number[];\n  orderedPinnedTopicIds?: number[];\n}\n\nexport type TranslatedMessage = {\n  isPending?: boolean;\n  text?: ApiFormattedText;\n};\n\nexport type ChatTranslatedMessages = {\n  byLangCode: Record<string, Record<number, TranslatedMessage>>;\n};\n\nexport type ChatRequestedTranslations = {\n  toLanguage?: string;\n  manualMessages?: Record<number, string>;\n};\n\nexport type SimilarBotsInfo = {\n  similarBotsIds?: string[];\n  count: number;\n};\n\nexport type ConfettiParams = OptionalCombine<{\n  style?: ConfettiStyle;\n  withStars?: boolean;\n}, {\n  top?: number;\n  left?: number;\n  width?: number;\n  height?: number;\n}>;\n\nexport interface Size {\n  width: number;\n  height: number;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type WebPageMediaSize = 'large' | 'small';\n\nexport type StarGiftCategory = number | 'all' | 'limited' | 'stock';\n\nexport type CallSound = (\n  'join' | 'allowTalk' | 'leave' | 'connecting' | 'incoming' | 'end' | 'connect' | 'busy' | 'ringing'\n);\n\nexport type BotAppPermissions = {\n  geolocation?: boolean;\n};\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n\n  static resolved(): Deferred<void>;\n  static resolved<T>(value: T): Deferred<T>;\n  static resolved<T>(value?: T): Deferred<T | void> {\n    const deferred = new Deferred<T | void>();\n    deferred.resolve(value);\n    return deferred;\n  }\n}\n","import type { Scheduler } from './schedulers';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\n\ninterface AnimationInstance {\n  isCancelled: boolean;\n}\n\nlet currentInstance: AnimationInstance | undefined;\n\nexport function animateSingle(tick: Function, schedulerFn: Scheduler, instance?: AnimationInstance) {\n  if (!instance) {\n    if (currentInstance && !currentInstance.isCancelled) {\n      currentInstance.isCancelled = true;\n    }\n\n    instance = { isCancelled: false };\n    currentInstance = instance;\n  }\n\n  if (!instance!.isCancelled && tick()) {\n    schedulerFn(() => {\n      animateSingle(tick, schedulerFn, instance);\n    });\n  }\n}\n\nexport function cancelSingleAnimation() {\n  const dumbScheduler = (cb: AnyFunction) => cb;\n  const dumbCb = () => undefined;\n\n  animateSingle(dumbCb, dumbScheduler);\n}\n\nexport function animate(tick: Function, schedulerFn: Scheduler) {\n  schedulerFn(() => {\n    if (tick()) {\n      animate(tick, schedulerFn);\n    }\n  });\n}\n\nexport function animateInstantly(tick: Function, schedulerFn: Scheduler) {\n  if (tick()) {\n    schedulerFn(() => {\n      animateInstantly(tick, schedulerFn);\n    });\n  }\n}\n\ntype TimingFn = (t: number) => number;\n\ntype AnimateNumberProps<T extends number | number[]> = {\n  to: T;\n  from: T;\n  duration: number;\n  onUpdate: (value: T) => void;\n  timing?: TimingFn;\n  onEnd?: (isCanceled?: boolean) => void;\n};\n\nexport const timingFunctions = {\n  linear: (t: number) => t,\n  easeIn: (t: number) => t ** 1.675,\n  easeOut: (t: number) => -1 * t ** 1.675,\n  easeInOut: (t: number) => 0.5 * (Math.sin((t - 0.5) * Math.PI) + 1),\n  easeInQuad: (t: number) => t * t,\n  easeOutQuad: (t: number) => t * (2 - t),\n  easeInOutQuad: (t: number) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t),\n  easeInCubic: (t: number) => t ** 3,\n  easeOutCubic: (t: number) => (--t) * t * t + 1,\n  easeInOutCubic: (t: number) => (t < 0.5 ? 4 * t ** 3 : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1),\n  easeInQuart: (t: number) => t ** 4,\n  easeOutQuart: (t: number) => 1 - (--t) * t ** 3,\n  easeInOutQuart: (t: number) => (t < 0.5 ? 8 * t ** 4 : 1 - 8 * (--t) * t ** 3),\n  easeInQuint: (t: number) => t ** 5,\n  easeOutQuint: (t: number) => 1 + (--t) * t ** 4,\n  easeInOutQuint: (t: number) => (t < 0.5 ? 16 * t ** 5 : 1 + 16 * (--t) * t ** 4),\n};\n\nexport function animateNumber<T extends number | number[]>({\n  timing = timingFunctions.linear,\n  onUpdate,\n  duration,\n  onEnd,\n  from,\n  to,\n}: AnimateNumberProps<T>) {\n  const t0 = Date.now();\n\n  let isCanceled = false;\n\n  animateInstantly(() => {\n    if (isCanceled) return false;\n\n    const t1 = Date.now();\n    const t = Math.min((t1 - t0) / duration, 1);\n\n    const progress = timing(t);\n    if (typeof from === 'number' && typeof to === 'number') {\n      onUpdate((from + ((to - from) * progress)) as T);\n    } else if (Array.isArray(from) && Array.isArray(to)) {\n      const result = from.map((f, i) => f + ((to[i] - f) * progress));\n      onUpdate(result as T);\n    }\n\n    if (t === 1) {\n      onEnd?.();\n    }\n\n    return t < 1;\n  }, requestMeasure);\n\n  return () => {\n    isCanceled = true;\n    onEnd?.(true);\n  };\n}\n\nexport function applyStyles(element: HTMLElement, css: Record<string, string>) {\n  Object.assign(element.style, css);\n}\n","import { getGlobal } from '../global';\n\nimport { DEBUG } from '../config';\nimport { selectTabState } from '../global/selectors';\n\nexport function updateAppBadge(unreadCount: number) {\n  if (!selectTabState(getGlobal()).isMasterTab) return;\n  if (typeof window.navigator.setAppBadge !== 'function') {\n    return;\n  }\n\n  window.navigator.setAppBadge(unreadCount).catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n  });\n}\n","export function areDeepEqual<T extends any>(value1: T, value2: T): boolean {\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n  if (type1 !== type2) {\n    return false;\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  if (type1 !== 'object' || value1 === null || value2 === null) {\n    return value1 === value2;\n  }\n\n  const isArray1 = Array.isArray(value1);\n  const isArray2 = Array.isArray(value2);\n\n  if (isArray1 !== isArray2) {\n    return false;\n  }\n\n  if (isArray1) {\n    const array1 = value1 as any[];\n    const array2 = value2 as any[];\n\n    if (array1.length !== array2.length) {\n      return false;\n    }\n\n    return array1.every((member1, i) => areDeepEqual(member1, array2[i]));\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n\n  return keys1.length === Object.keys(object2).length\n    && keys1.every((key1) => areDeepEqual(object1[key1], object2[key1]));\n}\n","export default function arePropsShallowEqual(currentProps: AnyLiteral, newProps: AnyLiteral) {\n  if (currentProps === newProps) {\n    return true;\n  }\n\n  const currentKeys = Object.keys(currentProps);\n  const currentKeysLength = currentKeys.length;\n  const newKeysLength = Object.keys(newProps).length;\n\n  if (currentKeysLength !== newKeysLength) {\n    return false;\n  }\n\n  if (currentKeysLength === 0) {\n    return true;\n  }\n\n  for (let i = 0; i < currentKeysLength; i++) {\n    const prop = currentKeys[i];\n    if (currentProps[prop] !== newProps[prop]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function logUnequalProps(currentProps: AnyLiteral, newProps: AnyLiteral, msg: string, debugKey = '') {\n  const currentKeys = Object.keys(currentProps);\n  const currentKeysLength = currentKeys.length;\n  const newKeysLength = Object.keys(newProps).length;\n\n  if (currentKeysLength !== newKeysLength) {\n    // eslint-disable-next-line no-console\n    console.log(`${msg} LENGTH`);\n    return;\n  }\n\n  // eslint-disable-next-line no-console\n  console.log(msg);\n  currentKeys.forEach((prop) => {\n    if (currentProps[prop] !== newProps[prop]) {\n      // eslint-disable-next-line no-console\n      console.log(debugKey, prop, ':', currentProps[prop], '=>', newProps[prop]);\n    }\n  });\n}\n","function promisifyRequest(request) {\n    return new Promise((resolve, reject) => {\n        // @ts-ignore - file size hacks\n        request.oncomplete = request.onsuccess = () => resolve(request.result);\n        // @ts-ignore - file size hacks\n        request.onabort = request.onerror = () => reject(request.error);\n    });\n}\nfunction createStore(dbName, storeName) {\n    const request = indexedDB.open(dbName);\n    request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n    const dbp = promisifyRequest(request);\n    return (txMode, callback) => dbp.then((db) => callback(db.transaction(storeName, txMode).objectStore(storeName)));\n}\nlet defaultGetStoreFunc;\nfunction defaultGetStore() {\n    if (!defaultGetStoreFunc) {\n        defaultGetStoreFunc = createStore('keyval-store', 'keyval');\n    }\n    return defaultGetStoreFunc;\n}\n/**\n * Get a value by its key.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction get(key, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => promisifyRequest(store.get(key)));\n}\n/**\n * Set a value with a key.\n *\n * @param key\n * @param value\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction set(key, value, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.put(value, key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Set multiple values at once. This is faster than calling set() multiple times.\n * It's also atomic – if one of the pairs can't be added, none will be added.\n *\n * @param entries Array of entries, where each entry is an array of `[key, value]`.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction setMany(entries, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        entries.forEach((entry) => store.put(entry[1], entry[0]));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Get multiple values by their keys\n *\n * @param keys\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction getMany(keys, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => Promise.all(keys.map((key) => promisifyRequest(store.get(key)))));\n}\n/**\n * Update a value. This lets you see the old value and update it as an atomic operation.\n *\n * @param key\n * @param updater A callback that takes the old value and returns a new value.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction update(key, updater, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => \n    // Need to create the promise manually.\n    // If I try to chain promises, the transaction closes in browsers\n    // that use a promise polyfill (IE10/11).\n    new Promise((resolve, reject) => {\n        store.get(key).onsuccess = function () {\n            try {\n                store.put(updater(this.result), key);\n                resolve(promisifyRequest(store.transaction));\n            }\n            catch (err) {\n                reject(err);\n            }\n        };\n    }));\n}\n/**\n * Delete a particular key from the store.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction del(key, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.delete(key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Delete multiple keys at once.\n *\n * @param keys List of keys to delete.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction delMany(keys, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        keys.forEach((key) => store.delete(key));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Clear all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction clear(customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.clear();\n        return promisifyRequest(store.transaction);\n    });\n}\nfunction eachCursor(store, callback) {\n    store.openCursor().onsuccess = function () {\n        if (!this.result)\n            return;\n        callback(this.result);\n        this.result.continue();\n    };\n    return promisifyRequest(store.transaction);\n}\n/**\n * Get all keys in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction keys(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAllKeys) {\n            return promisifyRequest(store.getAllKeys());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.key)).then(() => items);\n    });\n}\n/**\n * Get all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction values(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAll) {\n            return promisifyRequest(store.getAll());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.value)).then(() => items);\n    });\n}\n/**\n * Get all entries in the store. Each entry is an array of `[key, value]`.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction entries(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        // (although, hopefully we'll get a simpler path some day)\n        if (store.getAll && store.getAllKeys) {\n            return Promise.all([\n                promisifyRequest(store.getAllKeys()),\n                promisifyRequest(store.getAll()),\n            ]).then(([keys, values]) => keys.map((key, i) => [key, values[i]]));\n        }\n        const items = [];\n        return customStore('readonly', (store) => eachCursor(store, (cursor) => items.push([cursor.key, cursor.value])).then(() => items));\n    });\n}\n\nexport { clear, createStore, del, delMany, entries, get, getMany, keys, promisifyRequest, set, setMany, update, values };\n","import {\n  clear,\n  createStore,\n  del,\n  delMany,\n  entries as getEntries,\n  get,\n  getMany,\n  keys as getKeys,\n  set,\n  setMany,\n  update,\n  values as getValues,\n} from 'idb-keyval';\n\nclass IdbStore {\n  public store: ReturnType<typeof createStore>;\n\n  constructor(name: string) {\n    this.store = createStore(name, 'store');\n  }\n\n  public set(key: string, value: any) {\n    return set(key, value, this.store);\n  }\n\n  public setMany(entries: [string, any][]) {\n    return setMany(entries, this.store);\n  }\n\n  public get<T = unknown>(key: string) {\n    return get<T>(key, this.store);\n  }\n\n  public getMany<T = unknown>(keys: string[]) {\n    return getMany<T>(keys, this.store);\n  }\n\n  public clear() {\n    return clear(this.store);\n  }\n\n  public del(key: string) {\n    return del(key, this.store);\n  }\n\n  public delMany(keys: string[]) {\n    return delMany(keys, this.store);\n  }\n\n  public entries() {\n    return getEntries(this.store);\n  }\n\n  public keys() {\n    return getKeys(this.store);\n  }\n\n  public values<T = unknown>() {\n    return getValues<T>(this.store);\n  }\n\n  public update<T = unknown>(key: string, updater: (oldValue: T | undefined) => T) {\n    return update(key, updater, this.store);\n  }\n}\n\nexport const MAIN_IDB_STORE = new IdbStore('tt-data');\nexport const PASSCODE_IDB_STORE = new IdbStore('tt-passcode');\n","export default function unloadVideo(video: HTMLVideoElement) {\n  video.pause();\n  // https://github.com/shaka-project/shaka-player/commit/0e3d10e61cb08cc35750e48face4e58f24542fc8\n  video.removeAttribute('src');\n  while (video.firstChild) {\n    video.removeChild(video.firstChild);\n  }\n\n  video.load();\n}\n","type Parts = (string | false | undefined)[];\ntype PartsWithGlobals = (string | false | undefined | string[])[];\ntype ClassNameBuilder =\n  ((elementName: string, ...modifiers: PartsWithGlobals) => string)\n  & Record<string, string>;\n\nexport default function buildClassName(...parts: Parts) {\n  return parts.filter(Boolean).join(' ');\n}\n\nexport function createClassNameBuilder(componentName: string) {\n  return ((elementName: string, ...modifiers: PartsWithGlobals) => {\n    const baseName = elementName === '&' ? componentName : `${componentName}__${elementName}`;\n\n    return modifiers.reduce<string[]>((acc, modifier) => {\n      if (modifier) {\n        // A bit hacky way to pass global class names\n        if (Array.isArray(modifier)) {\n          acc.push(...modifier);\n        } else {\n          acc.push(`${baseName}--${modifier}`);\n        }\n      }\n\n      return acc;\n    }, [baseName]).join(' ');\n  }) as ClassNameBuilder;\n}\n","type Parts = (string | false | undefined)[];\n\nexport default function buildStyle(...parts: Parts) {\n  return parts.filter(Boolean).join(';');\n}\n","import { ELECTRON_HOST_URL, IS_PACKAGED_ELECTRON } from '../config';\n\n// eslint-disable-next-line no-restricted-globals\nconst cacheApi = self.caches;\n\nlet isSupported: boolean | undefined;\n\nexport async function isCacheApiSupported() {\n  if (!cacheApi) return false;\n\n  isSupported = isSupported ?? await cacheApi.has('test').then(() => true).catch(() => false);\n  return isSupported;\n}\n\nexport enum Type {\n  Text,\n  Blob,\n  Json,\n  ArrayBuffer,\n}\n\nexport async function fetch(\n  cacheName: string, key: string, type: Type, isHtmlAllowed = false,\n) {\n  if (!cacheApi) {\n    return undefined;\n  }\n\n  try {\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = IS_PACKAGED_ELECTRON\n      ? `${ELECTRON_HOST_URL}/${key.replace(/:/g, '_')}`\n      : new Request(key.replace(/:/g, '_'));\n    const cache = await cacheApi.open(cacheName);\n    const response = await cache.match(request);\n    if (!response) {\n      return undefined;\n    }\n\n    const contentType = response.headers.get('Content-Type');\n\n    switch (type) {\n      case Type.Text:\n        return await response.text();\n      case Type.Blob: {\n        // Ignore deprecated data-uri avatars\n        if (key.startsWith('avatar') && contentType && contentType.startsWith('text')) {\n          return undefined;\n        }\n\n        const blob = await response.blob();\n        const shouldRecreate = !blob.type || (!isHtmlAllowed && blob.type.includes('html'));\n        // iOS Safari fails to preserve `type` in cache\n        let resolvedType = blob.type || contentType;\n\n        if (!(shouldRecreate && resolvedType)) {\n          return blob;\n        }\n\n        // Prevent HTML-in-video attacks (for files that were cached before fix)\n        if (!isHtmlAllowed) {\n          resolvedType = resolvedType.replace(/html/gi, '');\n        }\n\n        return new Blob([blob], { type: resolvedType });\n      }\n      case Type.Json:\n        return await response.json();\n      case Type.ArrayBuffer:\n        return await response.arrayBuffer();\n      default:\n        return undefined;\n    }\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function save(cacheName: string, key: string, data: AnyLiteral | Blob | ArrayBuffer | string) {\n  if (!cacheApi) {\n    return false;\n  }\n\n  try {\n    const cacheData = typeof data === 'string' || data instanceof Blob || data instanceof ArrayBuffer\n      ? data\n      : JSON.stringify(data);\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = IS_PACKAGED_ELECTRON\n      ? `${ELECTRON_HOST_URL}/${key.replace(/:/g, '_')}`\n      : new Request(key.replace(/:/g, '_'));\n    const response = new Response(cacheData);\n    const cache = await cacheApi.open(cacheName);\n    await cache.put(request, response);\n    return true;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return false;\n  }\n}\n\nexport async function remove(cacheName: string, key: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    const cache = await cacheApi.open(cacheName);\n    return await cache.delete(key);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function clear(cacheName: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    return await cacheApi.delete(cacheName);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n","export function createCallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>() {\n  const callbacks = new Set<T>();\n\n  function addCallback(cb: T) {\n    callbacks.add(cb);\n\n    return () => {\n      removeCallback(cb);\n    };\n  }\n\n  function removeCallback(cb: T) {\n    callbacks.delete(cb);\n  }\n\n  function runCallbacks(...args: Parameters<T>) {\n    callbacks.forEach((callback) => {\n      callback(...args);\n    });\n  }\n\n  function hasCallbacks() {\n    return Boolean(callbacks.size);\n  }\n\n  return {\n    runCallbacks,\n    addCallback,\n    removeCallback,\n    hasCallbacks,\n  };\n}\n\nexport type CallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>\n  = ReturnType<typeof createCallbackManager<T>>;\n","import captureKeyboardListener from './captureKeyboardListeners';\n\ntype IHandlerFunction = () => void;\n\nexport default function captureEscKeyListener(handler: IHandlerFunction) {\n  return captureKeyboardListener({ onEsc: handler });\n}\n","import { Lethargy } from './lethargy';\nimport { clamp, round } from './math';\nimport { debounce } from './schedulers';\nimport { IS_IOS, IS_WINDOWS } from './windowEnvironment';\nimport windowSize from './windowSize';\n\nexport enum SwipeDirection {\n  Up,\n  Down,\n  Left,\n  Right,\n}\n\nexport interface MoveOffsets {\n  dragOffsetX: number;\n  dragOffsetY: number;\n}\n\ninterface CaptureOptions {\n  onCapture?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onRelease?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onDrag?: (\n    e: MouseEvent | TouchEvent | WheelEvent,\n    captureEvent: MouseEvent | TouchEvent | WheelEvent,\n    offsets: MoveOffsets,\n    cancelDrag?: (x: boolean, y: boolean) => void,\n  ) => void;\n  onSwipe?: (e: Event, direction: SwipeDirection, offsets: MoveOffsets) => boolean;\n  onZoom?: (e: TouchEvent | WheelEvent, params: {\n    // Absolute zoom level\n    zoom?: number;\n    // Relative zoom factor\n    zoomFactor?: number;\n\n    // center coordinate of the initial pinch\n    initialCenterX: number;\n    initialCenterY: number;\n\n    // offset of the pinch center (current from initial)\n    dragOffsetX: number;\n    dragOffsetY: number;\n\n    // center coordinate of the current pinch\n    currentCenterX: number;\n    currentCenterY: number;\n  }) => void;\n  onClick?: (e: MouseEvent | TouchEvent) => void;\n  onDoubleClick?: (e: MouseEvent | RealTouchEvent | WheelEvent, params: { centerX: number; centerY: number }) => void;\n  excludedClosestSelector?: string;\n  includedClosestSelector?: string;\n  selectorToPreventScroll?: string;\n  withNativeDrag?: boolean;\n  maxZoom?: number;\n  minZoom?: number;\n  doubleTapZoom?: number;\n  initialZoom?: number;\n  isNotPassive?: boolean;\n  withCursor?: boolean;\n  swipeThreshold?: number;\n  withWheelDrag?: boolean;\n}\n\n// https://stackoverflow.com/questions/11287877/how-can-i-get-e-offsetx-on-mobile-ipad\n// Android does not have this value, and iOS has it but as read-only\nexport interface RealTouchEvent extends TouchEvent {\n  pageX?: number;\n  pageY?: number;\n}\n\ntype TSwipeAxis =\n  'x'\n  | 'y'\n  | undefined;\n\nexport const IOS_SCREEN_EDGE_THRESHOLD = 20;\nexport const SWIPE_DIRECTION_THRESHOLD = 10;\nexport const SWIPE_DIRECTION_TOLERANCE = 1.5;\n\nconst MOVE_THRESHOLD = 15;\nconst SWIPE_THRESHOLD_DEFAULT = 20;\nconst RELEASE_WHEEL_ZOOM_DELAY = 150;\nconst RELEASE_WHEEL_DRAG_DELAY = 150;\n\nfunction getDistance(a: Touch, b?: Touch) {\n  if (!b) return 0;\n  return Math.hypot((b.pageX - a.pageX), (b.pageY - a.pageY));\n}\n\nfunction getTouchCenter(a: Touch, b: Touch) {\n  return {\n    x: (a.pageX + b.pageX) / 2,\n    y: (a.pageY + b.pageY) / 2,\n  };\n}\n\nlet lastClickTime = 0;\nconst lethargy = new Lethargy({\n  stability: 5,\n  sensitivity: 25,\n  tolerance: IS_WINDOWS ? 1 : 0.6, // Windows `scrollDelta` does not die down to 0\n  delay: 150,\n});\n\nexport function captureEvents(element: HTMLElement, options: CaptureOptions) {\n  let captureEvent: MouseEvent | RealTouchEvent | WheelEvent | undefined;\n  let hasMoved = false;\n  let hasSwiped = false;\n  let isZooming = false;\n  let initialDistance = 0;\n  let wheelZoom = options.initialZoom ?? 1;\n  let initialDragOffset = {\n    x: 0,\n    y: 0,\n  };\n  let isDragCanceled = {\n    x: false,\n    y: false,\n  };\n  const currentWindowSize = windowSize.get();\n  let initialTouchCenter = {\n    x: currentWindowSize.width / 2,\n    y: currentWindowSize.height / 2,\n  };\n  let initialSwipeAxis: TSwipeAxis | undefined;\n  const minZoom = options.minZoom ?? 1;\n  const maxZoom = options.maxZoom ?? 4;\n\n  function onCapture(e: MouseEvent | RealTouchEvent) {\n    const target = e.target as HTMLElement;\n    const {\n      excludedClosestSelector,\n      includedClosestSelector,\n      withNativeDrag,\n      withCursor,\n      onDrag,\n    } = options;\n\n    if (element !== target && !element.contains(target)) {\n      return;\n    }\n\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {\n      return;\n    }\n\n    if (\n      (excludedClosestSelector && (target.matches(excludedClosestSelector) || target.closest(excludedClosestSelector)))\n      || (\n        includedClosestSelector && !(target.matches(includedClosestSelector) || target.closest(includedClosestSelector))\n      )\n    ) {\n      return;\n    }\n\n    captureEvent = e;\n\n    if (e.type === 'mousedown') {\n      if (!withNativeDrag && onDrag) {\n        e.preventDefault();\n      }\n\n      document.addEventListener('mousemove', onMove);\n      document.addEventListener('mouseup', onRelease);\n    } else if (e.type === 'touchstart') {\n      // We need to always listen on `touchstart` target:\n      // https://stackoverflow.com/questions/33298828/touch-move-event-dont-fire-after-touch-start-target-is-removed\n      target.addEventListener('touchmove', onMove, { passive: true });\n      target.addEventListener('touchend', onRelease, { passive: true });\n      target.addEventListener('touchcancel', onRelease, { passive: true });\n\n      if ('touches' in e) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (e.touches.length === 2) {\n          initialDistance = getDistance(e.touches[0], e.touches[1]);\n          initialTouchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n        }\n      }\n    }\n\n    if (withCursor) {\n      document.body.classList.add('cursor-grabbing');\n    }\n\n    options.onCapture?.(e);\n  }\n\n  function onRelease(e?: MouseEvent | TouchEvent) {\n    if (captureEvent) {\n      if (options.withCursor) {\n        document.body.classList.remove('cursor-grabbing');\n      }\n\n      document.removeEventListener('mouseup', onRelease);\n      document.removeEventListener('mousemove', onMove);\n      (captureEvent.target as HTMLElement).removeEventListener('touchcancel', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchend', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchmove', onMove);\n\n      if (IS_IOS && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = '';\n          });\n      }\n\n      if (e) {\n        if (hasMoved) {\n          if (options.onRelease) {\n            options.onRelease(e);\n          }\n        } else if (e.type === 'mouseup') {\n          if (options.onDoubleClick && Date.now() - lastClickTime < 300) {\n            options.onDoubleClick(e, {\n              centerX: captureEvent!.pageX!,\n              centerY: captureEvent!.pageY!,\n            });\n          } else if (options.onClick && (!('button' in e) || e.button === 0)) {\n            options.onClick(e);\n          }\n          lastClickTime = Date.now();\n        }\n      }\n    }\n\n    hasMoved = false;\n    hasSwiped = false;\n    isZooming = false;\n    initialDistance = 0;\n    wheelZoom = clamp(wheelZoom, minZoom, maxZoom);\n    initialSwipeAxis = undefined;\n    initialDragOffset = {\n      x: 0,\n      y: 0,\n    };\n    isDragCanceled = {\n      x: false,\n      y: false,\n    };\n    const newWindowSize = windowSize.get();\n    initialTouchCenter = {\n      x: newWindowSize.width / 2,\n      y: newWindowSize.height / 2,\n    };\n    captureEvent = undefined;\n  }\n\n  function onMove(e: MouseEvent | RealTouchEvent) {\n    if (captureEvent) {\n      if (e.type === 'touchmove' && ('touches' in e)) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (options.onZoom && initialDistance > 0 && e.touches.length === 2) {\n          const endDistance = getDistance(e.touches[0], e.touches[1]);\n          const touchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n          const dragOffsetX = touchCenter.x - initialTouchCenter.x;\n          const dragOffsetY = touchCenter.y - initialTouchCenter.y;\n          const zoomFactor = endDistance / initialDistance;\n          options.onZoom(e, {\n            zoomFactor,\n            initialCenterX: initialTouchCenter.x,\n            initialCenterY: initialTouchCenter.y,\n            dragOffsetX,\n            dragOffsetY,\n            currentCenterX: touchCenter.x,\n            currentCenterY: touchCenter.y,\n          });\n          if (zoomFactor !== 1) hasMoved = true;\n        }\n      }\n\n      const dragOffsetX = e.pageX! - captureEvent.pageX!;\n      const dragOffsetY = e.pageY! - captureEvent.pageY!;\n\n      if (Math.abs(dragOffsetX) >= MOVE_THRESHOLD || Math.abs(dragOffsetY) >= MOVE_THRESHOLD) {\n        hasMoved = true;\n      }\n\n      let shouldPreventScroll = false;\n\n      if (options.onDrag) {\n        options.onDrag(e, captureEvent, {\n          dragOffsetX,\n          dragOffsetY,\n        });\n        shouldPreventScroll = true;\n      }\n\n      if (options.onSwipe && !hasSwiped) {\n        hasSwiped = onSwipe(e, dragOffsetX, dragOffsetY);\n        shouldPreventScroll = hasSwiped;\n      }\n\n      if (IS_IOS && shouldPreventScroll && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = 'hidden';\n          });\n      }\n    }\n  }\n\n  function onSwipe(e: MouseEvent | RealTouchEvent, dragOffsetX: number, dragOffsetY: number) {\n    // Avoid conflicts with swipe-to-back gestures\n    if (IS_IOS) {\n      const x = (e as RealTouchEvent).touches[0].pageX;\n      if (x <= IOS_SCREEN_EDGE_THRESHOLD || x >= windowSize.get().width - IOS_SCREEN_EDGE_THRESHOLD) {\n        return false;\n      }\n    }\n\n    const xAbs = Math.abs(dragOffsetX);\n    const yAbs = Math.abs(dragOffsetY);\n    const threshold = options.swipeThreshold ?? SWIPE_THRESHOLD_DEFAULT;\n\n    let axis: TSwipeAxis | undefined;\n    if (xAbs > yAbs && xAbs >= threshold) {\n      axis = 'x';\n    } else if (yAbs > xAbs && yAbs >= threshold) {\n      axis = 'y';\n    }\n\n    if (!axis) {\n      return false;\n    }\n\n    if (!initialSwipeAxis) {\n      initialSwipeAxis = axis;\n    } else if (initialSwipeAxis !== axis) {\n      // Prevent horizontal swipe after vertical to prioritize scroll\n      return false;\n    }\n\n    return processSwipe(e, axis, dragOffsetX, dragOffsetY, options.onSwipe!);\n  }\n\n  const releaseWheelDrag = debounce(onRelease, RELEASE_WHEEL_DRAG_DELAY, false);\n  const releaseWheelZoom = debounce(onRelease, RELEASE_WHEEL_ZOOM_DELAY, false);\n\n  function onWheelCapture(e: WheelEvent) {\n    if (hasMoved) return;\n    onCapture(e);\n    hasMoved = true;\n    initialTouchCenter = { x: e.x, y: e.y };\n  }\n\n  function onWheelZoom(e: WheelEvent) {\n    if (!options.onZoom) return;\n    onWheelCapture(e);\n    const dragOffsetX = e.x - initialTouchCenter.x;\n    const dragOffsetY = e.y - initialTouchCenter.y;\n    const delta = clamp(e.deltaY, -25, 25);\n    wheelZoom -= delta * 0.01;\n    wheelZoom = clamp(wheelZoom, minZoom * 0.5, maxZoom * 3);\n    isZooming = true;\n    options.onZoom(e, {\n      zoom: round(wheelZoom, 2),\n      initialCenterX: initialTouchCenter.x,\n      initialCenterY: initialTouchCenter.y,\n      dragOffsetX,\n      dragOffsetY,\n      currentCenterX: e.x,\n      currentCenterY: e.y,\n    });\n    releaseWheelZoom(e);\n  }\n\n  function onWheelDrag(e: WheelEvent) {\n    if (!options.onDrag) return;\n    onWheelCapture(e);\n    // Ignore wheel inertia if drag is canceled in this direction\n    if (!isDragCanceled.x || Math.sign(initialDragOffset.x) === Math.sign(e.deltaX)) {\n      initialDragOffset.x -= e.deltaX;\n    }\n    if (!isDragCanceled.y || Math.sign(initialDragOffset.y) === Math.sign(e.deltaY)) {\n      initialDragOffset.y -= e.deltaY;\n    }\n    const { x, y } = initialDragOffset;\n    options.onDrag(e, captureEvent!, {\n      dragOffsetX: x,\n      dragOffsetY: y,\n    }, (dx, dy) => {\n      isDragCanceled = { x: dx, y: dy };\n    });\n    releaseWheelDrag(e);\n  }\n\n  function onWheel(e: WheelEvent) {\n    if (!options.onZoom && !options.onDrag) return;\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    const { doubleTapZoom = 3 } = options;\n    if (options.onDoubleClick && Object.is(e.deltaX, -0) && Object.is(e.deltaY, -0) && e.ctrlKey) {\n      onWheelCapture(e);\n      wheelZoom = wheelZoom > 1 ? 1 : doubleTapZoom;\n      options.onDoubleClick(e, { centerX: e.pageX, centerY: e.pageY });\n      hasMoved = false;\n      return;\n    }\n    const metaKeyPressed = e.metaKey || e.ctrlKey || e.shiftKey;\n    if (metaKeyPressed) {\n      onWheelZoom(e);\n    }\n    if (!metaKeyPressed && !isZooming) {\n      // Check if this event produced by user scroll and not by inertia\n      const isUserEvent = lethargy.check(e);\n      if (wheelZoom !== 1 || isUserEvent) {\n        onWheelDrag(e);\n      }\n    }\n  }\n\n  if (options.withWheelDrag) {\n    element.addEventListener('wheel', onWheel);\n  }\n\n  element.addEventListener('mousedown', onCapture);\n  document.body.addEventListener('touchstart', onCapture, { passive: !options.isNotPassive });\n\n  return () => {\n    onRelease();\n    document.body.removeEventListener('touchstart', onCapture);\n    element.removeEventListener('mousedown', onCapture);\n    element.removeEventListener('wheel', onWheel);\n  };\n}\n\nfunction processSwipe(\n  e: Event,\n  currentSwipeAxis: TSwipeAxis,\n  dragOffsetX: number,\n  dragOffsetY: number,\n  onSwipe: (e: Event, direction: SwipeDirection, offsets: MoveOffsets) => boolean,\n) {\n  const offsets = { dragOffsetX, dragOffsetY };\n\n  if (currentSwipeAxis === 'x') {\n    if (dragOffsetX < 0) {\n      return onSwipe(e, SwipeDirection.Left, offsets);\n    } else {\n      return onSwipe(e, SwipeDirection.Right, offsets);\n    }\n  } else if (currentSwipeAxis === 'y') {\n    if (dragOffsetY < 0) {\n      return onSwipe(e, SwipeDirection.Up, offsets);\n    } else {\n      return onSwipe(e, SwipeDirection.Down, offsets);\n    }\n  }\n\n  return false;\n}\n","/**\n * Lethargy help distinguish between scroll events initiated by the user, and those by inertial scrolling.\n * Lethargy does not have external dependencies.\n *\n * @param stability - Specifies the length of the rolling average.\n * In effect, the larger the value, the smoother the curve will be.\n * This attempts to prevent anomalies from firing 'real' events. Valid values are all positive integers,\n * but in most cases, you would need to stay between 5 and around 30.\n *\n * @param sensitivity - Specifies the minimum value for wheelDelta for it to register as a valid scroll event.\n * Because the tail of the curve have low wheelDelta values,\n * this will stop them from registering as valid scroll events.\n * The unofficial standard wheelDelta is 120, so valid values are positive integers below 120.\n *\n * @param tolerance - Prevent small fluctuations from affecting results.\n * Valid values are decimals from 0, but should ideally be between 0.05 and 0.3.\n *\n * Based on https://github.com/d4nyll/lethargy\n */\n\nexport type LethargyConfig = {\n  stability?: number;\n  sensitivity?: number;\n  tolerance?: number;\n  delay?: number;\n};\n\nexport class Lethargy {\n  stability: number;\n\n  sensitivity: number;\n\n  tolerance: number;\n\n  delay: number;\n\n  lastUpDeltas: Array<number>;\n\n  lastDownDeltas: Array<number>;\n\n  deltasTimestamp: Array<number>;\n\n  constructor({\n    stability = 8,\n    sensitivity = 100,\n    tolerance = 1.1,\n    delay = 150,\n  }: LethargyConfig = {}) {\n    this.stability = stability;\n    this.sensitivity = sensitivity;\n    this.tolerance = tolerance;\n    this.delay = delay;\n    this.lastUpDeltas = new Array(this.stability * 2).fill(0);\n    this.lastDownDeltas = new Array(this.stability * 2).fill(0);\n    this.deltasTimestamp = new Array(this.stability * 2).fill(0);\n  }\n\n  check(e: any) {\n    let lastDelta;\n    e = e.originalEvent || e;\n    if (e.wheelDelta !== undefined) {\n      lastDelta = e.wheelDelta;\n    } else if (e.deltaY !== undefined) {\n      lastDelta = e.deltaY * -40;\n    } else if (e.detail !== undefined || e.detail === 0) {\n      lastDelta = e.detail * -40;\n    }\n    this.deltasTimestamp.push(Date.now());\n    this.deltasTimestamp.shift();\n    if (lastDelta > 0) {\n      this.lastUpDeltas.push(lastDelta);\n      this.lastUpDeltas.shift();\n      return this.isInertia(1);\n    } else {\n      this.lastDownDeltas.push(lastDelta);\n      this.lastDownDeltas.shift();\n      return this.isInertia(-1);\n    }\n  }\n\n  isInertia(direction: number) {\n    const lastDeltas = direction === -1 ? this.lastDownDeltas : this.lastUpDeltas;\n    if (lastDeltas[0] === undefined) return direction;\n    if (\n      this.deltasTimestamp[this.stability * 2 - 2] + this.delay > Date.now()\n      && lastDeltas[0] === lastDeltas[this.stability * 2 - 1]\n    ) {\n      return false;\n    }\n    const lastDeltasOld = lastDeltas.slice(0, this.stability);\n    const lastDeltasNew = lastDeltas.slice(this.stability, this.stability * 2);\n    const oldSum = lastDeltasOld.reduce((t, s) => t + s);\n    const newSum = lastDeltasNew.reduce((t, s) => t + s);\n    const oldAverage = oldSum / lastDeltasOld.length;\n    const newAverage = newSum / lastDeltasNew.length;\n    return Math.abs(oldAverage) <= Math.abs(newAverage * this.tolerance)\n      && this.sensitivity < Math.abs(newAverage);\n  }\n}\n","type HandlerName =\n  'onEnter'\n  | 'onBackspace'\n  | 'onDelete'\n  | 'onEsc'\n  | 'onUp'\n  | 'onDown'\n  | 'onLeft'\n  | 'onRight'\n  | 'onTab';\ntype Handler = (e: KeyboardEvent) => void | boolean;\ntype CaptureOptions = Partial<Record<HandlerName, Handler>>;\n\nconst keyToHandlerName: Record<string, HandlerName> = {\n  Enter: 'onEnter',\n  Backspace: 'onBackspace',\n  Delete: 'onDelete',\n  Esc: 'onEsc',\n  Escape: 'onEsc',\n  ArrowUp: 'onUp',\n  ArrowDown: 'onDown',\n  ArrowLeft: 'onLeft',\n  ArrowRight: 'onRight',\n  Tab: 'onTab',\n};\n\nconst handlers: Record<HandlerName, Handler[]> = {\n  onEnter: [],\n  onDelete: [],\n  onBackspace: [],\n  onEsc: [],\n  onUp: [],\n  onDown: [],\n  onLeft: [],\n  onRight: [],\n  onTab: [],\n};\n\nexport default function captureKeyboardListeners(options: CaptureOptions) {\n  if (!hasActiveHandlers()) {\n    document.addEventListener('keydown', handleKeyDown, true);\n  }\n\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    if (!handler) {\n      return;\n    }\n\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      currentEventHandlers.push(handler);\n    }\n  });\n\n  return () => {\n    releaseKeyboardListener(options);\n  };\n}\n\nfunction hasActiveHandlers() {\n  return Object.values(handlers).some((keyHandlers) => Boolean(keyHandlers.length));\n}\n\nfunction handleKeyDown(e: KeyboardEvent) {\n  const handlerName = keyToHandlerName[e.key];\n  if (!handlerName) {\n    return;\n  }\n\n  const { length } = handlers[handlerName];\n  if (!length) {\n    return;\n  }\n\n  for (let i = length - 1; i >= 0; i--) {\n    const handler = handlers[handlerName][i]!;\n    if (handler(e) !== false) {\n      e.stopPropagation();\n      break;\n    }\n  }\n}\n\nfunction releaseKeyboardListener(options: CaptureOptions) {\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      const index = currentEventHandlers.findIndex((cb) => cb === handler);\n      if (index !== -1) {\n        currentEventHandlers.splice(index, 1);\n      }\n    }\n  });\n\n  if (!hasActiveHandlers()) {\n    document.removeEventListener('keydown', handleKeyDown, false);\n  }\n}\n","import { DEBUG } from '../config';\n\nexport const CLIPBOARD_ITEM_SUPPORTED = window.navigator.clipboard && window.ClipboardItem;\n\nconst textCopyEl = document.createElement('textarea');\ntextCopyEl.setAttribute('readonly', '');\ntextCopyEl.tabIndex = -1;\ntextCopyEl.className = 'visually-hidden';\n\nexport const copyTextToClipboard = (str: string): void => {\n  textCopyEl.value = str;\n  document.body.appendChild(textCopyEl);\n  const selection = document.getSelection();\n\n  if (selection) {\n    // Store previous selection\n    const rangeToRestore = selection.rangeCount > 0 && selection.getRangeAt(0);\n    textCopyEl.select();\n    document.execCommand('copy');\n    // Restore the original selection\n    if (rangeToRestore) {\n      selection.removeAllRanges();\n      selection.addRange(rangeToRestore);\n    }\n  }\n\n  document.body.removeChild(textCopyEl);\n};\n\nexport const copyHtmlToClipboard = (html: string, text: string): void => {\n  if (!window.navigator.clipboard?.write) {\n    copyTextToClipboard(text);\n    return;\n  }\n\n  window.navigator.clipboard.write([\n    new ClipboardItem({\n      'text/plain': new Blob([text], { type: 'text/plain' }),\n      'text/html': new Blob([html], { type: 'text/html' }),\n    }),\n  ]);\n};\n\nexport const copyImageToClipboard = (imageUrl?: string) => {\n  if (!imageUrl) return;\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  const imageEl = new Image();\n  imageEl.onload = (e: Event) => {\n    if (ctx && e.currentTarget) {\n      const img = e.currentTarget as HTMLImageElement;\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob(copyBlobToClipboard, 'image/png', 1);\n    }\n  };\n\n  imageEl.src = imageUrl;\n};\n\nexport const copyTextToClipboardFromPromise = async (\n  getTextPromise: Promise<string | undefined>,\n  onSuccess: NoneToVoidFunction,\n  onFailure: NoneToVoidFunction,\n) => {\n  const copyTextToClipboardFallback = async () => {\n    try {\n      const text = await getTextPromise;\n      if (text) {\n        copyTextToClipboard(text);\n      } else {\n        onFailure();\n      }\n      return Boolean(text);\n    } catch {\n      onFailure();\n      return false;\n    }\n  };\n  if (!CLIPBOARD_ITEM_SUPPORTED || !navigator.clipboard.write) {\n    if (await copyTextToClipboardFallback()) onSuccess();\n    return;\n  }\n  try {\n    let hasGetDataError = false;\n    const rejectGetDataError = () => Promise.reject(new Error('GET_DATA_ERROR'));\n\n    const clipboardTextItem = new ClipboardItem({\n      'text/plain': getTextPromise.then((text) => text || rejectGetDataError()).catch(() => {\n        hasGetDataError = true;\n        return '';\n      }),\n    });\n    await navigator.clipboard.write([clipboardTextItem]);\n    if (hasGetDataError) {\n      onFailure();\n      return;\n    }\n  } catch {\n    // Promises in ClipboardItem aren't supported in older Chrome versions\n    if (!await copyTextToClipboardFallback()) return;\n  }\n  onSuccess();\n};\n\nasync function copyBlobToClipboard(pngBlob: Blob | null) {\n  if (!pngBlob || !CLIPBOARD_ITEM_SUPPORTED) {\n    return;\n  }\n\n  try {\n    await window.navigator.clipboard.write?.([\n      new ClipboardItem({\n        [pngBlob.type]: pngBlob,\n      }),\n    ]);\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }\n}\n","// Sometimes event is fired earlier than animation completes\nconst ANIMATION_END_DELAY = 50;\n\nexport function waitForTransitionEnd(\n  node: Node, handler: NoneToVoidFunction, propertyName?: string, fallbackMs?: number,\n) {\n  return waitForEndEvent('transitionend', node, handler, propertyName, fallbackMs);\n}\n\nexport function waitForAnimationEnd(\n  node: Node, handler: NoneToVoidFunction, animationName?: string, fallbackMs?: number,\n) {\n  return waitForEndEvent('animationend', node, handler, animationName, fallbackMs);\n}\n\nfunction waitForEndEvent(\n  eventType: 'transitionend' | 'animationend',\n  node: Node,\n  handler: NoneToVoidFunction,\n  detailedName?: string,\n  fallbackMs?: number,\n) {\n  let isHandled = false;\n\n  function cleanup() {\n    node.removeEventListener(eventType, handleAnimationEnd);\n  }\n\n  function handleAnimationEnd(e: TransitionEvent | AnimationEvent | Event) {\n    if (isHandled || e.target !== e.currentTarget) {\n      return;\n    }\n\n    if (detailedName && (\n      (e instanceof TransitionEvent && e.propertyName === detailedName)\n      || (e instanceof AnimationEvent && e.animationName === detailedName)\n    )) {\n      return;\n    }\n\n    isHandled = true;\n\n    cleanup();\n\n    setTimeout(() => {\n      handler();\n    }, ANIMATION_END_DELAY);\n  }\n\n  node.addEventListener(eventType, handleAnimationEnd);\n\n  if (fallbackMs) {\n    setTimeout(() => {\n      if (isHandled) return;\n\n      cleanup();\n\n      handler();\n    }, fallbackMs);\n  }\n\n  return cleanup;\n}\n","import type { OldLangFn } from '../../hooks/useOldLang';\nimport type { TimeFormat } from '../../types';\nimport type { LangFn } from '../localization';\n\nimport withCache from '../withCache';\n\nconst WEEKDAYS_FULL = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nconst MONTHS_FULL = [\n  'January', 'February', 'March', 'April', 'May', 'June',\n  'July', 'August', 'September', 'October', 'November', 'December',\n];\n\nconst MONTHS_FULL_LOWERCASE = MONTHS_FULL.map((month) => month.toLowerCase());\nconst MIN_SEARCH_YEAR = 2015;\nconst MAX_DAY_IN_MONTH = 31;\nconst MAX_MONTH_IN_YEAR = 12;\nexport const MILLISECONDS_IN_DAY = 24 * 60 * 60 * 1000;\n\nexport function isToday(date: Date) {\n  return getDayStartAt(new Date()) === getDayStartAt(date);\n}\n\nexport function getDayStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nexport function getDayStartAt(datetime: number | Date) {\n  return getDayStart(datetime).getTime();\n}\n\nexport function toYearMonth(timestamp: number) {\n  const date = new Date(timestamp * 1000);\n  return `${date.getFullYear()}-${date.getMonth()}`;\n}\n\nfunction toIsoString(date: Date) {\n  return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\n}\n\n// @optimization `toLocaleTimeString` is avoided because of bad performance\nexport function formatTime(lang: OldLangFn, datetime: number | Date) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  const timeFormat = lang.timeFormat || '24h';\n\n  let hours = date.getHours();\n  let marker = '';\n  if (timeFormat === '12h') {\n    marker = hours >= 12 ? '\\xa0PM' : '\\xa0AM'; // NBSP\n    hours = hours > 12 ? hours % 12 : hours;\n  }\n\n  return `${String(hours).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}${marker}`;\n}\n\nexport function formatPastTimeShort(lang: OldLangFn, datetime: number | Date, alwaysShowTime = false) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const time = formatTime(lang, date);\n\n  const today = getDayStart(new Date());\n  if (date >= today) {\n    return time;\n  }\n\n  const weekAgo = new Date(today);\n  weekAgo.setDate(today.getDate() - 7);\n  if (date >= weekAgo) {\n    const weekday = lang(`Weekday.Short${WEEKDAYS_FULL[date.getDay()]}`);\n    return alwaysShowTime ? lang('FullDateTimeFormat', [weekday, time]) : weekday;\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n\n  const formattedDate = formatDateToString(date, lang.code, noYear);\n  return alwaysShowTime ? lang('FullDateTimeFormat', [formattedDate, time]) : formattedDate;\n}\n\nexport function formatFullDate(lang: OldLangFn, datetime: number | Date) {\n  return formatDateToString(datetime, lang.code, false, 'numeric');\n}\n\nexport function formatMonthAndYear(lang: OldLangFn, date: Date, isShort = false) {\n  return formatDateToString(date, lang.code, false, isShort ? 'short' : 'long', true);\n}\n\nexport function formatCountdown(\n  lang: OldLangFn,\n  msLeft: number,\n) {\n  const days = Math.floor(msLeft / MILLISECONDS_IN_DAY);\n  if (msLeft < 0) {\n    return 0;\n  } else if (days < 1) {\n    return formatMediaDuration(msLeft / 1000);\n  } else if (days < 7) {\n    return lang('Days', days);\n  } else if (days < 30) {\n    return lang('Weeks', Math.floor(days / 7));\n  } else if (days < 365) {\n    return lang('Months', Math.floor(days / 30));\n  } else {\n    return lang('Years', Math.floor(days / 365));\n  }\n}\n\nexport function formatCountdownShort(lang: OldLangFn, msLeft: number): string {\n  if (msLeft < 60 * 1000) {\n    return Math.ceil(msLeft / 1000).toString();\n  } else if (msLeft < 60 * 60 * 1000) {\n    return Math.ceil(msLeft / (60 * 1000)).toString();\n  } else if (msLeft < MILLISECONDS_IN_DAY) {\n    return lang('MessageTimer.ShortHours', Math.ceil(msLeft / (60 * 60 * 1000)));\n  } else {\n    return lang('MessageTimer.ShortDays', Math.ceil(msLeft / MILLISECONDS_IN_DAY));\n  }\n}\n\nexport function formatLastUpdated(lang: OldLangFn, currentTime: number, lastUpdated = currentTime) {\n  const seconds = currentTime - lastUpdated;\n  if (seconds < 60) {\n    return lang('LiveLocationUpdated.JustNow');\n  } else if (seconds < 60 * 60) {\n    return lang('LiveLocationUpdated.MinutesAgo', Math.floor(seconds / 60));\n  } else {\n    return lang('LiveLocationUpdated.TodayAt', formatTime(lang, lastUpdated));\n  }\n}\n\nexport function formatRelativeTime(lang: OldLangFn, currentTime: number, lastUpdated = currentTime) {\n  const seconds = currentTime - lastUpdated;\n\n  if (seconds < 60) {\n    return lang('Time.JustNow');\n  }\n\n  // within an hour\n  if (seconds < 60 * 60) {\n    return lang('Time.MinutesAgo', Math.floor(seconds / 60));\n  }\n\n  const lastUpdatedDate = new Date(lastUpdated * 1000);\n  const today = getDayStart(new Date());\n  if (lastUpdatedDate >= today) {\n    return lang('Time.TodayAt', formatTime(lang, lastUpdatedDate));\n  }\n\n  const yesterday = new Date(today);\n  yesterday.setDate(today.getDate() - 1);\n  if (lastUpdatedDate > yesterday) {\n    return lang('Time.YesterdayAt', formatTime(lang, lastUpdatedDate));\n  }\n\n  return lang('Time.AtDate', formatFullDate(lang, lastUpdatedDate));\n}\n\ntype DurationType = 'Seconds' | 'Minutes' | 'Hours' | 'Days' | 'Weeks';\n\nexport function formatTimeDuration(lang: OldLangFn, duration: number, showLast = 2) {\n  if (!duration) {\n    return undefined;\n  }\n\n  const durationRecords: { duration: number; type: DurationType }[] = [];\n  const labels = [\n    { multiplier: 1, type: 'Seconds' },\n    { multiplier: 60, type: 'Minutes' },\n    { multiplier: 60, type: 'Hours' },\n    { multiplier: 24, type: 'Days' },\n    { multiplier: 7, type: 'Weeks' },\n  ] as Array<{ multiplier: number; type: DurationType }>;\n  let t = 1;\n  labels.forEach((label, idx) => {\n    t *= label.multiplier;\n\n    if (duration < t) {\n      return;\n    }\n\n    const modulus = labels[idx === (labels.length - 1) ? idx : idx + 1].multiplier!;\n    durationRecords.push({\n      duration: Math.floor((duration / t) % modulus),\n      type: label.type,\n    });\n  });\n\n  const out = durationRecords.slice(-showLast).reverse();\n  for (let i = out.length - 1; i >= 0; --i) {\n    if (out[i].duration === 0) {\n      out.splice(i, 1);\n    }\n  }\n\n  // TODO In arabic we don't use \",\" as delimiter rather we use \"and\" each time\n  return out.map((part) => lang(part.type, part.duration, 'i')).join(', ');\n}\n\nexport function formatHumanDate(\n  lang: OldLangFn,\n  datetime: number | Date,\n  isShort = false,\n  noWeekdays = false,\n  isUpperFirst?: boolean,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const today = getDayStart(new Date());\n\n  if (!noWeekdays) {\n    if (toIsoString(date) === toIsoString(today)) {\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(lang('Weekday.Today'));\n    }\n\n    const yesterday = new Date(today);\n    yesterday.setDate(today.getDate() - 1);\n    if (toIsoString(date) === toIsoString(yesterday)) {\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(lang('Weekday.Yesterday'));\n    }\n\n    const weekAgo = new Date(today);\n    const weekAhead = new Date(today);\n    weekAgo.setDate(today.getDate() - 7);\n    weekAhead.setDate(today.getDate() + 7);\n    if (date >= weekAgo && date <= weekAhead) {\n      const weekDayString = formatWeekday(lang, date.getDay(), isShort);\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(weekDayString);\n    }\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n  const formattedDate = formatDateToString(date, lang.code, noYear, isShort ? 'short' : 'long');\n\n  return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(formattedDate);\n}\n\n/**\n * Returns weekday name\n * @param day 0 - Sunday, 1 - Monday, ...\n */\nexport function formatWeekday(lang: OldLangFn, day: number, isShort = false) {\n  const weekDay = WEEKDAYS_FULL[day];\n  return isShort ? lang(`Weekday.Short${weekDay}`) : lang(`Weekday.${weekDay}`);\n}\n\nexport function formatMediaDateTime(\n  lang: OldLangFn,\n  datetime: number | Date,\n  isUpperFirst?: boolean,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  return `${formatHumanDate(lang, date, true, undefined, isUpperFirst)}, ${formatTime(lang, date)}`;\n}\n\nexport function formatMediaDuration(duration: number, maxValue?: number) {\n  const hours = Math.floor(duration / 3600);\n  const minutes = Math.floor((duration % 3600) / 60);\n  const seconds = Math.floor(duration % 3600 % 60);\n\n  const maxHours = maxValue ? Math.floor(maxValue / 3600) : 0;\n  const maxMinutes = maxValue ? Math.floor((maxValue % 3600) / 60) : 0;\n  let string = '';\n  if (hours > 0 || maxHours > 0) {\n    string += `${String(hours).padStart(2, '0')}:`;\n    string += `${String(minutes).padStart(2, '0')}:`;\n  } else if (maxMinutes >= 10) {\n    string += `${String(minutes).padStart(2, '0')}:`;\n  } else {\n    string += `${String(minutes)}:`;\n  }\n  string += String(seconds).padStart(2, '0');\n\n  return string;\n}\n\nexport function formatVoiceRecordDuration(durationInMs: number) {\n  const parts = [];\n\n  let milliseconds = durationInMs % 1000;\n  durationInMs -= milliseconds;\n  milliseconds = Math.floor(milliseconds / 10);\n\n  durationInMs = Math.floor(durationInMs / 1000);\n  const seconds = durationInMs % 60;\n  durationInMs -= seconds;\n\n  durationInMs = Math.floor(durationInMs / 60);\n  const minutes = durationInMs % 60;\n  durationInMs -= minutes;\n\n  durationInMs = Math.floor(durationInMs / 60);\n  const hours = durationInMs % 60;\n\n  if (hours > 0) {\n    parts.push(String(hours).padStart(2, '0'));\n  }\n  parts.push(String(minutes).padStart(hours > 0 ? 2 : 1, '0'));\n  parts.push(String(seconds).padStart(2, '0'));\n\n  return `${parts.join(':')},${String(milliseconds).padStart(2, '0')}`;\n}\n\nconst formatDayToStringWithCache = withCache((\n  dayStartAt: number,\n  locale: string,\n  noYear?: boolean,\n  monthFormat: 'short' | 'long' | 'numeric' = 'short',\n  noDay?: boolean,\n) => {\n  return new Date(dayStartAt).toLocaleString(\n    locale,\n    {\n      year: noYear ? undefined : 'numeric',\n      month: monthFormat,\n      day: noDay ? undefined : 'numeric',\n    },\n  );\n});\n\nexport function formatDateToString(\n  datetime: Date | number,\n  locale = 'en-US',\n  noYear = false,\n  monthFormat: 'short' | 'long' | 'numeric' = 'short',\n  noDay = false,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  const dayStartAt = getDayStartAt(date);\n\n  return formatDayToStringWithCache(dayStartAt, locale, noYear, monthFormat, noDay);\n}\n\nexport function formatDateTimeToString(\n  datetime: Date | number, locale = 'en-US', noSeconds?: boolean,\n  timeFormat?: TimeFormat,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  return date.toLocaleString(\n    locale,\n    {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n      second: noSeconds ? undefined : 'numeric',\n      hourCycle: timeFormat === '12h' ? 'h12' : 'h23',\n    },\n  );\n}\n\nexport function formatDateAtTime(\n  lang: OldLangFn,\n  datetime: number | Date,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const today = getDayStart(new Date());\n  const time = formatTime(lang, date);\n\n  if (toIsoString(date) === toIsoString(today)) {\n    return lang('Time.TodayAt', time);\n  }\n\n  const yesterday = new Date(today);\n  yesterday.setDate(today.getDate() - 1);\n  if (toIsoString(date) === toIsoString(yesterday)) {\n    return lang('Time.YesterdayAt', time);\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n  const formattedDate = formatDateToString(date, lang.code, noYear);\n\n  return lang('formatDateAtTime', [formattedDate, time]);\n}\n\nexport function formatShortDuration(lang: LangFn, duration: number) {\n  if (duration < 0) {\n    return lang('RightNow');\n  }\n\n  if (duration < 60) {\n    const count = Math.ceil(duration);\n    return lang('Seconds', { count }, { pluralValue: duration });\n  }\n\n  if (duration < 60 * 60) {\n    const count = Math.ceil(duration / 60);\n    return lang('Minutes', { count }, { pluralValue: count });\n  }\n\n  if (duration < 60 * 60 * 24) {\n    const count = Math.ceil(duration / (60 * 60));\n    return lang('Hours', { count }, { pluralValue: count });\n  }\n\n  const count = Math.ceil(duration / (60 * 60 * 24));\n  return lang('Days', { count }, { pluralValue: count });\n}\n\nfunction isValidDate(day: number, month: number, year = 2021): boolean {\n  if (month > (MAX_MONTH_IN_YEAR - 1) || day > MAX_DAY_IN_MONTH) {\n    return false;\n  }\n  const date = new Date(year, month, day);\n  return !Number.isNaN(date.getTime()) && date.getDate() === day;\n}\n\nexport function parseDateString(query = ''): string | undefined {\n  const matchStringDate = query.match(/\\d{1,2}\\s[a-zA-Z]{3,}/);\n  const matchEuropeStringDate = query.match(/[a-zA-Z]{3,}\\s\\d{1,2}/);\n  const matchNumberDate = query.match(/\\d{1,2}[./-]\\d{1,2}([./-]\\d{2,4})?/);\n  if (!matchStringDate && !matchNumberDate && !matchEuropeStringDate) {\n    return undefined;\n  }\n\n  if (matchNumberDate) {\n    const [date, month, year] = query.split(/[./-]/).map(Number);\n    return !(year && year < MIN_SEARCH_YEAR) && isValidDate(date, month - 1, year || undefined)\n      ? `${year ? `${year}-` : ''}${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`\n      : undefined;\n  }\n\n  const dateParts = query.split(' ');\n  const date = matchStringDate ? dateParts[0] : dateParts[1];\n  const month = (matchStringDate ? dateParts[1] : dateParts[0]).toLowerCase();\n  const monthIndex = MONTHS_FULL_LOWERCASE.findIndex((item) => item.startsWith(month));\n\n  return monthIndex !== -1 && isValidDate(Number(date), monthIndex)\n    ? `${String(monthIndex + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`\n    : undefined;\n}\n\nexport function timestampPlusDay(timestamp: number) {\n  return timestamp + MILLISECONDS_IN_DAY / 1000;\n}\n\nfunction lowerFirst(str: string) {\n  return `${str[0].toLowerCase()}${str.slice(1)}`;\n}\n\nfunction upperFirst(str: string) {\n  return `${str[0].toUpperCase()}${str.slice(1)}`;\n}\n","/// In seconds\nexport const MINUTE = 60;\nexport const HOUR = 3600;\nexport const DAY = 86400;\n\nexport function getMinutes(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / MINUTE);\n}\n\nexport function getHours(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / HOUR);\n}\n\nexport function getDays(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / DAY);\n}\n","/* eslint-disable no-console */\n\nexport const DEBUG_LEVELS = ['log', 'error', 'warn', 'info', 'debug'] as const;\nexport type DebugLevel = typeof DEBUG_LEVELS[number];\n// @ts-ignore\nconst ORIGINAL_FUNCTIONS: Record<DebugLevel, (...args: any[]) => void> = DEBUG_LEVELS.reduce((acc, level) => {\n  // @ts-ignore\n  acc[level] = console[level];\n  return acc;\n}, {});\n\ntype DebugEntry = {\n  level: DebugLevel;\n  args: any[];\n  date: Date;\n};\nlet DEBUG_LOGS: DebugEntry[] = [];\n\nexport function logDebugMessage(level: DebugLevel, ...args: any[]) {\n  DEBUG_LOGS.push({\n    level,\n    args,\n    date: new Date(),\n  });\n  ORIGINAL_FUNCTIONS[level](...args);\n}\n\nexport function initDebugConsole() {\n  DEBUG_LOGS = [];\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = (...args: any[]) => {\n      logDebugMessage(level, ...args);\n    };\n  });\n}\n\nexport function disableDebugConsole() {\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = ORIGINAL_FUNCTIONS[level];\n  });\n  DEBUG_LOGS = [];\n}\n\nexport function getDebugLogs() {\n  return JSON.stringify(DEBUG_LOGS, (key, value) => (typeof value === 'bigint'\n    ? value.toString()\n    : value));\n}\n","import type { ThreadId } from '../types';\n\nimport { RE_TG_LINK, RE_TME_LINK } from '../config';\nimport { toChannelId } from '../global/helpers';\nimport { ensureProtocol } from './ensureProtocol';\nimport { isUsernameValid } from './username';\nimport { IS_BAD_URL_PARSER } from './windowEnvironment';\n\nexport type DeepLinkMethod = 'resolve' | 'login' | 'passport' | 'settings' | 'join' | 'addstickers' | 'addemoji' |\n'setlanguage' | 'addtheme' | 'confirmphone' | 'socks' | 'proxy' | 'privatepost' | 'bg' | 'share' | 'msg' | 'msg_url' |\n'invoice' | 'addlist' | 'boost' | 'giftcode' | 'message' | 'premium_offer' | 'premium_multigift' | 'stars_topup'\n| 'nft';\n\ninterface PublicMessageLink {\n  type: 'publicMessageLink';\n  username: string;\n  messageId: number;\n  isSingle: boolean;\n  threadId?: ThreadId;\n  commentId?: number;\n  mediaTimestamp?: string;\n}\n\nexport interface PrivateMessageLink {\n  type: 'privateMessageLink';\n  channelId: string;\n  messageId: number;\n  isSingle: boolean;\n  threadId?: ThreadId;\n  commentId?: number;\n  mediaTimestamp?: string;\n}\n\ninterface ShareLink {\n  type: 'shareLink';\n  url: string;\n  text?: string;\n}\n\ninterface ChatFolderLink {\n  type: 'chatFolderLink';\n  slug: string;\n}\n\ninterface LoginCodeLink {\n  type: 'loginCodeLink';\n  code: string;\n}\n\ninterface TelegramPassportLink {\n  type: 'telegramPassportLink';\n  botId: number;\n  scope: string;\n  publicKey: string;\n  nonce: string;\n  callbackUrl?: string;\n  payload?: string;\n}\n\ninterface PublicUsernameOrBotLink {\n  type: 'publicUsernameOrBotLink';\n  username: string;\n  start?: string;\n  ref?: string;\n  startApp?: string;\n  mode?: string;\n  appName?: string;\n  startAttach?: string;\n  attach?: string;\n  text?: string;\n  choose?: string;\n}\n\ninterface PrivateChannelLink {\n  type: 'privateChannelLink';\n  channelId: string;\n}\n\ninterface ChatBoostLink {\n  type: 'chatBoostLink';\n  username?: string;\n  id?: string;\n}\n\ninterface BusinessChatLink {\n  type: 'businessChatLink';\n  slug: string;\n}\n\ninterface PremiumReferrerLink {\n  type: 'premiumReferrerLink';\n  referrer: string;\n}\n\ninterface PremiumMultigiftLink {\n  type: 'premiumMultigiftLink';\n  referrer: string;\n}\n\ninterface GiftUniqueLink {\n  type: 'giftUniqueLink';\n  slug: string;\n}\n\ntype DeepLink =\n  TelegramPassportLink |\n  LoginCodeLink |\n  PublicMessageLink |\n  PrivateMessageLink |\n  ShareLink |\n  ChatFolderLink |\n  PublicUsernameOrBotLink |\n  PrivateChannelLink |\n  BusinessChatLink |\n  PremiumReferrerLink |\n  PremiumMultigiftLink |\n  ChatBoostLink |\n  GiftUniqueLink;\n\ntype BuilderParams<T extends DeepLink> = Record<keyof Omit<T, 'type'>, string | undefined>;\ntype BuilderReturnType<T extends DeepLink> = T | undefined;\ntype DeepLinkType = DeepLink['type'] | 'unknown';\n\ntype PrivateMessageLinkBuilderParams = Omit<BuilderParams<PrivateMessageLink>, 'isSingle'> & {\n  single?: string;\n};\n\ntype PublicMessageLinkBuilderParams = Omit<BuilderParams<PublicMessageLink>, 'isSingle'> & {\n  single?: string;\n};\n\nconst ELIGIBLE_HOSTNAMES = new Set(['t.me', 'telegram.me', 'telegram.dog']);\n\nexport function isDeepLink(link: string): boolean {\n  return Boolean(link.match(RE_TME_LINK) || link.match(RE_TG_LINK));\n}\n\nexport function tryParseDeepLink(link: string): DeepLink | undefined {\n  if (!isDeepLink(link)) {\n    return undefined;\n  }\n  try {\n    return parseDeepLink(link);\n  } catch (err) {\n    return undefined;\n  }\n}\n\nfunction parseDeepLink(url: string) {\n  const correctUrl = ensureProtocol(url);\n  if (!correctUrl) {\n    return undefined;\n  }\n  if (correctUrl.startsWith('https:') || correctUrl.startsWith('http:')) {\n    const urlParsed = new URL(correctUrl);\n    return parseHttpLink(urlParsed);\n  }\n  if (correctUrl.startsWith('tg:')) {\n    const urlToParse = IS_BAD_URL_PARSER ? correctUrl.replace(/^tg:\\/\\//, 'https://') : correctUrl;\n    const urlParsed = new URL(urlToParse);\n    return parseTgLink(urlParsed);\n  }\n  return undefined;\n}\n\nfunction parseTgLink(url: URL) {\n  const { hostname } = url;\n  const queryParams = getQueryParams(url);\n  const pathParams = getPathParams(url);\n  const method = hostname as DeepLinkMethod;\n\n  const deepLinkType = getTgDeepLinkType(queryParams, pathParams, method);\n  switch (deepLinkType) {\n    case 'publicMessageLink': {\n      const {\n        domain, post, single, thread, comment, t,\n      } = queryParams;\n      return buildPublicMessageLink({\n        username: domain,\n        messageId: post,\n        single,\n        threadId: thread,\n        commentId: comment,\n        mediaTimestamp: t,\n      });\n    }\n    case 'privateMessageLink': {\n      const {\n        channel, post, single, thread, comment, t,\n      } = queryParams;\n      return buildPrivateMessageLink({\n        channelId: channel,\n        messageId: post,\n        single,\n        threadId: thread,\n        commentId: comment,\n        mediaTimestamp: t,\n      });\n    }\n    case 'shareLink':\n      return buildShareLink({ text: queryParams.text, url: queryParams.url });\n    case 'chatFolderLink':\n      return buildChatFolderLink({ slug: queryParams.slug });\n    case 'loginCodeLink':\n      return buildLoginCodeLink({ code: queryParams.code });\n    case 'telegramPassportLink':\n      return buildTelegramPassportLink({\n        botId: queryParams.bot_id,\n        scope: queryParams.scope,\n        publicKey: queryParams.public_key,\n        nonce: queryParams.nonce,\n        callbackUrl: queryParams.callback_url,\n        payload: queryParams.payload,\n      });\n    case 'publicUsernameOrBotLink':\n      return buildPublicUsernameOrBotLink({\n        username: queryParams.domain,\n        start: queryParams.start,\n        text: queryParams.text,\n        appName: queryParams.appname,\n        startApp: queryParams.startapp,\n        mode: queryParams.mode,\n        startAttach: queryParams.startattach,\n        attach: queryParams.attach,\n        choose: queryParams.choose,\n        ref: queryParams.ref,\n      });\n    case 'privateChannelLink': {\n      return buildPrivateChannelLink({ channelId: queryParams.channel });\n    }\n    case 'businessChatLink':\n      return buildBusinessChatLink({ slug: queryParams.slug });\n    case 'premiumReferrerLink':\n      return buildPremiumReferrerLink({ referrer: queryParams.ref });\n    case 'premiumMultigiftLink':\n      return buildPremiumMultigiftLink({ referrer: queryParams.ref });\n    case 'chatBoostLink':\n      return buildChatBoostLink({ username: queryParams.domain, id: queryParams.channel });\n    case 'giftUniqueLink':\n      return buildGiftUniqueLink({ slug: queryParams.slug });\n    default:\n      break;\n  }\n  return undefined;\n}\n\nfunction parseHttpLink(url: URL) {\n  if (!ELIGIBLE_HOSTNAMES.has(url.hostname)) {\n    return undefined;\n  }\n  const queryParams = getQueryParams(url);\n  const pathParams = getPathParams(url);\n\n  const deepLinkType = getHttpDeepLinkType(queryParams, pathParams);\n  switch (deepLinkType) {\n    case 'publicMessageLink': {\n      const {\n        single, comment, t,\n      } = queryParams;\n      const {\n        username,\n        thread,\n        messageId,\n      } = pathParams.length === 2 ? {\n        username: pathParams[0],\n        thread: queryParams.thread,\n        messageId: pathParams[1],\n      } : {\n        username: pathParams[0],\n        thread: pathParams[1],\n        messageId: pathParams[2],\n      };\n      return buildPublicMessageLink({\n        username,\n        messageId,\n        single,\n        threadId: thread,\n        commentId: comment,\n        mediaTimestamp: t,\n      });\n    }\n    case 'privateMessageLink': {\n      const {\n        single, comment, t,\n      } = queryParams;\n      const {\n        channelId,\n        thread,\n        messageId,\n      } = pathParams.length === 3 ? {\n        channelId: pathParams[1],\n        thread: queryParams.thread,\n        messageId: pathParams[2],\n      } : {\n        channelId: pathParams[1],\n        thread: pathParams[2],\n        messageId: pathParams[3],\n      };\n      return buildPrivateMessageLink({\n        channelId,\n        messageId,\n        single,\n        threadId: thread,\n        commentId: comment,\n        mediaTimestamp: t,\n      });\n    }\n    case 'shareLink': {\n      return buildShareLink({ text: queryParams.text, url: queryParams.url });\n    }\n    case 'chatFolderLink':\n      return buildChatFolderLink({ slug: pathParams[1] });\n    case 'loginCodeLink':\n      return buildLoginCodeLink({ code: pathParams[1] });\n    case 'publicUsernameOrBotLink':\n      return buildPublicUsernameOrBotLink({\n        username: pathParams[0],\n        start: queryParams.start,\n        text: queryParams.text,\n        startApp: queryParams.startapp,\n        mode: queryParams.mode,\n        appName: undefined,\n        startAttach: queryParams.startattach,\n        attach: queryParams.attach,\n        choose: queryParams.choose,\n        ref: queryParams.ref,\n      });\n    case 'privateChannelLink': {\n      return buildPrivateChannelLink({ channelId: pathParams[1] });\n    }\n    case 'businessChatLink':\n      return buildBusinessChatLink({ slug: pathParams[1] });\n    case 'chatBoostLink': {\n      if (pathParams[0] === 'boost') {\n        return buildChatBoostLink({ username: pathParams[1], id: queryParams.c });\n      }\n      const isPrivateChannel = pathParams[0] === 'c';\n      return buildChatBoostLink({\n        username: !isPrivateChannel ? pathParams[0] : undefined,\n        id: isPrivateChannel ? pathParams[1] : undefined,\n      });\n    }\n    case 'giftUniqueLink': {\n      const slug = pathParams.slice(1).join('/');\n      return buildGiftUniqueLink({\n        slug,\n      });\n    }\n    default:\n      break;\n  }\n  return undefined;\n}\n\nfunction getHttpDeepLinkType(\n  queryParams: Record<string, string>,\n  pathParams: string[],\n): DeepLinkType {\n  const len = pathParams.length;\n  const method = pathParams[0];\n  if (len === 1) {\n    if (method === 'share') return 'shareLink';\n    if (method === 'boost' || queryParams.boost !== undefined) return 'chatBoostLink';\n\n    if (isUsernameValid(method)) {\n      return 'publicUsernameOrBotLink';\n    }\n  } else if (len === 2) {\n    if (method === 'addlist') return 'chatFolderLink';\n    if (method === 'login') return 'loginCodeLink';\n    if (method === 'm') return 'businessChatLink';\n    if (method === 'boost') return 'chatBoostLink';\n    if (method === 'nft') return 'giftUniqueLink';\n    if (method === 'c') {\n      if (queryParams.boost !== undefined) return 'chatBoostLink';\n      return 'privateChannelLink';\n    }\n\n    if (isUsernameValid(pathParams[0]) && isNumber(pathParams[1])) {\n      return 'publicMessageLink';\n    }\n  } else if (len === 3) {\n    if (method === 'c' && pathParams.slice(1).every(isNumber)) {\n      return 'privateMessageLink';\n    }\n    if (isUsernameValid(pathParams[0]) && pathParams.slice(1).every(isNumber)) {\n      return 'publicMessageLink';\n    }\n    if (method === 'nft') return 'giftUniqueLink';\n  } else if (len === 4) {\n    if (method === 'c' && pathParams.slice(1).every(isNumber)) {\n      return 'privateMessageLink';\n    }\n  }\n  return 'unknown';\n}\n\nfunction getTgDeepLinkType(\n  queryParams: Record<string, string>,\n  pathParams: string[],\n  method: DeepLinkMethod,\n): DeepLinkType {\n  switch (method) {\n    case 'resolve': {\n      const {\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        domain, post, bot_id, scope, public_key, nonce,\n      } = queryParams;\n      if (domain === 'telegrampassport' && bot_id && scope && public_key && nonce) {\n        return 'telegramPassportLink';\n      }\n      if (domain && post) {\n        return 'publicMessageLink';\n      }\n      if (isUsernameValid(domain)) {\n        return 'publicUsernameOrBotLink';\n      }\n      break;\n    }\n    case 'privatepost': {\n      const { channel, post } = queryParams;\n      if (channel) {\n        if (post) return 'privateMessageLink';\n        return 'privateChannelLink';\n      }\n      break;\n    }\n    case 'msg_url':\n      return 'shareLink';\n    case 'addlist':\n      return 'chatFolderLink';\n    case 'login':\n      return 'loginCodeLink';\n    case 'passport':\n      return 'telegramPassportLink';\n    case 'message':\n      return 'businessChatLink';\n    case 'premium_offer':\n      return 'premiumReferrerLink';\n    case 'premium_multigift':\n      return 'premiumMultigiftLink';\n    case 'boost':\n      return 'chatBoostLink';\n    case 'nft':\n      return 'giftUniqueLink';\n    default:\n      break;\n  }\n  return 'unknown';\n}\n\nfunction buildShareLink(params: BuilderParams<ShareLink>): BuilderReturnType<ShareLink> {\n  const { url, text } = params;\n  if (!url) {\n    return undefined;\n  }\n  return {\n    type: 'shareLink',\n    url,\n    text,\n  };\n}\n\nfunction buildPublicMessageLink(params: PublicMessageLinkBuilderParams): BuilderReturnType<PublicMessageLink> {\n  const {\n    messageId, threadId, commentId, username, single, mediaTimestamp,\n  } = params;\n  if (!username || !isUsernameValid(username)) {\n    return undefined;\n  }\n  if (!messageId || !isNumber(messageId)) {\n    return undefined;\n  }\n  if (threadId && !isNumber(threadId)) {\n    return undefined;\n  }\n  if (commentId && !isNumber(commentId)) {\n    return undefined;\n  }\n  return {\n    type: 'publicMessageLink',\n    username,\n    messageId: Number(messageId),\n    isSingle: single === '',\n    threadId: threadId ? Number(threadId) : undefined,\n    commentId: commentId ? Number(commentId) : undefined,\n    mediaTimestamp,\n  };\n}\n\nfunction buildPrivateMessageLink(params: PrivateMessageLinkBuilderParams): BuilderReturnType<PrivateMessageLink> {\n  const {\n    messageId, threadId, commentId, channelId, single, mediaTimestamp,\n  } = params;\n  if (!channelId || !isNumber(channelId)) {\n    return undefined;\n  }\n  if (!messageId || !isNumber(messageId)) {\n    return undefined;\n  }\n  if (threadId && !isNumber(threadId)) {\n    return undefined;\n  }\n  if (commentId && !isNumber(commentId)) {\n    return undefined;\n  }\n  return {\n    type: 'privateMessageLink',\n    channelId,\n    messageId: Number(messageId),\n    isSingle: single === '',\n    threadId: threadId ? Number(threadId) : undefined,\n    commentId: commentId ? Number(commentId) : undefined,\n    mediaTimestamp,\n  };\n}\n\nfunction buildChatFolderLink(params: BuilderParams<ChatFolderLink>): BuilderReturnType<ChatFolderLink> {\n  const {\n    slug,\n  } = params;\n  if (!slug) {\n    return undefined;\n  }\n  return {\n    type: 'chatFolderLink',\n    slug,\n  };\n}\n\nfunction buildLoginCodeLink(params: BuilderParams<LoginCodeLink>): BuilderReturnType<LoginCodeLink> {\n  const {\n    code,\n  } = params;\n  if (!code) {\n    return undefined;\n  }\n  return {\n    type: 'loginCodeLink',\n    code,\n  };\n}\n\nfunction buildTelegramPassportLink(\n  params: BuilderParams<TelegramPassportLink>,\n): BuilderReturnType<TelegramPassportLink> {\n  const {\n    botId,\n    scope,\n    publicKey,\n    nonce,\n    callbackUrl,\n    payload,\n  } = params;\n  if (!botId || !isNumber(botId) || !scope || !publicKey || !nonce) {\n    return undefined;\n  }\n  return {\n    type: 'telegramPassportLink',\n    botId: Number(botId),\n    scope,\n    publicKey,\n    nonce,\n    callbackUrl,\n    payload,\n  };\n}\n\nfunction buildPublicUsernameOrBotLink(\n  params: BuilderParams<PublicUsernameOrBotLink>,\n): BuilderReturnType<PublicUsernameOrBotLink> {\n  const {\n    username,\n    start,\n    text,\n    startApp,\n    mode,\n    startAttach,\n    attach,\n    appName,\n    choose,\n    ref,\n  } = params;\n  if (!username) {\n    return undefined;\n  }\n  if (!isUsernameValid(username)) {\n    return undefined;\n  }\n  return {\n    type: 'publicUsernameOrBotLink',\n    username,\n    start,\n    startApp,\n    mode,\n    appName,\n    startAttach,\n    attach,\n    text,\n    choose,\n    ref,\n  };\n}\n\nfunction buildPrivateChannelLink(params: BuilderParams<PrivateChannelLink>): BuilderReturnType<PrivateChannelLink> {\n  const {\n    channelId,\n  } = params;\n  if (!channelId) {\n    return undefined;\n  }\n\n  return {\n    type: 'privateChannelLink',\n    channelId: toChannelId(channelId),\n  };\n}\n\nexport function buildChatBoostLink(params: BuilderParams<ChatBoostLink>): BuilderReturnType<ChatBoostLink> {\n  const {\n    username,\n    id,\n  } = params;\n\n  if (!username && !id) {\n    return undefined;\n  }\n\n  return {\n    type: 'chatBoostLink',\n    username,\n    id: id ? toChannelId(id) : undefined,\n  };\n}\n\nfunction buildBusinessChatLink(params: BuilderParams<BusinessChatLink>): BuilderReturnType<BusinessChatLink> {\n  const {\n    slug,\n  } = params;\n\n  if (!slug) {\n    return undefined;\n  }\n\n  return {\n    type: 'businessChatLink',\n    slug,\n  };\n}\n\nfunction buildGiftUniqueLink(params: BuilderParams<GiftUniqueLink>): BuilderReturnType<GiftUniqueLink> {\n  const {\n    slug,\n  } = params;\n\n  if (!slug) {\n    return undefined;\n  }\n\n  return {\n    type: 'giftUniqueLink',\n    slug,\n  };\n}\n\nfunction buildPremiumReferrerLink(params: BuilderParams<PremiumReferrerLink>): BuilderReturnType<PremiumReferrerLink> {\n  const {\n    referrer,\n  } = params;\n\n  if (!referrer) {\n    return undefined;\n  }\n\n  return {\n    type: 'premiumReferrerLink',\n    referrer,\n  };\n}\n\nfunction buildPremiumMultigiftLink(\n  params: BuilderParams<PremiumMultigiftLink>,\n): BuilderReturnType<PremiumMultigiftLink> {\n  const {\n    referrer,\n  } = params;\n\n  if (!referrer) {\n    return undefined;\n  }\n\n  return {\n    type: 'premiumMultigiftLink',\n    referrer,\n  };\n}\n\nfunction isNumber(s: string) {\n  return /^-?\\d+$/.test(s);\n}\n\nfunction getPathParams(url: URL) {\n  const parts = url.pathname.split('/').filter(Boolean);\n  if (parts[0] === 's') {\n    parts.shift();\n  }\n  return parts.map(decodeURI);\n}\n\nfunction getQueryParams(url: URL) {\n  return Object.fromEntries(url.searchParams);\n}\n","import { getActions } from '../global';\n\nimport type { ApiChatType, ApiFormattedText } from '../api/types';\nimport type { DeepLinkMethod, PrivateMessageLink } from './deepLinkParser';\n\nimport { API_CHAT_TYPES, RE_TG_LINK } from '../config';\nimport { toChannelId } from '../global/helpers';\nimport { tryParseDeepLink } from './deepLinkParser';\nimport { IS_BAD_URL_PARSER } from './windowEnvironment';\n\nexport const processDeepLink = (url: string): boolean => {\n  const actions = getActions();\n\n  const parsedLink = tryParseDeepLink(url);\n  if (parsedLink) {\n    switch (parsedLink.type) {\n      case 'privateMessageLink':\n        handlePrivateMessageLink(parsedLink, actions);\n        return true;\n      case 'publicMessageLink': {\n        actions.openChatByUsername({\n          username: parsedLink.username,\n          threadId: parsedLink.threadId,\n          messageId: parsedLink.messageId,\n          commentId: parsedLink.commentId,\n        });\n        return true;\n      }\n      case 'publicUsernameOrBotLink': {\n        const choose = parseChooseParameter(parsedLink.choose);\n\n        actions.openChatByUsername({\n          username: parsedLink.username,\n          startParam: parsedLink.start,\n          ref: parsedLink.ref,\n          text: parsedLink.text,\n          startApp: parsedLink.startApp,\n          mode: parsedLink.mode,\n          startAttach: parsedLink.startAttach,\n          attach: parsedLink.attach,\n          choose,\n          originalParts: [parsedLink.username, parsedLink.appName],\n        });\n        return true;\n      }\n      case 'privateChannelLink': {\n        actions.openPrivateChannel({\n          id: parsedLink.channelId,\n        });\n        return true;\n      }\n      case 'businessChatLink':\n        actions.resolveBusinessChatLink({\n          slug: parsedLink.slug,\n        });\n        return true;\n      case 'premiumReferrerLink':\n        actions.openPremiumModal();\n        return true;\n      case 'premiumMultigiftLink':\n        actions.openGiftRecipientPicker();\n        return true;\n      case 'chatBoostLink':\n        actions.processBoostParameters({\n          usernameOrId: (parsedLink.username || parsedLink.id)!,\n          isPrivate: Boolean(parsedLink.id),\n        });\n        return true;\n      case 'giftUniqueLink':\n        actions.openUniqueGiftBySlug({ slug: parsedLink.slug });\n        return true;\n      default:\n        break;\n    }\n  }\n\n  if (!url.match(RE_TG_LINK)) {\n    return false;\n  }\n\n  const urlToParse = IS_BAD_URL_PARSER ? url.replace(/^tg:\\/\\//, 'https://') : url;\n\n  const {\n    protocol, searchParams, hostname,\n  } = new URL(urlToParse);\n\n  if (protocol !== 'tg:') return false;\n\n  const method = hostname as DeepLinkMethod;\n  const params = Object.fromEntries(searchParams);\n\n  const {\n    checkChatInvite,\n    openChatByUsername,\n    openChatByPhoneNumber,\n    openStickerSet,\n    joinVoiceChatByLink,\n    openInvoice,\n    openChatWithDraft,\n    checkChatlistInvite,\n    openStoryViewerByUsername,\n    checkGiftCode,\n    openStarsBalanceModal,\n  } = actions;\n\n  switch (method) {\n    case 'resolve': {\n      const {\n        domain, phone, post, comment, voicechat, livestream, start, startattach, attach, thread, topic,\n        appname, startapp, mode, story, text,\n      } = params;\n\n      const threadId = Number(thread) || Number(topic) || undefined;\n\n      if (domain !== 'telegrampassport') {\n        if (appname) {\n          openChatByUsername({\n            username: domain,\n            startApp: startapp,\n            mode,\n            originalParts: [domain, appname],\n            text,\n          });\n        } else if (params.hasOwnProperty('voicechat') || params.hasOwnProperty('livestream')) {\n          joinVoiceChatByLink({\n            username: domain,\n            inviteHash: voicechat || livestream,\n          });\n        } else if (phone) {\n          openChatByPhoneNumber({\n            phoneNumber: phone,\n            startAttach: startattach,\n            attach,\n            text,\n          });\n        } else if (story) {\n          openStoryViewerByUsername({ username: domain, storyId: Number(story) });\n        } else {\n          openChatByUsername({\n            username: domain,\n            messageId: post ? Number(post) : undefined,\n            commentId: comment ? Number(comment) : undefined,\n            startParam: start,\n            mode,\n            startAttach: startattach,\n            attach,\n            threadId,\n          });\n        }\n      }\n      break;\n    }\n    case 'bg': {\n      // const {\n      //   slug, color, rotation, mode, intensity, bg_color: bgColor, gradient,\n      // } = params;\n      break;\n    }\n    case 'join': {\n      const { invite } = params;\n\n      checkChatInvite({ hash: invite });\n      break;\n    }\n    case 'addemoji':\n    case 'addstickers': {\n      const { set } = params;\n\n      openStickerSet({\n        stickerSetInfo: {\n          shortName: set,\n        },\n      });\n      break;\n    }\n    case 'share':\n    case 'msg':\n    case 'msg_url': {\n      const { url: urlParam, text } = params;\n      openChatWithDraft({ text: formatShareText(urlParam, text) });\n      break;\n    }\n    case 'addlist': {\n      checkChatlistInvite({ slug: params.slug });\n      break;\n    }\n\n    case 'login': {\n      // const { code, token } = params;\n      break;\n    }\n\n    case 'invoice': {\n      const { slug } = params;\n      openInvoice({ type: 'slug', slug });\n      break;\n    }\n\n    case 'stars_topup': {\n      const { balance, purpose } = params;\n      const balanceNeeded = Number(balance);\n      if (!balanceNeeded || balanceNeeded < 0) return true;\n\n      openStarsBalanceModal({ topup: { balanceNeeded, purpose } });\n      break;\n    }\n\n    case 'giftcode': {\n      const { slug } = params;\n      checkGiftCode({ slug });\n      break;\n    }\n    default:\n      // Unsupported deeplink\n      return false;\n  }\n  return true;\n};\n\nexport function formatShareText(url?: string, text?: string, title?: string): ApiFormattedText {\n  return {\n    text: [url, title, text].filter(Boolean).join('\\n'),\n  };\n}\n\nfunction handlePrivateMessageLink(link: PrivateMessageLink, actions: ReturnType<typeof getActions>) {\n  const {\n    focusMessage,\n  } = actions;\n  const {\n    channelId, messageId, threadId,\n  } = link;\n  focusMessage({\n    chatId: toChannelId(channelId),\n    threadId,\n    messageId,\n  });\n}\n\nfunction parseChooseParameter(choose?: string) {\n  if (!choose) return undefined;\n  const types = choose.toLowerCase().split(' ');\n  return types.filter((type): type is ApiChatType => API_CHAT_TYPES.includes(type as ApiChatType));\n}\n","export default function calcTextLineHeightAndCount(textContainer: HTMLElement) {\n  const lineHeight = parseInt(getComputedStyle(textContainer).lineHeight, 10);\n\n  const totalLines = textContainer.scrollHeight / lineHeight;\n\n  return {\n    totalLines,\n    lineHeight,\n  };\n}\n","import type { VirtualElement } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\nexport default function jsxToHtml(jsx: VirtualElement) {\n  const fragment = document.createElement('div');\n  TeactDOM.render(jsx, fragment);\n\n  const children = Array.from(fragment.children);\n  TeactDOM.render(undefined, fragment);\n\n  return children;\n}\n","import { addCallback } from '../../lib/teact/teactn';\nimport { getGlobal } from '../../global';\n\nimport type { ApiSticker } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport { requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { getStickerHashById } from '../../global/helpers';\nimport { selectCanPlayAnimatedEmojis } from '../../global/selectors';\nimport { createCallbackManager } from '../callbacks';\nimport generateUniqueId from '../generateUniqueId';\nimport * as mediaLoader from '../mediaLoader';\nimport { throttle } from '../schedulers';\nimport { IS_WEBM_SUPPORTED } from '../windowEnvironment';\n\nimport blankSrc from '../../assets/blank.png';\nimport placeholderSrc from '../../assets/square.svg';\n\ntype CustomEmojiLoadCallback = (customEmojis: GlobalState['customEmojis']) => void;\ntype CustomEmojiInputRenderCallback = (emojiId: string) => void;\n\nconst DOM_PROCESS_THROTTLE = 500;\n\nconst INPUT_WAITING_CUSTOM_EMOJI_IDS: Set<string> = new Set();\n\nconst handlers = new Map<CustomEmojiLoadCallback, string>();\nconst renderCallbacks = createCallbackManager<CustomEmojiInputRenderCallback>();\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  if (\n    global.customEmojis.byId !== prevGlobal?.customEmojis.byId\n    || selectCanPlayAnimatedEmojis(global) !== selectCanPlayAnimatedEmojis(prevGlobal)\n  ) {\n    for (const entry of handlers) {\n      const [handler, id] = entry;\n      if (global.customEmojis.byId[id]) {\n        handler(global.customEmojis);\n      }\n    }\n\n    checkInputCustomEmojiLoad(global.customEmojis);\n  }\n\n  prevGlobal = global;\n});\n\nexport function addCustomEmojiCallback(handler: CustomEmojiLoadCallback, emojiId: string) {\n  handlers.set(handler, emojiId);\n}\n\nexport function removeCustomEmojiCallback(handler: CustomEmojiLoadCallback) {\n  handlers.delete(handler);\n}\n\nexport const addCustomEmojiInputRenderCallback = renderCallbacks.addCallback;\nconst callInputRenderHandlers = throttle(renderCallbacks.runCallbacks, DOM_PROCESS_THROTTLE);\n\nfunction processDomForCustomEmoji() {\n  const emojis = document.querySelectorAll<HTMLImageElement>('.custom-emoji.placeholder');\n  emojis.forEach((emoji) => {\n    const customEmoji = getGlobal().customEmojis.byId[emoji.dataset.documentId!];\n    if (!customEmoji) {\n      INPUT_WAITING_CUSTOM_EMOJI_IDS.add(emoji.dataset.documentId!);\n      return;\n    }\n    const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(customEmoji);\n\n    if (customEmoji.shouldUseTextColor && !emoji.classList.contains('colorable')) {\n      requestMutation(() => {\n        emoji.classList.add('colorable');\n      });\n    }\n\n    if (!isPlaceholder) {\n      requestMutation(() => {\n        emoji.src = src;\n        emoji.classList.remove('placeholder');\n        if (uniqueId) emoji.dataset.uniqueId = uniqueId;\n\n        callInputRenderHandlers(customEmoji.id);\n      });\n    }\n  });\n}\n\nexport const processMessageInputForCustomEmoji = throttle(processDomForCustomEmoji, DOM_PROCESS_THROTTLE);\n\nfunction checkInputCustomEmojiLoad(customEmojis: GlobalState['customEmojis']) {\n  const loaded = Array.from(INPUT_WAITING_CUSTOM_EMOJI_IDS).filter((id) => Boolean(customEmojis.byId[id]));\n  if (loaded.length) {\n    loaded.forEach((id) => INPUT_WAITING_CUSTOM_EMOJI_IDS.delete(id));\n    processMessageInputForCustomEmoji();\n  }\n}\n\nexport function getCustomEmojiMediaDataForInput(emojiId: string, isPreview?: boolean) {\n  const mediaHash = getStickerHashById(emojiId, isPreview);\n  const data = mediaLoader.getFromMemory(mediaHash);\n  if (data) {\n    return data;\n  }\n\n  fetchAndProcess(mediaHash);\n  return undefined;\n}\n\nfunction fetchAndProcess(mediaHash: string) {\n  return mediaLoader.fetch(mediaHash, ApiMediaFormat.BlobUrl).then(() => {\n    processMessageInputForCustomEmoji();\n  });\n}\n\nexport function getInputCustomEmojiParams(customEmoji?: ApiSticker) {\n  if (!customEmoji) return [true, placeholderSrc, undefined];\n  const shouldUseStaticFallback = !IS_WEBM_SUPPORTED && customEmoji.isVideo;\n  const isUsingSharedCanvas = customEmoji.isLottie || (customEmoji.isVideo && !shouldUseStaticFallback);\n  if (isUsingSharedCanvas) {\n    fetchAndProcess(`sticker${customEmoji.id}`);\n    return [false, blankSrc, generateUniqueId()];\n  }\n\n  const mediaData = getCustomEmojiMediaDataForInput(customEmoji.id, shouldUseStaticFallback);\n\n  return [!mediaData, mediaData || placeholderSrc, undefined];\n}\n","import { addExtraClass } from '../../lib/teact/teact-dom';\n\nimport { requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { removeVS16s } from '../../lib/twemojiRegex';\nimport withCache from '../withCache';\n\n// Due to the fact that emoji from Apple do not contain some characters, it is necessary to remove them from emoji-data\n// https://github.com/iamcal/emoji-data/issues/136\nconst EXCLUDE_EMOJIS = ['female_sign', 'male_sign', 'medical_symbol'];\n\nconst ISO_FLAGS_OFFSET = 127397;\n\nexport type EmojiRawData = typeof import('emoji-data-ios/emoji-data.json');\nexport type EmojiModule = { default: EmojiRawData };\n\nexport type EmojiData = {\n  categories: Array<EmojiCategory>;\n  emojis: Record<string, Emoji>;\n};\n\nfunction unifiedToNative(unified: string) {\n  const unicodes = unified.split('-');\n  const codePoints = unicodes.map((i) => parseInt(i, 16));\n\n  return String.fromCodePoint(...codePoints);\n}\n\nexport const LOADED_EMOJIS = new Set<string>();\n\nexport function handleEmojiLoad(event: React.SyntheticEvent<HTMLImageElement>) {\n  const emoji = event.currentTarget;\n\n  LOADED_EMOJIS.add(event.currentTarget.dataset.path!);\n\n  requestMutation(() => {\n    addExtraClass(emoji, 'open');\n  });\n}\n\nexport function nativeToUnified(emoji: string) {\n  let code;\n\n  if (emoji.length === 1) {\n    code = emoji.charCodeAt(0).toString(16).padStart(4, '0');\n  } else {\n    const pairs = [];\n    for (let i = 0; i < emoji.length; i++) {\n      if (emoji.charCodeAt(i) >= 0xd800 && emoji.charCodeAt(i) <= 0xdbff) {\n        if (emoji.charCodeAt(i + 1) >= 0xdc00 && emoji.charCodeAt(i + 1) <= 0xdfff) {\n          pairs.push(\n            (emoji.charCodeAt(i) - 0xd800) * 0x400\n            + (emoji.charCodeAt(i + 1) - 0xdc00) + 0x10000,\n          );\n        }\n      } else if (emoji.charCodeAt(i) < 0xd800 || emoji.charCodeAt(i) > 0xdfff) {\n        pairs.push(emoji.charCodeAt(i));\n      }\n    }\n\n    code = pairs.map((x) => x.toString(16).padStart(4, '0')).join('-');\n  }\n\n  return code;\n}\n\nfunction nativeToUnifiedExtended(emoji: string) {\n  return nativeToUnified(removeVS16s(emoji));\n}\n\nexport const nativeToUnifiedExtendedWithCache = withCache(nativeToUnifiedExtended);\n\nexport function uncompressEmoji(data: EmojiRawData): EmojiData {\n  const emojiData: EmojiData = { categories: [], emojis: {} };\n\n  for (let i = 0; i < data.length; i += 2) {\n    const category = {\n      id: data[i][0],\n      name: data[i][1],\n      emojis: [],\n    } as EmojiCategory;\n\n    for (let j = 0; j < data[i + 1].length; j++) {\n      const emojiRaw = data[i + 1][j];\n      if (!EXCLUDE_EMOJIS.includes(emojiRaw[1][0])) {\n        category.emojis.push(emojiRaw[1][0]);\n        emojiData.emojis[emojiRaw[1][0]] = {\n          id: emojiRaw[1][0],\n          names: emojiRaw[1] as string[],\n          native: unifiedToNative(emojiRaw[0] as string),\n          image: (emojiRaw[0] as string).toLowerCase(),\n        };\n      }\n    }\n\n    emojiData.categories.push(category);\n  }\n\n  return emojiData;\n}\n\nexport function isoToEmoji(iso: string) {\n  // Special case for Fragment numbers\n  if (iso === 'FT') {\n    return '\\uD83C\\uDFF4\\u200D\\u2620\\uFE0F';\n  }\n\n  const code = iso.toUpperCase();\n\n  if (!/^[A-Z]{2}$/.test(code)) return iso;\n  const codePoints = [...code].map((c) => c.codePointAt(0)! + ISO_FLAGS_OFFSET);\n  return String.fromCodePoint(...codePoints);\n}\n","import EMOJI_REGEX from '../../lib/twemojiRegex';\n\n// Non-standard variations of emojis, used on some devices\nconst EMOJI_EXCEPTIONS: [string | RegExp, string][] = [\n  [/\\u{1f3f3}\\u200d\\u{1f308}/gu, '\\u{1f3f3}\\ufe0f\\u200d\\u{1f308}'], // 🏳‍🌈\n  [/\\u{1f3f3}\\u200d\\u26a7\\ufe0f?/gu, '\\u{1f3f3}\\ufe0f\\u200d\\u26a7\\ufe0f'], // 🏳️‍⚧️\n  [/\\u26d3\\u200d\\u{1f4a5}/gu, '\\u26d3\\ufe0f\\u200d\\u{1f4a5}'], // ⛓‍💥\n  [/\\u200d([\\u2640\\u2642])(?!\\ufe0f)/gu, '\\u200d$1\\ufe0f'], // Gender variation without 0xFE0F\n];\n\nexport default function fixNonStandardEmoji(text: string) {\n  // Non-standard sequences typically parsed as separate emojis, so no need to fix text without any\n  if (!text.match(EMOJI_REGEX)) return text;\n  // eslint-disable-next-line no-restricted-syntax\n  for (const [regex, replacement] of EMOJI_EXCEPTIONS) {\n    text = text.replace(regex, replacement);\n  }\n\n  return text;\n}\n","import EMOJI_REGEX from '../../lib/twemojiRegex';\nimport fixNonStandardEmoji from './fixNonStandardEmoji';\n\nconst DETECT_UP_TO = 100;\nconst MAX_LENGTH = DETECT_UP_TO * 8; // Maximum 8 code points per one emoji.\n\nexport default function parseEmojiOnlyString(text: string): number | false {\n  const standardizedText = fixNonStandardEmoji(text);\n  const lines = standardizedText.split('\\n');\n  const textWithoutNewlines = lines.join('');\n  if (textWithoutNewlines.length > MAX_LENGTH) {\n    return false;\n  }\n\n  const totalCount = countIfEmojiOnly(textWithoutNewlines);\n  if (!totalCount || totalCount > DETECT_UP_TO) {\n    return false;\n  }\n\n  // Calculate max emoji count per column or line. Used in UI to determine the size of the emoji.\n  let max = lines.length;\n  for (const line of lines) {\n    const count = countIfEmojiOnly(line);\n    if (count === false) {\n      return false;\n    }\n    if (count > max) {\n      max = count;\n    }\n  }\n\n  return max;\n}\n\nfunction countIfEmojiOnly(line: string): false | number {\n  const iterator = line.matchAll(EMOJI_REGEX);\n  let count = 0;\n  let currentIndex = 0;\n\n  for (const match of iterator) {\n    if (match.index !== currentIndex) {\n      return false;\n    }\n\n    count++;\n    currentIndex = match.index + match[0].length;\n  }\n\n  if (currentIndex !== line.length) {\n    return false;\n  }\n\n  return count;\n}\n","const PROTOCOL_WHITELIST = new Set(['http:', 'https:', 'tg:', 'ton:', 'mailto:', 'tel:']);\nconst FALLBACK_PREFIX = 'https://';\n\nexport function ensureProtocol(url?: string) {\n  if (!url) {\n    return undefined;\n  }\n\n  try {\n    const parsedUrl = new URL(url);\n    // eslint-disable-next-line no-script-url\n    if (!PROTOCOL_WHITELIST.has(parsedUrl.protocol)) {\n      return `${FALLBACK_PREFIX}${url}`;\n    }\n\n    return url;\n  } catch (err) {\n    return `${FALLBACK_PREFIX}${url}`;\n  }\n}\n","import { ESTABLISH_BROADCAST_CHANNEL_NAME } from '../config';\nimport { createCallbackManager } from './callbacks';\nimport { getPasscodeHash, setPasscodeHash } from './passcode';\nimport { IS_MULTITAB_SUPPORTED } from './windowEnvironment';\n\nimport Deferred from './Deferred';\n\nconst ESTABLISH_TIMEOUT = 100;\n\nconst { addCallback, runCallbacks } = createCallbackManager();\nconst { addCallback: addCallbackTokenDied, runCallbacks: runCallbacksTokenDied } = createCallbackManager();\nconst token = Number(Math.random().toString().substring(2));\nconst collectedTokens = new Set([token]);\nlet channel = IS_MULTITAB_SUPPORTED ? new BroadcastChannel(ESTABLISH_BROADCAST_CHANNEL_NAME) : undefined;\n\nlet isEstablished = false;\nconst initialEstablishment = new Deferred();\nlet masterToken: number | undefined;\nlet isWaitingForMaster = false;\nlet reestablishToken: number | undefined;\n\ntype EstablishMessage = {\n  collectedTokens: Set<number>;\n  masterToken?: number;\n  tokenDied?: number;\n  currentPasscodeHash?: ArrayBuffer;\n  reestablishToken?: number;\n  shouldGiveUpMaster?: boolean;\n  hasGaveUpMaster?: boolean;\n};\n\nconst handleMessage = ({ data }: { data: EstablishMessage }) => {\n  if (!channel || !data) return;\n\n  if (data.currentPasscodeHash) {\n    setPasscodeHash(data.currentPasscodeHash);\n  }\n\n  if (data.hasGaveUpMaster && isWaitingForMaster) {\n    masterToken = token;\n    isWaitingForMaster = false;\n    initialEstablishment.resolve();\n    runCallbacks(true);\n    return;\n  }\n\n  if (data.shouldGiveUpMaster) {\n    if (masterToken === token) {\n      runCallbacks(false);\n      channel.postMessage({ currentPasscodeHash: getPasscodeHash(), hasGaveUpMaster: true });\n    }\n    masterToken = data.masterToken;\n    return;\n  }\n\n  if (data.tokenDied) {\n    runCallbacksTokenDied(data.tokenDied);\n    collectedTokens.delete(data.tokenDied);\n    if (data.tokenDied === masterToken) {\n      collectedTokens.delete(data.tokenDied);\n      masterToken = undefined;\n      isEstablished = false;\n      reestablishToken = data.tokenDied;\n\n      channel.postMessage({\n        collectedTokens,\n        masterToken,\n        reestablishToken,\n      });\n      if (collectedTokens.size === 1) {\n        isEstablished = true;\n        masterToken = token;\n        reestablishToken = undefined;\n        initialEstablishment.resolve();\n        runCallbacks(true);\n      }\n    }\n  }\n\n  if (data.collectedTokens) {\n    if (!data.reestablishToken && reestablishToken) {\n      return;\n    }\n    if (data.reestablishToken && reestablishToken !== data.reestablishToken) {\n      data.collectedTokens.delete(data.reestablishToken);\n\n      reestablishToken = data.reestablishToken;\n    }\n    const prevLength = collectedTokens.size;\n    data.collectedTokens.forEach((l) => collectedTokens.add(l));\n    if (reestablishToken) data.collectedTokens.delete(reestablishToken);\n\n    if (!isEstablished) {\n      if (data.masterToken) {\n        reestablishToken = undefined;\n        masterToken = data.masterToken;\n        runCallbacks(masterToken === token);\n\n        if (!isEstablished) {\n          channel.postMessage({\n            collectedTokens,\n            masterToken,\n            reestablishToken,\n          });\n        }\n        initialEstablishment.resolve();\n        isEstablished = true;\n      } else if (prevLength !== collectedTokens.size) {\n        channel.postMessage({\n          collectedTokens,\n          masterToken,\n          reestablishToken,\n        });\n      } else {\n        reestablishToken = undefined;\n        masterToken = Math.max(...Array.from(collectedTokens));\n        runCallbacks(masterToken === token);\n\n        if (!isEstablished) {\n          channel.postMessage({\n            collectedTokens,\n            masterToken,\n            reestablishToken,\n          });\n        }\n        initialEstablishment.resolve();\n        isEstablished = true;\n      }\n    } else if (!data.masterToken) {\n      channel.postMessage({\n        collectedTokens,\n        masterToken,\n        reestablishToken,\n      });\n    }\n  }\n};\n\nexport function establishMultitabRole(shouldReestablishMasterToSelf?: boolean) {\n  if (!channel) return;\n\n  channel.addEventListener('message', handleMessage);\n\n  channel.postMessage({ collectedTokens });\n\n  // To make the connection faster, we can ignore the waiting and connect right away,\n  // and then if we realize we're not master, drop the connection\n  setTimeout(() => {\n    if (masterToken === undefined) {\n      masterToken = token;\n      initialEstablishment.resolve();\n      runCallbacks(true);\n    } else if (shouldReestablishMasterToSelf) {\n      reestablishMasterToSelf();\n    }\n  }, ESTABLISH_TIMEOUT);\n\n  window.addEventListener('beforeunload', signalTokenDead);\n}\n\nexport function signalTokenDead() {\n  if (!channel) return;\n\n  runCallbacksTokenDied(token);\n  channel.removeEventListener('message', handleMessage);\n  channel.postMessage({ tokenDied: token, currentPasscodeHash: getPasscodeHash() });\n  channel.close();\n  channel = undefined;\n}\n\nexport function signalPasscodeHash() {\n  if (!channel) return;\n  channel.postMessage({ currentPasscodeHash: getPasscodeHash() });\n}\n\nexport function getCurrentTabId() {\n  return token;\n}\n\nexport function getAllMultitabTokens() {\n  return Array.from(collectedTokens);\n}\n\nexport function reestablishMasterToSelf() {\n  if (!channel) return;\n\n  isWaitingForMaster = true;\n  channel.postMessage({\n    collectedTokens, masterToken: token, shouldGiveUpMaster: true,\n  });\n}\n\nexport const subscribeToTokenDied = addCallbackTokenDied;\nexport const subscribeToMasterChange = addCallback;\n\nexport const initialEstablishmentPromise = initialEstablishment.promise;\n\nexport function isCurrentTabMaster() {\n  return masterToken === token;\n}\n","import { CONTENT_TYPES_WITH_PREVIEW } from '../config';\nimport { pause } from './schedulers';\n\n// Polyfill for Safari: `File` is not available in web worker\nif (typeof File === 'undefined') {\n  // eslint-disable-next-line no-global-assign, no-restricted-globals, func-names\n  self.File = class extends Blob {\n    name: string;\n\n    constructor(fileBits: BlobPart[], fileName: string, options?: FilePropertyBag) {\n      if (options) {\n        const { type, ...rest } = options;\n        super(fileBits, { type });\n        Object.assign(this, rest);\n      } else {\n        super(fileBits);\n      }\n\n      this.name = fileName;\n    }\n  } as typeof File;\n}\n\nexport function blobToDataUri(blob: Blob): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onload = (e: ProgressEvent<FileReader>) => {\n      const { result } = e.target || {};\n      if (typeof result === 'string') {\n        resolve(result);\n      }\n\n      reject(new Error('Failed to read blob'));\n    };\n\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport function blobToFile(blob: Blob, fileName: string) {\n  return new File([blob], fileName, {\n    lastModified: Date.now(),\n    type: blob.type,\n  });\n}\n\nexport function preloadImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = url;\n  });\n}\n\nexport function preloadVideo(url: string): Promise<HTMLVideoElement> {\n  return new Promise((resolve, reject) => {\n    const video = document.createElement('video');\n    video.volume = 0;\n    video.onloadedmetadata = () => resolve(video);\n    video.onerror = reject;\n    video.src = url;\n  });\n}\n\nexport async function createPosterForVideo(url: string): Promise<string | undefined> {\n  try {\n    const video = await preloadVideo(url);\n\n    return await Promise.race([\n      pause(2000) as Promise<undefined>,\n      new Promise<string | undefined>((resolve, reject) => {\n        video.onseeked = () => {\n          if (!video.videoWidth || !video.videoHeight) {\n            resolve(undefined);\n          }\n\n          const canvas = document.createElement('canvas');\n          canvas.width = video.videoWidth;\n          canvas.height = video.videoHeight;\n          const ctx = canvas.getContext('2d')!;\n          ctx.drawImage(video, 0, 0);\n\n          canvas.toBlob((blob) => {\n            resolve(blob ? URL.createObjectURL(blob) : undefined);\n          });\n        };\n        video.onerror = reject;\n        video.currentTime = Math.min(video.duration, 1);\n      }),\n    ]);\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport async function fetchBlob(blobUrl: string) {\n  const response = await fetch(blobUrl);\n  return response.blob();\n}\n\nexport async function fetchFile(blobUrl: string, fileName: string) {\n  const blob = await fetchBlob(blobUrl);\n  return blobToFile(blob, fileName);\n}\n\nexport function imgToCanvas(img: HTMLImageElement) {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.drawImage(img, 0, 0);\n\n  return canvas;\n}\n\nexport function hasPreview(file: File) {\n  return CONTENT_TYPES_WITH_PREVIEW.has(file.type);\n}\n\nexport function validateFiles(files: File[] | FileList | null): File[] | undefined {\n  if (!files?.length) {\n    return undefined;\n  }\n  return Array.from(files).map(fixMovMime).filter((file) => file.size);\n}\n\n// .mov MIME type not reported sometimes https://developer.mozilla.org/en-US/docs/Web/API/File/type#sect1\nfunction fixMovMime(file: File) {\n  const ext = file.name.split('.').pop()!;\n  if (!file.type && ext.toLowerCase() === 'mov') {\n    return new File([file], file.name, { type: 'video/quicktime' });\n  }\n  return file;\n}\n","import { onFullyIdle } from '../lib/teact/teact';\nimport { addCallback } from '../lib/teact/teactn';\nimport { addActionHandler, getGlobal } from '../global';\n\nimport type {\n  ApiChat, ApiChatFolder, ApiUser,\n} from '../api/types';\nimport type { GlobalState } from '../global/types';\nimport type { NotifyException, NotifySettings } from '../types';\nimport type { CallbackManager } from './callbacks';\n\nimport {\n  ALL_FOLDER_ID, ARCHIVED_FOLDER_ID, DEBUG, SAVED_FOLDER_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../config';\nimport { selectIsChatMuted } from '../global/helpers';\nimport {\n  selectChatLastMessage,\n  selectNotifyExceptions,\n  selectNotifySettings,\n  selectTabState,\n  selectTopics,\n} from '../global/selectors';\nimport arePropsShallowEqual from './arePropsShallowEqual';\nimport { createCallbackManager } from './callbacks';\nimport { areSortedArraysEqual, unique } from './iteratees';\nimport { throttle } from './schedulers';\n\ninterface FolderSummary {\n  id: number;\n  listIds?: Set<string>;\n  orderedPinnedIds?: string[];\n  contacts?: true;\n  nonContacts?: true;\n  groups?: true;\n  channels?: true;\n  bots?: true;\n  excludeMuted?: true;\n  excludeRead?: true;\n  excludeArchived?: true;\n  excludedChatIds?: Set<string>;\n  includedChatIds?: Set<string>;\n  pinnedChatIds?: Set<string>;\n}\n\ninterface ChatSummary {\n  id: string;\n  type: ApiChat['type'];\n  isListedInAll: boolean;\n  isListedInSaved: boolean;\n  isArchived: boolean;\n  isMuted: boolean;\n  isUnread: boolean;\n  unreadCount?: number;\n  unreadMentionsCount?: number;\n  orderInAll: number;\n  orderInSaved: number;\n  isUserBot?: boolean;\n  isUserContact?: boolean;\n}\n\nconst UPDATE_THROTTLE = 500;\nconst DEBUG_DURATION_LIMIT = 6;\n\nconst initials = buildInitials();\n\nlet prevGlobal: {\n  allFolderListIds?: GlobalState['chats']['listIds']['active'];\n  allFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['active'];\n  archivedFolderListIds?: GlobalState['chats']['listIds']['archived'];\n  archivedFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['archived'];\n  savedFolderListIds?: GlobalState['chats']['listIds']['saved'];\n  savedFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['saved'];\n  isAllFolderFullyLoaded?: boolean;\n  isArchivedFolderFullyLoaded?: boolean;\n  isSavedFolderFullyLoaded?: boolean;\n  lastAllMessageIds?: GlobalState['chats']['lastMessageIds']['all'];\n  lastSavedMessageIds?: GlobalState['chats']['lastMessageIds']['saved'];\n  topicsInfoById: GlobalState['chats']['topicsInfoById'];\n  chatsById: Record<string, ApiChat>;\n  foldersById: Record<string, ApiChatFolder>;\n  usersById: Record<string, ApiUser>;\n  notifySettings: NotifySettings;\n  notifyExceptions?: Record<number, NotifyException>;\n} = initials.prevGlobal;\n\nlet prepared: {\n  folderSummariesById: Record<string, FolderSummary>;\n  chatSummariesById: Map<string, ChatSummary>;\n  folderIdsByChatId: Record<string, number[]>;\n  chatIdsByFolderId: Record<number, Set<string> | undefined>;\n  isOrderedListJustPatched: Record<number, boolean | undefined>;\n} = initials.prepared;\n\nlet results: {\n  orderedIdsByFolderId: Record<string, string[] | undefined>;\n  pinnedCountByFolderId: Record<string, number | undefined>; // Also watched by `callbacks.orderedIdsByFolderId`\n  chatsCountByFolderId: Record<string, number | undefined>;\n  unreadCountersByFolderId: Record<string, {\n    chatsCount: number;\n    notificationsCount: number;\n  } | undefined>;\n} = initials.results;\n\nlet callbacks: {\n  orderedIdsByFolderId: Record<number, CallbackManager>;\n  chatsCountByFolderId: CallbackManager;\n  unreadCountersByFolderId: CallbackManager;\n} = initials.callbacks;\n\nif (DEBUG) {\n  (window as any).DEBUG_getFolderManager = () => ({\n    prepared,\n    results,\n  });\n}\n\nconst updateFolderManagerThrottled = throttle(() => {\n  onFullyIdle(() => {\n    updateFolderManager(getGlobal());\n  });\n}, UPDATE_THROTTLE);\n\nlet inited = false;\n\n/* Getters */\n\nexport function init() {\n  inited = true;\n\n  addCallback(updateFolderManagerThrottled);\n  addActionHandler('reset', reset);\n\n  const global = getGlobal();\n  if (!selectTabState(global).isMasterTab) {\n    updateFolders(global, true, true, true, true);\n  }\n  updateFolderManager(global);\n}\n\nexport function getOrderedIds(folderId: number) {\n  if (!inited) init();\n\n  return results.orderedIdsByFolderId[folderId];\n}\n\nexport function getPinnedChatsCount(folderId: number) {\n  if (!inited) init();\n\n  return results.pinnedCountByFolderId[folderId] || 0;\n}\n\nexport function getChatsCount() {\n  if (!inited) init();\n\n  return results.chatsCountByFolderId;\n}\n\nexport function getUnreadCounters() {\n  if (!inited) init();\n\n  return results.unreadCountersByFolderId;\n}\n\nexport function getAllNotificationsCount() {\n  return getUnreadCounters()[ALL_FOLDER_ID]?.notificationsCount || 0;\n}\n\nexport function getOrderKey(chatId: string, isForSaved?: boolean) {\n  const summary = prepared.chatSummariesById.get(chatId)!;\n  return isForSaved ? summary.orderInSaved : summary.orderInAll;\n}\n\n/* Callback managers */\n\nexport function addOrderedIdsCallback(folderId: number, callback: (orderedIds: string[]) => void) {\n  if (!callbacks.orderedIdsByFolderId[folderId]) {\n    callbacks.orderedIdsByFolderId[folderId] = createCallbackManager();\n  }\n\n  return callbacks.orderedIdsByFolderId[folderId].addCallback(callback);\n}\n\nexport function addChatsCountCallback(callback: (chatsCount: typeof results.chatsCountByFolderId) => void) {\n  return callbacks.chatsCountByFolderId.addCallback(callback);\n}\n\nexport function addUnreadCountersCallback(callback: (unreadCounters: typeof results.unreadCountersByFolderId) => void) {\n  return callbacks.unreadCountersByFolderId.addCallback(callback);\n}\n\n/* Global update handlers */\n\nfunction updateFolderManager(global: GlobalState) {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  let DEBUG_startedAt: number;\n  if (DEBUG) {\n    DEBUG_startedAt = performance.now();\n  }\n\n  const isAllFolderChanged = Boolean(\n    global.chats.listIds.active\n    && isMainFolderChanged(ALL_FOLDER_ID, global.chats.listIds.active, global.chats.orderedPinnedIds.active),\n  );\n  const isArchivedFolderChanged = Boolean(\n    global.chats.listIds.archived\n    && isMainFolderChanged(ARCHIVED_FOLDER_ID, global.chats.listIds.archived, global.chats.orderedPinnedIds.archived),\n  );\n  const isSavedFolderChanged = Boolean(\n    global.chats.listIds.saved\n    && isMainFolderChanged(SAVED_FOLDER_ID, global.chats.listIds.saved, global.chats.orderedPinnedIds.saved),\n  );\n  const isAllFullyLoadedChanged = global.chats.isFullyLoaded.active !== prevGlobal.isAllFolderFullyLoaded;\n  const isArchivedFullyLoadedChanged = global.chats.isFullyLoaded.archived !== prevGlobal.isArchivedFolderFullyLoaded;\n  const isSavedFolderFullyLoadedChanged = global.chats.isFullyLoaded.saved !== prevGlobal.isSavedFolderFullyLoaded;\n\n  const areFoldersChanged = global.chatFolders.byId !== prevGlobal.foldersById;\n  const areChatsChanged = global.chats.byId !== prevGlobal.chatsById;\n  const areSavedLastMessageIdsChanged = global.chats.lastMessageIds.saved !== prevGlobal.lastSavedMessageIds;\n  const areAllLastMessageIdsChanged = global.chats.lastMessageIds.all !== prevGlobal.lastAllMessageIds;\n  const areTopicsChanged = global.chats.topicsInfoById !== prevGlobal.topicsInfoById;\n  const areUsersChanged = global.users.byId !== prevGlobal.usersById;\n  const areNotifySettingsChanged = selectNotifySettings(global) !== prevGlobal.notifySettings;\n  const areNotifyExceptionsChanged = selectNotifyExceptions(global) !== prevGlobal.notifyExceptions;\n\n  let affectedFolderIds: number[] = [];\n\n  if (isAllFullyLoadedChanged || isArchivedFullyLoadedChanged || isSavedFolderFullyLoadedChanged) {\n    affectedFolderIds = affectedFolderIds.concat(\n      updateFullyLoaded(global, isArchivedFullyLoadedChanged, isSavedFolderFullyLoadedChanged),\n    );\n  }\n\n  if (!(\n    isAllFolderChanged || isArchivedFolderChanged || isSavedFolderChanged || areFoldersChanged\n    || areChatsChanged || areUsersChanged || areTopicsChanged || areNotifySettingsChanged || areNotifyExceptionsChanged\n    || areSavedLastMessageIdsChanged || areAllLastMessageIdsChanged\n  )\n  ) {\n    if (affectedFolderIds.length) {\n      updateResults(affectedFolderIds);\n    }\n\n    return;\n  }\n\n  const prevAllFolderListIds = prevGlobal.allFolderListIds;\n  const prevArchivedFolderListIds = prevGlobal.archivedFolderListIds;\n  const prevSavedFolderListIds = prevGlobal.savedFolderListIds;\n\n  updateFolders(global, isAllFolderChanged, isArchivedFolderChanged, isSavedFolderChanged, areFoldersChanged);\n\n  affectedFolderIds = affectedFolderIds.concat(updateChats(\n    global,\n    areFoldersChanged || isAllFolderChanged || isArchivedFolderChanged || isSavedFolderChanged,\n    areNotifySettingsChanged,\n    areNotifyExceptionsChanged,\n    prevAllFolderListIds,\n    prevArchivedFolderListIds,\n    prevSavedFolderListIds,\n  ));\n\n  updateResults(unique(affectedFolderIds));\n\n  if (DEBUG) {\n    const duration = performance.now() - DEBUG_startedAt!;\n    if (duration > DEBUG_DURATION_LIMIT) {\n      // eslint-disable-next-line no-console\n      console.warn(`Slow \\`updateFolderManager\\`: ${Math.round(duration)} ms`);\n    }\n  }\n}\n\nfunction isMainFolderChanged(folderId: number, newListIds?: string[], newPinnedIds?: string[]) {\n  const currentListIds = folderId === ALL_FOLDER_ID\n    ? prevGlobal.allFolderListIds\n    : folderId === SAVED_FOLDER_ID\n      ? prevGlobal.savedFolderListIds : prevGlobal.archivedFolderListIds;\n  const currentPinnedIds = folderId === ALL_FOLDER_ID\n    ? prevGlobal.allFolderPinnedIds\n    : folderId === SAVED_FOLDER_ID\n      ? prevGlobal.savedFolderPinnedIds : prevGlobal.archivedFolderPinnedIds;\n\n  return currentListIds !== newListIds || currentPinnedIds !== newPinnedIds;\n}\n\nfunction updateFullyLoaded(\n  global: GlobalState,\n  isArchivedFullyLoadedChanged = false,\n  isSavedFolderFullyLoadedChanged = false,\n) {\n  let affectedFolderIds = [];\n\n  if (isArchivedFullyLoadedChanged) {\n    affectedFolderIds.push(ARCHIVED_FOLDER_ID);\n  }\n\n  if (isSavedFolderFullyLoadedChanged) {\n    affectedFolderIds.push(SAVED_FOLDER_ID);\n  }\n\n  const isAllFolderFullyLoaded = global.chats.isFullyLoaded.active;\n  const isArchivedFolderFullyLoaded = global.chats.isFullyLoaded.archived;\n  const isSavedFolderFullyLoaded = global.chats.isFullyLoaded.saved;\n\n  if (isAllFolderFullyLoaded && isArchivedFolderFullyLoaded) {\n    const emptyFolderIds = Object.keys(prepared.folderSummariesById)\n      .filter((folderId) => !results.orderedIdsByFolderId[folderId])\n      .map(Number);\n\n    affectedFolderIds = affectedFolderIds.concat(emptyFolderIds);\n  }\n\n  prevGlobal.isAllFolderFullyLoaded = isAllFolderFullyLoaded;\n  prevGlobal.isArchivedFolderFullyLoaded = isArchivedFolderFullyLoaded;\n  prevGlobal.isSavedFolderFullyLoaded = isSavedFolderFullyLoaded;\n\n  return affectedFolderIds;\n}\n\nfunction updateFolders(\n  global: GlobalState,\n  isAllFolderChanged: boolean,\n  isArchivedFolderChanged: boolean,\n  isSavedFolderChanged: boolean,\n  areFoldersChanged: boolean,\n) {\n  const changedFolders = [];\n\n  if (isAllFolderChanged) {\n    const newListIds = global.chats.listIds.active!;\n    const newPinnedIds = global.chats.orderedPinnedIds.active;\n\n    prepared.folderSummariesById[ALL_FOLDER_ID] = buildFolderSummaryFromMainList(\n      ALL_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.allFolderListIds = newListIds;\n    prevGlobal.allFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(ALL_FOLDER_ID);\n  }\n\n  if (isArchivedFolderChanged) {\n    const newListIds = global.chats.listIds.archived!;\n    const newPinnedIds = global.chats.orderedPinnedIds.archived;\n\n    prepared.folderSummariesById[ARCHIVED_FOLDER_ID] = buildFolderSummaryFromMainList(\n      ARCHIVED_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.archivedFolderListIds = newListIds;\n    prevGlobal.archivedFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(ARCHIVED_FOLDER_ID);\n  }\n\n  if (isSavedFolderChanged) {\n    const newListIds = global.chats.listIds.saved!;\n    const newPinnedIds = global.chats.orderedPinnedIds.saved;\n\n    prepared.folderSummariesById[SAVED_FOLDER_ID] = buildFolderSummaryFromMainList(\n      SAVED_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.savedFolderListIds = newListIds;\n    prevGlobal.savedFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(SAVED_FOLDER_ID);\n  }\n\n  if (areFoldersChanged) {\n    const newFoldersById = global.chatFolders.byId;\n\n    Object.values(newFoldersById).forEach((folder) => {\n      if (folder === prevGlobal.foldersById[folder.id]) {\n        return;\n      }\n\n      prepared.folderSummariesById[folder.id] = buildFolderSummary(folder);\n\n      changedFolders.push(folder.id);\n    });\n\n    prevGlobal.foldersById = newFoldersById;\n  }\n\n  return changedFolders;\n}\n\nfunction buildFolderSummaryFromMainList(\n  folderId: number, listIds: string[], orderedPinnedIds?: string[],\n): FolderSummary {\n  return {\n    id: folderId,\n    listIds: new Set(listIds),\n    orderedPinnedIds,\n    pinnedChatIds: new Set(orderedPinnedIds),\n  };\n}\n\nfunction buildFolderSummary(folder: ApiChatFolder): FolderSummary {\n  return {\n    ...folder,\n    orderedPinnedIds: folder.pinnedChatIds,\n    excludedChatIds: folder.excludedChatIds ? new Set(folder.excludedChatIds) : undefined,\n    includedChatIds: folder.excludedChatIds ? new Set(folder.includedChatIds) : undefined,\n    pinnedChatIds: folder.excludedChatIds ? new Set(folder.pinnedChatIds) : undefined,\n  };\n}\n\nfunction updateChats(\n  global: GlobalState,\n  areFoldersChanged: boolean,\n  areNotifySettingsChanged: boolean,\n  areNotifyExceptionsChanged: boolean,\n  prevAllFolderListIds?: string[],\n  prevArchivedFolderListIds?: string[],\n  prevSavedFolderListIds?: string[],\n) {\n  const newChatsById = global.chats.byId;\n  const newUsersById = global.users.byId;\n  const newAllLastMessageIds = global.chats.lastMessageIds.all;\n  const newSavedLastMessageIds = global.chats.lastMessageIds.saved;\n  const newNotifySettings = selectNotifySettings(global);\n  const newNotifyExceptions = selectNotifyExceptions(global);\n  const folderSummaries = Object.values(prepared.folderSummariesById);\n  const affectedFolderIds = new Set<number>();\n\n  const newAllFolderListIds = global.chats.listIds.active;\n  const newArchivedFolderListIds = global.chats.listIds.archived;\n  const newSavedFolderListIds = global.chats.listIds.saved;\n\n  const newGeneralIds = [...newAllFolderListIds || [], ...newArchivedFolderListIds || []];\n  const newAllIds = [...newGeneralIds, ...newSavedFolderListIds || []];\n  let allIds = newAllIds;\n  if (newAllFolderListIds !== prevAllFolderListIds || newArchivedFolderListIds !== prevArchivedFolderListIds\n    || newSavedFolderListIds !== prevSavedFolderListIds) {\n    allIds = unique(allIds.concat(\n      prevAllFolderListIds || [], prevArchivedFolderListIds || [], prevSavedFolderListIds || [],\n    ));\n  }\n\n  allIds.forEach((chatId) => {\n    const chat = newChatsById[chatId];\n\n    if (\n      !areFoldersChanged\n      && !areNotifySettingsChanged\n      && !areNotifyExceptionsChanged\n      && chat === prevGlobal.chatsById[chatId]\n      && newUsersById[chatId] === prevGlobal.usersById[chatId]\n      && newAllLastMessageIds?.[chatId] === prevGlobal.lastAllMessageIds?.[chatId]\n      && newSavedLastMessageIds?.[chatId] === prevGlobal.lastSavedMessageIds?.[chatId]\n    ) {\n      return;\n    }\n\n    let newFolderIds: number[];\n    if (chat) {\n      const currentSummary = prepared.chatSummariesById.get(chatId);\n      const isRemovedFromAll = !newGeneralIds.includes(chatId);\n      const isRemovedFromSaved = !newSavedFolderListIds?.includes(chatId);\n      const newSummary = buildChatSummary(\n        global,\n        chat,\n        newNotifySettings,\n        newNotifyExceptions,\n        newUsersById[chatId],\n        isRemovedFromAll,\n        isRemovedFromSaved,\n      );\n\n      if (!areFoldersChanged && currentSummary && arePropsShallowEqual(newSummary, currentSummary)) {\n        return;\n      }\n\n      prepared.chatSummariesById.set(chatId, newSummary);\n\n      newFolderIds = buildChatFolderIds(newSummary, folderSummaries);\n      newFolderIds.forEach((folderId) => {\n        affectedFolderIds.add(folderId);\n      });\n    } else {\n      prepared.chatSummariesById.delete(chatId);\n      newFolderIds = [];\n    }\n\n    const currentFolderIds = prepared.folderIdsByChatId[chatId] || [];\n    if (areSortedArraysEqual(newFolderIds, currentFolderIds)) {\n      return;\n    }\n\n    const deletedFolderIds = updateListsForChat(chatId, currentFolderIds, newFolderIds);\n    deletedFolderIds.forEach((folderId) => {\n      affectedFolderIds.add(folderId);\n    });\n  });\n\n  prevGlobal.chatsById = newChatsById;\n  prevGlobal.usersById = newUsersById;\n  prevGlobal.lastAllMessageIds = newAllLastMessageIds;\n  prevGlobal.lastSavedMessageIds = newSavedLastMessageIds;\n  prevGlobal.notifySettings = newNotifySettings;\n  prevGlobal.notifyExceptions = newNotifyExceptions;\n\n  return Array.from(affectedFolderIds);\n}\n\nfunction buildChatSummary<T extends GlobalState>(\n  global: T,\n  chat: ApiChat,\n  notifySettings: NotifySettings,\n  notifyExceptions?: Record<number, NotifyException>,\n  user?: ApiUser,\n  isRemovedFromAll?: boolean,\n  isRemovedFromSaved?: boolean,\n): ChatSummary {\n  const {\n    id, type, isRestricted, isNotJoined, migratedTo, folderId,\n    unreadCount: chatUnreadCount, unreadMentionsCount: chatUnreadMentionsCount, hasUnreadMark,\n    isForum,\n  } = chat;\n  const topics = selectTopics(global, chat.id);\n\n  const { unreadCount, unreadMentionsCount } = isForum\n    ? Object.values(topics || {}).reduce((acc, topic) => {\n      acc.unreadCount += topic.unreadCount;\n      acc.unreadMentionsCount += topic.unreadMentionsCount;\n\n      return acc;\n    }, { unreadCount: 0, unreadMentionsCount: 0 })\n    : { unreadCount: chatUnreadCount, unreadMentionsCount: chatUnreadMentionsCount };\n\n  const userInfo = type === 'chatTypePrivate' && user;\n  const lastMessage = selectChatLastMessage(global, chat.id);\n  const shouldHideServiceChat = chat.id === SERVICE_NOTIFICATIONS_USER_ID && (\n    !lastMessage || lastMessage.content.action?.type === 'historyClear'\n  );\n\n  const orderInAll = Math.max(chat.creationDate || 0, chat.draftDate || 0, lastMessage?.date || 0);\n\n  const lastMessageInSaved = selectChatLastMessage(global, chat.id, 'saved');\n  const orderInSaved = lastMessageInSaved?.date || 0;\n\n  return {\n    id,\n    type,\n    isListedInAll: Boolean(!isRestricted && !isNotJoined && !migratedTo && !shouldHideServiceChat && !isRemovedFromAll),\n    isListedInSaved: !isRemovedFromSaved,\n    isArchived: folderId === ARCHIVED_FOLDER_ID,\n    isMuted: selectIsChatMuted(chat, notifySettings, notifyExceptions),\n    isUnread: Boolean(unreadCount || unreadMentionsCount || hasUnreadMark),\n    unreadCount,\n    unreadMentionsCount,\n    isUserBot: userInfo ? userInfo.type === 'userTypeBot' : undefined,\n    isUserContact: userInfo ? userInfo.isContact : undefined,\n    orderInAll,\n    orderInSaved,\n  };\n}\n\nfunction buildChatFolderIds(chatSummary: ChatSummary, folderSummaries: FolderSummary[]) {\n  return folderSummaries.reduce<number[]>((acc, folderSummary) => {\n    if (isChatInFolder(chatSummary, folderSummary)) {\n      acc.push(folderSummary.id);\n    }\n\n    return acc;\n  }, []).sort();\n}\n\nfunction isChatInFolder(\n  chatSummary: ChatSummary,\n  folderSummary: FolderSummary,\n) {\n  const isListed = folderSummary.id === SAVED_FOLDER_ID ? chatSummary.isListedInSaved : chatSummary.isListedInAll;\n  if (!isListed) {\n    return false;\n  }\n\n  const { id: chatId, type } = chatSummary;\n\n  if (folderSummary.listIds) {\n    if (\n      (chatSummary.isArchived && folderSummary.id === ALL_FOLDER_ID)\n      || (!chatSummary.isArchived && folderSummary.id === ARCHIVED_FOLDER_ID)\n    ) {\n      return false;\n    }\n\n    return folderSummary.listIds.has(chatId);\n  }\n\n  if (folderSummary.excludedChatIds?.has(chatId)) {\n    return false;\n  }\n\n  if (folderSummary.includedChatIds?.has(chatId)) {\n    return true;\n  }\n\n  if (folderSummary.pinnedChatIds?.has(chatId)) {\n    return true;\n  }\n\n  if (folderSummary.excludeArchived && chatSummary.isArchived) {\n    return false;\n  }\n\n  if (folderSummary.excludeRead && !chatSummary.isUnread) {\n    return false;\n  }\n\n  if (folderSummary.excludeMuted && chatSummary.isMuted && !chatSummary.unreadMentionsCount) {\n    return false;\n  }\n\n  if (type === 'chatTypePrivate') {\n    if (chatSummary.isUserBot) {\n      if (folderSummary.bots) {\n        return true;\n      }\n    } else {\n      if (folderSummary.contacts && chatSummary.isUserContact) {\n        return true;\n      }\n\n      if (folderSummary.nonContacts && !chatSummary.isUserContact) {\n        return true;\n      }\n    }\n  } else if (type === 'chatTypeChannel') {\n    return Boolean(folderSummary.channels);\n  } else if (type === 'chatTypeBasicGroup' || type === 'chatTypeSuperGroup') {\n    return Boolean(folderSummary.groups);\n  }\n\n  return false;\n}\n\nfunction updateListsForChat(chatId: string, currentFolderIds: number[], newFolderIds: number[]) {\n  const currentFolderIdsSet = new Set(currentFolderIds);\n  const newFolderIdsSet = new Set(newFolderIds);\n  const deletedFolderIds: number[] = [];\n\n  unique([...currentFolderIds, ...newFolderIds]).forEach((folderId) => {\n    let currentFolderOrderedIds = results.orderedIdsByFolderId[folderId];\n\n    if (currentFolderIdsSet.has(folderId) && !newFolderIdsSet.has(folderId)) {\n      prepared.chatIdsByFolderId[folderId]!.delete(chatId);\n\n      deletedFolderIds.push(folderId);\n\n      if (currentFolderOrderedIds) {\n        currentFolderOrderedIds = currentFolderOrderedIds.filter((id) => id !== chatId);\n        prepared.isOrderedListJustPatched[folderId] = true;\n      }\n    } else if (!currentFolderIdsSet.has(folderId) && newFolderIdsSet.has(folderId)) {\n      if (!prepared.chatIdsByFolderId[folderId]) {\n        prepared.chatIdsByFolderId[folderId] = new Set();\n      }\n\n      prepared.chatIdsByFolderId[folderId]!.add(chatId);\n\n      if (currentFolderOrderedIds) {\n        currentFolderOrderedIds.push(chatId);\n        prepared.isOrderedListJustPatched[folderId] = true;\n      }\n    }\n\n    results.orderedIdsByFolderId[folderId] = currentFolderOrderedIds;\n  });\n\n  prepared.folderIdsByChatId[chatId] = newFolderIds;\n\n  return deletedFolderIds;\n}\n\nfunction updateResults(affectedFolderIds: number[]) {\n  let wasUnreadCountersChanged = false;\n  let wasChatsCountChanged = false;\n\n  Array.from(affectedFolderIds).forEach((folderId) => {\n    const { pinnedCount: newPinnedCount, orderedIds: newOrderedIds } = buildFolderOrderedIds(folderId);\n    // When signed out\n    if (!newOrderedIds) {\n      return;\n    }\n\n    const currentOrderedIds = results.orderedIdsByFolderId[folderId];\n    const currentPinnedCount = results.pinnedCountByFolderId[folderId];\n    const areOrderedIdsChanged = (\n      !currentOrderedIds\n      || currentPinnedCount === undefined || currentPinnedCount !== newPinnedCount\n      || prepared.isOrderedListJustPatched[folderId]\n      || !areSortedArraysEqual(newOrderedIds, currentOrderedIds)\n    );\n    if (areOrderedIdsChanged) {\n      prepared.isOrderedListJustPatched[folderId] = false;\n      results.orderedIdsByFolderId[folderId] = newOrderedIds;\n      results.pinnedCountByFolderId[folderId] = newPinnedCount;\n      callbacks.orderedIdsByFolderId[folderId]?.runCallbacks(newOrderedIds);\n    }\n\n    const currentChatsCount = results.chatsCountByFolderId[folderId];\n    const newChatsCount = newOrderedIds.length;\n    if (!wasChatsCountChanged) {\n      wasChatsCountChanged = currentChatsCount !== newChatsCount;\n    }\n    results.chatsCountByFolderId[folderId] = newChatsCount;\n\n    const currentUnreadCounters = results.unreadCountersByFolderId[folderId];\n    const newUnreadCounters = buildFolderUnreadCounters(folderId);\n    if (!wasUnreadCountersChanged) {\n      wasUnreadCountersChanged = (\n        !currentUnreadCounters || !arePropsShallowEqual(newUnreadCounters, currentUnreadCounters)\n      );\n    }\n    results.unreadCountersByFolderId[folderId] = newUnreadCounters;\n  });\n\n  if (wasChatsCountChanged) {\n    // We need to update the entire object as it will be returned from a hook\n    const newValue = { ...results.chatsCountByFolderId };\n    results.chatsCountByFolderId = newValue;\n    callbacks.chatsCountByFolderId.runCallbacks(newValue);\n  }\n\n  if (wasUnreadCountersChanged) {\n    // We need to update the entire object as it will be returned from a hook\n    const newValue = { ...results.unreadCountersByFolderId };\n    results.unreadCountersByFolderId = newValue;\n    callbacks.unreadCountersByFolderId.runCallbacks(newValue);\n  }\n}\n\nfunction buildFolderOrderedIds(folderId: number) {\n  const folderSummary = prepared.folderSummariesById[folderId];\n  if (!folderSummary) {\n    return {};\n  }\n\n  const { orderedPinnedIds, pinnedChatIds } = folderSummary;\n  const {\n    chatIdsByFolderId: { [folderId]: chatIds },\n  } = prepared;\n  const {\n    orderedIdsByFolderId: { [folderId]: prevOrderedIds },\n  } = results;\n\n  const isSavedFolder = folderId === SAVED_FOLDER_ID;\n\n  const sortedPinnedIds = chatIds ? orderedPinnedIds?.filter((id) => chatIds.has(id)) : orderedPinnedIds;\n  const allListIds = prevOrderedIds || (chatIds && Array.from(chatIds)) || [];\n  const notPinnedIds = pinnedChatIds ? allListIds.filter((id) => !pinnedChatIds.has(id)) : allListIds;\n  const sortedNotPinnedIds = notPinnedIds.sort((chatId1: string, chatId2: string) => {\n    return getOrderKey(chatId2, isSavedFolder) - getOrderKey(chatId1, isSavedFolder);\n  });\n\n  return {\n    pinnedCount: sortedPinnedIds?.length || 0,\n    orderedIds: [\n      ...(sortedPinnedIds || []),\n      ...sortedNotPinnedIds,\n    ],\n  };\n}\n\nfunction buildFolderUnreadCounters(folderId: number) {\n  const {\n    chatSummariesById,\n  } = prepared;\n  const {\n    orderedIdsByFolderId: { [folderId]: orderedIds },\n  } = results;\n\n  return orderedIds!.reduce((newUnreadCounters, chatId) => {\n    const chatSummary = chatSummariesById.get(chatId);\n    if (!chatSummary) {\n      return newUnreadCounters;\n    }\n\n    if (chatSummary.isUnread) {\n      newUnreadCounters.chatsCount++;\n\n      if (chatSummary.unreadMentionsCount) {\n        newUnreadCounters.notificationsCount += chatSummary.unreadMentionsCount;\n      }\n\n      if (!chatSummary.isMuted) {\n        if (chatSummary.unreadCount) {\n          newUnreadCounters.notificationsCount += chatSummary.unreadCount;\n        } else if (!chatSummary.unreadMentionsCount) {\n          newUnreadCounters.notificationsCount += 1; // Manually marked unread\n        }\n      }\n    }\n\n    return newUnreadCounters;\n  }, {\n    chatsCount: 0,\n    notificationsCount: 0,\n  });\n}\n\nfunction buildInitials() {\n  return {\n    prevGlobal: {\n      foldersById: {},\n      chatsById: {},\n      usersById: {},\n      topicsInfoById: {},\n      notifySettings: {} as NotifySettings,\n      notifyExceptions: {},\n    },\n\n    prepared: {\n      folderSummariesById: {},\n      chatSummariesById: new Map(),\n      folderIdsByChatId: {},\n      chatIdsByFolderId: {},\n      isOrderedListJustPatched: {},\n    },\n\n    results: {\n      orderedIdsByFolderId: {},\n      pinnedCountByFolderId: {},\n      chatsCountByFolderId: {},\n      unreadCountersByFolderId: {},\n    },\n\n    callbacks: {\n      orderedIdsByFolderId: {},\n      chatsCountByFolderId: createCallbackManager(),\n      unreadCountersByFolderId: createCallbackManager(),\n    },\n  };\n}\n\nfunction reset() {\n  const newInitials = buildInitials();\n\n  prevGlobal = newInitials.prevGlobal;\n  prepared = newInitials.prepared;\n  results = newInitials.results;\n  callbacks = newInitials.callbacks;\n}\n","// Used before applying CSS transition\nexport default function forceReflow(element: HTMLElement) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n  element.offsetWidth;\n}\n","import React, { type TeactNode } from '../lib/teact/teact';\n\nimport { STARS_CURRENCY_CODE } from '../config';\n\nimport StarIcon from '../components/common/icons/StarIcon';\n\nexport function formatCurrency(\n  totalPrice: number,\n  currency: string,\n  locale: string = 'en',\n  options?: {\n    shouldOmitFractions?: boolean;\n    iconClassName?: string;\n  },\n): TeactNode {\n  const price = totalPrice / 10 ** getCurrencyExp(currency);\n\n  if (currency === STARS_CURRENCY_CODE) {\n    return [<StarIcon className={options?.iconClassName} type=\"gold\" size=\"adaptive\" />, price];\n  }\n\n  return formatCurrencyAsString(totalPrice, currency, locale, options);\n}\n\nexport function formatCurrencyAsString(\n  totalPrice: number,\n  currency: string,\n  locale: string = 'en',\n  options?: {\n    shouldOmitFractions?: boolean;\n  },\n) {\n  const price = totalPrice / 10 ** getCurrencyExp(currency);\n\n  if ((options?.shouldOmitFractions || currency === STARS_CURRENCY_CODE) && Number.isInteger(price)) {\n    return new Intl.NumberFormat(locale, {\n      style: 'currency',\n      currency,\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(price);\n  }\n\n  return new Intl.NumberFormat(locale, {\n    style: 'currency',\n    currency,\n  }).format(price);\n}\n\nfunction getCurrencyExp(currency: string) {\n  if (currency === 'TON') {\n    return 9;\n  }\n  if (currency === 'CLF') {\n    return 4;\n  }\n  if (['BHD', 'IQD', 'JOD', 'KWD', 'LYD', 'OMR', 'TND'].includes(currency)) {\n    return 3;\n  }\n  if ([\n    'BIF', 'BYR', 'CLP', 'CVE', 'DJF', 'GNF', 'ISK', 'JPY', 'KMF', 'KRW', 'MGA', 'PYG', 'RWF', 'UGX', 'UYI',\n    'VND', 'VUV', 'XAF', 'XOF', 'XPF', STARS_CURRENCY_CODE,\n  ].includes(currency)) {\n    return 0;\n  }\n  if (currency === 'MRO') {\n    return 1;\n  }\n  return 2;\n}\n","import blue from '../assets/icons/forumTopic/blue.svg';\nimport green from '../assets/icons/forumTopic/green.svg';\nimport grey from '../assets/icons/forumTopic/grey.svg';\nimport red from '../assets/icons/forumTopic/red.svg';\nimport rose from '../assets/icons/forumTopic/rose.svg';\nimport violet from '../assets/icons/forumTopic/violet.svg';\nimport yellow from '../assets/icons/forumTopic/yellow.svg';\n\n// eslint-disable-next-line max-len\n// https://github.com/telegramdesktop/tdesktop/blob/1aece79a471d99a8b63d826b1bce1f36a04d7293/Telegram/SourceFiles/data/data_forum_topic.cpp#L50\nconst TOPIC_MAPPING: Record<number, [string, string]> = {\n  0x6FB9F0: [blue, 'blue'],\n  0xFFD67E: [yellow, 'yellow'],\n  0xCB86DB: [violet, 'violet'],\n  0x8EEE98: [green, 'green'],\n  0xFF93B2: [rose, 'rose'],\n  0xFB6F5F: [red, 'red'],\n};\n\nexport function getTopicColors() {\n  return Object.keys(TOPIC_MAPPING).map((key) => parseInt(key, 10));\n}\n\nexport function getTopicDefaultIcon(iconColor?: number) {\n  return (iconColor && TOPIC_MAPPING[iconColor as keyof typeof TOPIC_MAPPING][0]) || grey;\n}\n\nexport function getTopicColorCssVariable(iconColor?: number) {\n  const color = (iconColor && TOPIC_MAPPING[iconColor as keyof typeof TOPIC_MAPPING][1]) || 'grey';\n  return `--color-topic-${color}`;\n}\n","export default function generateUniqueId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n","import type { ApiError, ApiFieldError } from '../api/types';\n\nimport { DEBUG } from '../config';\n\nconst READABLE_ERROR_MESSAGES: Record<string, string> = {\n  CHAT_RESTRICTED: 'You can\\'t send messages in this chat, you were restricted',\n  CHAT_SEND_POLL_FORBIDDEN: 'You can\\'t create polls in this chat',\n  CHAT_SEND_STICKERS_FORBIDDEN: 'You can\\'t send stickers in this chat',\n  CHAT_SEND_GIFS_FORBIDDEN: 'You can\\'t send gifs in this chat',\n  CHAT_SEND_MEDIA_FORBIDDEN: 'You can\\'t send media in this chat',\n  CHAT_LINK_EXISTS: 'The chat is public, you can\\'t hide the history to new users',\n  // eslint-disable-next-line max-len\n  SLOWMODE_WAIT_X: 'Slowmode is enabled in this chat: you must wait for the specified number of seconds before sending another message to the chat.',\n  USER_BANNED_IN_CHANNEL: 'You\\'re banned from sending messages in supergroups / channels',\n  USER_IS_BLOCKED: 'You were blocked by this user',\n  YOU_BLOCKED_USER: 'You blocked this user',\n  IMAGE_PROCESS_FAILED: 'Failure while processing image',\n  MEDIA_EMPTY: 'The provided media object is invalid',\n  MEDIA_GROUPED_INVALID: 'Failed to replace album media',\n  MEDIA_NEW_INVALID: 'Failed to replace new media',\n  MESSAGE_NOT_MODIFIED: 'Message not modified. The new content is identical to the current one.',\n  MEDIA_INVALID: 'Media invalid',\n  PASSWORD_HASH_INVALID: 'Incorrect password',\n  PHOTO_EXT_INVALID: 'The extension of the photo is invalid',\n  PHOTO_INVALID_DIMENSIONS: 'The photo dimensions are invalid',\n  PHOTO_SAVE_FILE_INVALID: 'Internal issues, try again later',\n  // eslint-disable-next-line max-len\n  MESSAGE_DELETE_FORBIDDEN: 'You can\\'t delete one of the messages you tried to delete, most likely because it is a service message.',\n  MESSAGE_POLL_CLOSED: 'Poll closed',\n  MESSAGE_EDIT_TIME_EXPIRED: 'You can\\'t edit this message anymore.',\n  PINNED_DIALOGS_TOO_MUCH: 'Sorry, you can only pin 5 chats to the top',\n  CHANNEL_PRIVATE: 'This channel is private',\n  MEDIA_CAPTION_TOO_LONG: 'The provided caption is too long',\n  ADDRESS_STREET_LINE1_INVALID: 'The address you provided is not valid',\n  ADDRESS_STREET_LINE2_INVALID: 'The address you provided is not valid',\n  ADDRESS_CITY_INVALID: 'The city you provided is not valid',\n  ADDRESS_COUNTRY_INVALID: 'The country you provided is not valid',\n  ADDRESS_POSTCODE_INVALID: 'The postcode you provided is not valid',\n  ADDRESS_STATE_INVALID: 'The state you provided is not valid',\n  REQ_INFO_NAME_INVALID: 'The name you provided is not valid',\n  REQ_INFO_PHONE_INVALID: 'The phone you provided is not valid',\n  REQ_INFO_EMAIL_INVALID: 'The email you provided is not valid',\n  // TODO Bring back after fixing the weird bug\n  // CHANNEL_INVALID: 'An error occurred. Please try again later',\n  LINK_NOT_MODIFIED: 'This discussion is already linked to the channel',\n  MESSAGE_TOO_LONG: 'Message is too long',\n\n  // Non-API errors\n  // eslint-disable-next-line max-len\n  SERVICE_WORKER_DISABLED: 'Service Worker is disabled. Streaming media may not be supported. Try reloading the page without holding <Shift> key',\n  // eslint-disable-next-line max-len\n  MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS: 'The provided message is too long. Please remove {EXTRA_CHARS_COUNT} character{PLURAL_S}.',\n  // eslint-disable-next-line max-len\n  FRESH_RESET_AUTHORISATION_FORBIDDEN: 'You can’t logout other sessions if less than 24 hours have passed since you logged on the current session',\n\n  BOTS_TOO_MUCH: 'There are too many bots in this chat/channel',\n  BOT_GROUPS_BLOCKED: 'This bot can\\'t be added to groups',\n  USERS_TOO_MUCH: 'The maximum number of users has been exceeded',\n  USER_CHANNELS_TOO_MUCH: 'One of the users you tried to add is already in too many channels/supergroups',\n  USER_KICKED: 'This user was kicked from this supergroup/channel',\n  USER_NOT_MUTUAL_CONTACT: 'The provided user is not a mutual contact',\n  USER_PRIVACY_RESTRICTED: 'The user\\'s privacy settings do not allow you to do this',\n  INVITE_HASH_EMPTY: 'The invite hash is empty',\n  INVITE_HASH_EXPIRED: 'The invite link has expired',\n  INVITE_HASH_INVALID: 'The invite hash is invalid',\n  CHANNELS_TOO_MUCH: 'You have joined too many channels/supergroups',\n  USER_ALREADY_PARTICIPANT: 'You already in the group',\n  SCHEDULE_DATE_INVALID: 'Invalid schedule date provided',\n  WALLPAPER_DIMENSIONS_INVALID: 'The wallpaper dimensions are invalid, please select another file',\n  ADMINS_TOO_MUCH: 'There are too many admins',\n  ADMIN_RANK_EMOJI_NOT_ALLOWED: 'An admin rank cannot contain emojis',\n  ADMIN_RANK_INVALID: 'The specified admin rank is invalid',\n  FRESH_CHANGE_ADMINS_FORBIDDEN: 'You were just elected admin, you can\\'t add or modify other admins yet',\n  INPUT_USER_DEACTIVATED: 'Can\\'t do this action to a deleted account',\n  BOT_PRECHECKOUT_TIMEOUT: 'The request for payment has expired',\n  PROVIDER_ACCOUNT_TIMEOUT: 'Request to the payment provider has expired',\n\n  STARGIFT_CONVERT_TOO_OLD: 'This gift no longer can be converted to Stars',\n  SUBSCRIPTION_ALREADY_ACTIVE: 'You are already subscribed',\n\n  PEERS_LIST_EMPTY: 'No chats are added to the list',\n\n  PAID_MEDIA_FORBIDDEN: 'You can\\'t send paid media in this chat',\n};\n\nif (DEBUG) {\n  READABLE_ERROR_MESSAGES.CHAT_WRITE_FORBIDDEN = 'You can\\'t write in this chat';\n  READABLE_ERROR_MESSAGES.CHAT_ADMIN_REQUIRED = 'You must be an admin in this chat to do this';\n}\n\nexport const SHIPPING_ERRORS: Record<string, ApiFieldError> = {\n  ADDRESS_STREET_LINE1_INVALID: {\n    field: 'streetLine1',\n    message: 'Incorrect street address',\n  },\n  ADDRESS_STREET_LINE2_INVALID: {\n    field: 'streetLine2',\n    message: 'Incorrect street address',\n  },\n  ADDRESS_CITY_INVALID: {\n    field: 'city',\n    message: 'Incorrect city',\n  },\n  ADDRESS_COUNTRY_INVALID: {\n    field: 'countryIso2',\n    message: 'Incorrect country',\n  },\n  ADDRESS_POSTCODE_INVALID: {\n    field: 'postCode',\n    message: 'Incorrect post code',\n  },\n  ADDRESS_STATE_INVALID: {\n    field: 'state',\n    message: 'Incorrect state',\n  },\n  REQ_INFO_NAME_INVALID: {\n    field: 'fullName',\n    message: 'Incorrect name',\n  },\n  REQ_INFO_PHONE_INVALID: {\n    field: 'phone',\n    message: 'Incorrect phone',\n  },\n  REQ_INFO_EMAIL_INVALID: {\n    field: 'email',\n    message: 'Incorrect email',\n  },\n};\n\nconst FINAL_PAYMENT_ERRORS = new Set([\n  'BOT_PRECHECKOUT_FAILED',\n  'PAYMENT_FAILED',\n]);\n\nexport default function getReadableErrorText(error: ApiError) {\n  const { message, isSlowMode, textParams } = error;\n  // Currently, Telegram API doesn't return `SLOWMODE_WAIT_X` error as described in the docs\n  if (isSlowMode) {\n    const extraPartIndex = message.indexOf(' (caused by');\n    return extraPartIndex > 0 ? message.substring(0, extraPartIndex) : message;\n  }\n  let errorMessage = READABLE_ERROR_MESSAGES[message];\n  if (errorMessage && textParams) {\n    errorMessage = Object.keys(textParams).reduce((acc, current) => {\n      return acc.replace(current, textParams[current]);\n    }, errorMessage as string);\n  }\n  return errorMessage;\n}\n\nexport function getShippingError(error: ApiError): ApiFieldError | undefined {\n  return SHIPPING_ERRORS[error.message];\n}\n\nexport function shouldClosePaymentModal(error: ApiError): boolean {\n  return FINAL_PAYMENT_ERRORS.has(error.message);\n}\n","import { DEBUG, DEBUG_ALERT_MSG } from '../config';\nimport { isCurrentTabMaster } from './establishMultitabRole';\nimport { throttle } from './schedulers';\n\nlet showError = true;\nlet error: Error | undefined;\n\nwindow.addEventListener('error', handleErrorEvent);\nwindow.addEventListener('unhandledrejection', handleErrorEvent);\n\nif (DEBUG) {\n  window.addEventListener('focus', () => {\n    if (!isCurrentTabMaster()) {\n      return;\n    }\n    showError = true;\n    if (error) {\n      // eslint-disable-next-line no-alert\n      window.alert(getErrorMessage(error));\n      error = undefined;\n    }\n  });\n  window.addEventListener('blur', () => {\n    if (!isCurrentTabMaster()) {\n      return;\n    }\n    showError = false;\n  });\n}\n\nconst throttleError = throttle((err) => {\n  if (showError) {\n    // eslint-disable-next-line no-alert\n    window.alert(getErrorMessage(err));\n  } else {\n    error = err;\n  }\n}, 1500);\n\nexport function handleError(err: Error) {\n  // eslint-disable-next-line no-console\n  console.error(err);\n  if (DEBUG) {\n    throttleError(err);\n  }\n}\n\nfunction handleErrorEvent(e: ErrorEvent | PromiseRejectionEvent) {\n  // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n  if (e instanceof ErrorEvent && e.message === 'ResizeObserver loop limit exceeded') {\n    return;\n  }\n\n  e.preventDefault();\n  handleError(e instanceof ErrorEvent ? (e.error || e.message) : e.reason);\n}\n\nfunction getErrorMessage(err: Error) {\n  return `${DEBUG_ALERT_MSG}\\n\\n${(err?.message) || err}\\n${err?.stack}`;\n}\n","import { getActions } from '../global';\n\nlet promptInstall: () => Promise<void>;\n\nexport function setupBeforeInstallPrompt() {\n  window.addEventListener('beforeinstallprompt', (e: any) => {\n    promptInstall = async () => {\n      e.prompt();\n      const userChoice = await e.userChoice;\n      const isInstalled = userChoice.outcome === 'accepted';\n\n      if (!isInstalled) return;\n      getActions().setInstallPrompt({ canInstall: false });\n    };\n    getActions().setInstallPrompt({ canInstall: true });\n  });\n}\n\nexport function getPromptInstall() {\n  return promptInstall;\n}\n","type CollectionByKey<Member> = Record<number | string, Member>;\n\ntype OrderDirection =\n  'asc'\n  | 'desc';\n\ninterface OrderCallback<T> {\n  (member: T): any;\n}\n\nexport function buildCollectionByKey<T extends AnyLiteral>(collection: T[], key: keyof T) {\n  return collection.reduce((byKey: CollectionByKey<T>, member: T) => {\n    byKey[member[key]] = member;\n\n    return byKey;\n  }, {});\n}\n\nexport function buildCollectionByCallback<T extends AnyLiteral, K extends number | string, R extends unknown>(\n  collection: T[],\n  callback: (member: T) => [K, R],\n) {\n  return collection.reduce((byKey: Record<K, R>, member: T) => {\n    const [key, value] = callback(member);\n    byKey[key] = value;\n\n    return byKey;\n  }, {} as Record<K, R>);\n}\n\nexport function mapValues<R extends any, M extends any>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => R,\n): CollectionByKey<R> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<R>, key, index) => {\n    newByKey[key] = callback(byKey[key], key, index, byKey);\n    return newByKey;\n  }, {});\n}\n\nexport function pick<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    result[key] = object[key];\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function pickTruthy<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    if (object[key]) {\n      result[key] = object[key];\n    }\n\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function omit<T extends object, K extends keyof T>(object: T, keys: K[]): Omit<T, K> {\n  const stringKeys = new Set(keys.map(String));\n  const savedKeys = Object.keys(object)\n    .filter((key) => !stringKeys.has(key)) as Array<Exclude<keyof T, K>>;\n\n  return pick(object, savedKeys);\n}\n\nexport function omitUndefined<T extends object>(object: T): T {\n  return Object.keys(object).reduce((result, stringKey) => {\n    const key = stringKey as keyof T;\n    if (object[key] !== undefined) {\n      result[key as keyof T] = object[key];\n    }\n    return result;\n  }, {} as T);\n}\n\nexport function orderBy<T>(\n  collection: T[],\n  orderRule: (keyof T) | OrderCallback<T> | ((keyof T) | OrderCallback<T>)[],\n  mode: OrderDirection | [OrderDirection, OrderDirection] = 'asc',\n): T[] {\n  function compareValues(a: T, b: T, currentOrderRule: (keyof T) | OrderCallback<T>, isAsc: boolean) {\n    const aValue = (typeof currentOrderRule === 'function' ? currentOrderRule(a) : a[currentOrderRule]) || 0;\n    const bValue = (typeof currentOrderRule === 'function' ? currentOrderRule(b) : b[currentOrderRule]) || 0;\n\n    return isAsc ? aValue - bValue : bValue - aValue;\n  }\n\n  if (Array.isArray(orderRule)) {\n    const [mode1, mode2] = Array.isArray(mode) ? mode : [mode, mode];\n    const [orderRule1, orderRule2] = orderRule;\n    const isAsc1 = mode1 === 'asc';\n    const isAsc2 = mode2 === 'asc';\n\n    return collection.sort((a, b) => {\n      return compareValues(a, b, orderRule1, isAsc1) || compareValues(a, b, orderRule2, isAsc2);\n    });\n  }\n\n  const isAsc = mode === 'asc';\n  return collection.sort((a, b) => {\n    return compareValues(a, b, orderRule, isAsc);\n  });\n}\n\nexport function unique<T extends any>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport function uniqueByField<T extends any>(array: T[], field: keyof T): T[] {\n  return [...new Map(array.map((item) => [item[field], item])).values()];\n}\n\nexport function compact<T extends any>(array: T[]) {\n  return array.filter(Boolean);\n}\n\nexport function areSortedArraysEqual(array1: any[], array2: any[]) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => item === array2[i]);\n}\n\nexport function areSortedArraysIntersecting(array1: any[], array2: any[]) {\n  return array1[0] <= array2[array2.length - 1] && array1[array1.length - 1] >= array2[0];\n}\nexport function isInsideSortedArrayRange(value:any, array: any[]) {\n  return array[0] <= value && value <= array[array.length - 1];\n}\n\nexport function findIntersectionWithSet<T>(array: T[], set: Set<T>): T[] {\n  return array.filter((a) => set.has(a));\n}\n/**\n * Exlude elements from base array. Both arrays should be sorted in same order\n * @param base\n * @param toExclude\n * @returns New array without excluded elements\n */\nexport function excludeSortedArray<T extends any>(base: T[], toExclude: T[]) {\n  if (!base?.length) return base;\n\n  const result: T[] = [];\n\n  let excludeIndex = 0;\n\n  for (let i = 0; i < base.length; i++) {\n    if (toExclude[excludeIndex] === base[i]) {\n      excludeIndex += 1;\n    } else {\n      result.push(base[i]);\n    }\n  }\n\n  return result;\n}\n\nexport function split<T extends any>(array: T[], chunkSize: number) {\n  const result: T[][] = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    result.push(array.slice(i, i + chunkSize));\n  }\n\n  return result;\n}\n\nexport function partition<T extends unknown>(\n  array: T[], filter: (value: T, index: number, array: T[]) => boolean | undefined,\n): [T[], T[]] {\n  const pass: T[] = [];\n  const fail: T[] = [];\n\n  array.forEach((e, idx, arr) => (filter(e, idx, arr) ? pass : fail).push(e));\n\n  return [pass, fail];\n}\n\nexport function cloneDeep<T>(value: T): T {\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(cloneDeep) as typeof value;\n  }\n\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key as keyof T] = cloneDeep(value[key as keyof T]);\n    return acc;\n  }, {} as T);\n}\n\nexport function isLiteralObject(value: any): value is AnyLiteral {\n  return isObject(value) && !Array.isArray(value);\n}\n\nfunction isObject(value: any): value is object {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null;\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T, index: number, obj: T[]) => boolean): T | undefined {\n  let cursor = array.length;\n\n  while (cursor--) {\n    if (predicate(array[cursor], cursor, array)) {\n      return array[cursor];\n    }\n  }\n\n  return undefined;\n}\n\nexport function compareFields<T>(a: T, b: T) {\n  return Number(b) - Number(a);\n}\n","import type { ApiMessage, ApiSponsoredMessage } from '../../api/types';\n\nexport type MessageKey = `msg${string}-${number}`;\n\nexport function getMessageKey(message: ApiMessage | ApiSponsoredMessage): MessageKey {\n  const {\n    chatId,\n  } = message;\n\n  if ('randomId' in message) {\n    return buildMessageKey(chatId, Number(message.randomId));\n  }\n  return buildMessageKey(chatId, message.previousLocalId || message.id);\n}\n\nexport function getMessageServerKey(message: ApiMessage): MessageKey | undefined {\n  if (isLocalMessageId(message.id)) {\n    return undefined;\n  }\n  const { chatId, id } = message;\n  return buildMessageKey(chatId, id);\n}\n\nexport function buildMessageKey(chatId: string, msgId: number): MessageKey {\n  return `msg${chatId}-${msgId}`;\n}\n\nexport function parseMessageKey(key: MessageKey) {\n  const match = key.match(/^msg(-?\\d+)-(\\d+)/)!;\n\n  return { chatId: match[1], messageId: Number(match[2]) };\n}\n\nexport function isLocalMessageId(id: number) {\n  return !Number.isInteger(id);\n}\n","import type { ApiMessage } from '../../api/types';\n\nexport type SearchResultKey = `${string}_${number}`;\n\nexport function getSearchResultKey(message: ApiMessage): SearchResultKey {\n  const { chatId, id } = message;\n\n  return `${chatId}_${id}`;\n}\n\nexport function parseSearchResultKey(key: SearchResultKey) {\n  const [chatId, messageId] = key.split('_');\n\n  return [chatId, Number(messageId)] as const;\n}\n","import { DEBUG } from '../../config';\n\nexport default function readStrings(data: string): Record<string, string> {\n  const lines = data.split(/;\\r?\\n?/);\n  const result: Record<string, string> = {};\n  for (const line of lines) {\n    if (!line.startsWith('\"')) continue;\n    const [key, value] = parseLine(line) || [];\n    if (!key || !value) {\n      // eslint-disable-next-line no-console\n      console.warn('Bad formatting in line:', line);\n      continue;\n    }\n    result[key] = value;\n  }\n  return result;\n}\n\nfunction parseLine(line: string) {\n  let isEscaped = false;\n  let isInsideString = false;\n\n  let separatorIndex;\n  for (let i = 0; i < line.length; i++) {\n    const char = line[i];\n    if (char === '\\\\') {\n      isEscaped = !isEscaped;\n      continue;\n    }\n\n    if (char === '\"' && !isEscaped) {\n      isInsideString = !isInsideString;\n      continue;\n    }\n\n    if (char === '=' && !isInsideString) {\n      separatorIndex = i;\n      break;\n    }\n\n    isEscaped = false;\n  }\n\n  if (separatorIndex === undefined || separatorIndex === line.length - 1) return undefined;\n\n  try {\n    const key = JSON.parse(line.slice(0, separatorIndex));\n    const value = JSON.parse(line.slice(separatorIndex + 1));\n\n    return [key, value];\n  } catch (e) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Error parsing line:', line, e);\n    }\n  }\n\n  return undefined;\n}\n","import type {\n  ApiLanguage, CachedLangData, LangPack, LangPackStringValuePlural,\n} from '../../api/types';\n\nimport readStrings from './readStrings';\n\nconst FALLBACK_LANG_CODE = 'en';\nconst FALLBACK_VERSION = 0;\nconst FALLBACK_TRANSLATE_URL = 'https://translations.telegram.org/en/weba';\n\nexport default async function readFallbackStrings(forLocalScript?: boolean): Promise<CachedLangData> {\n  let fileData;\n  if (forLocalScript) {\n    fileData = (await import('fs')).readFileSync('./src/assets/localization/fallback.strings', 'utf8');\n  } else {\n    const file = await import('../../assets/localization/fallback.strings');\n    fileData = file.default;\n  }\n  const rawStrings = readStrings(fileData);\n\n  const strings: LangPack['strings'] = {};\n\n  Object.entries(rawStrings).forEach(([key, value]) => {\n    const [clearKey, pluralSuffix] = key.split('_');\n\n    if (!pluralSuffix) {\n      strings[clearKey] = value;\n      return;\n    }\n\n    const knownValue = (strings[clearKey] || {}) as LangPackStringValuePlural;\n    knownValue[pluralSuffix as keyof LangPackStringValuePlural] = value;\n    strings[clearKey] = knownValue;\n  });\n\n  const langPack: LangPack = {\n    langCode: FALLBACK_LANG_CODE,\n    version: FALLBACK_VERSION,\n    strings,\n  };\n\n  const stringsCount = Object.keys(strings).length;\n\n  const language: ApiLanguage = {\n    langCode: FALLBACK_LANG_CODE,\n    name: 'English',\n    nativeName: 'English',\n    pluralCode: FALLBACK_LANG_CODE,\n    stringsCount,\n    translatedCount: stringsCount,\n    translationsUrl: FALLBACK_TRANSLATE_URL,\n  };\n\n  return {\n    langPack,\n    language,\n  };\n}\n","/* eslint-disable */\n// This file is generated by dev/generateInitialLangFallback.ts. Do not edit it manually.\n\nimport type { LangPackStringValue } from '../../api/types';\nimport type { LangKey } from '../../types/language';\n\nexport default {\n  \"WrongNumber\": \"Wrong number?\",\n  \"SentAppCode\": \"We've sent the code to the **Telegram** app on your other device.\",\n  \"LoginJustSentSms\": \"We've sent you a code via SMS. Please enter it above.\",\n  \"LoginHeaderPassword\": \"Enter Password\",\n  \"LoginEnterPasswordDescription\": \"You have Two-Step Verification enabled, so your account is protected with an additional password.\",\n  \"StartText\": \"Please confirm your country code\\nand enter your phone number.\",\n  \"LoginPhonePlaceholder\": \"Your phone number\",\n  \"LoginNext\": \"Next\",\n  \"LoginQRLogin\": \"Log in by QR Code\",\n  \"LoginQRTitle\": \"Log in to Telegram by QR Code\",\n  \"LoginQRHelp1\": \"Open Telegram on your phone\",\n  \"LoginQRHelp2\": \"Go to **Settings** > **Devices** > **Link Desktop Device**\",\n  \"LoginQRHelp3\": \"Point your phone at this screen to confirm login\",\n  \"LoginQRCancel\": \"Log in by phone Number\",\n  \"YourName\": \"Your Name\",\n  \"LoginRegisterDesc\": \"Enter your name and add a profile photo.\",\n  \"LoginRegisterFirstNamePlaceholder\": \"First Name\",\n  \"LoginRegisterLastNamePlaceholder\": \"Last Name\",\n  \"LoginSelectCountryTitle\": \"Country\",\n  \"CountryNone\": \"Country not found\",\n  \"PleaseEnterPassword\": \"Enter your new password\",\n  \"ErrorPhoneNumberInvalid\": \"Invalid phone number, please try again\",\n  \"ErrorCodeInvalid\": \"Invalid code, please try again\",\n  \"ErrorIncorrectPassword\": \"Invalid password, please try again\",\n  \"ErrorPasswordFlood\": \"Too many attempts, please try again later\",\n  \"ErrorPhoneBanned\": \"This phone number is banned\",\n  \"ErrorFloodTime\": \"Too many attempts, please try again in {time}\",\n  \"ErrorUnexpected\": \"Unexpected error\",\n  \"ErrorUnexpectedMessage\": \"Unexpected error: {error}\"\n} as Record<LangKey, LangPackStringValue>;\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiLanguage,\n  CachedLangData,\n  LangPack,\n  LangPackStringValue,\n} from '../../api/types';\nimport type { LangKey, LangVariable } from '../../types/language';\nimport {\n  type AdvancedLangFnOptions,\n  type AdvancedLangFnOptionsWithPlural,\n  type AdvancedLangFnParameters,\n  areAdvancedLangFnOptions,\n  isDeletedLangString,\n  isPluralLangString,\n  type LangFn,\n  type LangFnOptions,\n  type LangFnOptionsWithPlural,\n  type LangFnParameters,\n  type LangFormatters,\n  type RegularLangFnParameters,\n} from './types';\n\nimport { DEBUG, LANG_PACK } from '../../config';\nimport { callApi } from '../../api/gramjs';\nimport renderText, { type TextFilter } from '../../components/common/helpers/renderText';\nimport { MAIN_IDB_STORE } from '../browser/idb';\nimport { getBasicListFormat } from '../browser/intlListFormat';\nimport { createCallbackManager } from '../callbacks';\nimport readFallbackStrings from '../data/readFallbackStrings';\nimport { initialEstablishmentPromise, isCurrentTabMaster } from '../establishMultitabRole';\nimport { omit, unique } from '../iteratees';\nimport { notifyLangpackUpdate } from '../multitab';\nimport { replaceInStringsWithTeact } from '../replaceWithTeact';\nimport { fastRaf } from '../schedulers';\nimport { IS_INTL_LIST_FORMAT_SUPPORTED, IS_MULTITAB_SUPPORTED } from '../windowEnvironment';\n\nimport Deferred from '../Deferred';\nimport LimitedMap from '../primitives/LimitedMap';\n\nimport initialStrings from '../../assets/localization/initialStrings';\n\nconst LANGPACK_STORE_PREFIX = 'langpack-';\nconst FORMATTERS_FALLBACK_LANG = 'en';\n\nconst STRING_CACHE_LIMIT = 400;\nconst TRANSLATION_CACHE = new LimitedMap<string, string>(STRING_CACHE_LIMIT);\n\nlet language: ApiLanguage | undefined;\nlet formatters: LangFormatters | undefined;\n\nlet langPack: LangPack | undefined;\nlet fallbackLangPack: LangPack | undefined;\n\nlet translationFn = createTranslationFn();\n\nconst {\n  addCallback,\n  removeCallback,\n  runCallbacks,\n} = createCallbackManager();\n\nlet areCallbacksScheduled = false;\nfunction scheduleCallbacks() {\n  if (areCallbacksScheduled) return;\n  areCallbacksScheduled = true;\n  fastRaf(() => {\n    runCallbacks();\n    areCallbacksScheduled = false;\n  });\n}\n\nconst localizationReady = new Deferred<void>();\n\nfunction loadCachedLangData(langCode: string) {\n  return MAIN_IDB_STORE.get<CachedLangData>(`${LANGPACK_STORE_PREFIX}${langCode}`);\n}\n\nfunction cacheLangData(data: CachedLangData) {\n  notifyLangpackUpdate(data.language.langCode);\n  return MAIN_IDB_STORE.set(`${LANGPACK_STORE_PREFIX}${data.language.langCode}`, data);\n}\n\nlet fallbackLoadPromise: Promise<CachedLangData> | undefined;\nasync function loadFallbackPack() {\n  if (fallbackLangPack || fallbackLoadPromise) return;\n  fallbackLoadPromise = readFallbackStrings();\n  const fallbackData = await fallbackLoadPromise;\n  fallbackLangPack = fallbackData.langPack;\n\n  TRANSLATION_CACHE.clear();\n\n  if (!language) {\n    updateLanguage(fallbackData.language);\n  } else {\n    translationFn = createTranslationFn();\n    scheduleCallbacks();\n  }\n}\n\nasync function fetchDifference() {\n  if (!langPack || !language) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[Localization] Trying to fetch difference without loaded data');\n    }\n    return;\n  }\n\n  if (IS_MULTITAB_SUPPORTED) {\n    await initialEstablishmentPromise;\n    if (!isCurrentTabMaster()) return;\n  }\n\n  const result = await callApi('fetchLangDifference', {\n    langPack: LANG_PACK,\n    langCode: langPack.langCode,\n    fromVersion: langPack.version,\n  });\n  if (!result) return;\n\n  applyLangPackDifference(result.version, result.strings, result.keysToRemove);\n}\n\nexport function applyLangPackDifference(\n  version: number, strings: Record<string, LangPackStringValue>, keysToRemove: string[],\n) {\n  if (!langPack || !language || version === langPack.version) return;\n\n  const newLangPack = {\n    ...langPack,\n    version,\n    strings: {\n      ...omit(langPack.strings, keysToRemove),\n      ...strings,\n    },\n  };\n  updateLangPack(newLangPack);\n\n  cacheLangData({\n    langPack: newLangPack,\n    language,\n  });\n  scheduleCallbacks();\n}\n\nfunction updateLanguage(newLang: ApiLanguage) {\n  language = newLang;\n\n  createFormatters();\n\n  translationFn = createTranslationFn();\n\n  scheduleCallbacks();\n}\n\nfunction createFormatters() {\n  if (!language) return;\n  const langCode = language.pluralCode;\n  const listFormatFallback = getBasicListFormat();\n\n  function createListFormat(lang: string, type: 'conjunction' | 'disjunction') {\n    return IS_INTL_LIST_FORMAT_SUPPORTED ? new Intl.ListFormat(lang, { type }) : listFormatFallback;\n  }\n\n  try {\n    formatters = {\n      pluralRules: new Intl.PluralRules(langCode),\n      region: new Intl.DisplayNames(langCode, { type: 'region' }),\n      conjunction: createListFormat(langCode, 'conjunction'),\n      disjunction: createListFormat(langCode, 'disjunction'),\n      number: new Intl.NumberFormat(langCode),\n    };\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.warn('Failed to create formatters:', e);\n    formatters = {\n      pluralRules: new Intl.PluralRules(FORMATTERS_FALLBACK_LANG),\n      region: new Intl.DisplayNames(FORMATTERS_FALLBACK_LANG, { type: 'region' }),\n      conjunction: createListFormat(FORMATTERS_FALLBACK_LANG, 'conjunction'),\n      disjunction: createListFormat(FORMATTERS_FALLBACK_LANG, 'disjunction'),\n      number: new Intl.NumberFormat(FORMATTERS_FALLBACK_LANG),\n    };\n  }\n}\n\nfunction updateLangPack(newLangPack: LangPack) {\n  langPack = newLangPack;\n\n  TRANSLATION_CACHE.clear();\n\n  scheduleCallbacks();\n}\n\nexport async function initLocalization(langCode: string, canLoadFromServer?: boolean) {\n  if (language) return;\n\n  const cachedData = await loadCachedLangData(langCode);\n  if (cachedData) {\n    langPack = cachedData.langPack;\n    language = cachedData.language;\n    createFormatters();\n\n    fetchDifference();\n  } else if (canLoadFromServer) {\n    await loadAndChangeLanguage(langCode);\n  } else {\n    loadFallbackPack();\n  }\n\n  translationFn = createTranslationFn();\n  scheduleCallbacks();\n  localizationReady.resolve();\n}\n\nexport async function refreshFromCache(langCode: string) {\n  if (isCurrentTabMaster()) return;\n\n  const cachedData = await loadCachedLangData(langCode);\n  if (cachedData) {\n    updateLangPack(cachedData.langPack);\n    updateLanguage(cachedData.language);\n  }\n}\n\nexport async function loadAndChangeLanguage(langCode: string, shouldCheckCache?: boolean) {\n  if (shouldCheckCache) { // Can be removed when old lang provider is phased out. Cache is checked in `initLocalization`.\n    const cachedData = await loadCachedLangData(langCode);\n    if (cachedData) {\n      return changeLanguage(cachedData.language);\n    }\n  }\n\n  if (IS_MULTITAB_SUPPORTED) {\n    await initialEstablishmentPromise;\n    if (!isCurrentTabMaster()) return undefined;\n  }\n\n  const remoteLanguage = await callApi('fetchLanguage', {\n    langPack: LANG_PACK,\n    langCode,\n  });\n\n  if (!remoteLanguage) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to fetch language', langCode);\n    }\n    return undefined;\n  }\n\n  return changeLanguage(remoteLanguage);\n}\n\nexport function requestLangPackDifference(langCode: string) {\n  if (language?.langCode !== langCode) return;\n  fetchDifference();\n}\n\nexport async function changeLanguage(newLanguage: ApiLanguage) {\n  if (langPack && language?.langCode === newLanguage.langCode) return;\n\n  const cachedData = await loadCachedLangData(newLanguage.langCode);\n  if (cachedData) {\n    updateLangPack(cachedData.langPack);\n    updateLanguage(cachedData.language);\n\n    fetchDifference();\n  } else {\n    if (IS_MULTITAB_SUPPORTED) {\n      await initialEstablishmentPromise;\n      if (!isCurrentTabMaster()) return;\n    }\n    const remoteLangPack = await callApi('fetchLangPack', {\n      langPack: LANG_PACK,\n      langCode: newLanguage.langCode,\n    });\n    if (!remoteLangPack) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to fetch lang pack');\n      return;\n    }\n\n    updateLangPack({\n      langCode: newLanguage.langCode,\n      version: remoteLangPack.version,\n      strings: remoteLangPack.strings,\n    });\n    updateLanguage(newLanguage);\n\n    cacheLangData({\n      langPack: langPack!,\n      language: newLanguage,\n    });\n  }\n\n  document.documentElement.lang = newLanguage.baseLangCode || newLanguage.langCode;\n\n  scheduleCallbacks();\n}\n\nfunction createTranslationFn(): LangFn {\n  const fn: LangFn = ((\n    key: LangKey,\n    variables: Record<string, unknown> | undefined,\n    options: LangFnOptions | AdvancedLangFnOptions | undefined,\n  ) => {\n    if (options && areAdvancedLangFnOptions(options)) {\n      return processTranslationAdvanced(key, variables as Record<string, TeactNode>, options);\n    }\n    return processTranslation(key, variables as Record<string, string | number>, options);\n  }) as LangFn;\n  fn.code = language?.langCode || FORMATTERS_FALLBACK_LANG;\n  fn.isRtl = language?.isRtl;\n  fn.pluralCode = language?.pluralCode || FORMATTERS_FALLBACK_LANG;\n  fn.with = (({ key, variables, options }: LangFnParameters) => {\n    if (options && areAdvancedLangFnOptions(options)) {\n      return processTranslationAdvanced(key, variables as Record<string, TeactNode | undefined>, options);\n    }\n    return processTranslation(key, variables as Record<string, LangVariable>, options);\n  });\n  fn.withRegular = (({ key, variables, options }: RegularLangFnParameters) => {\n    return processTranslation(key, variables, options);\n  });\n  fn.withAdvanced = (({ key, variables, options }: AdvancedLangFnParameters) => {\n    return processTranslationAdvanced(key, variables, options);\n  });\n  fn.region = (code: string) => formatters?.region.of(code);\n  fn.conjunction = (list: string[]) => formatters?.conjunction.format(list) || list.join(', ');\n  fn.disjunction = (list: string[]) => formatters?.disjunction.format(list) || list.join(', ');\n  fn.number = (value: number) => formatters?.number.format(value) || String(value);\n  fn.languageInfo = language!;\n  return fn;\n}\n\nexport function getTranslationFn(): LangFn {\n  return translationFn;\n}\n\nfunction getString(langKey: LangKey, count: number) {\n  let langPackStringValue = langPack?.strings[langKey];\n\n  if (!langPackStringValue && !fallbackLangPack) {\n    loadFallbackPack();\n  }\n\n  langPackStringValue ||= fallbackLangPack?.strings[langKey];\n  langPackStringValue ||= initialStrings[langKey];\n\n  if (!langPackStringValue || isDeletedLangString(langPackStringValue)) return undefined;\n\n  const pluralSuffix = formatters?.pluralRules.select(count) || 'other';\n\n  const string = isPluralLangString(langPackStringValue)\n    ? (langPackStringValue[pluralSuffix] || langPackStringValue.other)\n    : langPackStringValue;\n\n  return string;\n}\n\nfunction processTranslation(\n  langKey: LangKey,\n  variables?: Record<string, LangVariable | RegularLangFnParameters>,\n  options?: LangFnOptions | LangFnOptionsWithPlural,\n): string {\n  const cacheKey = `${langKey}-${JSON.stringify(variables)}-${JSON.stringify(options)}`;\n  if (TRANSLATION_CACHE.has(cacheKey)) {\n    return TRANSLATION_CACHE.get(cacheKey)!;\n  }\n\n  const pluralValue = options && 'pluralValue' in options ? Number(options.pluralValue) : 0;\n  const string = getString(langKey, pluralValue);\n\n  if (!string) return langKey;\n\n  const variableEntries = variables ? Object.entries(variables) : [];\n  const finalString = variableEntries.reduce((result, [key, value]) => {\n    if (value === undefined) return result;\n    if (typeof value === 'object') { // Allow recursive variables in basic `lang.with`\n      value = processTranslation(value.key, value.variables, value.options);\n    }\n\n    const valueAsString = Number.isFinite(value) ? formatters!.number.format(value as number) : String(value);\n    return result.replace(`{${key}}`, valueAsString);\n  }, string);\n\n  TRANSLATION_CACHE.set(cacheKey, finalString);\n\n  return finalString;\n}\n\nfunction processTranslationAdvanced(\n  langKey: LangKey,\n  variables?: Record<string, TeactNode | undefined>,\n  options?: AdvancedLangFnOptions | AdvancedLangFnOptionsWithPlural,\n): TeactNode {\n  const pluralValue = options && 'pluralValue' in options ? Number(options.pluralValue) : 0;\n  const string = getString(langKey, pluralValue);\n  if (!string) return langKey;\n\n  const variableEntries = variables ? Object.entries(variables) : [];\n\n  let tempResult: TeactNode = [string];\n  if (options?.specialReplacement) {\n    const specialReplacements = Object.entries(options.specialReplacement);\n    tempResult = specialReplacements.reduce((acc, [key, value]) => {\n      return replaceInStringsWithTeact(acc, key, value);\n    }, tempResult);\n  }\n\n  const withRenderText = options?.withMarkdown || options?.renderTextFilters;\n\n  if (withRenderText) {\n    const filters = options?.withMarkdown\n      ? unique((options.renderTextFilters || []).concat(['simple_markdown', 'emoji']) as TextFilter[])\n      : options.renderTextFilters;\n\n    return tempResult.flatMap((curr: TeactNode) => {\n      if (typeof curr !== 'string') {\n        return curr;\n      }\n\n      return renderText(curr, filters, {\n        markdownPostProcessor: (part: string) => {\n          return variableEntries.reduce((result, [key, value]): TeactNode[] => {\n            if (value === undefined) return result;\n\n            const preparedValue = Number.isFinite(value) ? formatters!.number.format(value as number) : value;\n            return replaceInStringsWithTeact(result, `{${key}}`, preparedValue);\n          }, [part] as TeactNode[]);\n        },\n      });\n    });\n  }\n\n  return variableEntries.reduce((result, [key, value]): TeactNode[] => {\n    if (value === undefined) return result;\n\n    const preparedValue = Number.isFinite(value) ? formatters!.number.format(value as number) : value;\n    return replaceInStringsWithTeact(result, `{${key}}`, preparedValue);\n  }, tempResult);\n}\n\nexport const localizationReadyPromise = localizationReady.promise;\n\nexport {\n  addCallback as addLocalizationCallback,\n  removeCallback as removeLocalizationCallback,\n};\n\nexport type {\n  LangFn,\n  LangFnParameters,\n  RegularLangFnParameters,\n  AdvancedLangFnParameters,\n};\n","export function getBasicListFormat() {\n  return {\n    format: (items: string[]) => items.join(', '),\n  };\n}\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiLanguage,\n  LangPackStringValue,\n  LangPackStringValueDeleted,\n  LangPackStringValuePlural,\n  LangPackStringValueRegular,\n} from '../../api/types';\nimport type { TextFilter } from '../../components/common/helpers/renderText';\nimport type {\n  LangPairPluralWithVariables,\n  LangPairWithVariables,\n  LangVariable,\n  PluralLangKey,\n  PluralLangKeyWithVariables,\n  RegularLangKey,\n  RegularLangKeyWithVariables,\n} from '../../types/language';\n\nexport interface LangFnOptionsRegular {\n  withNodes?: never;\n  withMarkdown?: never;\n  pluralValue?: never;\n}\n\nexport type LangFnOptionsWithPlural = Omit<LangFnOptionsRegular, 'pluralValue'> & {\n  pluralValue: number;\n};\n\nexport type LangFnOptions = LangFnOptionsRegular | LangFnOptionsWithPlural;\n\nexport interface AdvancedLangFnOptionsRegular {\n  withNodes: true;\n  withMarkdown?: boolean;\n  pluralValue?: never;\n  renderTextFilters?: TextFilter[];\n  specialReplacement?: Record<string, TeactNode>;\n}\n\nexport type AdvancedLangFnOptionsWithPlural = Omit<AdvancedLangFnOptionsRegular, 'pluralValue'> & {\n  pluralValue: number;\n};\n\nexport type AdvancedLangFnOptions = AdvancedLangFnOptionsRegular | AdvancedLangFnOptionsWithPlural;\n\ntype LangPairWithNodes = LangPairWithVariables<TeactNode | undefined>;\ntype LangPairPluralWithNodes = LangPairPluralWithVariables<TeactNode | undefined>;\n\ntype RegularLangFnParametersWithoutVariables = {\n  key: RegularLangKey;\n  variables?: undefined;\n  options?: LangFnOptions;\n};\n\ntype RegularLangFnParametersWithVariables<T = LangPairWithVariables> = {\n  [K in keyof T]: {\n    key: K;\n    variables: {\n      [key in keyof T[K]]: LangVariable | RegularLangFnParameters;\n    };\n    options?: LangFnOptions;\n  }\n}[keyof T];\n\ntype RegularLangFnPluralParameters = {\n  key: PluralLangKey;\n  variables?: undefined;\n  options: LangFnOptionsWithPlural;\n};\n\ntype RegularLangFnPluralParametersWithVariables<T = LangPairPluralWithVariables> = {\n  [K in keyof T]: {\n    key: K;\n    variables: {\n      [key in keyof T[K]]: LangVariable | RegularLangFnParameters;\n    };\n    options: LangFnOptionsWithPlural;\n  }\n}[keyof T];\n\nexport type RegularLangFnParameters =\n| RegularLangFnParametersWithoutVariables\n| RegularLangFnParametersWithVariables\n| RegularLangFnPluralParameters\n| RegularLangFnPluralParametersWithVariables;\n\ntype AdvancedLangFnParametersWithoutVariables = {\n  key: RegularLangKey;\n  variables?: undefined;\n  options: AdvancedLangFnOptions;\n};\n\ntype AdvancedLangFnParametersWithVariables<T = LangPairWithNodes> = {\n  [K in keyof T]: {\n    key: K;\n    variables: T[K];\n    options: AdvancedLangFnOptions;\n  }\n}[keyof T];\n\ntype AdvancedLangFnPluralParameters = {\n  key: PluralLangKey;\n  variables?: undefined;\n  options: AdvancedLangFnOptionsWithPlural;\n};\n\ntype AdvancedLangFnPluralParametersWithVariables<T = LangPairPluralWithNodes> = {\n  [K in keyof T]: {\n    key: K;\n    variables: T[K];\n    options: AdvancedLangFnOptionsWithPlural;\n  }\n}[keyof T];\n\nexport type AdvancedLangFnParameters =\n| AdvancedLangFnParametersWithoutVariables\n| AdvancedLangFnParametersWithVariables\n| AdvancedLangFnPluralParameters\n| AdvancedLangFnPluralParametersWithVariables;\n\nexport type LangFnParameters = RegularLangFnParameters | AdvancedLangFnParameters;\n\nexport type LangFn = {\n  <K extends RegularLangKey = RegularLangKey>(\n    key: K, variables?: undefined, options?: LangFnOptions,\n  ): string;\n  <K extends PluralLangKey = PluralLangKey>(\n    key: K, variables: undefined, options: LangFnOptionsWithPlural,\n  ): string;\n  <K extends RegularLangKeyWithVariables = RegularLangKeyWithVariables>(\n    key: K, variables: LangPairWithVariables[K], options?: LangFnOptions,\n  ): string;\n  <K extends PluralLangKeyWithVariables = PluralLangKeyWithVariables>(\n    key: K, variables: LangPairPluralWithVariables[K], options: LangFnOptionsWithPlural,\n  ): string;\n\n  <K extends RegularLangKey = RegularLangKey>(\n    key: K, variables?: undefined, options?: AdvancedLangFnOptions,\n  ): TeactNode;\n  <K extends PluralLangKey = PluralLangKey>(\n    key: K, variables: undefined, options: AdvancedLangFnOptionsWithPlural,\n  ): TeactNode;\n  <K extends RegularLangKeyWithVariables = RegularLangKeyWithVariables>(\n    key: K, variables: LangPairWithVariables<TeactNode | undefined>[K], options: AdvancedLangFnOptions,\n  ): TeactNode;\n  <K extends PluralLangKeyWithVariables = PluralLangKeyWithVariables>(\n    key: K, variables: LangPairPluralWithVariables<TeactNode | undefined>[K], options: AdvancedLangFnOptionsWithPlural,\n  ): TeactNode;\n\n  with: (params: LangFnParameters) => TeactNode;\n  withRegular: (params: RegularLangFnParameters) => string;\n  withAdvanced: (params: AdvancedLangFnParameters) => TeactNode;\n  region: (code: string) => string | undefined;\n  conjunction: (list: string[]) => string;\n  disjunction: (list: string[]) => string;\n  number: (value: number) => string;\n  isRtl?: boolean;\n  code: string;\n  pluralCode: string;\n  languageInfo: ApiLanguage;\n};\n\ntype ListFormat = Pick<Intl.ListFormat, 'format'>;\n\nexport type LangFormatters = {\n  pluralRules: Intl.PluralRules;\n  region: Intl.DisplayNames;\n  conjunction: ListFormat;\n  disjunction: ListFormat;\n  number: Intl.NumberFormat;\n};\n\n/* GUARDS */\n\nexport function isDeletedLangString(string: LangPackStringValue): string is LangPackStringValueDeleted {\n  return typeof string === 'object' && 'isDeleted' in string;\n}\n\nexport function isRegularLangString(string: LangPackStringValue): string is LangPackStringValueRegular {\n  return typeof string === 'string';\n}\n\nexport function isPluralLangString(string: LangPackStringValue): string is LangPackStringValuePlural {\n  return !isRegularLangString(string) && !isDeletedLangString(string);\n}\n\nexport function isLangFnParam(object: unknown): object is LangFnParameters {\n  return Boolean(object) && typeof object === 'object' && 'key' in object! && !('type' in object);\n}\n\nexport function areAdvancedLangFnOptions(\n  params: LangFnOptions | AdvancedLangFnOptions,\n): params is AdvancedLangFnOptions {\n  return 'withNodes' in params && Boolean(params.withNodes);\n}\n","export const clamp = (num: number, min: number, max: number) => (Math.min(max, Math.max(min, num)));\nexport const isBetween = (num: number, min: number, max: number) => (num >= min && num <= max);\nexport const round = (num: number, decimals: number = 0) => Math.round(num * 10 ** decimals) / 10 ** decimals;\nexport const lerp = (start: number, end: number, interpolationRatio: number) => {\n  return (1 - interpolationRatio) * start + interpolationRatio * end;\n};\n\n// Fractional values cause blurry text & canvas. Round to even to keep whole numbers while centering\nexport function roundToNearestEven(value: number) {\n  return Math.round(value / 2) * 2;\n}\n","const SAMPLE_RATE = 48000;\nconst BIT_DEPTH = 16;\n\nexport async function oggToWav(opusData: Blob): Promise<Blob> {\n  const arrayBuffer = await new Response(opusData).arrayBuffer();\n\n  return new Promise((resolve) => {\n    const typedArray = new Uint8Array(arrayBuffer);\n\n    let decoderWorker: Worker | undefined = new Worker(\n      new URL('opus-recorder/dist/decoderWorker.min.js', import.meta.url),\n    );\n    let wavWorker: Worker | undefined = new Worker(new URL('opus-recorder/dist/waveWorker.min.js', import.meta.url));\n\n    decoderWorker.onmessage = (e) => {\n      // eslint-disable-next-line no-null/no-null\n      if (e.data === null) {\n        // `null` means decoder is finished\n        wavWorker!.postMessage({ command: 'done' });\n      } else {\n        // `e.data` contains decoded buffers as float32 values\n        wavWorker!.postMessage(\n          {\n            command: 'encode',\n            buffers: e.data,\n          },\n          e.data.map(({ buffer }: Float32Array) => buffer),\n        );\n      }\n    };\n\n    wavWorker.onmessage = (e) => {\n      if (e.data.message === 'page') {\n        resolve(new Blob([e.data.page], { type: 'audio/wav' }));\n\n        decoderWorker!.terminate();\n        decoderWorker = undefined;\n        wavWorker!.terminate();\n        wavWorker = undefined;\n      }\n    };\n\n    wavWorker.postMessage({\n      command: 'init',\n      wavBitDepth: BIT_DEPTH,\n      wavSampleRate: SAMPLE_RATE,\n    });\n\n    decoderWorker.postMessage({\n      command: 'init',\n      decoderSampleRate: SAMPLE_RATE,\n      outputBufferSampleRate: SAMPLE_RATE,\n    });\n\n    decoderWorker.postMessage({\n      command: 'decode',\n      pages: typedArray,\n    }, [typedArray.buffer]);\n  });\n}\n","import type {\n  ApiOnProgress,\n  ApiParsedMedia,\n  ApiPreparedMedia,\n} from '../api/types';\nimport {\n  ApiMediaFormat,\n} from '../api/types';\n\nimport {\n  DEBUG, ELECTRON_HOST_URL,\n  IS_PACKAGED_ELECTRON, MEDIA_CACHE_DISABLED, MEDIA_CACHE_NAME, MEDIA_CACHE_NAME_AVATARS,\n} from '../config';\nimport { callApi, cancelApiProgress } from '../api/gramjs';\nimport * as cacheApi from './cacheApi';\nimport { fetchBlob } from './files';\nimport { oggToWav } from './oggToWav';\nimport {\n  IS_OPUS_SUPPORTED, IS_PROGRESSIVE_SUPPORTED,\n} from './windowEnvironment';\n\nconst asCacheApiType = {\n  [ApiMediaFormat.BlobUrl]: cacheApi.Type.Blob,\n  [ApiMediaFormat.Text]: cacheApi.Type.Text,\n  [ApiMediaFormat.DownloadUrl]: undefined,\n  [ApiMediaFormat.Progressive]: undefined,\n};\n\nconst PROGRESSIVE_URL_PREFIX = `${IS_PACKAGED_ELECTRON ? ELECTRON_HOST_URL : '.'}/progressive/`;\nconst URL_DOWNLOAD_PREFIX = './download/';\nconst MAX_MEDIA_RETRIES = 5;\n\nconst memoryCache = new Map<string, ApiPreparedMedia>();\nconst fetchPromises = new Map<string, Promise<ApiPreparedMedia | undefined>>();\nconst progressCallbacks = new Map<string, Map<string, ApiOnProgress>>();\nconst cancellableCallbacks = new Map<string, ApiOnProgress>();\n\nexport function fetch<T extends ApiMediaFormat>(\n  url: string,\n  mediaFormat: T,\n  isHtmlAllowed = false,\n  onProgress?: ApiOnProgress,\n  callbackUniqueId?: string,\n): Promise<ApiPreparedMedia> {\n  if (mediaFormat === ApiMediaFormat.Progressive) {\n    return (\n      IS_PROGRESSIVE_SUPPORTED\n        ? getProgressive(url)\n        : fetch(url, ApiMediaFormat.BlobUrl, isHtmlAllowed, onProgress, callbackUniqueId)\n    ) as Promise<ApiPreparedMedia>;\n  }\n\n  if (mediaFormat === ApiMediaFormat.DownloadUrl) {\n    return (\n      IS_PROGRESSIVE_SUPPORTED\n        ? getDownloadUrl(url)\n        : fetch(url, ApiMediaFormat.BlobUrl, isHtmlAllowed, onProgress, callbackUniqueId)\n    ) as Promise<ApiPreparedMedia>;\n  }\n\n  if (!fetchPromises.has(url)) {\n    const promise = fetchFromCacheOrRemote(url, mediaFormat, isHtmlAllowed)\n      .catch((err) => {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.warn(err);\n        }\n\n        return undefined;\n      })\n      .finally(() => {\n        fetchPromises.delete(url);\n        progressCallbacks.delete(url);\n        cancellableCallbacks.delete(url);\n      });\n\n    fetchPromises.set(url, promise);\n  }\n\n  if (onProgress && callbackUniqueId) {\n    let activeCallbacks = progressCallbacks.get(url);\n    if (!activeCallbacks) {\n      activeCallbacks = new Map<string, ApiOnProgress>();\n      progressCallbacks.set(url, activeCallbacks);\n    }\n    activeCallbacks.set(callbackUniqueId, onProgress);\n  }\n\n  return fetchPromises.get(url) as Promise<ApiPreparedMedia>;\n}\n\nexport function getFromMemory(url: string) {\n  return memoryCache.get(url) as ApiPreparedMedia;\n}\n\nexport function cancelProgress(progressCallback: ApiOnProgress) {\n  progressCallbacks.forEach((map, url) => {\n    map.forEach((callback) => {\n      if (callback === progressCallback) {\n        const parentCallback = cancellableCallbacks.get(url);\n        if (!parentCallback) return;\n\n        cancelApiProgress(parentCallback);\n        cancellableCallbacks.delete(url);\n        progressCallbacks.delete(url);\n      }\n    });\n  });\n}\n\nexport function removeCallback(url: string, callbackUniqueId: string) {\n  const callbacks = progressCallbacks.get(url);\n  if (!callbacks) return;\n  callbacks.delete(callbackUniqueId);\n}\n\nexport function getProgressiveUrl(url: string) {\n  return `${PROGRESSIVE_URL_PREFIX}${url}`;\n}\n\nfunction getProgressive(url: string) {\n  const progressiveUrl = `${PROGRESSIVE_URL_PREFIX}${url}`;\n\n  memoryCache.set(url, progressiveUrl);\n\n  return Promise.resolve(progressiveUrl);\n}\n\nfunction getDownloadUrl(url: string) {\n  return Promise.resolve(`${URL_DOWNLOAD_PREFIX}${url}`);\n}\n\nasync function fetchFromCacheOrRemote(\n  url: string, mediaFormat: ApiMediaFormat, isHtmlAllowed: boolean, retryNumber = 0,\n): Promise<string> {\n  if (!MEDIA_CACHE_DISABLED) {\n    const cacheName = url.startsWith('avatar') ? MEDIA_CACHE_NAME_AVATARS : MEDIA_CACHE_NAME;\n    const cached = await cacheApi.fetch(cacheName, url, asCacheApiType[mediaFormat]!, isHtmlAllowed);\n\n    if (cached) {\n      let media = cached;\n\n      if (cached.type === 'audio/ogg' && !IS_OPUS_SUPPORTED) {\n        media = await oggToWav(media);\n      }\n\n      const prepared = prepareMedia(media);\n\n      memoryCache.set(url, prepared);\n\n      return prepared;\n    }\n  }\n\n  const onProgress = makeOnProgress(url);\n  cancellableCallbacks.set(url, onProgress);\n\n  const remote = await callApi('downloadMedia', { url, mediaFormat, isHtmlAllowed }, onProgress);\n  if (!remote) {\n    if (retryNumber >= MAX_MEDIA_RETRIES) {\n      throw new Error(`Failed to fetch media ${url}`);\n    }\n    await new Promise((resolve) => {\n      setTimeout(resolve, getRetryTimeout(retryNumber));\n    });\n    // eslint-disable-next-line no-console\n    if (DEBUG) console.debug(`Retrying to fetch media ${url}`);\n    return fetchFromCacheOrRemote(url, mediaFormat, isHtmlAllowed, retryNumber + 1);\n  }\n\n  let { mimeType } = remote;\n  let prepared = prepareMedia(remote.dataBlob);\n\n  if (mimeType === 'audio/ogg' && !IS_OPUS_SUPPORTED) {\n    const blob = await fetchBlob(prepared as string);\n    URL.revokeObjectURL(prepared as string);\n    const media = await oggToWav(blob);\n    prepared = prepareMedia(media);\n    mimeType = media.type;\n  }\n\n  memoryCache.set(url, prepared);\n\n  return prepared;\n}\n\nfunction makeOnProgress(url: string) {\n  const onProgress: ApiOnProgress = (progress: number) => {\n    progressCallbacks.get(url)?.forEach((callback) => {\n      callback(progress);\n      if (callback.isCanceled) onProgress.isCanceled = true;\n    });\n  };\n\n  return onProgress;\n}\n\nfunction prepareMedia(mediaData: Exclude<ApiParsedMedia, ArrayBuffer>): ApiPreparedMedia {\n  if (mediaData instanceof Blob) {\n    return URL.createObjectURL(mediaData);\n  }\n\n  return mediaData;\n}\n\nif (IS_PROGRESSIVE_SUPPORTED) {\n  navigator.serviceWorker.addEventListener('message', async (e) => {\n    const { type, messageId, params } = e.data as {\n      type: string;\n      messageId: string;\n      params: { url: string; start: number; end: number };\n    };\n\n    if (type !== 'requestPart') {\n      return;\n    }\n\n    const result = await callApi('downloadMedia', { mediaFormat: ApiMediaFormat.Progressive, ...params });\n    if (!result) {\n      return;\n    }\n\n    const { arrayBuffer, mimeType, fullSize } = result;\n\n    navigator.serviceWorker.controller!.postMessage({\n      type: 'partResponse',\n      messageId,\n      result: {\n        arrayBuffer,\n        mimeType,\n        fullSize,\n      },\n    }, [arrayBuffer!]);\n  });\n}\n\nfunction getRetryTimeout(retryNumber: number) {\n  // 250ms, 500ms, 1s, 2s, 4s\n  return 250 * 2 ** retryNumber;\n}\n","export const MEMO_EMPTY_ARRAY = [];\n","import { DEBUG } from '../config';\nimport { createCallbackManager } from './callbacks';\n\nexport enum Bundles {\n  Auth,\n  Main,\n  Extra,\n  Calls,\n  Stars,\n}\n\ninterface ImportedBundles {\n  [Bundles.Auth]: typeof import('../bundles/auth');\n  [Bundles.Main]: typeof import('../bundles/main');\n  [Bundles.Extra]: typeof import('../bundles/extra');\n  [Bundles.Calls]: typeof import('../bundles/calls');\n  [Bundles.Stars]: typeof import('../bundles/stars');\n}\n\ntype BundlePromises = {\n  [K in keyof ImportedBundles]: Promise<ImportedBundles[K]>\n};\n\nexport type BundleModules<B extends keyof ImportedBundles> = keyof ImportedBundles[B];\n\nconst LOAD_PROMISES: Partial<BundlePromises> = {};\nconst MEMORY_CACHE: Partial<ImportedBundles> = {};\n\nconst { addCallback, runCallbacks } = createCallbackManager();\n\nexport async function loadBundle<B extends Bundles>(bundleName: B) {\n  if (!LOAD_PROMISES[bundleName]) {\n    switch (bundleName) {\n      case Bundles.Auth:\n        LOAD_PROMISES[Bundles.Auth] = import(/* webpackChunkName: \"BundleAuth\" */ '../bundles/auth');\n        break;\n      case Bundles.Main:\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.log('>>> START LOAD MAIN BUNDLE');\n        }\n\n        LOAD_PROMISES[Bundles.Main] = import(/* webpackChunkName: \"BundleMain\" */ '../bundles/main');\n        break;\n      case Bundles.Extra:\n        LOAD_PROMISES[Bundles.Extra] = import(/* webpackChunkName: \"BundleExtra\" */ '../bundles/extra');\n        break;\n      case Bundles.Calls:\n        LOAD_PROMISES[Bundles.Calls] = import(/* webpackChunkName: \"BundleCalls\" */ '../bundles/calls');\n        break;\n      case Bundles.Stars:\n        LOAD_PROMISES[Bundles.Stars] = import(/* webpackChunkName: \"BundleStars\" */ '../bundles/stars');\n        break;\n    }\n\n    (LOAD_PROMISES[bundleName] as Promise<ImportedBundles[B]>).then(runCallbacks);\n  }\n\n  const bundle = (await LOAD_PROMISES[bundleName]) as unknown as ImportedBundles[B];\n\n  if (!MEMORY_CACHE[bundleName]) {\n    MEMORY_CACHE[bundleName] = bundle;\n  }\n\n  return bundle;\n}\n\nexport async function loadModule<B extends Bundles>(bundleName: B) {\n  await loadBundle(bundleName);\n}\n\nexport function getModuleFromMemory<B extends Bundles, M extends BundleModules<B>>(\n  bundleName: B, moduleName: M,\n): ImportedBundles[B][M] | undefined {\n  const bundle = MEMORY_CACHE[bundleName] as ImportedBundles[B];\n\n  if (!bundle) {\n    return undefined;\n  }\n\n  return bundle[moduleName];\n}\n\nexport const addLoadListener = addCallback;\n","import { isLiteralObject, unique } from './iteratees';\n\nconst EQUAL = Symbol('EQUAL');\nconst DELETE = { __delete: true };\nconst DELETE_ALL_CHILDREN = { __deleteAllChildren: true };\n\nexport function deepDiff<T extends any>(value1: T, value2: T): Partial<T> | typeof EQUAL | typeof DELETE_ALL_CHILDREN {\n  if (value1 === value2) {\n    return EQUAL;\n  }\n\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n\n  if (type1 !== type2) {\n    return value2;\n  }\n\n  if (Array.isArray(value1) && Array.isArray(value2) && areSortedArraysDeepEqual(value1, value2)) {\n    return EQUAL;\n  }\n\n  if (!isLiteralObject(value1) || !isLiteralObject(value2)) {\n    return value2;\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (!keys2.length) {\n    return !keys1.length ? EQUAL : DELETE_ALL_CHILDREN;\n  }\n\n  const allKeys = unique(keys1.concat(keys2));\n\n  const diff = allKeys.reduce((acc: any, key) => {\n    const subValue1 = object1[key];\n    const subValue2 = object2[key];\n\n    if (!object2.hasOwnProperty(key)) {\n      acc[key] = DELETE;\n      return acc;\n    }\n\n    if (!object1!.hasOwnProperty(key)) {\n      acc[key] = subValue2;\n      return acc;\n    }\n\n    const subDiff = deepDiff(subValue1, subValue2);\n    if (subDiff !== EQUAL) {\n      acc[key] = subDiff;\n    }\n\n    return acc;\n  }, {});\n\n  if (Object.keys(diff).length === 0) {\n    return EQUAL;\n  }\n\n  return diff;\n}\n\nfunction areSortedArraysDeepEqual<T extends Array<any>>(array1: T, array2: T) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => deepDiff(item, array2[i]) === EQUAL);\n}\n","import { isLiteralObject, unique } from './iteratees';\n\nexport function deepMerge<T extends any>(value1: T, value2: T): T {\n  if (value1 === value2) {\n    return value2;\n  }\n\n  if (!isLiteralObject(value2)) {\n    return value2;\n  }\n\n  if (!isLiteralObject(value1)) {\n    return reduceDiff(value2) as T;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  if (value2.__deleteAllChildren) {\n    return {} as T;\n  }\n\n  const allKeys = unique(Object.keys(value1).concat(Object.keys(value2)));\n\n  return allKeys.reduce((acc: AnyLiteral, key) => {\n    const oldValue = value1[key];\n\n    if (!value2.hasOwnProperty(key)) {\n      acc[key] = oldValue;\n    } else {\n      const newValue = value2[key];\n      // eslint-disable-next-line no-underscore-dangle\n      if (!newValue?.__delete) {\n        acc[key] = deepMerge(oldValue, newValue);\n      }\n    }\n\n    return acc;\n  }, {}) as T;\n}\n\nfunction reduceDiff(diff: AnyLiteral) {\n  // eslint-disable-next-line no-underscore-dangle\n  if (diff.__deleteAllChildren) {\n    return {};\n  }\n\n  return Object.entries(diff).reduce((acc: AnyLiteral, [key, value]) => {\n    // eslint-disable-next-line no-underscore-dangle\n    if (!value?.__delete) {\n      // eslint-disable-next-line no-null/no-null\n      acc[key] = isLiteralObject(value) ? reduceDiff(value) : value;\n    }\n\n    return acc;\n  }, {});\n}\n","/* eslint-disable eslint-multitab-tt/set-global-only-variable */\nimport { onFullyIdle } from '../lib/teact/teact';\nimport { addCallback } from '../lib/teact/teactn';\nimport { getActions, getGlobal, setGlobal } from '../global';\n\nimport type { LocalDb } from '../api/gramjs/localDb';\nimport type { MethodArgs, Methods } from '../api/gramjs/methods/types';\nimport type { ApiInitialArgs } from '../api/types';\nimport type { GlobalState } from '../global/types';\n\nimport { DATA_BROADCAST_CHANNEL_NAME, MULTITAB_LOCALSTORAGE_KEY } from '../config';\nimport { selectTabState } from '../global/selectors';\nimport {\n  callApiLocal,\n  cancelApiProgressMaster,\n  handleMethodCallback,\n  handleMethodResponse,\n  initApi,\n  updateFullLocalDb,\n  updateLocalDb,\n} from '../api/gramjs';\nimport { deepDiff } from './deepDiff';\nimport { deepMerge } from './deepMerge';\nimport { getCurrentTabId, signalPasscodeHash, subscribeToTokenDied } from './establishMultitabRole';\nimport { omit } from './iteratees';\nimport { IS_MULTITAB_SUPPORTED } from './windowEnvironment';\n\ntype BroadcastChannelRefreshLangpack = {\n  type: 'langpackRefresh';\n  langCode: string;\n};\n\ntype BroadcastChannelRequestGlobal = {\n  type: 'requestGlobal';\n  token?: number;\n  appVersion: string;\n};\n\ntype BroadcastChannelGlobalUpdate = {\n  type: 'globalUpdate';\n  global: GlobalState;\n};\n\ntype BroadcastChannelCancelApiProgress = {\n  type: 'cancelApiProgress';\n  token: number;\n  messageId: string;\n};\n\ntype BroadcastChannelCallApi = {\n  type: 'callApi';\n  token: number;\n  messageId: string;\n  name: keyof Methods;\n  args: MethodArgs<keyof Methods>;\n  withCallback?: boolean;\n};\n\ntype BroadcastChannelMessageResponse = {\n  type: 'messageResponse';\n  token: number;\n  messageId: string;\n  response: any;\n};\n\ntype BroadcastChannelLocalDbUpdate = {\n  type: 'localDbUpdate';\n  batchedUpdates: {\n    name: keyof LocalDb;\n    prop: string;\n    value: any;\n  }[];\n};\n\ntype BroadcastChannelLocalDbUpdateFull = {\n  type: 'localDbUpdateFull';\n  localDb: any;\n};\n\ntype BroadcastChannelMessageCallback = {\n  type: 'messageCallback';\n  token: number;\n  messageId: string;\n  callbackArgs: any;\n};\n\ntype BroadcastChannelGlobalDiff = {\n  type: 'globalDiffUpdate';\n  diff: any;\n};\n\ntype BroadcastChannelInitApi = {\n  type: 'initApi';\n  token: number;\n  initialArgs: ApiInitialArgs;\n};\n\nconst MULTITAB_ESTABLISH_TIMEOUT = 800;\n\nexport type TypedBroadcastChannel = {\n  postMessage: (message: BroadcastChannelMessage) => void;\n  addEventListener: (type: 'message', listener: (event: { data: BroadcastChannelMessage }) => void) => void;\n  removeEventListener: (type: 'message', listener: (event: { data: BroadcastChannelMessage }) => void) => void;\n};\n\ntype BroadcastChannelMessage = (\n  BroadcastChannelRequestGlobal | BroadcastChannelGlobalUpdate | BroadcastChannelCallApi |\n  BroadcastChannelMessageResponse | BroadcastChannelRefreshLangpack |\n  BroadcastChannelMessageCallback | BroadcastChannelCancelApiProgress | BroadcastChannelLocalDbUpdate |\n  BroadcastChannelLocalDbUpdateFull | BroadcastChannelGlobalDiff | BroadcastChannelInitApi\n);\n\nlet resolveGlobalPromise: VoidFunction | undefined;\nlet isFirstGlobalResolved = false;\nlet currentGlobal: GlobalState | undefined;\nlet isDisabled = false;\n\nconst channel = IS_MULTITAB_SUPPORTED\n  ? new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) as TypedBroadcastChannel\n  : undefined;\n\nlet isBroadcastDiffScheduled = false;\nlet lastBroadcastDiffGlobal: GlobalState | undefined;\n\nfunction broadcastDiffOnIdle() {\n  if (isBroadcastDiffScheduled) return;\n\n  isBroadcastDiffScheduled = true;\n  lastBroadcastDiffGlobal = currentGlobal;\n\n  onFullyIdle(() => {\n    if (!channel) return;\n\n    const diff = deepDiff(lastBroadcastDiffGlobal, currentGlobal);\n\n    if (typeof diff !== 'symbol') {\n      channel.postMessage({\n        type: 'globalDiffUpdate',\n        diff,\n      });\n    }\n\n    isBroadcastDiffScheduled = false;\n  });\n}\n\nexport function unsubcribeFromMultitabBroadcastChannel() {\n  if (channel) {\n    channel.removeEventListener('message', handleMessage);\n    isDisabled = true;\n  }\n}\n\nexport function subscribeToMultitabBroadcastChannel() {\n  if (!channel) return;\n\n  subscribeToTokenDied((token) => {\n    if (token === getCurrentTabId()) {\n      unsubcribeFromMultitabBroadcastChannel();\n      const global = getGlobal();\n      const newGlobal = {\n        ...global,\n        byTabId: omit(global.byTabId, [token]),\n      };\n\n      const diff = deepDiff(global, newGlobal);\n\n      if (typeof diff !== 'symbol') {\n        channel.postMessage({\n          type: 'globalDiffUpdate',\n          diff,\n        });\n      }\n      return;\n    }\n    let global = getGlobal();\n    global = {\n      ...global,\n      byTabId: omit(global.byTabId, [token]),\n    };\n\n    setGlobal(global);\n  });\n\n  addCallback((global: GlobalState) => {\n    if (!isFirstGlobalResolved || isDisabled) {\n      currentGlobal = global;\n      return;\n    }\n\n    if (currentGlobal === global) {\n      return;\n    }\n\n    if (!currentGlobal) {\n      currentGlobal = global;\n      channel.postMessage({\n        type: 'globalUpdate',\n        global,\n      });\n      return;\n    }\n\n    broadcastDiffOnIdle();\n\n    currentGlobal = global;\n  });\n\n  channel.addEventListener('message', handleMessage);\n}\n\nexport function handleMessage({ data }: { data: BroadcastChannelMessage }) {\n  if (!data || !channel) return;\n\n  switch (data.type) {\n    case 'initApi': {\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const { initialArgs } = data;\n      initApi(getActions().apiUpdate, initialArgs);\n      break;\n    }\n\n    case 'globalDiffUpdate': {\n      if (!isFirstGlobalResolved) return;\n      const { diff } = data;\n      const oldGlobal = getGlobal();\n      const global = deepMerge(oldGlobal, diff);\n\n      // @ts-ignore\n      global.DEBUG_randomId = oldGlobal.DEBUG_randomId;\n\n      currentGlobal = global;\n      setGlobal(global);\n      break;\n    }\n\n    case 'globalUpdate': {\n      if (isFirstGlobalResolved) return;\n      const oldGlobal = getGlobal();\n      // @ts-ignore\n      data.global.DEBUG_randomId = oldGlobal.DEBUG_randomId;\n      currentGlobal = data.global;\n      setGlobal(data.global);\n      if (resolveGlobalPromise) {\n        resolveGlobalPromise();\n        resolveGlobalPromise = undefined;\n        isFirstGlobalResolved = true;\n      }\n      break;\n    }\n\n    case 'requestGlobal': {\n      const { appVersion } = data;\n      if (appVersion !== APP_VERSION) {\n        // If app version on the other tab was updated, reload the current page immediately and don't respond\n        // to the other tab's request because our current global might be incompatible with the new version\n        window.location.reload();\n        return;\n      }\n\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n\n      if (!selectTabState(global).isMasterTab) return;\n\n      channel.postMessage({\n        type: 'globalUpdate',\n        global,\n      });\n\n      signalPasscodeHash();\n      break;\n    }\n\n    case 'messageCallback': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      handleMethodCallback(data);\n      break;\n    }\n\n    case 'localDbUpdate': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      const {\n        batchedUpdates,\n      } = data;\n\n      batchedUpdates.forEach(({\n        name,\n        prop,\n        value,\n      }) => {\n        updateLocalDb(name, prop, value);\n      });\n      break;\n    }\n\n    case 'localDbUpdateFull': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      const { localDb } = data;\n\n      updateFullLocalDb(localDb);\n      break;\n    }\n\n    case 'messageResponse': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n\n      if (selectTabState(global).isMasterTab) return;\n\n      handleMethodResponse(data);\n      break;\n    }\n\n    case 'cancelApiProgress': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const { messageId } = data;\n\n      cancelApiProgressMaster(messageId);\n      break;\n    }\n\n    case 'callApi': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const {\n        name, messageId, token, args, withCallback,\n      } = data;\n\n      const argsWithCallback = (withCallback ? [...args, (...callbackArgs: any[]) => {\n        channel.postMessage({\n          type: 'messageCallback',\n          token,\n          messageId,\n          callbackArgs,\n        });\n      }] : args) as MethodArgs<keyof Methods>;\n\n      (async () => {\n        const result = await (callApiLocal(name, ...argsWithCallback));\n\n        channel.postMessage({\n          type: 'messageResponse',\n          token,\n          messageId,\n          response: result,\n        });\n      })();\n\n      break;\n    }\n\n    case 'langpackRefresh': {\n      getActions().refreshLangPackFromCache({ langCode: data.langCode });\n      break;\n    }\n  }\n}\n\nexport function requestGlobal(appVersion: string): Promise<void> {\n  if (channel) {\n    channel.postMessage({\n      type: 'requestGlobal',\n      appVersion,\n    });\n  }\n\n  const resolveWithoutGlobal = () => {\n    if (resolveGlobalPromise) {\n      resolveGlobalPromise();\n      resolveGlobalPromise = undefined;\n    }\n    isFirstGlobalResolved = true;\n  };\n\n  if (localStorage.getItem(MULTITAB_LOCALSTORAGE_KEY)) {\n    setTimeout(resolveWithoutGlobal, MULTITAB_ESTABLISH_TIMEOUT);\n  } else {\n    resolveWithoutGlobal();\n    return Promise.resolve();\n  }\n\n  return new Promise((resolve) => {\n    resolveGlobalPromise = resolve;\n  });\n}\n\nexport function notifyLangpackUpdate(langCode: string) {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'langpackRefresh',\n    langCode,\n  });\n}\n","import { getActions, getGlobal, setGlobal } from '../global';\n\nimport type {\n  ApiChat, ApiMessage, ApiPeer, ApiPeerReaction,\n  ApiPhoneCall, ApiUser,\n} from '../api/types';\nimport { ApiMediaFormat } from '../api/types';\n\nimport { APP_NAME, DEBUG, IS_TEST } from '../config';\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getMessageAction,\n  getMessageRecentReaction,\n  getMessageSenderName,\n  getMessageStatefulContent,\n  getPrivateChatUserId,\n  getUserFullName,\n  isActionMessage,\n  isChatChannel,\n  selectIsChatMuted,\n  selectShouldShowMessagePreview,\n} from '../global/helpers';\nimport { getMessageSummaryText } from '../global/helpers/messageSummary';\nimport { getMessageReplyInfo } from '../global/helpers/replies';\nimport { addNotifyExceptions, replaceSettings } from '../global/reducers';\nimport {\n  selectChat,\n  selectChatMessage,\n  selectCurrentMessageList,\n  selectIsChatWithSelf,\n  selectNotifyExceptions,\n  selectNotifySettings,\n  selectTopicFromMessage,\n  selectUser,\n} from '../global/selectors';\nimport { callApi } from '../api/gramjs';\nimport { renderActionMessageText } from '../components/common/helpers/renderActionMessageText';\nimport { buildCollectionByKey } from './iteratees';\nimport * as mediaLoader from './mediaLoader';\nimport { oldTranslate } from './oldLangProvider';\nimport { debounce } from './schedulers';\nimport { IS_ELECTRON, IS_SERVICE_WORKER_SUPPORTED, IS_TOUCH_ENV } from './windowEnvironment';\n\nfunction getDeviceToken(subscription: PushSubscription) {\n  const data = subscription.toJSON();\n  return JSON.stringify({\n    endpoint: data.endpoint,\n    keys: data.keys,\n  });\n}\n\nfunction checkIfPushSupported() {\n  if (!IS_SERVICE_WORKER_SUPPORTED || IS_ELECTRON) return false;\n\n  if (!('showNotification' in ServiceWorkerRegistration.prototype)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Push notifications aren\\'t supported.');\n    }\n    return false;\n  }\n\n  // If permission is denied, it is blocked until the user manually changes their settings\n  if (Notification.permission === 'denied') {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] The user has blocked push notifications.');\n    }\n    return false;\n  }\n\n  // Check if push messaging is supported\n  if (!('PushManager' in window)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Push messaging isn\\'t supported.');\n    }\n    return false;\n  }\n\n  return true;\n}\n\nexport function checkIfNotificationsSupported() {\n  // Let's check if the browser supports notifications\n  if (!('Notification' in window)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] This browser does not support desktop notification');\n    }\n    return false;\n  }\n\n  if (Notification.permission === 'denied' as NotificationPermission) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] The user has blocked push notifications.');\n    }\n    return false;\n  }\n  return true;\n}\n\nconst expirationTime = 12 * 60 * 60 * 1000; // 12 hours\n// Notification id is removed from soundPlayed cache after 3 seconds\nconst soundPlayedDelay = 3 * 1000;\nconst soundPlayedIds = new Set<string>();\nconst notificationSound = new Audio('./notification.mp3');\nnotificationSound.setAttribute('mozaudiochannel', 'notification');\n\nexport async function playNotifySound(id?: string, volume?: number) {\n  if (id !== undefined && soundPlayedIds.has(id)) return;\n  const { notificationSoundVolume } = selectNotifySettings(getGlobal());\n  const currentVolume = volume ? volume / 10 : notificationSoundVolume / 10;\n  if (currentVolume === 0) return;\n  notificationSound.volume = currentVolume;\n  if (id !== undefined) {\n    notificationSound.addEventListener('ended', () => {\n      soundPlayedIds.add(id);\n    }, { once: true });\n\n    setTimeout(() => {\n      soundPlayedIds.delete(id);\n    }, soundPlayedDelay);\n  }\n\n  try {\n    await notificationSound.play();\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Unable to play notification sound');\n    }\n  }\n}\n\nexport const playNotifySoundDebounced = debounce(playNotifySound, 1000, true, false);\n\nfunction checkIfShouldResubscribe(subscription: PushSubscription | null) {\n  const global = getGlobal();\n  if (!global.push || !subscription) return true;\n  if (getDeviceToken(subscription) !== global.push.deviceToken) return true;\n  return Date.now() - global.push.subscribedAt > expirationTime;\n}\n\nexport async function requestPermission() {\n  if (!('Notification' in window)) {\n    return false;\n  }\n  let permission = Notification.permission;\n  if (!['granted', 'denied'].includes(permission)) {\n    permission = await Notification.requestPermission();\n  }\n  return permission === 'granted';\n}\n\nasync function unsubscribeFromPush(subscription: PushSubscription | null) {\n  const global = getGlobal();\n  const { deleteDeviceToken } = getActions();\n  if (subscription) {\n    try {\n      const deviceToken = getDeviceToken(subscription);\n      await callApi('unregisterDevice', deviceToken);\n      await subscription.unsubscribe();\n      deleteDeviceToken();\n      return;\n    } catch (error) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[PUSH] Unable to unsubscribe from push.', error);\n      }\n    }\n  }\n  if (global.push) {\n    await callApi('unregisterDevice', global.push.deviceToken);\n    deleteDeviceToken();\n  }\n}\n\nexport async function unsubscribe() {\n  if (!checkIfPushSupported()) return;\n  const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n  const subscription = await serviceWorkerRegistration.pushManager.getSubscription();\n  await unsubscribeFromPush(subscription);\n}\n\n// Indicates if notification settings are loaded from the api\nlet areSettingsLoaded = false;\n\n// Load notification settings from the api\nasync function loadNotificationSettings() {\n  if (areSettingsLoaded) return selectNotifySettings(getGlobal());\n  const [resultSettings, resultExceptions] = await Promise.all([\n    callApi('fetchNotificationSettings'),\n    callApi('fetchNotificationExceptions'),\n  ]);\n  if (!resultSettings) return selectNotifySettings(getGlobal());\n\n  let global = replaceSettings(getGlobal(), resultSettings);\n  if (resultExceptions) {\n    global = addNotifyExceptions(global, resultExceptions);\n  }\n  setGlobal(global);\n  areSettingsLoaded = true;\n  return selectNotifySettings(global);\n}\n\n// Load custom emoji from the api if it's not cached already\nasync function loadCustomEmoji(id: string) {\n  let global = getGlobal();\n  if (global.customEmojis.byId[id]) return;\n  const customEmoji = await callApi('fetchCustomEmoji', {\n    documentId: [id],\n  });\n  if (!customEmoji) return;\n  global = getGlobal();\n  global = {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      byId: {\n        ...global.customEmojis.byId,\n        ...buildCollectionByKey(customEmoji, 'id'),\n      },\n    },\n  };\n  setGlobal(global);\n}\n\nlet isSubscriptionFailed = false;\nexport function checkIfOfflinePushFailed() {\n  return isSubscriptionFailed;\n}\n\nexport async function subscribe() {\n  const { setDeviceToken, updateWebNotificationSettings } = getActions();\n  let hasWebNotifications = false;\n  let hasPushNotifications = false;\n  if (!checkIfPushSupported()) {\n    // Ask for notification permissions only if service worker notifications are not supported\n    // As pushManager.subscribe automatically triggers permission popup\n    hasWebNotifications = await requestPermission();\n    updateWebNotificationSettings({\n      hasWebNotifications,\n      hasPushNotifications,\n    });\n    return;\n  }\n  const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n  let subscription = await serviceWorkerRegistration.pushManager.getSubscription();\n  if (!checkIfShouldResubscribe(subscription)) return;\n  await unsubscribeFromPush(subscription);\n  try {\n    subscription = await serviceWorkerRegistration.pushManager.subscribe({\n      userVisibleOnly: true,\n    });\n    const deviceToken = getDeviceToken(subscription);\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.log('[PUSH] Received push subscription: ', deviceToken);\n    }\n    await callApi('registerDevice', deviceToken);\n    setDeviceToken(deviceToken);\n    hasPushNotifications = true;\n    hasWebNotifications = true;\n  } catch (error: any) {\n    if (Notification.permission === 'denied') {\n      // The user denied the notification permission which\n      // means we failed to subscribe and the user will need\n      // to manually change the notification permission to\n      // subscribe to push messages\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn('[PUSH] The user has blocked push notifications.');\n      }\n    } else {\n      // A problem occurred with the subscription, this can\n      // often be down to an issue or lack of the gcm_sender_id\n      // and / or gcm_user_visible_only\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[PUSH] Unable to subscribe to push.', error);\n      }\n      // Request permissions and fall back to local notifications\n      // if pushManager.subscribe was aborted due to invalid VAPID key.\n      if ([DOMException.ABORT_ERR, DOMException.NOT_SUPPORTED_ERR].includes(error.code)) {\n        isSubscriptionFailed = true;\n        hasWebNotifications = await requestPermission();\n      }\n    }\n  }\n  updateWebNotificationSettings({\n    hasWebNotifications,\n    hasPushNotifications,\n  });\n}\n\nfunction checkIfShouldNotify(chat: ApiChat, message: Partial<ApiMessage>) {\n  if (!areSettingsLoaded) return false;\n  const global = getGlobal();\n  const isMuted = selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global));\n  const shouldNotifyAboutMessage = !message.content?.action?.phoneCall;\n  if (isMuted || !shouldNotifyAboutMessage\n     || chat.isNotJoined || !chat.isListed || selectIsChatWithSelf(global, chat.id)) {\n    return false;\n  }\n  // On touch devices show notifications when chat is not active\n  if (IS_TOUCH_ENV) {\n    const {\n      chatId,\n      type,\n    } = selectCurrentMessageList(global) || {};\n    return !(chatId === chat.id && type === 'thread');\n  }\n  // On desktop show notifications when window is not focused\n  return !document.hasFocus();\n}\n\nfunction getNotificationContent(chat: ApiChat, message: ApiMessage, reaction?: ApiPeerReaction) {\n  const global = getGlobal();\n  let {\n    senderId,\n  } = message;\n  const hasReaction = Boolean(reaction);\n  if (hasReaction) senderId = reaction.peerId;\n\n  const { isScreenLocked } = global.passcode;\n  const messageSenderChat = senderId ? selectChat(global, senderId) : undefined;\n  const messageSenderUser = senderId ? selectUser(global, senderId) : undefined;\n  const messageAction = getMessageAction(message as ApiMessage);\n\n  const replyInfo = getMessageReplyInfo(message);\n  const actionTargetMessage = messageAction && replyInfo?.replyToMsgId\n    ? selectChatMessage(global, replyInfo?.replyFrom?.fromChatId || chat.id, replyInfo.replyToMsgId)\n    : undefined;\n  const {\n    targetUserIds: actionTargetUserIds,\n    targetChatId: actionTargetChatId,\n  } = messageAction || {};\n\n  const actionTargetUsers = actionTargetUserIds\n    ? actionTargetUserIds.map((userId) => selectUser(global, userId))\n      .filter(Boolean)\n    : undefined;\n  const privateChatUserId = getPrivateChatUserId(chat);\n  const isSelf = privateChatUserId === global.currentUserId;\n\n  const topic = selectTopicFromMessage(global, message);\n\n  let body: string;\n  if (\n    !isScreenLocked\n    && selectShouldShowMessagePreview(chat, selectNotifySettings(global), selectNotifyExceptions(global))\n  ) {\n    const isChat = chat && (isChatChannel(chat) || message.senderId === message.chatId);\n\n    if (isActionMessage(message)) {\n      body = renderActionMessageText(\n        oldTranslate,\n        message,\n        messageSenderUser,\n        chat,\n        actionTargetUsers,\n        actionTargetMessage,\n        actionTargetChatId,\n        topic,\n        { asPlainText: true },\n      ) as string;\n    } else {\n      // TODO[forums] Support ApiChat\n      const senderName = getMessageSenderName(oldTranslate, chat.id, isChat ? messageSenderChat : messageSenderUser);\n      const statefulContent = getMessageStatefulContent(global, message);\n      let summary = getMessageSummaryText(oldTranslate, message, statefulContent, hasReaction, 60);\n\n      if (hasReaction) {\n        const emoji = getReactionEmoji(reaction);\n        summary = oldTranslate('PushReactText', [emoji, summary]);\n      }\n\n      body = senderName ? `${senderName}: ${summary}` : summary;\n    }\n  } else {\n    body = 'New message';\n  }\n\n  let title = isScreenLocked ? APP_NAME : getChatTitle(oldTranslate, chat, isSelf);\n\n  if (message.isSilent) {\n    title += ' 🔕';\n  }\n\n  return { title, body };\n}\n\nasync function getAvatar(chat: ApiPeer) {\n  const imageHash = getChatAvatarHash(chat);\n  if (!imageHash) return undefined;\n  let mediaData = mediaLoader.getFromMemory(imageHash);\n  if (!mediaData) {\n    await mediaLoader.fetch(imageHash, ApiMediaFormat.BlobUrl);\n    mediaData = mediaLoader.getFromMemory(imageHash);\n  }\n  return mediaData;\n}\n\nfunction getReactionEmoji(reaction: ApiPeerReaction) {\n  let emoji;\n  if (reaction.reaction.type === 'emoji') {\n    emoji = reaction.reaction.emoticon;\n  }\n\n  if (reaction.reaction.type === 'custom') {\n    // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n    emoji = getGlobal().customEmojis.byId[reaction.reaction.documentId]?.emoji;\n  }\n  return emoji || '❤️';\n}\n\nexport async function notifyAboutCall({\n  call, user,\n}: {\n  call: ApiPhoneCall; user: ApiUser;\n}) {\n  const { hasWebNotifications } = await loadNotificationSettings();\n  if (document.hasFocus() || !hasWebNotifications) return;\n  const areNotificationsSupported = checkIfNotificationsSupported();\n  if (!areNotificationsSupported) return;\n\n  const icon = await getAvatar(user);\n\n  const options: NotificationOptions = {\n    body: getUserFullName(user),\n    icon,\n    badge: icon,\n    tag: `call_${call.id}`,\n  };\n\n  if ('vibrate' in navigator) {\n    // @ts-ignore\n    options.vibrate = [200, 100, 200];\n  }\n\n  const notification = new Notification(oldTranslate('VoipIncoming'), options);\n\n  notification.onclick = () => {\n    notification.close();\n    if (window.focus) {\n      window.focus();\n    }\n  };\n}\n\nexport async function notifyAboutMessage({\n  chat,\n  message,\n  isReaction = false,\n}: { chat: ApiChat; message: Partial<ApiMessage>; isReaction?: boolean }) {\n  const { hasWebNotifications } = await loadNotificationSettings();\n  if (!checkIfShouldNotify(chat, message)) return;\n  const areNotificationsSupported = checkIfNotificationsSupported();\n  if (!hasWebNotifications || !areNotificationsSupported) {\n    if (!message.isSilent && !isReaction && !IS_ELECTRON) {\n      // Only play sound if web notifications are disabled\n      playNotifySoundDebounced(String(message.id) || chat.id);\n    }\n\n    return;\n  }\n  if (!areNotificationsSupported) return;\n\n  if (!message.id) return;\n\n  const activeReaction = getMessageRecentReaction(message);\n  // Do not notify about reactions on messages that are not outgoing\n  if (isReaction && !activeReaction) return;\n\n  // If this is a custom emoji reaction we need to make sure it is loaded\n  if (isReaction && activeReaction && activeReaction.reaction.type === 'custom') {\n    await loadCustomEmoji(activeReaction.reaction.documentId);\n  }\n\n  const icon = await getAvatar(chat);\n\n  const {\n    title,\n    body,\n  } = getNotificationContent(chat, message as ApiMessage, activeReaction);\n\n  if (checkIfPushSupported()) {\n    if (navigator.serviceWorker?.controller) {\n      // notify service worker about new message notification\n      navigator.serviceWorker.controller.postMessage({\n        type: 'showMessageNotification',\n        payload: {\n          title,\n          body,\n          icon,\n          chatId: chat.id,\n          messageId: message.id,\n          shouldReplaceHistory: true,\n          isSilent: message.isSilent,\n          reaction: activeReaction?.reaction,\n        },\n      });\n    }\n  } else {\n    const dispatch = getActions();\n    const options: NotificationOptions = {\n      body,\n      icon,\n      badge: icon,\n      tag: String(message.id),\n    };\n\n    if ('vibrate' in navigator) {\n      // @ts-ignore\n      options.vibrate = [200, 100, 200];\n    }\n\n    const notification = new Notification(title, options);\n\n    notification.onclick = () => {\n      notification.close();\n      dispatch.focusMessage({\n        chatId: chat.id,\n        messageId: message.id!,\n        shouldReplaceHistory: true,\n      });\n      if (window.focus) {\n        window.focus();\n      }\n    };\n\n    // Play sound when notification is displayed\n    notification.onshow = () => {\n      // TODO Update when reaction badges are implemented\n      if (isReaction || message.isSilent || IS_ELECTRON) return;\n      playNotifySoundDebounced(String(message.id) || chat.id);\n    };\n  }\n}\n\nexport function closeMessageNotifications(payload: { chatId: string; lastReadInboxMessageId?: number }) {\n  if (IS_TEST || !navigator.serviceWorker?.controller) return;\n  navigator.serviceWorker.controller.postMessage({\n    type: 'closeMessageNotifications',\n    payload,\n  });\n}\n\n// Notify service worker that client is fully loaded\nexport function notifyClientReady() {\n  if (!navigator.serviceWorker?.controller) return;\n  navigator.serviceWorker.controller.postMessage({\n    type: 'clientReady',\n  });\n}\n","import { getGlobal } from '../global';\n\nimport type { ApiOldLangPack, ApiOldLangString } from '../api/types';\nimport type { LangCode, TimeFormat } from '../types';\n\nimport {\n  LANG_CACHE_NAME, LANG_PACKS,\n} from '../config';\nimport { callApi } from '../api/gramjs';\nimport * as cacheApi from './cacheApi';\nimport { createCallbackManager } from './callbacks';\nimport { loadAndChangeLanguage } from './localization';\nimport { formatInteger } from './textFormat';\n\nexport interface LangFn {\n  (key: string, value?: any, format?: 'i', pluralValue?: number): string;\n\n  isRtl?: boolean;\n  code?: LangCode;\n  langName?: string;\n  timeFormat?: TimeFormat;\n}\n\nconst SUBSTITUTION_REGEX = /%\\d?\\$?[sdf@]/g;\nconst PLURAL_OPTIONS = ['value', 'zeroValue', 'oneValue', 'twoValue', 'fewValue', 'manyValue', 'otherValue'] as const;\n// Some rules edited from https://github.com/eemeli/make-plural/blob/master/packages/plurals/cardinals.js\nconst PLURAL_RULES = {\n  /* eslint-disable max-len */\n  en: (n: number) => (n !== 1 ? 6 : 2),\n  ar: (n: number) => (n === 0 ? 1 : n === 1 ? 2 : n === 2 ? 3 : n % 100 >= 3 && n % 100 <= 10 ? 4 : n % 100 >= 11 ? 5 : 6),\n  be: (n: number) => {\n    const s = String(n).split('.');\n    const t0 = Number(s[0]) === n;\n    const n10 = t0 ? Number(s[0].slice(-1)) : 0;\n    const n100 = t0 ? Number(s[0].slice(-2)) : 0;\n    return n10 === 1 && n100 !== 11 ? 2\n      : (n10 >= 2 && n10 <= 4) && (n100 < 12 || n100 > 14) ? 4\n        : (t0 && n10 === 0) || (n10 >= 5 && n10 <= 9) || (n100 >= 11 && n100 <= 14) ? 5\n          : 6;\n  },\n  ca: (n: number) => (n !== 1 ? 6 : 2),\n  cs: (n: number) => {\n    const s = String(n).split('.');\n    const i = Number(s[0]);\n    const v0 = !s[1];\n    return n === 1 && v0 ? 2 : (i >= 2 && i <= 4) && v0 ? 4 : !v0 ? 5 : 6;\n  },\n  de: (n: number) => (n !== 1 ? 6 : 2),\n  es: (n: number) => (n !== 1 ? 6 : 2),\n  fa: (n: number) => (n > 1 ? 6 : 2),\n  fi: (n: number) => (n !== 1 ? 6 : 2),\n  fr: (n: number) => (n > 1 ? 6 : 2),\n  id: () => 0,\n  it: (n: number) => (n !== 1 ? 6 : 2),\n  hr: (n: number) => {\n    const s = String(n).split('.');\n    const i = s[0];\n    const f = s[1] || '';\n    const v0 = !s[1];\n    const i10 = Number(i.slice(-1));\n    const i100 = Number(i.slice(-2));\n    const f10 = Number(f.slice(-1));\n    const f100 = Number(f.slice(-2));\n    return (v0 && i10 === 1 && i100 !== 11) || (f10 === 1 && f100 !== 11) ? 2\n      : (v0 && (i10 >= 2 && i10 <= 4) && (i100 < 12 || i100 > 14)) || ((f10 >= 2 && f10 <= 4) && (f100 < 12 || f100 > 14)) ? 4\n        : 6;\n  },\n  hu: (n: number) => (n > 1 ? 6 : 2),\n  ko: () => 0,\n  ms: () => 0,\n  nb: (n: number) => (n > 1 ? 6 : 2),\n  nl: (n: number) => (n !== 1 ? 6 : 2),\n  pl: (n: number) => (n === 1 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  'pt-br': (n: number) => (n > 1 ? 6 : 2),\n  ru: (n: number) => (n % 10 === 1 && n % 100 !== 11 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  sk: (n: number) => {\n    const s = String(n).split('.');\n    const i = Number(s[0]);\n    const v0 = !s[1];\n    return n === 1 && v0 ? 2 : (i >= 2 && i <= 4) && v0 ? 4 : !v0 ? 5 : 6;\n  },\n  sr: (n: number) => {\n    const s = String(n).split('.');\n    const i = s[0];\n    const f = s[1] || '';\n    const v0 = !s[1];\n    const i10 = Number(i.slice(-1));\n    const i100 = Number(i.slice(-2));\n    const f10 = Number(f.slice(-1));\n    const f100 = Number(f.slice(-2));\n    return (v0 && i10 === 1 && i100 !== 11) || (f10 === 1 && f100 !== 11) ? 2\n      : (v0 && (i10 >= 2 && i10 <= 4) && (i100 < 12 || i100 > 14)) || ((f10 >= 2 && f10 <= 4) && (f100 < 12 || f100 > 14)) ? 4\n        : 6;\n  },\n  tr: (n: number) => (n > 1 ? 6 : 2),\n  uk: (n: number) => (n % 10 === 1 && n % 100 !== 11 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  uz: (n: number) => (n > 1 ? 6 : 2),\n  /* eslint-enable max-len */\n};\n\nconst cache = new Map<string, string>();\n\nlet langPack: ApiOldLangPack | undefined;\nlet fallbackLangPack: ApiOldLangPack | undefined;\n\nconst {\n  addCallback,\n  removeCallback,\n  runCallbacks,\n} = createCallbackManager();\n\nexport { addCallback, removeCallback };\n\nlet currentLangCode: string | undefined;\nlet currentTimeFormat: TimeFormat | undefined;\n\nfunction createLangFn() {\n  return (key: string, value?: any, format?: 'i', pluralValue?: number) => {\n    if (value !== undefined) {\n      const cacheValue = Array.isArray(value) ? JSON.stringify(value) : value;\n      const cached = cache.get(`${key}_${cacheValue}_${format}${pluralValue ? `_${pluralValue}` : ''}`);\n      if (cached) {\n        return cached;\n      }\n    }\n\n    if (!fallbackLangPack) {\n      void importFallbackLangPack();\n    }\n\n    const langString = langPack?.[key] || fallbackLangPack?.[key];\n    if (!langString) {\n      return key;\n    }\n\n    return processTranslation(langString, key, value, format, pluralValue);\n  };\n}\n\nlet translationFn: LangFn = createLangFn();\n\n/**\n * @deprecated Do not translate inside non-reactive contexts. Pass parameters to the component instead\n */\nexport function oldTranslate(...args: Parameters<LangFn>) {\n  return translationFn(...args);\n}\n\nexport function getTranslationFn(): LangFn {\n  return translationFn;\n}\n\n/**\n * @deprecated Migrate to `changeLanguage` in `util/localization.ts` instead\n */\nexport async function oldSetLanguage(langCode: LangCode, callback?: NoneToVoidFunction, withFallback = false) {\n  loadAndChangeLanguage(langCode, true);\n  if (langPack && langCode === currentLangCode) {\n    if (callback) {\n      callback();\n    }\n\n    return;\n  }\n\n  let newLangPack = await cacheApi.fetch(LANG_CACHE_NAME, langCode, cacheApi.Type.Json);\n  if (!newLangPack) {\n    if (withFallback) {\n      await importFallbackLangPack();\n    }\n\n    newLangPack = await fetchRemote(langCode);\n    if (!newLangPack) {\n      return;\n    }\n  }\n\n  cache.clear();\n\n  currentLangCode = langCode;\n  langPack = newLangPack;\n  document.documentElement.lang = langCode;\n\n  const global = getGlobal();\n  const { languages, byKey } = global.settings;\n  const timeFormat = byKey?.timeFormat;\n  const langInfo = languages?.find((lang) => lang.langCode === langCode);\n  translationFn = createLangFn();\n  translationFn.isRtl = Boolean(langInfo?.isRtl);\n  translationFn.code = langCode.replace('-raw', '') as LangCode;\n  translationFn.langName = langInfo?.nativeName;\n  translationFn.timeFormat = timeFormat;\n\n  if (callback) {\n    callback();\n  }\n\n  runCallbacks();\n}\n\nexport function setTimeFormat(timeFormat: TimeFormat) {\n  if (timeFormat && timeFormat === currentTimeFormat) {\n    return;\n  }\n\n  currentTimeFormat = timeFormat;\n  translationFn.timeFormat = timeFormat;\n\n  runCallbacks();\n}\n\nasync function importFallbackLangPack() {\n  if (fallbackLangPack) {\n    return;\n  }\n\n  fallbackLangPack = (await import('./fallbackLangPack')).default;\n  runCallbacks();\n}\n\nasync function fetchRemote(langCode: string): Promise<ApiOldLangPack | undefined> {\n  const remote = await callApi('oldFetchLangPack', { sourceLangPacks: LANG_PACKS, langCode });\n  if (remote) {\n    await cacheApi.save(LANG_CACHE_NAME, langCode, remote.langPack);\n    return remote.langPack;\n  }\n\n  return undefined;\n}\n\nfunction getPluralOption(amount: number) {\n  const langCode = currentLangCode || 'en';\n  const optionIndex = PLURAL_RULES[langCode as keyof typeof PLURAL_RULES]\n    ? PLURAL_RULES[langCode as keyof typeof PLURAL_RULES](amount)\n    : 0;\n\n  return PLURAL_OPTIONS[optionIndex];\n}\n\nfunction processTemplate(template: string, value: any) {\n  value = Array.isArray(value) ? value : [value];\n  const translationSlices = template.split(SUBSTITUTION_REGEX);\n  const initialValue = translationSlices.shift();\n\n  return translationSlices.reduce((result, str, index) => {\n    return `${result}${String(value[index] ?? '')}${str}`;\n  }, initialValue || '');\n}\n\nfunction processTranslation(\n  langString: ApiOldLangString | undefined, key: string, value?: any, format?: 'i', pluralValue?: number,\n) {\n  const preferredPluralOption = typeof value === 'number' || pluralValue !== undefined\n    ? getPluralOption(pluralValue ?? value)\n    : 'value';\n  const template = typeof langString === 'string'\n    ? langString\n    : preferredPluralOption === 'value'\n      // Support cached older `langString` interface\n      ? (typeof langString === 'object' ? (langString as any).value : langString)\n      : typeof langString === 'object'\n        ? langString[preferredPluralOption] || langString.otherValue\n        : undefined;\n\n  if (!template?.trim()) {\n    const parts = key.split('.');\n\n    return parts[parts.length - 1];\n  }\n\n  if (value !== undefined) {\n    const formattedValue = format === 'i' ? formatInteger(value) : value;\n    const result = processTemplate(template, formattedValue);\n    const cacheValue = Array.isArray(value) ? JSON.stringify(value) : value;\n    cache.set(`${key}_${cacheValue}_${format}${pluralValue ? `_${pluralValue}` : ''}`, result);\n    return result;\n  }\n\n  return template;\n}\n","import type { ApiFormattedText, ApiMessageEntity } from '../api/types';\nimport { ApiMessageEntityTypes } from '../api/types';\nimport { getBlockQuoteInnerText } from '../components/common/Blockquote';\nimport { extractCodeBlockData } from '../components/common/code/CodeBlock';\nimport { getCustomEmojiInnerText } from '../components/common/CustomEmoji';\n\nimport { RE_LINK_TEMPLATE } from '../config';\nimport { isMarkdownMarker } from '../contest/text-editor';\nimport { Utils } from '../contest/text-editor/utils';\nimport { IS_EMOJI_SUPPORTED } from './windowEnvironment';\n\nexport const ENTITY_CLASS_BY_NODE_NAME: Record<string, ApiMessageEntityTypes> = {\n  B: ApiMessageEntityTypes.Bold,\n  STRONG: ApiMessageEntityTypes.Bold,\n  I: ApiMessageEntityTypes.Italic,\n  EM: ApiMessageEntityTypes.Italic,\n  INS: ApiMessageEntityTypes.Underline,\n  U: ApiMessageEntityTypes.Underline,\n  S: ApiMessageEntityTypes.Strike,\n  STRIKE: ApiMessageEntityTypes.Strike,\n  DEL: ApiMessageEntityTypes.Strike,\n  CODE: ApiMessageEntityTypes.Code,\n  PRE: ApiMessageEntityTypes.Pre,\n  BLOCKQUOTE: ApiMessageEntityTypes.Blockquote,\n};\n\nconst MAX_TAG_DEEPNESS = 3;\n\nexport default function parseHtmlAsFormattedText(\n  html: string, withMarkdownLinks = false, skipMarkdown = false\n): ApiFormattedText {\n  if (!skipMarkdown) {\n    skipMarkdown = true;\n    console.warn(\"Markdown parsing currently disabled in this function!\");\n    console.error(\"Markdown parsing currently disabled in this function!\");\n  }\n  const fragment = document.createElement('div');\n  fragment.innerHTML = html;\n  // skipMarkdown ? html\n  //   : withMarkdownLinks ? parseMarkdown(parseMarkdownLinks(html)) : parseMarkdown(html);\n  fixImageContent(fragment);\n  const innerText = [...fragment.childNodes].reduce((text, node) => text + getNodeInnerText(node), '');\n  const text = innerText.trim().replace(/\\u200b+/g, '');\n  const trimShift = innerText.indexOf(text[0]);\n  let textIndex = -trimShift;\n  let recursionDeepness = 0;\n  const entities: ApiMessageEntity[] = [];\n\n  function addEntity(node: ChildNode) {\n    if (node.nodeType === Node.COMMENT_NODE) return;\n    if (isMarkdownMarker(node)) return;\n    const { index, entity } = getEntityDataFromNode(node, text, textIndex);\n\n    if (entity) {\n      textIndex = index;\n      entities.push(entity);\n    } else if (node.textContent) {\n      // Skip newlines on the beginning\n      if (index === 0 && node.textContent.trim() === '') {\n        return;\n      }\n      textIndex += node.textContent.length;\n    }\n\n    // ? Skip Childs\n    if (entity?.type === ApiMessageEntityTypes.Pre\n      // || entity?.type === ApiMessageEntityTypes.Blockquote\n      || entity?.type === ApiMessageEntityTypes.CustomEmoji) return;\n    // ! FOR NOW\n    // if (entity?.type === ApiMessageEntityTypes.Spoiler) return;\n\n    if (node.hasChildNodes() && recursionDeepness <= MAX_TAG_DEEPNESS) {\n      recursionDeepness += 1;\n      Array.from(node.childNodes).forEach(addEntity);\n    }\n  }\n\n  Array.from(fragment.childNodes).forEach((node) => {\n    recursionDeepness = 1;\n    addEntity(node);\n  });\n\n  return {\n    text,\n    entities: entities.length ? entities : undefined,\n  };\n}\n\nfunction getNodeInnerText(node: ChildNode) {\n  return extractCodeBlockData(node)?.codeContent ||\n    getBlockQuoteInnerText(node)?.text ||\n    getCustomEmojiInnerText(node)?.text ||\n    Utils.getTextContentWithBreaks(node, { skipMarkdownMarker: true });\n}\n\nexport function fixImageContent(fragment: HTMLDivElement) {\n  fragment.querySelectorAll('img').forEach((node) => {\n    if (node.dataset.documentId) { // Custom Emoji\n      node.textContent = (node as HTMLImageElement).alt || '';\n    } else { // Regular emoji with image fallback\n      node.replaceWith(node.alt || '');\n    }\n  });\n}\n\n// function parseMarkdown(html: string) {\n//   let parsedHtml = html.slice(0);\n\n//   // Strip redundant nbsp's\n//   parsedHtml = parsedHtml.replace(/&nbsp;/g, ' ');\n\n//   // Replace <div><br></div> with newline (new line in Safari)\n//   parsedHtml = parsedHtml.replace(/<div><br([^>]*)?><\\/div>/g, '\\n');\n//   // Replace <br> with newline\n//   parsedHtml = parsedHtml.replace(/<br([^>]*)?>/g, '\\n');\n\n//   // Strip redundant <div> tags\n//   parsedHtml = parsedHtml.replace(/<\\/div>(\\s*)<div>/g, '\\n');\n//   parsedHtml = parsedHtml.replace(/<div>/g, '\\n');\n//   parsedHtml = parsedHtml.replace(/<\\/div>/g, '');\n\n//   // Pre\n//   parsedHtml = parsedHtml.replace(/^`{3}(.*?)[\\n\\r](.*?[\\n\\r]?)`{3}/gms, '<pre data-language=\"$1\">$2</pre>');\n//   parsedHtml = parsedHtml.replace(/^`{3}[\\n\\r]?(.*?)[\\n\\r]?`{3}/gms, '<pre>$1</pre>');\n//   parsedHtml = parsedHtml.replace(/[`]{3}([^`]+)[`]{3}/g, '<pre>$1</pre>');\n\n//   // Code\n//   parsedHtml = parsedHtml.replace(\n//     /(?!<(code|pre)[^<]*|<\\/)[`]{1}([^`\\n]+)[`]{1}(?![^<]*<\\/(code|pre)>)/g,\n//     '<code>$2</code>',\n//   );\n\n//   // Custom Emoji markdown tag\n//   if (!IS_EMOJI_SUPPORTED) {\n//     // Prepare alt text for custom emoji\n//     parsedHtml = parsedHtml.replace(/\\[<img[^>]+alt=\"([^\"]+)\"[^>]*>]/gm, '[$1]');\n//   }\n//   parsedHtml = parsedHtml.replace(\n//     /(?!<(?:code|pre)[^<]*|<\\/)\\[([^\\]\\n]+)\\]\\(customEmoji:(\\d+)\\)(?![^<]*<\\/(?:code|pre)>)/g,\n//     '<img alt=\"$1\" data-document-id=\"$2\">',\n//   );\n\n//   // Other simple markdown\n//   parsedHtml = parsedHtml.replace(\n//     /(?!<(code|pre)[^<]*|<\\/)[*]{2}([^*\\n]+)[*]{2}(?![^<]*<\\/(code|pre)>)/g,\n//     '<b>$2</b>',\n//   );\n//   parsedHtml = parsedHtml.replace(\n//     /(?!<(code|pre)[^<]*|<\\/)[_]{2}([^_\\n]+)[_]{2}(?![^<]*<\\/(code|pre)>)/g,\n//     '<i>$2</i>',\n//   );\n//   parsedHtml = parsedHtml.replace(\n//     /(?!<(code|pre)[^<]*|<\\/)[~]{2}([^~\\n]+)[~]{2}(?![^<]*<\\/(code|pre)>)/g,\n//     '<s>$2</s>',\n//   );\n//   parsedHtml = parsedHtml.replace(\n//     /(?!<(code|pre)[^<]*|<\\/)[|]{2}([^|\\n]+)[|]{2}(?![^<]*<\\/(code|pre)>)/g,\n//     `<span data-entity-type=\"${ApiMessageEntityTypes.Spoiler}\">$2</span>`,\n//   );\n\n//   return parsedHtml;\n// }\n\n// function parseMarkdownLinks(html: string) {\n//   return html.replace(new RegExp(`\\\\[([^\\\\]]+?)]\\\\((${RE_LINK_TEMPLATE}+?)\\\\)`, 'g'), (_, text, link) => {\n//     const url = link.includes('://') ? link : link.includes('@') ? `mailto:${link}` : `https://${link}`;\n//     return `<a href=\"${url}\">${text}</a>`;\n//   });\n// }\n\nfunction getEntityDataFromNode(\n  node: ChildNode,\n  rawText: string,\n  textIndex: number,\n): { index: number; entity?: ApiMessageEntity } {\n  const type = getEntityTypeFromNode(node);\n\n  if (!type || !node.textContent) {\n    return {\n      index: textIndex,\n      entity: undefined,\n    };\n  }\n\n  const textContent = getNodeInnerText(node)!;\n  const rawIndex = rawText.indexOf(textContent, textIndex);\n  // In some cases, last text entity ends with a newline (which gets trimmed from `rawText`).\n  // In this case, `rawIndex` would return `-1`, so we use `textIndex` instead.\n  const index = rawIndex >= 0 ? rawIndex : textIndex;\n  const offset = rawText.substring(0, index).length;\n  const { length } = rawText.substring(index, index + textContent.length);\n\n  if (type === ApiMessageEntityTypes.Blockquote) {\n    return {\n      index,\n      entity: {\n        type,\n        offset,\n        length,\n        collapsed: (node as HTMLElement).dataset.collapsed === \"true\" || undefined\n      },\n    };\n  }\n\n  if (type === ApiMessageEntityTypes.TextUrl) {\n    return {\n      index,\n      entity: {\n        type,\n        offset,\n        length,\n        url: (node as HTMLAnchorElement).href,\n      },\n    };\n  }\n  if (type === ApiMessageEntityTypes.MentionName) {\n    return {\n      index,\n      entity: {\n        type,\n        offset,\n        length,\n        userId: (node as HTMLAnchorElement).dataset.userId!,\n      },\n    };\n  }\n\n  if (type === ApiMessageEntityTypes.Pre) {\n    return {\n      index,\n      entity: {\n        type,\n        offset,\n        length,\n        language: (node as HTMLPreElement).dataset.language,\n      },\n    };\n  }\n\n  if (type === ApiMessageEntityTypes.CustomEmoji) {\n    return {\n      index,\n      entity: {\n        type,\n        offset,\n        length,\n        documentId: (node as HTMLImageElement).dataset.documentId!,\n      },\n    };\n  }\n\n  return {\n    index,\n    entity: {\n      type,\n      offset,\n      length,\n    },\n  };\n}\n\nexport function getEntityTypeFromNode(node: ChildNode): ApiMessageEntityTypes | undefined {\n  if (node instanceof HTMLElement && node.dataset.entityType) {\n    return node.dataset.entityType as ApiMessageEntityTypes;\n  }\n\n  // if (ENTITY_CLASS_BY_NODE_NAME[node.nodeName]) {\n  //   return ENTITY_CLASS_BY_NODE_NAME[node.nodeName];\n  // }\n\n  if (node.nodeName === 'A') {\n    const anchor = node as HTMLAnchorElement;\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.MentionName) {\n      return ApiMessageEntityTypes.MentionName;\n    }\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.Url) {\n      return ApiMessageEntityTypes.Url;\n    }\n    if (anchor.href.startsWith('mailto:')) {\n      return ApiMessageEntityTypes.Email;\n    }\n    if (anchor.href.startsWith('tel:')) {\n      return ApiMessageEntityTypes.Phone;\n    }\n    if (anchor.href !== anchor.textContent) {\n      return ApiMessageEntityTypes.TextUrl;\n    }\n\n    return ApiMessageEntityTypes.Url;\n  }\n\n  if (node.nodeName === 'SPAN') {\n    return (node as HTMLElement).dataset.entityType as any;\n  }\n\n  if (node.nodeName === 'IMG') {\n    if ((node as HTMLImageElement).dataset.documentId) {\n      return ApiMessageEntityTypes.CustomEmoji;\n    }\n  }\n\n  return undefined;\n}\n","import { LEGACY_PASSCODE_CACHE_NAME } from '../config';\nimport { PASSCODE_IDB_STORE } from './browser/idb';\nimport * as cacheApi from './cacheApi';\n\nconst IV_LENGTH = 12;\nconst SALT = 'harder better faster stronger';\n\nlet currentPasscodeHash: ArrayBuffer | undefined;\n\nexport class UnrecoverablePasscodeError extends Error {}\n\nexport function getPasscodeHash() {\n  return currentPasscodeHash;\n}\n\nexport function setPasscodeHash(passcodeHash: ArrayBuffer) {\n  currentPasscodeHash = passcodeHash;\n}\n\nexport async function setupPasscode(passcode: string) {\n  currentPasscodeHash = await sha256(passcode);\n}\n\nexport async function encryptSession(sessionJson?: string, globalJson?: string) {\n  if (!currentPasscodeHash) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing current passcode');\n    throw new Error('[api/passcode] Missing current passcode');\n  }\n\n  await Promise.all([\n    (async () => {\n      if (!sessionJson) return;\n\n      const sessionEncrypted = await aesEncrypt(sessionJson, currentPasscodeHash);\n      await store('sessionEncrypted', sessionEncrypted);\n    })(),\n    (async () => {\n      if (!globalJson) return;\n\n      const globalEncrypted = await aesEncrypt(globalJson, currentPasscodeHash);\n      await store('globalEncrypted', globalEncrypted);\n    })(),\n  ]);\n}\n\nexport async function decryptSessionByCurrentHash() {\n  if (!currentPasscodeHash) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing current passcode');\n    throw new Error('[api/passcode] Missing current passcode');\n  }\n\n  const [sessionEncrypted, globalEncrypted] = await Promise.all([\n    load('sessionEncrypted'),\n    load('globalEncrypted'),\n  ]);\n\n  if (!sessionEncrypted || !globalEncrypted) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing required stored fields');\n    throw new Error('[api/passcode] Missing required stored fields');\n  }\n\n  try {\n    const [sessionJson, globalJson] = await Promise.all([\n      aesDecrypt(sessionEncrypted, currentPasscodeHash),\n      aesDecrypt(globalEncrypted, currentPasscodeHash),\n    ]);\n\n    return { sessionJson, globalJson };\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Error decrypting session', err);\n    throw err;\n  }\n}\n\nexport async function decryptSession(passcode: string) {\n  const passcodeHash = await sha256(passcode);\n\n  const [sessionEncrypted, globalEncrypted] = await Promise.all([\n    load('sessionEncrypted'),\n    load('globalEncrypted'),\n  ]);\n\n  if (!sessionEncrypted || !globalEncrypted) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing required stored fields');\n    throw new UnrecoverablePasscodeError('[api/passcode] Missing required stored fields');\n  }\n\n  try {\n    const [sessionJson, globalJson] = await Promise.all([\n      aesDecrypt(sessionEncrypted, passcodeHash),\n      aesDecrypt(globalEncrypted, passcodeHash),\n    ]);\n\n    currentPasscodeHash = passcodeHash;\n\n    return { sessionJson, globalJson };\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Error decrypting session', err);\n    throw err;\n  }\n}\n\nexport function forgetPasscode() {\n  currentPasscodeHash = undefined;\n}\n\nexport function clearEncryptedSession() {\n  forgetPasscode();\n  PASSCODE_IDB_STORE.clear();\n  return cacheApi.clear(LEGACY_PASSCODE_CACHE_NAME);\n}\n\nfunction sha256(plaintext: string) {\n  return crypto.subtle.digest('SHA-256', new TextEncoder().encode(`${plaintext}${SALT}`));\n}\n\nfunction store(key: string, value: ArrayBuffer) {\n  const asArray = Array.from(new Uint8Array(value));\n  PASSCODE_IDB_STORE.set(key, asArray);\n}\n\nasync function load(key: string) {\n  const cached = await PASSCODE_IDB_STORE.get<number[]>(key);\n  if (cached) {\n    const asArrayBuffer = new Uint8Array(cached).buffer;\n    return asArrayBuffer;\n  }\n  // Fallback for old data\n  return cacheApi.fetch(LEGACY_PASSCODE_CACHE_NAME, key, cacheApi.Type.ArrayBuffer);\n}\n\nasync function aesEncrypt(plaintext: string, pwHash: ArrayBuffer) {\n  const iv = crypto.getRandomValues(new Uint8Array(IV_LENGTH));\n  const alg = { name: 'AES-GCM', iv };\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['encrypt']);\n  const ptUint8 = new TextEncoder().encode(plaintext);\n  const ctBuffer = await crypto.subtle.encrypt(alg, key, ptUint8);\n  const ct = new Uint8Array(ctBuffer);\n  const result = new Uint8Array(IV_LENGTH + ct.length);\n  result.set(iv, 0);\n  result.set(ct, IV_LENGTH);\n  return result.buffer;\n}\n\nasync function aesDecrypt(data: ArrayBuffer, pwHash: ArrayBuffer) {\n  const dataArray = new Uint8Array(data);\n  const iv = dataArray.slice(0, IV_LENGTH);\n  const alg = { name: 'AES-GCM', iv };\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']);\n  const ct = dataArray.slice(IV_LENGTH);\n  const plainBuffer = await crypto.subtle.decrypt(alg, key, ct);\n\n  return new TextDecoder().decode(plainBuffer);\n}\n","/*\n * Thanks to Ace Monkey for this mind-blowing patch.\n */\n\nexport function patchSafariProgressiveAudio(audioEl: HTMLAudioElement) {\n  if (audioEl.dataset.patchedForSafari) {\n    return;\n  }\n\n  audioEl.addEventListener('play', () => {\n    const t = audioEl.currentTime;\n\n    audioEl.dataset.patchForSafariInProgress = 'true';\n    function onProgress() {\n      if (!audioEl.buffered.length) {\n        return;\n      }\n      audioEl.currentTime = audioEl.duration - 1;\n      audioEl.addEventListener('progress', () => {\n        delete audioEl.dataset.patchForSafariInProgress;\n        audioEl.currentTime = t;\n        if (audioEl.paused && !audioEl.dataset.preventPlayAfterPatch) {\n          audioEl.play();\n        }\n      }, { once: true });\n\n      audioEl.removeEventListener('progress', onProgress);\n    }\n\n    audioEl.addEventListener('progress', onProgress);\n  }, { once: true });\n\n  audioEl.dataset.patchedForSafari = 'true';\n}\n\nexport function isSafariPatchInProgress(audioEl: HTMLAudioElement) {\n  return Boolean(audioEl.dataset.patchForSafariInProgress);\n}\n","import type { PerformanceType } from '../types';\n\nexport function applyPerformanceSettings(performanceType: PerformanceType) {\n  const {\n    pageTransitions,\n    messageSendingAnimations,\n    mediaViewerAnimations,\n    messageComposerAnimations,\n    contextMenuAnimations,\n    contextMenuBlur,\n    rightColumnAnimations,\n  } = performanceType;\n\n  const root = document.body;\n\n  root.classList.toggle('no-page-transitions', !pageTransitions);\n  root.classList.toggle('no-message-sending-animations', !messageSendingAnimations);\n  root.classList.toggle('no-media-viewer-animations', !mediaViewerAnimations);\n  root.classList.toggle('no-message-composer-animations', !messageComposerAnimations);\n  root.classList.toggle('no-context-menu-animations', !contextMenuAnimations);\n  root.classList.toggle('no-menu-blur', !contextMenuBlur);\n  root.classList.toggle('no-right-column-animations', !rightColumnAnimations);\n}\n","import { getActions } from '../global';\n\nimport { PRODUCTION_HOSTNAME, WEB_VERSION_BASE } from '../config';\nimport { clearWebsync } from './websync';\n\nconst SEARCH_ENGINE_REGEX = /(^|\\.)(google|bing|duckduckgo|ya|yandex)\\./i;\n// Handled by the legacy version. Cannot be updated\nconst PERMANENT_VERSION_KEY = 'kz_version';\nconst AVAILABLE_VERSIONS = ['Z', 'K'] as const;\nconst CLIENT_VERSION = 'Z';\ntype AvailableVersions = typeof AVAILABLE_VERSIONS[number];\n\nfunction setPermanentWebVersion(version: AvailableVersions) {\n  localStorage.setItem(PERMANENT_VERSION_KEY, JSON.stringify(version));\n}\n\nexport function getPermanentWebVersion(): AvailableVersions | undefined {\n  const version = localStorage.getItem(PERMANENT_VERSION_KEY);\n  if (version) {\n    return JSON.parse(version);\n  }\n\n  return undefined;\n}\n\nexport function switchPermanentWebVersion(version: AvailableVersions) {\n  setPermanentWebVersion(version);\n  clearWebsync();\n  getActions().skipLockOnUnload();\n  window.location.assign(`${WEB_VERSION_BASE}${version.toLowerCase()}`);\n}\n\nexport function checkAndAssignPermanentWebVersion() {\n  if (window.location.hostname !== PRODUCTION_HOSTNAME) return;\n\n  const referrer = document.referrer.toLowerCase();\n  if (!referrer) return;\n  try {\n    const isSearchEngine = new URL(referrer).host.match(SEARCH_ENGINE_REGEX);\n    if (!isSearchEngine) return;\n\n    const currentVersion = getPermanentWebVersion();\n    if (currentVersion) {\n      if (currentVersion !== CLIENT_VERSION) {\n        switchPermanentWebVersion(currentVersion);\n      }\n      return;\n    }\n\n    const urlParams = new URLSearchParams(window.location.search);\n    const hasTest = (urlParams.get('test') ?? undefined) !== undefined;\n    const shouldRedirect = Math.random() < 0.5;\n\n    if (hasTest || !shouldRedirect) {\n      setPermanentWebVersion('Z');\n      return;\n    }\n\n    switchPermanentWebVersion('K');\n  } catch (e) {\n    // Ignore\n  }\n}\n","import type { ApiCountryCode } from '../api/types';\n\nconst PATTERN_PLACEHOLDER = 'X';\nconst DEFAULT_PATTERN = 'XXX XXX XXX XXX';\n\nexport function getCountryCodesByIso(phoneCodeList: ApiCountryCode[], iso: string) {\n  return phoneCodeList.filter((country) => country.iso2 === iso);\n}\n\nexport function getCountryFromPhoneNumber(phoneCodeList: ApiCountryCode[], input = '') {\n  let phoneNumber = input.replace(/[^\\d+]+/g, '');\n  if (phoneNumber.startsWith('+')) {\n    phoneNumber = phoneNumber.substr(1);\n  }\n\n  const possibleCountries = phoneCodeList\n    .filter((country) => phoneNumber.startsWith(country.countryCode));\n  const codesWithPrefix: { code: string; country: ApiCountryCode }[] = possibleCountries\n    .map((country) => (country.prefixes || ['']).map((prefix) => {\n      return {\n        code: `${country.countryCode}${prefix}`,\n        country,\n      };\n    }))\n    .flat();\n\n  const bestMatches = codesWithPrefix\n    .filter(({ code }) => phoneNumber.startsWith(code))\n    .sort((a, b) => a.code.length - b.code.length);\n\n  return bestMatches[bestMatches.length - 1]?.country;\n}\n\nexport function formatPhoneNumber(input: string, country?: ApiCountryCode) {\n  if (!input) {\n    return '';\n  }\n\n  let phoneNumber = input.replace(/[^\\d]+/g, '');\n  if (country) {\n    phoneNumber = phoneNumber.substr(country.countryCode.length);\n  } else if (input.startsWith('+')) {\n    return input;\n  }\n  const pattern = getBestPattern(phoneNumber, country?.patterns);\n\n  const result: string[] = []; // Result character array\n  let j = 0; // Position inside pattern\n  for (let i = 0; i < phoneNumber.length; i++) {\n    while (pattern[j] !== PATTERN_PLACEHOLDER && j < pattern.length) {\n      result.push(pattern[j]);\n      if (pattern[j] === phoneNumber[i]) { // If pattern contains digits, move input position too\n        i++;\n        if (i === phoneNumber.length) break; // But don't overdo it, or it will insert full pattern unexpectedly\n      }\n      j++;\n    }\n\n    result.push(phoneNumber[i]); // For placeholder characters, setting current input digit\n    j++;\n  }\n\n  return result.join('');\n}\n\nfunction getBestPattern(numberWithoutCode: string, patterns?: string[]) {\n  if (!patterns || patterns.length === 0) return DEFAULT_PATTERN;\n  if (patterns.length === 1) return patterns[0];\n\n  const defaultPattern = patterns.find((pattern) => pattern.startsWith(PATTERN_PLACEHOLDER)) || DEFAULT_PATTERN;\n\n  const bestMatches = patterns.filter((pattern) => {\n    const stripped = pattern.replace(/[^\\dX]+/g, '');\n    if (stripped.startsWith(PATTERN_PLACEHOLDER)) return false; // Don't consider default number format here\n    for (let i = 0; i < numberWithoutCode.length; i++) {\n      if (i > stripped.length - 1 || (stripped[i] !== PATTERN_PLACEHOLDER && stripped[i] !== numberWithoutCode[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n\n  // Playing it safe: if not sure, use default for that region\n  return bestMatches.length === 1 ? bestMatches[0] : defaultPattern;\n}\n\nexport function formatPhoneNumberWithCode(phoneCodeList: ApiCountryCode[], phoneNumber: string) {\n  if (!phoneNumber) {\n    return '';\n  }\n\n  const numberWithPlus = phoneNumber.startsWith('+') ? phoneNumber : `+${phoneNumber}`;\n  const country = getCountryFromPhoneNumber(phoneCodeList, numberWithPlus);\n  if (!country) {\n    return numberWithPlus;\n  }\n  return `+${country.countryCode} ${formatPhoneNumber(numberWithPlus, country)}`;\n}\n","/**\n * A Map that has a limited size. When the limit is reached, the oldest entry is removed.\n * Ignores last access time, only cares about insertion order.\n */\nexport default class LimitedMap<K, V> {\n  private map: Map<K, V>;\n\n  private insertionQueue: Set<K>;\n\n  constructor(private limit: number) {\n    this.map = new Map();\n    this.insertionQueue = new Set<K>();\n  }\n\n  public get(key: K): V | undefined {\n    return this.map.get(key);\n  }\n\n  public set(key: K, value: V): this {\n    if (this.map.size === this.limit) {\n      const keyToRemove = Array.from(this.insertionQueue).shift();\n      if (keyToRemove) {\n        this.map.delete(keyToRemove);\n        this.insertionQueue.delete(keyToRemove);\n      }\n    }\n\n    this.map.set(key, value);\n    this.insertionQueue.add(key);\n\n    return this;\n  }\n\n  public has(key: K): boolean {\n    return this.map.has(key);\n  }\n\n  public delete(key: K): boolean {\n    const result = this.map.delete(key);\n    if (result) {\n      this.insertionQueue.delete(key);\n    }\n    return result;\n  }\n\n  public clear(): void {\n    this.map.clear();\n    this.insertionQueue.clear();\n  }\n\n  public forEach(callbackfn: (value: V, key: K, map: Map<K, V>) => void, thisArg?: any): void {\n    this.map.forEach(callbackfn, thisArg);\n  }\n\n  public get size(): number {\n    return this.map.size;\n  }\n\n  public get [Symbol.toStringTag](): string {\n    return this.map[Symbol.toStringTag];\n  }\n\n  public [Symbol.iterator](): IterableIterator<[K, V]> {\n    return this.map[Symbol.iterator]();\n  }\n\n  public entries(): IterableIterator<[K, V]> {\n    return this.map.entries();\n  }\n\n  public keys(): IterableIterator<K> {\n    return this.map.keys();\n  }\n\n  public values(): IterableIterator<V> {\n    return this.map.values();\n  }\n}\n","import { type TeactNode } from '../lib/teact/teact';\n\nexport function replaceWithTeact(\n  input: string, searchValue: string | RegExp, replaceValue: TeactNode,\n) {\n  const parts = input.split(searchValue);\n  const [firstElement, ...rest] = parts;\n\n  return rest.reduce((acc: TeactNode[], curr: string): TeactNode[] => (\n    acc.concat(replaceValue, curr)\n  ), [firstElement]).filter(Boolean);\n}\n\nexport function replaceInStringsWithTeact(\n  input: TeactNode[], searchValue: string | RegExp, replaceValue: TeactNode,\n) {\n  return input.flatMap((curr: TeactNode) => {\n    if (typeof curr === 'string') return replaceWithTeact(curr, searchValue, replaceValue);\n    return curr;\n  }, []);\n}\n","import { getActions } from '../global';\n\nimport type { CallbackAction } from '../global/types';\n\nconst callbacks = new Map<string, number>();\n\n// TODO Pass callbacks to the master tab. Sync them on master change\nexport default function requestActionTimeout(action: CallbackAction, timeout: number) {\n  const name = action.action;\n  clearTimeout(callbacks.get(name));\n  const timerId = window.setTimeout(() => {\n    // @ts-ignore\n    getActions()[name](action.payload);\n  }, timeout);\n  callbacks.set(name, timerId);\n}\n","import type { MessageListType, ThreadId } from '../types';\nimport { MAIN_THREAD_ID } from '../api/types';\n\nimport { IS_MOCKED_CLIENT } from '../config';\n\nlet parsedInitialLocationHash: Record<string, string> | undefined;\nlet messageHash: string | undefined;\nlet isAlreadyParsed = false;\nlet initialLocationHash = window.location.hash;\n\nexport function resetInitialLocationHash() {\n  isAlreadyParsed = false;\n  messageHash = undefined;\n  parsedInitialLocationHash = undefined;\n  initialLocationHash = '';\n}\n\nexport function resetLocationHash() {\n  window.location.hash = '';\n}\n\nexport const createLocationHash = (chatId: string, type: MessageListType, threadId: ThreadId): string => {\n  const displayType = type === 'thread' ? undefined : type;\n  const parts = threadId === MAIN_THREAD_ID ? [chatId, displayType] : [chatId, threadId, displayType];\n\n  return parts.filter(Boolean).join('_');\n};\n\nexport function parseLocationHash(currentUserId?: string) {\n  parseInitialLocationHash();\n\n  if (!messageHash) return undefined;\n\n  const parts = messageHash.split('_');\n  let chatId: string | undefined;\n  let type: string | undefined;\n  let threadId: string | undefined;\n  if (parts.length === 1) {\n    chatId = parts[0];\n  } else if (parts.length === 2) {\n    const isType = ['thread', 'pinned', 'scheduled'].includes(parts[1]);\n    chatId = parts[0];\n    type = isType ? parts[1] : 'thread';\n    threadId = !isType ? parts[1] : undefined;\n  } else if (parts.length >= 3) {\n    [chatId, threadId, type] = parts;\n  }\n  if (!chatId?.match(/^-?\\d+$/)) return undefined;\n\n  const isType = ['thread', 'pinned', 'scheduled'].includes(type!);\n\n  const castedThreadId = (chatId === currentUserId ? threadId : Number(threadId)) || MAIN_THREAD_ID;\n\n  return {\n    chatId,\n    type: type && isType ? (type as MessageListType) : 'thread',\n    threadId: castedThreadId,\n  };\n}\n\nexport const createMessageHashUrl = (chatId: string, type: MessageListType, threadId: ThreadId): string => {\n  const url = new URL(window.location.href);\n  url.hash = createLocationHash(chatId, type, threadId);\n  return url.href;\n};\n\nexport function parseInitialLocationHash() {\n  if (parsedInitialLocationHash) return parsedInitialLocationHash;\n\n  if (isAlreadyParsed) return undefined;\n\n  const locationHash = getInitialLocationHash();\n  if (!locationHash) return undefined;\n\n  let parsedHash = locationHash.replace(/^#/, '');\n  if (parsedHash.includes('?')) {\n    [messageHash, parsedHash] = parsedHash.split('?');\n    if (!IS_MOCKED_CLIENT) {\n      window.location.hash = messageHash;\n    }\n  } else if (parsedHash.includes('=')) {\n    if (!IS_MOCKED_CLIENT) {\n      window.location.hash = '';\n    }\n  }\n\n  parsedInitialLocationHash = parsedHash.includes('=') ? parsedHash.split('&').reduce((acc, cur) => {\n    const [key, value] = cur.split('=');\n    acc[key] = value;\n    return acc;\n  }, {} as Record<string, string>) : undefined;\n  isAlreadyParsed = true;\n  if (!parsedInitialLocationHash) {\n    messageHash = parsedHash;\n  }\n\n  return parsedInitialLocationHash;\n}\n\nexport function clearWebTokenAuth() {\n  if (!parsedInitialLocationHash) return;\n\n  delete parsedInitialLocationHash.tgWebAuthToken;\n}\n\nfunction getInitialLocationHash() {\n  return initialLocationHash;\n}\n","import { DEBUG_MORE } from '../config';\nimport { handleError } from './handleError';\n\nconst SAFE_EXEC_ENABLED = !DEBUG_MORE;\n\nexport default function safeExec<F extends AnyFunction>(\n  cb: F,\n  rescue?: (err: Error) => void,\n  always?: NoneToVoidFunction,\n): ReturnType<F> | undefined {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  try {\n    return cb();\n  } catch (err: any) {\n    rescue?.(err);\n    handleError(err);\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n","import { DEBUG } from '../config';\n\nconst safePlay = (mediaEl: HTMLMediaElement) => {\n  mediaEl.play().catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn(err, mediaEl);\n    }\n  });\n};\n\nexport const getIsVideoPlaying = (video: HTMLVideoElement) => {\n  return video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2;\n};\n\nexport default safePlay;\n","export type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\nexport function throttle<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n) {\n  let interval: number | undefined;\n  let isPending: boolean;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    isPending = true;\n    args = _args;\n\n    if (!interval) {\n      if (shouldRunFirst) {\n        isPending = false;\n        fn(...args);\n      }\n\n      // eslint-disable-next-line no-restricted-globals\n      interval = self.setInterval(() => {\n        if (!isPending) {\n          // eslint-disable-next-line no-restricted-globals\n          self.clearInterval(interval!);\n          interval = undefined;\n          return;\n        }\n\n        isPending = false;\n        fn(...args);\n      }, ms);\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          currentTimeoutCallbacks.forEach(fastRafCallbacks.delete, fastRafCallbacks);\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nconst IDLE_TIMEOUT = 500;\n\nlet onIdleCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onIdle(callback: NoneToVoidFunction) {\n  // eslint-disable-next-line no-restricted-globals\n  if (!self.requestIdleCallback) {\n    onTickEnd(callback);\n    return;\n  }\n\n  if (!onIdleCallbacks) {\n    onIdleCallbacks = [callback];\n\n    requestIdleCallback((deadline) => {\n      const currentCallbacks = onIdleCallbacks!;\n      onIdleCallbacks = undefined;\n\n      while (currentCallbacks.length) {\n        const cb = currentCallbacks.shift()!;\n        cb();\n\n        if (!deadline.timeRemaining()) break;\n      }\n\n      if (currentCallbacks.length) {\n        if (onIdleCallbacks) {\n          // Prepend the remaining callbacks if the next pass is already planned\n          onIdleCallbacks = currentCallbacks.concat(onIdleCallbacks);\n        } else {\n          currentCallbacks.forEach(onIdle);\n        }\n      }\n    }, { timeout: IDLE_TIMEOUT });\n  } else {\n    onIdleCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n    // eslint-disable-next-line no-restricted-globals\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n","let RE_NOT_LETTER: RegExp;\n\ntry {\n  RE_NOT_LETTER = /[^\\p{L}\\p{M}]+/ui;\n} catch (e) {\n  // Support for older versions of firefox\n  RE_NOT_LETTER = /[^\\wа-яёґєії]+/i;\n}\n\nexport default function searchWords(haystack: string, needle: string | string[]) {\n  if (!haystack || !needle) {\n    return false;\n  }\n\n  const needleWords = typeof needle === 'string' ? needle.toLowerCase().split(RE_NOT_LETTER) : needle;\n  const haystackLower = haystack.toLowerCase();\n\n  // @optimization\n  if (needleWords.length === 1 && !haystackLower.includes(needleWords[0])) {\n    return false;\n  }\n\n  let haystackWords: string[];\n\n  return needleWords.every((needleWord) => {\n    if (!haystackLower.includes(needleWord)) {\n      return false;\n    }\n\n    if (!haystackWords) {\n      haystackWords = haystackLower.split(RE_NOT_LETTER);\n    }\n\n    return haystackWords.some((haystackWord) => haystackWord.startsWith(needleWord));\n  });\n}\n\nexport function prepareSearchWordsForNeedle(needle: string) {\n  const needleWords = needle.toLowerCase().split(RE_NOT_LETTER);\n\n  return (haystack: string) => searchWords(haystack, needleWords);\n}\n","let serverTimeOffset = 0;\n\nexport function setServerTimeOffset(_serverTimeOffset: number) {\n  serverTimeOffset = _serverTimeOffset;\n}\n\nexport function getServerTimeOffset() {\n  return serverTimeOffset;\n}\n\nexport function getServerTime() {\n  return Math.floor(Date.now() / 1000) + serverTimeOffset;\n}\n","import type { ApiSessionData } from '../api/types';\n\nimport {\n  DEBUG, IS_SCREEN_LOCKED_CACHE_KEY,\n  SESSION_USER_KEY,\n} from '../config';\n\nconst DC_IDS = [1, 2, 3, 4, 5];\n\nexport function hasStoredSession() {\n  if (checkSessionLocked()) {\n    return true;\n  }\n\n  const userAuthJson = localStorage.getItem(SESSION_USER_KEY);\n  if (!userAuthJson) {\n    return false;\n  }\n\n  try {\n    const userAuth = JSON.parse(userAuthJson);\n    return Boolean(userAuth && userAuth.id && userAuth.dcID);\n  } catch (err) {\n    // Do nothing.\n    return false;\n  }\n}\n\nexport function storeSession(sessionData: ApiSessionData, currentUserId?: string) {\n  const {\n    mainDcId, keys, hashes, isTest,\n  } = sessionData;\n\n  localStorage.setItem(SESSION_USER_KEY, JSON.stringify({\n    dcID: mainDcId,\n    id: currentUserId,\n    test: isTest,\n  }));\n  localStorage.setItem('dc', String(mainDcId));\n  Object.keys(keys).map(Number).forEach((dcId) => {\n    localStorage.setItem(`dc${dcId}_auth_key`, JSON.stringify(keys[dcId]));\n  });\n\n  if (hashes) {\n    Object.keys(hashes).map(Number).forEach((dcId) => {\n      localStorage.setItem(`dc${dcId}_hash`, JSON.stringify(hashes[dcId]));\n    });\n  }\n}\n\nexport function clearStoredSession() {\n  [\n    SESSION_USER_KEY,\n    'dc',\n    ...DC_IDS.map((dcId) => `dc${dcId}_auth_key`),\n    ...DC_IDS.map((dcId) => `dc${dcId}_hash`),\n    ...DC_IDS.map((dcId) => `dc${dcId}_server_salt`),\n  ].forEach((key) => {\n    localStorage.removeItem(key);\n  });\n}\n\nexport function loadStoredSession(): ApiSessionData | undefined {\n  if (!hasStoredSession()) {\n    return undefined;\n  }\n\n  const userAuth = JSON.parse(localStorage.getItem(SESSION_USER_KEY)!);\n  if (!userAuth) {\n    return undefined;\n  }\n  const mainDcId = Number(userAuth.dcID);\n  const isTest = userAuth.test;\n  const keys: Record<number, string> = {};\n  const hashes: Record<number, string> = {};\n\n  DC_IDS.forEach((dcId) => {\n    try {\n      const key = localStorage.getItem(`dc${dcId}_auth_key`);\n      if (key) {\n        keys[dcId] = JSON.parse(key);\n      }\n\n      const hash = localStorage.getItem(`dc${dcId}_hash`);\n      if (hash) {\n        hashes[dcId] = JSON.parse(hash);\n      }\n    } catch (err) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn('Failed to load stored session', err);\n      }\n      // Do nothing.\n    }\n  });\n\n  if (!Object.keys(keys).length) return undefined;\n\n  return {\n    mainDcId,\n    keys,\n    hashes,\n    isTest,\n  };\n}\n\nexport function importTestSession() {\n  const sessionJson = process.env.TEST_SESSION!;\n  try {\n    const sessionData = JSON.parse(sessionJson) as ApiSessionData & { userId: string };\n    storeSession(sessionData, sessionData.userId);\n  } catch (err) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to load test session', err);\n    }\n  }\n}\n\nfunction checkSessionLocked() {\n  return localStorage.getItem(IS_SCREEN_LOCKED_CACHE_KEY) === 'true';\n}\n","import type { CallbackManager } from './callbacks';\n\nimport { createCallbackManager } from './callbacks';\n\ninterface SignalState<T> {\n  value: T;\n  effects: CallbackManager;\n}\n\nconst SIGNAL_MARK = Symbol('SIGNAL_MARK');\n\nexport type Signal<T = any> = ((() => T) & {\n  readonly [SIGNAL_MARK]: symbol;\n  subscribe: (cb: AnyToVoidFunction) => NoneToVoidFunction;\n  once: (cb: AnyToVoidFunction) => NoneToVoidFunction;\n});\n\nexport type SignalSetter = (newValue: any) => void;\n\nexport function isSignal(obj: any): obj is Signal {\n  return typeof obj === 'function' && SIGNAL_MARK in obj;\n}\n\n// A shorthand to unsubscribe effect from all signals\nconst unsubscribesByEffect = new Map<NoneToVoidFunction, Set<NoneToVoidFunction>>();\n\nlet currentEffect: NoneToVoidFunction | undefined;\n\nexport function createSignal<T>(defaultValue?: T) {\n  const state: SignalState<typeof defaultValue> = {\n    value: defaultValue,\n    effects: createCallbackManager(),\n  };\n\n  function subscribe(effect: NoneToVoidFunction) {\n    const unsubscribe = state.effects.addCallback(effect);\n\n    if (!unsubscribesByEffect.has(effect)) {\n      unsubscribesByEffect.set(effect, new Set([unsubscribe]));\n    } else {\n      unsubscribesByEffect.get(effect)!.add(unsubscribe);\n    }\n\n    return () => {\n      unsubscribe();\n\n      const unsubscribes = unsubscribesByEffect.get(effect)!;\n      unsubscribes.delete(unsubscribe);\n      if (!unsubscribes.size) {\n        unsubscribesByEffect.delete(effect);\n      }\n    };\n  }\n\n  function once(effect: NoneToVoidFunction) {\n    const unsub = subscribe(() => {\n      unsub();\n      effect();\n    });\n\n    return unsub;\n  }\n\n  function getter() {\n    if (currentEffect) {\n      subscribe(currentEffect);\n    }\n\n    return state.value;\n  }\n\n  function setter(newValue: T) {\n    if (state.value === newValue) {\n      return;\n    }\n\n    state.value = newValue;\n    state.effects.runCallbacks();\n  }\n\n  const signal = Object.assign(getter as Signal<T>, {\n    [SIGNAL_MARK]: SIGNAL_MARK,\n    subscribe,\n    once,\n  });\n\n  return [signal, setter] as const;\n}\n\nexport function cleanupEffect(effect: NoneToVoidFunction) {\n  unsubscribesByEffect.get(effect)?.forEach((unsubscribe) => {\n    unsubscribe();\n  });\n  unsubscribesByEffect.delete(effect);\n}\n","import type React from '../lib/teact/teact';\n\nconst stopEvent = (e: React.UIEvent | Event | React.FormEvent) => {\n  e.stopPropagation();\n  e.preventDefault();\n};\n\nexport default stopEvent;\n","import { SVG_NAMESPACE } from '../config';\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport jsxToHtml from './element/jsxToHtml';\nimport generateUniqueId from './generateUniqueId';\n\nconst DEFINITION_MAP = new Map<string, Element>();\n\nlet defs: SVGElement | undefined;\n\nfunction init() {\n  if (defs) return;\n\n  const container = document.createElementNS(SVG_NAMESPACE, 'svg');\n  container.setAttribute('width', '0');\n  container.setAttribute('height', '0');\n  container.setAttribute('viewBox', '0 0 1 1');\n  container.classList.add('svg-definitions');\n  document.body.appendChild(container);\n\n  defs = document.createElementNS(SVG_NAMESPACE, 'defs');\n  container.appendChild(defs);\n}\n\nfunction appendElement(element: Element) {\n  requestMutation(() => {\n    if (!defs) init();\n    defs!.appendChild(element);\n  });\n}\n\nexport function addSvgDefinition(element: React.JSX.Element, id?: string) {\n  id ??= generateUniqueId();\n  element.props.id = id;\n\n  const htmlElement = jsxToHtml(element)[0];\n  DEFINITION_MAP.set(element.props.id, htmlElement);\n  appendElement(htmlElement);\n  return id;\n}\n\nexport function removeSvgDefinition(id: string) {\n  const element = DEFINITION_MAP.get(id);\n  if (element) {\n    element.remove();\n    DEFINITION_MAP.delete(id);\n  }\n}\n","import type { MoveOffsets } from './captureEvents';\n\nimport { requestMeasure, requestMutation } from '../lib/fasterdom/fasterdom';\nimport { animateNumber, timingFunctions } from './animation';\nimport { captureEvents, SwipeDirection } from './captureEvents';\nimport { waitForAnimationEnd } from './cssAnimationEndListeners';\nimport { clamp } from './math';\nimport { IS_IOS } from './windowEnvironment';\n\nconst INERTIA_DURATION = 300;\nconst INERTIA_EASING = timingFunctions.easeOutCubic;\n\nlet isSwipeActive = false;\nlet swipeOffsets: MoveOffsets | undefined;\nlet onDrag: ((offsets: MoveOffsets) => void) | undefined;\nlet onRelease: ((onCancel: NoneToVoidFunction) => void) | undefined;\nlet cancelCurrentReleaseAnimation: NoneToVoidFunction | undefined;\n\nexport function captureControlledSwipe(\n  element: HTMLElement, options: {\n    excludedClosestSelector?: string;\n    selectorToPreventScroll?: string;\n    onSwipeLeftStart?: NoneToVoidFunction;\n    onSwipeRightStart?: NoneToVoidFunction;\n    onCancel: NoneToVoidFunction;\n  },\n) {\n  return captureEvents(element, {\n    excludedClosestSelector: options.excludedClosestSelector,\n    selectorToPreventScroll: options.selectorToPreventScroll,\n    swipeThreshold: 10,\n\n    onSwipe(e, direction, offsets) {\n      if (direction === SwipeDirection.Left) {\n        options.onSwipeLeftStart?.();\n      } else if (direction === SwipeDirection.Right) {\n        options.onSwipeRightStart?.();\n      } else {\n        return false;\n      }\n\n      if (IS_IOS) {\n        isSwipeActive = true;\n        swipeOffsets = offsets;\n      }\n\n      return true;\n    },\n\n    onDrag(e, captureEvent, offsets) {\n      if (!isSwipeActive) return;\n\n      onDrag?.(offsets);\n    },\n\n    onRelease() {\n      if (!isSwipeActive) return;\n\n      isSwipeActive = false;\n\n      onRelease?.(options.onCancel);\n\n      onDrag = undefined;\n      onRelease = undefined;\n    },\n  });\n}\n\nexport function allowSwipeControlForTransition(\n  currentSlide: HTMLElement,\n  nextSlide: HTMLElement,\n  onCancelForTransition: NoneToVoidFunction,\n) {\n  cancelCurrentReleaseAnimation?.();\n\n  if (!isSwipeActive) return;\n\n  const targetPosition = extractAnimationEndPosition(currentSlide);\n  if (!targetPosition) return;\n\n  currentSlide.getAnimations().forEach((a) => a.pause());\n  nextSlide.getAnimations().forEach((a) => a.pause());\n\n  currentSlide.style.animationTimingFunction = 'linear';\n  nextSlide.style.animationTimingFunction = 'linear';\n\n  let currentDirection: 1 | -1 | undefined;\n\n  requestMeasure(() => {\n    const computedStyle = getComputedStyle(currentSlide);\n    const initialPositionPx = extractPositionFromMatrix(computedStyle.transform, targetPosition.axis);\n    const targetPositionPx = targetPosition.units === 'px'\n      ? targetPosition.value\n      : ((targetPosition.value / 100) * (\n        targetPosition.axis === 'X' ? currentSlide.offsetWidth : currentSlide.offsetHeight\n      ));\n    const distance = targetPositionPx - initialPositionPx;\n\n    let progress = 0;\n\n    onDrag = ({ dragOffsetX, dragOffsetY }) => {\n      const dragOffset = targetPosition.axis === 'X'\n        ? dragOffsetX - swipeOffsets!.dragOffsetX\n        : dragOffsetY - swipeOffsets!.dragOffsetY;\n\n      const newProgress = clamp(dragOffset / distance, 0, 1);\n      currentDirection = newProgress > progress ? 1 : -1;\n      progress = newProgress;\n\n      updateAnimationProgress([currentSlide, nextSlide], progress);\n    };\n\n    onRelease = (onCancelForClient: NoneToVoidFunction) => {\n      const isRevertSwipe = currentDirection === -1;\n\n      function cleanup() {\n        currentSlide.getAnimations().forEach((a) => a.cancel());\n        nextSlide.getAnimations().forEach((a) => a.cancel());\n\n        requestMutation(() => {\n          currentSlide.style.animationTimingFunction = '';\n          nextSlide.style.animationTimingFunction = '';\n        });\n      }\n\n      if (!isRevertSwipe) {\n        // For some reason animations are not cleared when CSS class is removed\n        waitForAnimationEnd(currentSlide, cleanup);\n      }\n\n      cancelCurrentReleaseAnimation = animateNumber({\n        from: progress,\n        to: isRevertSwipe ? 0 : 1,\n        duration: INERTIA_DURATION,\n        timing: INERTIA_EASING,\n        onUpdate(releaseProgress) {\n          updateAnimationProgress([currentSlide, nextSlide], releaseProgress);\n        },\n        onEnd(isCanceled = false) {\n          cancelCurrentReleaseAnimation = undefined;\n\n          if (isCanceled || isRevertSwipe) {\n            cleanup();\n            onCancelForTransition();\n            onCancelForClient();\n          }\n        },\n      });\n    };\n  });\n}\n\nfunction updateAnimationProgress(elements: HTMLElement[], progress: number) {\n  elements.map((e) => e.getAnimations()).flat().forEach((animation) => {\n    animation.currentTime = (animation.effect!.getTiming().duration as number) * progress;\n  });\n}\n\nfunction extractAnimationEndPosition(element: HTMLElement) {\n  for (const animation of element.getAnimations()) {\n    if (!(animation.effect instanceof KeyframeEffect)) continue;\n\n    for (const keyframe of animation.effect.getKeyframes()) {\n      if (keyframe.offset !== 1 || !keyframe.transform) continue;\n\n      const position = extractPositionFromTransform(keyframe.transform as string);\n      if (position) {\n        return position;\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction extractPositionFromTransform(transformRule: string) {\n  const match = transformRule.match(/([XY])\\((-?\\d+)(%|px)\\)/);\n  if (!match) return undefined;\n\n  return {\n    axis: match[1] as 'X' | 'Y',\n    value: Number(match[2]),\n    units: match[3],\n  };\n}\n\nfunction extractPositionFromMatrix(transform: string, axis: 'X' | 'Y') {\n  const matrix = transform.slice(7, -1).split(',').map(Number);\n  return matrix[axis === 'X' ? 4 : 5];\n}\n","import type { ISettings } from '../types';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport themeColors from '../styles/themes.json';\nimport { animate } from './animation';\nimport { lerp } from './math';\n\ntype RGBAColor = {\n  r: number;\n  g: number;\n  b: number;\n  a?: number;\n};\n\nlet isInitialized = false;\n\nconst DECIMAL_PLACES = 3;\nconst HEX_COLOR_REGEX = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})?$/i;\nconst DURATION_MS = 200;\nconst ENABLE_ANIMATION_DELAY_MS = 500;\nconst RGB_VARIABLES = new Set([\n  '--color-text',\n  '--color-primary-shade',\n  '--color-text-secondary',\n  '--color-accent-own',\n]);\n\nconst DISABLE_ANIMATION_CSS = `\n.no-animations #root *,\n.no-animations #root *::before,\n.no-animations #root *::after {\n  transition: none !important;\n}`;\n\nconst colors = (Object.keys(themeColors) as Array<keyof typeof themeColors>).map((property) => ({\n  property,\n  colors: [hexToRgb(themeColors[property][0]), hexToRgb(themeColors[property][1])],\n}));\n\nconst injectCss = (css: string) => {\n  const style = document.createElement('style');\n  style.textContent = css;\n  document.head.appendChild(style);\n  return () => {\n    document.head.removeChild(style);\n  };\n};\n\nconst switchTheme = (theme: ISettings['theme'], withAnimation: boolean) => {\n  const themeClassName = `theme-${theme}`;\n  if (document.documentElement.classList.contains(themeClassName)) {\n    return;\n  }\n  const isDarkTheme = theme === 'dark';\n  const shouldAnimate = isInitialized && withAnimation;\n  const startIndex = isDarkTheme ? 0 : 1;\n  const endIndex = isDarkTheme ? 1 : 0;\n  const startAt = Date.now();\n  const themeColorTag = document.querySelector('meta[name=\"theme-color\"]');\n\n  requestMutation(() => {\n    document.documentElement.classList.remove(`theme-${isDarkTheme ? 'light' : 'dark'}`);\n    let uninjectCss: (() => void) | undefined;\n    if (isInitialized) {\n      uninjectCss = injectCss(DISABLE_ANIMATION_CSS);\n      document.documentElement.classList.add('no-animations');\n    }\n    document.documentElement.classList.add(themeClassName);\n    if (themeColorTag) {\n      themeColorTag.setAttribute('content', isDarkTheme ? '#212121' : '#fff');\n    }\n\n    setTimeout(() => {\n      requestMutation(() => {\n        uninjectCss?.();\n        document.documentElement.classList.remove('no-animations');\n      });\n    }, ENABLE_ANIMATION_DELAY_MS);\n\n    isInitialized = true;\n\n    if (shouldAnimate) {\n      animate(() => {\n        const t = Math.min((Date.now() - startAt) / DURATION_MS, 1);\n\n        applyColorAnimationStep(startIndex, endIndex, transition(t));\n\n        return t < 1;\n      }, requestMutation);\n    } else {\n      applyColorAnimationStep(startIndex, endIndex);\n    }\n  });\n};\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n\nexport function hexToRgb(hex: string): RGBAColor {\n  const result = HEX_COLOR_REGEX.exec(hex)!;\n\n  return {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16),\n    a: result[4] !== undefined ? parseInt(result[4], 16) : undefined,\n  };\n}\n\nexport function lerpRgb(start: RGBAColor, end: RGBAColor, interpolationRatio: number): RGBAColor {\n  const r = Math.round(lerp(start.r, end.r, interpolationRatio));\n  const g = Math.round(lerp(start.g, end.g, interpolationRatio));\n  const b = Math.round(lerp(start.b, end.b, interpolationRatio));\n  const a = start.a !== undefined\n    ? Math.round(lerp(start.a!, end.a!, interpolationRatio))\n    : undefined;\n\n  return {\n    r, g, b, a,\n  };\n}\n\nfunction applyColorAnimationStep(startIndex: number, endIndex: number, interpolationRatio: number = 1) {\n  colors.forEach(({ property, colors: propertyColors }) => {\n    const {\n      r, g, b, a,\n    } = lerpRgb(propertyColors[startIndex], propertyColors[endIndex], interpolationRatio);\n\n    const roundedA = a !== undefined ? Math.round((a / 255) * 10 ** DECIMAL_PLACES) / 10 ** DECIMAL_PLACES : undefined;\n\n    document.documentElement.style.setProperty(property, `rgb(${r},${g},${b}${roundedA ? `,${roundedA}` : ''})`);\n\n    if (RGB_VARIABLES.has(property)) {\n      document.documentElement.style.setProperty(`${property}-rgb`, `${r},${g},${b}`);\n    }\n  });\n}\n\nexport default switchTheme;\n","import type { ThemeKey } from '../types';\n\nlet systemThemeCache: ThemeKey = (\n  window.matchMedia?.('(prefers-color-scheme: dark)').matches\n) ? 'dark' : 'light';\n\nlet themeChangeCallback: ((newTheme: ThemeKey) => void) | undefined;\n\nexport function getSystemTheme() {\n  return systemThemeCache;\n}\n\nfunction handleSystemThemeChange(e: MediaQueryListEventMap['change']) {\n  systemThemeCache = e.matches ? 'dark' : 'light';\n\n  themeChangeCallback?.(systemThemeCache);\n}\n\nexport function setSystemThemeChangeCallback(callback: (newTheme: ThemeKey) => void) {\n  themeChangeCallback = callback;\n}\n\nwindow.matchMedia('(prefers-color-scheme: dark)')\n  .addEventListener('change', handleSystemThemeChange);\n","import type { OldLangFn } from '../hooks/useOldLang';\n\nimport EMOJI_REGEX from '../lib/twemojiRegex';\nimport fixNonStandardEmoji from './emoji/fixNonStandardEmoji';\nimport withCache from './withCache';\n\nexport function formatInteger(value: number) {\n  return String(value).replace(/\\d(?=(\\d{3})+$)/g, '$& ');\n}\n\nfunction formatFixedNumber(number: number) {\n  const fixed = String(number.toFixed(1));\n  if (fixed.substr(-2) === '.0') {\n    return Math.floor(number);\n  }\n\n  return number.toFixed(1).replace('.', ',');\n}\n\nexport function formatIntegerCompact(views: number) {\n  if (views < 1e3) {\n    return views.toString();\n  }\n\n  if (views < 1e6) {\n    return `${formatFixedNumber(views / 1e3)}K`;\n  }\n\n  return `${formatFixedNumber(views / 1e6)}M`;\n}\n\nexport function formatPercent(value: number, fractionDigits = 1) {\n  return `${Number.isInteger(value) ? value : value.toFixed(fractionDigits)}%`;\n}\n\nexport const getFirstLetters = withCache((phrase: string, count = 2) => {\n  return phrase\n    .replace(/[.,!@#$%^&*()_+=\\-`~[\\]/\\\\{}:\"|<>?]+/gi, '')\n    .trim()\n    .split(/\\s+/)\n    .slice(0, count)\n    .map((word: string) => {\n      if (!word.length) return '';\n      word = fixNonStandardEmoji(word);\n      const emojis = word.match(EMOJI_REGEX);\n      if (emojis && word.startsWith(emojis[0])) {\n        return emojis[0];\n      }\n      return word.match(/./u)![0].toUpperCase();\n    })\n    .join('');\n});\n\nconst FILE_SIZE_UNITS = ['B', 'KB', 'MB', 'GB'];\nexport function formatFileSize(lang: OldLangFn, bytes: number, decimals = 1): string {\n  if (bytes === 0) {\n    return lang('FileSize.B', 0);\n  }\n\n  const k = 1024;\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const value = (bytes / (k ** i)).toFixed(Math.max(decimals, 0));\n\n  return lang(`FileSize.${FILE_SIZE_UNITS[i]}`, value);\n}\n","import type { ApiPeerColors } from '../api/types';\n\nimport { PEER_COLOR_BG_ACTIVE_OPACITY, PEER_COLOR_BG_OPACITY, PEER_COLOR_GRADIENT_STEP } from '../config';\nimport { fastRaf } from './schedulers';\n\nconst GENERAL_VARIABLES = new Map<string, string>();\nconst LIGHT_VARIABLES = new Map<string, string>();\nconst DARK_VARIABLES = new Map<string, string>();\n\nconst style = document.createElement('style');\ndocument.head.appendChild(style);\n\nexport function setVariable(name: string, generalValue: string): void;\nexport function setVariable(name: string, lightValue: string, darkValue?: string): void;\nexport function setVariable(name: string, lightValueOrGeneral: string, darkValue?: string) {\n  if (!darkValue) {\n    GENERAL_VARIABLES.set(name, lightValueOrGeneral);\n    LIGHT_VARIABLES.delete(name);\n    DARK_VARIABLES.delete(name);\n  } else {\n    GENERAL_VARIABLES.delete(name);\n    LIGHT_VARIABLES.set(name, lightValueOrGeneral);\n    DARK_VARIABLES.set(name, darkValue);\n  }\n\n  scheduleVariableUpdate();\n}\n\nlet isUpdateScheduled = false;\nfunction scheduleVariableUpdate() {\n  if (isUpdateScheduled) return;\n  isUpdateScheduled = true;\n  fastRaf(updateVariables);\n}\n\nfunction updateVariables() {\n  const generalVariables = buildVariables(GENERAL_VARIABLES);\n  const lightVariables = buildVariables(LIGHT_VARIABLES);\n  const darkVariables = buildVariables(DARK_VARIABLES);\n\n  style.textContent = `\n    html {\n      ${generalVariables}\n    }\n\n    html.theme-light {\n      ${lightVariables}\n    }\n\n    html.theme-dark {\n      ${darkVariables}\n    }\n  `;\n}\n\nfunction buildVariables(map: Map<string, string>) {\n  return Array.from(map.entries()).map(([name, value]) => `--${name}: ${value};`).join(' ');\n}\n\nexport function updatePeerColors(\n  peerColors: ApiPeerColors['general'],\n) {\n  setPeerColor('0', ['#D45246']);\n  setPeerColor('1', ['#F68136']);\n  setPeerColor('2', ['#6C61DF']);\n  setPeerColor('3', ['#46BA43']);\n  setPeerColor('4', ['#5CAFFA']);\n  setPeerColor('5', ['#408ACF']);\n  setPeerColor('6', ['#D95574']);\n\n  Object.entries(peerColors).forEach(([key, value]) => {\n    if (!value.colors) return;\n    setPeerColor(key, value.colors, value.darkColors);\n  });\n}\n\nfunction setPeerColor(n: string, colors: string[], darkColors?: string[]) {\n  const mainLightColor = colors[0];\n  const mainDarkColor = darkColors?.[0];\n  if (!mainLightColor) return;\n\n  const lightBgColor = `${mainLightColor}${PEER_COLOR_BG_OPACITY}`;\n  const darkBgColor = mainDarkColor ? `${mainDarkColor}${PEER_COLOR_BG_OPACITY}` : undefined;\n\n  const lightBgActiveColor = `${mainLightColor}${PEER_COLOR_BG_ACTIVE_OPACITY}`;\n  const darkBgActiveColor = mainDarkColor ? `${mainDarkColor}${PEER_COLOR_BG_ACTIVE_OPACITY}` : undefined;\n\n  setVariable(`color-peer-${n}`, mainLightColor, mainDarkColor);\n  setVariable(`color-peer-bg-${n}`, lightBgColor, darkBgColor);\n  setVariable(`color-peer-bg-active-${n}`, lightBgActiveColor, darkBgActiveColor);\n\n  if (colors.length > 1) {\n    const lightGradientColors = colors.map((color, i) => (\n      `${color} ${i * PEER_COLOR_GRADIENT_STEP}px, ${color} ${(i + 1) * PEER_COLOR_GRADIENT_STEP}px`\n    ));\n    const darkGradientColors = darkColors?.map((color, i) => (\n      `${color} ${i * PEER_COLOR_GRADIENT_STEP}px, ${color} ${(i + 1) * PEER_COLOR_GRADIENT_STEP}px`\n    ));\n\n    const lightGradient = `repeating-linear-gradient(-45deg, ${lightGradientColors.join(', ')})`;\n    const darkGradient = darkGradientColors ? `repeating-linear-gradient(-45deg, ${darkGradientColors.join(', ')})`\n      : undefined;\n    setVariable(`color-peer-gradient-${n}`, lightGradient, darkGradient);\n  }\n}\n","import type { ApiThemeParameters } from '../api/types';\n\nexport function extractCurrentThemeParams(): ApiThemeParameters {\n  const style = getComputedStyle(document.documentElement);\n\n  const backgroundColor = getPropertyHexColor(style, '--color-background')!;\n  const secondaryTextColor = getPropertyHexColor(style, '--color-text-secondary')!;\n\n  const bgColor = backgroundColor;\n  const textColor = getPropertyHexColor(style, '--color-text')!;\n  const buttonColor = getPropertyHexColor(style, '--color-primary')!;\n  const buttonTextColor = getPropertyHexColor(style, '--color-white')!;\n  const linkColor = getPropertyHexColor(style, '--color-links')!;\n  const hintColor = secondaryTextColor;\n  const secondaryBgColor = getPropertyHexColor(style, '--color-background-secondary')!;\n  const sectionSeparatorColor = getPropertyHexColor(style, '--color-divider')!;\n\n  const headerBgColor = backgroundColor;\n  const accentTextColor = getPropertyHexColor(style, '--color-primary')!;\n  const sectionBgColor = backgroundColor;\n  const sectionHeaderTextColor = secondaryTextColor;\n  const subtitleTextColor = hintColor;\n  const destructiveTextColor = getPropertyHexColor(style, '--color-error')!;\n\n  return {\n    bg_color: bgColor,\n    text_color: textColor,\n    hint_color: hintColor,\n    link_color: linkColor,\n    button_color: buttonColor,\n    button_text_color: buttonTextColor,\n    secondary_bg_color: secondaryBgColor,\n    header_bg_color: headerBgColor,\n    accent_text_color: accentTextColor,\n    section_bg_color: sectionBgColor,\n    section_header_text_color: sectionHeaderTextColor,\n    subtitle_text_color: subtitleTextColor,\n    destructive_text_color: destructiveTextColor,\n    section_separator_color: sectionSeparatorColor,\n  };\n}\n\nexport function validateHexColor(color: string) {\n  return /^#[0-9A-F]{6}$/i.test(color);\n}\n\nexport function getPropertyHexColor(style: CSSStyleDeclaration, property: string) {\n  const value = style.getPropertyValue(property);\n  if (!value) return undefined;\n  return prepareHexColor(value.trim());\n}\n\nfunction prepareHexColor(color: string) {\n  if (validateHexColor(color)) return color;\n  return `#${color.match(/^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+\\.{0,1}\\d*))?\\)$/)!\n    .slice(1)\n    .map((n: string, i: number) => (i === 3 ? Math.round(parseFloat(n) * 255) : parseFloat(n))\n      .toString(16)\n      .padStart(2, '0')\n      .replace('NaN', ''))\n    .join('')}`;\n}\n","export default function trimText<T extends string | undefined>(text: T, length?: number) {\n  if (!text || !length || text.length <= length) {\n    return text;\n  }\n\n  return `${text.substring(0, length)}...`;\n}\n","export const MIN_USERNAME_LENGTH = 3; // Some bots have 3-letter usernames\nexport const MIN_UPDATE_USERNAME_LENGTH = 5; // 4 letter usernames are only available on Fragment\nexport const MAX_USERNAME_LENGTH = 32;\nexport const USERNAME_REGEX = /^[a-zA-Z]\\w+$/;\n\nexport function isUsernameValid(username: string, isUpdating?: boolean) {\n  const minUsernameLength = isUpdating ? MIN_UPDATE_USERNAME_LENGTH : MIN_USERNAME_LENGTH;\n  return username.length >= minUsernameLength\n    && username.length <= MAX_USERNAME_LENGTH\n    && USERNAME_REGEX.test(username);\n}\n","import { getGlobal } from '../global';\n\nimport {\n  APP_CODE_NAME,\n  DEBUG, IS_MOCKED_CLIENT,\n} from '../config';\nimport { hasStoredSession } from './sessions';\nimport { IS_ELECTRON } from './windowEnvironment';\n\nconst WEBSYNC_URLS = [\n  't.me',\n  'telegram.me',\n].map((domain) => `https://${domain}/_websync_?`);\nconst WEBSYNC_VERSION = `${APP_VERSION} ${APP_CODE_NAME}`;\nconst WEBSYNC_KEY = 'tgme_sync';\nconst WEBSYNC_TIMEOUT = 86400;\n\nconst getTs = () => {\n  return Math.floor(Number(new Date()) / 1000);\n};\n\nconst saveSync = (authed: boolean) => {\n  const ts = getTs();\n  localStorage.setItem(WEBSYNC_KEY, JSON.stringify({\n    canRedirect: authed,\n    ts,\n  }));\n};\n\nlet lastTimeout: NodeJS.Timeout | undefined;\n\nexport const forceWebsync = (authed: boolean) => {\n  if (IS_MOCKED_CLIENT || IS_ELECTRON) return undefined;\n  const currentTs = getTs();\n\n  const { canRedirect, ts } = JSON.parse(localStorage.getItem(WEBSYNC_KEY) || '{}');\n\n  if (canRedirect !== authed || ts + WEBSYNC_TIMEOUT <= currentTs) {\n    return Promise.all(WEBSYNC_URLS.map((url) => {\n      return new Promise<void>((resolve, reject) => {\n        const script = document.createElement('script');\n\n        const removeElement = () => Boolean(document.body.removeChild(script));\n\n        script.src = url + new URLSearchParams({\n          authed: Number(authed).toString(),\n          version: WEBSYNC_VERSION,\n        });\n\n        document.body.appendChild(script);\n\n        script.onload = () => {\n          saveSync(authed);\n          removeElement();\n          if (lastTimeout) {\n            clearTimeout(lastTimeout);\n            lastTimeout = undefined;\n          }\n          startWebsync();\n          resolve();\n        };\n\n        script.onerror = () => {\n          removeElement();\n          reject();\n        };\n      });\n    }));\n  } else {\n    return Promise.resolve();\n  }\n};\n\nexport function stopWebsync() {\n  if (DEBUG || IS_ELECTRON) return;\n\n  if (lastTimeout) clearTimeout(lastTimeout);\n}\n\nexport function startWebsync() {\n  if (DEBUG || IS_ELECTRON) {\n    return;\n  }\n\n  if (lastTimeout !== undefined) return;\n  const currentTs = getTs();\n\n  const { ts } = JSON.parse(localStorage.getItem(WEBSYNC_KEY) || '{}');\n\n  const timeout = WEBSYNC_TIMEOUT - (currentTs - ts);\n\n  lastTimeout = setTimeout(() => {\n    const { authState } = getGlobal();\n\n    const authed = authState === 'authorizationStateReady' || hasStoredSession();\n    forceWebsync(authed);\n  }, Math.max(0, timeout * 1000));\n}\n\nexport function clearWebsync() {\n  localStorage.removeItem(WEBSYNC_KEY);\n}\n","import { IS_TEST, PRODUCTION_HOSTNAME } from '../config';\n\nexport function getPlatform() {\n  const { userAgent, platform } = window.navigator;\n\n  const iosPlatforms = ['iPhone', 'iPad', 'iPod'];\n  if (\n    iosPlatforms.indexOf(platform) !== -1\n    // For new IPads with M1 chip and IPadOS platform returns \"MacIntel\"\n    || (platform === 'MacIntel' && ('maxTouchPoints' in navigator && navigator.maxTouchPoints > 2))\n  ) return 'iOS';\n\n  const macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];\n  if (macosPlatforms.indexOf(platform) !== -1) return 'macOS';\n\n  const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];\n  if (windowsPlatforms.indexOf(platform) !== -1) return 'Windows';\n\n  if (/Android/.test(userAgent)) return 'Android';\n\n  if (/Linux/.test(platform)) return 'Linux';\n\n  return undefined;\n}\n\nexport const IS_PRODUCTION_HOST = window.location.host === PRODUCTION_HOSTNAME;\nexport const PLATFORM_ENV = getPlatform();\nexport const IS_MAC_OS = PLATFORM_ENV === 'macOS';\nexport const IS_WINDOWS = PLATFORM_ENV === 'Windows';\nexport const IS_LINUX = PLATFORM_ENV === 'Linux';\nexport const IS_IOS = PLATFORM_ENV === 'iOS';\nexport const IS_ANDROID = PLATFORM_ENV === 'Android';\nexport const IS_MOBILE = IS_IOS || IS_ANDROID;\nexport const IS_SAFARI = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\nexport const IS_YA_BROWSER = navigator.userAgent.includes('YaBrowser');\nexport const IS_FIREFOX = navigator.userAgent.toLowerCase().includes('firefox')\n  || navigator.userAgent.toLowerCase().includes('iceweasel')\n  || navigator.userAgent.toLowerCase().includes('icecat');\nexport const IS_ELECTRON = Boolean(window.electron);\n\nexport enum MouseButton {\n  Main = 0,\n  Auxiliary = 1,\n  Secondary = 2,\n  Fourth = 3,\n  Fifth = 4,\n}\n\nexport const IS_PWA = (\n  window.matchMedia('(display-mode: standalone)').matches\n  || (window.navigator as any).standalone\n  || document.referrer.includes('android-app://')\n);\n\nexport const IS_APP = IS_PWA || IS_ELECTRON;\n\nexport const IS_TOUCH_ENV = window.matchMedia('(pointer: coarse)').matches;\nexport const IS_VOICE_RECORDING_SUPPORTED = Boolean(\n  window.navigator.mediaDevices && 'getUserMedia' in window.navigator.mediaDevices && (\n    window.AudioContext || (window as any).webkitAudioContext\n  ),\n);\nexport const IS_EMOJI_SUPPORTED = PLATFORM_ENV && (IS_MAC_OS || IS_IOS) && isLastEmojiVersionSupported();\n\nexport const IS_SERVICE_WORKER_SUPPORTED = 'serviceWorker' in navigator;\n\n// Remove in mid-late 2025 when Chromium 132 is no longer a problem\n// https://issues.chromium.org/issues/390581541\nconst chromeVersion = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)?.[2];\nconst hasBrokenServiceWorkerStreaming = chromeVersion && Number(chromeVersion) === 132;\n// TODO Consider failed service worker\nexport const IS_PROGRESSIVE_SUPPORTED = IS_SERVICE_WORKER_SUPPORTED && !hasBrokenServiceWorkerStreaming;\nexport const IS_OPUS_SUPPORTED = Boolean((new Audio()).canPlayType('audio/ogg; codecs=opus'));\nexport const IS_CANVAS_FILTER_SUPPORTED = (\n  !IS_TEST && 'filter' in (document.createElement('canvas').getContext('2d') || {})\n);\nexport const IS_REQUEST_FULLSCREEN_SUPPORTED = 'requestFullscreen' in document.createElement('div');\nexport const ARE_CALLS_SUPPORTED = !IS_FIREFOX; // https://bugzilla.mozilla.org/show_bug.cgi?id=1923416\nexport const LAYERS_ANIMATION_NAME = IS_ANDROID ? 'slideFade' : IS_IOS ? 'slideLayers' : 'pushSlide';\n\nexport const IS_WAVE_TRANSFORM_SUPPORTED = !IS_MOBILE\n  && !IS_FIREFOX // https://bugzilla.mozilla.org/show_bug.cgi?id=1808785\n  && !IS_SAFARI; // https://bugs.webkit.org/show_bug.cgi?id=245510\nexport const IS_SNAP_EFFECT_SUPPORTED = !IS_MOBILE\n  && !IS_FIREFOX // https://bugzilla.mozilla.org/show_bug.cgi?id=1896504\n  && !IS_SAFARI;\n\nconst TEST_VIDEO = document.createElement('video');\n\nexport const IS_WEBM_SUPPORTED = Boolean(TEST_VIDEO.canPlayType('video/webm; codecs=\"vp9\"').replace('no', ''));\n\nexport const ARE_WEBCODECS_SUPPORTED = 'VideoDecoder' in window;\n\nexport const MASK_IMAGE_DISABLED = true;\nexport const IS_OPFS_SUPPORTED = Boolean(navigator.storage?.getDirectory);\nif (IS_OPFS_SUPPORTED) {\n  // Clear old contents\n  (async () => {\n    try {\n      const directory = await navigator.storage.getDirectory();\n      await directory.removeEntry('downloads', { recursive: true });\n    } catch {\n      // Ignore\n    }\n  })();\n}\n\nexport const IS_OFFSET_PATH_SUPPORTED = CSS.supports('offset-rotate: 0deg');\nexport const IS_BACKDROP_BLUR_SUPPORTED = CSS.supports('backdrop-filter: blur()')\n  || CSS.supports('-webkit-backdrop-filter: blur()');\nexport const IS_INSTALL_PROMPT_SUPPORTED = 'onbeforeinstallprompt' in window;\nexport const IS_MULTITAB_SUPPORTED = 'BroadcastChannel' in window;\nexport const IS_OPEN_IN_NEW_TAB_SUPPORTED = IS_MULTITAB_SUPPORTED && !(IS_PWA && IS_MOBILE);\nexport const IS_TRANSLATION_SUPPORTED = !IS_TEST;\nexport const IS_INTL_LIST_FORMAT_SUPPORTED = 'ListFormat' in Intl;\n\nexport const IS_BAD_URL_PARSER = new URL('tg://host').host !== 'host';\n\nexport const MESSAGE_LIST_SENSITIVE_AREA = 750;\n\nexport const SCROLLBAR_WIDTH = (() => {\n  const el = document.createElement('div');\n  el.style.cssText = 'overflow:scroll; visibility:hidden; position:absolute;';\n  el.classList.add('custom-scroll');\n  document.body.appendChild(el);\n  const width = el.offsetWidth - el.clientWidth;\n  el.remove();\n\n  document.documentElement.style.setProperty('--scrollbar-width', `${width}px`);\n\n  return width;\n})();\n\nexport const MAX_BUFFER_SIZE = (IS_MOBILE ? 512 : 2000) * 1024 ** 2; // 512 OR 2000 MB\n\nfunction isLastEmojiVersionSupported() {\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\n  const inlineEl = document.createElement('span');\n  inlineEl.classList.add('emoji-test-element');\n  document.body.appendChild(inlineEl);\n\n  inlineEl.innerText = '🐦‍🔥'; // Emoji from 15.1 version\n  const newEmojiWidth = inlineEl.offsetWidth;\n  inlineEl.innerText = '❤️'; // Emoji from 1.0 version\n  const legacyEmojiWidth = inlineEl.offsetWidth;\n\n  document.body.removeChild(inlineEl);\n\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\n}\n\nexport const IS_GEOLOCATION_SUPPORTED = 'geolocation' in navigator;\n\nexport const getGeolocationStatus = async () => {\n  try {\n    const permissionStatus = await navigator.permissions.query({ name: 'geolocation' });\n\n    if (permissionStatus.state === 'granted' || permissionStatus.state === 'prompt') {\n      const geolocation = await new Promise<GeolocationCoordinates>((resolve, reject) => {\n        navigator.geolocation.getCurrentPosition(\n          (position) => resolve(position.coords),\n          (error) => reject(error),\n        );\n      });\n      return { accessRequested: true, accessGranted: true, geolocation };\n    }\n    if (permissionStatus.state === 'denied') {\n      return { accessRequested: true, accessGranted: false };\n    }\n  } catch (error) {\n    return { accessRequested: false, accessGranted: false };\n  }\n\n  return { accessRequested: false, accessGranted: false };\n};\n","import type { IDimensions } from '../types';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport { throttle } from './schedulers';\nimport { IS_IOS } from './windowEnvironment';\n\nconst WINDOW_ORIENTATION_CHANGE_THROTTLE_MS = 100;\nconst WINDOW_RESIZE_THROTTLE_MS = 250;\n\nlet initialHeight = window.innerHeight;\nlet currentWindowSize = updateSizes();\n\nconst handleResize = throttle(() => {\n  currentWindowSize = updateSizes();\n}, WINDOW_RESIZE_THROTTLE_MS, true);\n\nconst handleOrientationChange = throttle(() => {\n  initialHeight = window.innerHeight;\n  handleResize();\n}, WINDOW_ORIENTATION_CHANGE_THROTTLE_MS, false);\n\nwindow.addEventListener('orientationchange', handleOrientationChange);\nif (IS_IOS) {\n  window.visualViewport!.addEventListener('resize', handleResize);\n} else {\n  window.addEventListener('resize', handleResize);\n}\n\nexport function updateSizes(): IDimensions {\n  let height: number;\n  if (IS_IOS) {\n    height = window.visualViewport!.height + window.visualViewport!.pageTop;\n  } else {\n    height = window.innerHeight;\n  }\n\n  requestMutation(() => {\n    const vh = height * 0.01;\n    document.documentElement.style.setProperty('--vh', `${vh}px`);\n  });\n\n  return {\n    width: window.innerWidth,\n    height: window.innerHeight,\n  };\n}\n\nconst windowSize = {\n  get: () => currentWindowSize,\n  getIsKeyboardVisible: () => initialHeight > currentWindowSize.height,\n};\n\nexport default windowSize;\n","const cache = new WeakMap<AnyFunction, Map<string, any>>();\n\nexport default function withCache<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    let fnCache = cache.get(fn);\n    const cacheKey = args.map(String).join('_');\n\n    if (fnCache) {\n      const cached = fnCache.get(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    } else {\n      fnCache = new Map();\n      cache.set(fn, fnCache);\n    }\n\n    const newValue = fn(...args);\n\n    fnCache.set(cacheKey, newValue);\n\n    return newValue;\n  };\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"26\":\"c6aa48f26cf2c480ba22\",\"59\":\"cd45091cb5c130745405\",\"61\":\"36c66587faab069a921b\",\"69\":\"a6db53a4f00742fd1462\",\"90\":\"f7637ad4b6d9882054f9\",\"103\":\"06562548b3fda65effcc\",\"194\":\"c1f5ffb04238d98d648b\",\"244\":\"1774aa2e7bcb7144d884\",\"304\":\"48b0b40adff5d3e137ef\",\"313\":\"0f4bc4fa205668ed808c\",\"356\":\"1bc44e46652fa5288bf8\",\"373\":\"75fdc0ccff654eeecb30\",\"387\":\"81529401c679841b397b\",\"400\":\"a47601ed4b358f8abbb5\",\"405\":\"d66329eb14453a8b3d34\",\"409\":\"0fd7b0b4fa794dd68108\",\"433\":\"ad060437ffb6916a9321\",\"453\":\"28c197282b5d28a55117\",\"482\":\"f539aab19c85ff61ce44\",\"562\":\"08644faea2a11dc03715\",\"564\":\"d622f298de832ee1c2f8\",\"633\":\"0c008db6ee63daf3e6e9\",\"641\":\"110d9333b771d085f072\",\"676\":\"575fa56db35097bc4a32\",\"683\":\"eaf2b99781f1220c4b86\",\"695\":\"204dcc5a00550f0dc2f1\",\"768\":\"f5aea4b0692ec4ad998e\",\"835\":\"e84d44ebdf9dd2ae222c\",\"844\":\"352427ea6fbd67143ad5\",\"947\":\"58aaed90385beda86fce\",\"970\":\"7044f00deb7b3fdc1ab5\",\"996\":\"9460a03c6edee870f315\",\"1022\":\"10e6de63c64b3b9a18af\",\"1095\":\"95cc2d575059e9f6054f\",\"1105\":\"82a58e981ea92040fe89\",\"1164\":\"ce743c2bcc23d3043fe9\",\"1168\":\"456d17d716ba7e4d4ec5\",\"1184\":\"0d40f5d962d57f9ef64e\",\"1215\":\"e157a49d04b225308f77\",\"1348\":\"f655ca346b82779f07c5\",\"1387\":\"394c9143713a7fd68235\",\"1401\":\"5b095c8c14e292f91887\",\"1465\":\"acaade6ed215d80122fa\",\"1516\":\"91af49804dee1af8631e\",\"1575\":\"e5726d1c745dcc9873f2\",\"1586\":\"d55ded8aa155fbd69470\",\"1620\":\"8c85ba900a4207ce4da9\",\"1692\":\"66caee8054d626d59d48\",\"1700\":\"dd59d0dbdf3ef22443b3\",\"1775\":\"8b47df32db7309502f49\",\"1780\":\"f39d3ff745c63d496160\",\"1877\":\"13c44f38e27f297965ef\",\"2057\":\"114033549ec88321349c\",\"2118\":\"4d5cef94fa94e132add7\",\"2158\":\"a6754dbfe1f8d591a114\",\"2164\":\"e492657dac2eb724da50\",\"2225\":\"aadcce9013263158a5df\",\"2230\":\"3a602927b9e118113ffa\",\"2394\":\"37ece7e83ea7094182cc\",\"2440\":\"e89152702b001cdd81aa\",\"2448\":\"da0e561a2055927d551f\",\"2498\":\"94264e7f6126aa416ec1\",\"2651\":\"60007143ecc35556d2be\",\"2670\":\"9e12093c5acef62f3f98\",\"2729\":\"0065c8652592670fe035\",\"2800\":\"fe61871efd4cf024ed73\",\"2801\":\"218e3e05568344bfc382\",\"2856\":\"2ad12ce521ce05aaeb25\",\"2857\":\"e46d806152d3634a3af0\",\"2859\":\"4b454e5348e44d08385e\",\"2916\":\"30141131c0e95e8b9171\",\"2990\":\"544b6eac560aef426853\",\"3080\":\"15f4cdecf7bd92fd8cd7\",\"3325\":\"4d3c50092b95852e606d\",\"3363\":\"d0e8f9c9ad9af93e091f\",\"3405\":\"bf0efec17f73eea62691\",\"3499\":\"fb9028f6a91578dbeb7e\",\"3524\":\"e86bdc871cc7d384bb9f\",\"3564\":\"e1d4da9993f41f931d4a\",\"3715\":\"b369e2fb06fef4e03112\",\"3731\":\"4c3ad0d715104f8c9a90\",\"3745\":\"70fa1408b56b531c8b70\",\"3747\":\"9d65fbf6607c2639f1ac\",\"3787\":\"738b7fcddf703bfdba93\",\"3813\":\"322d1f0835139c813fc2\",\"3906\":\"20c0ac801cb25871d36d\",\"3981\":\"7181a4ce1bc076373789\",\"4008\":\"59b7339e18feff0fcf48\",\"4019\":\"5436e42f5f05697217c5\",\"4020\":\"7fd110ec1a610079e678\",\"4102\":\"6d3f605113d2ca62c370\",\"4128\":\"932954ee591c37fcab93\",\"4134\":\"71cfa5405de2ba0d28f9\",\"4180\":\"9be92536a6ec7980a981\",\"4204\":\"9b422b9bac0e923d0800\",\"4230\":\"fa2f1dbe863bef3e5337\",\"4326\":\"344ecd11d90386e0b584\",\"4336\":\"a6113c3827c4e53ba062\",\"4369\":\"54ab1e961fe44a65a28f\",\"4383\":\"108071f9a50471133448\",\"4435\":\"303678ebd6d3a95a6ad0\",\"4448\":\"6d46b3fccdf6fdc05fbd\",\"4484\":\"697013986f9f8314725b\",\"4550\":\"79ec4a71200382a8bb30\",\"4765\":\"42f30c9d40ea3d25deb4\",\"4785\":\"ee250366df8843a67094\",\"4903\":\"7b2461fbeeed521475dc\",\"4917\":\"451a5721d4c10bda0cef\",\"4940\":\"d4766f8c482b18850eb3\",\"5032\":\"c2d32c817b8fcd096923\",\"5046\":\"cae7eb2c1eb178edb5cb\",\"5073\":\"b7b27ed7a495221c6f61\",\"5116\":\"7e3a6f36b5b79abb782a\",\"5148\":\"e9ddaa9b7e6d1b5c2689\",\"5193\":\"277e1fb9e38cc39cf421\",\"5246\":\"f6aacfbe9ae9257098d1\",\"5260\":\"963906e0cff8dcb3a5f2\",\"5269\":\"cb8357f44d3e42279470\",\"5284\":\"a6c42167e28376bc544b\",\"5336\":\"7c49be58112e63514c13\",\"5345\":\"323a678ecb6d1df232ca\",\"5361\":\"b67441dffa58f8924636\",\"5429\":\"7a4bdbe76dc672994511\",\"5434\":\"9f2b0084773cc370a809\",\"5438\":\"60c9f65511b76d590655\",\"5499\":\"13cb3031a94ce4aaa036\",\"5525\":\"8cefdbd7798ac454e0d4\",\"5628\":\"404c65b7e2448f632b03\",\"5719\":\"fd58667cc73b93bde774\",\"5735\":\"31b6059ae6ea6bfde1ee\",\"5819\":\"59e9c49233dabd77f9df\",\"5962\":\"ede17865912f35b1a90f\",\"6047\":\"56c21fd26028a86e4eeb\",\"6058\":\"30cefd831f035595b5d0\",\"6167\":\"b42a04fdc12fb4b4a4aa\",\"6168\":\"ada3094042ebc5125641\",\"6241\":\"33e68803b77e2df83262\",\"6265\":\"c6c542183797c639fc12\",\"6272\":\"b25825eb9cace64817d5\",\"6308\":\"fc757fb049f7befef6c5\",\"6338\":\"b7431caf1d83069b35a0\",\"6441\":\"596e674263fc662c6563\",\"6442\":\"61a6ce48a2c67daada31\",\"6473\":\"504b8bde338f548d384e\",\"6685\":\"d3f3addf37c9d0774537\",\"6686\":\"78266345eeede412e9b8\",\"6708\":\"d1119cd75629196a200d\",\"6726\":\"738df768f67f2b3ae4e7\",\"6802\":\"c56f82fa0a9d57ab7e5f\",\"6827\":\"f9dabc7d712e3f363fd8\",\"6860\":\"7724ac0b43a96ee6e42c\",\"6869\":\"fd1804ea75e26a748a15\",\"6930\":\"e802a8ea9268ba51da18\",\"6947\":\"4089f0e6e5cacb406a13\",\"7001\":\"edd8f550449c6534ea87\",\"7120\":\"4351a393dfb081ce0d24\",\"7244\":\"c74333bf67d0d0e5f0b7\",\"7276\":\"30fdb090c835b9699945\",\"7283\":\"fffaae54cb7b28e809f3\",\"7357\":\"cb6f3aabbdaa5f7b258b\",\"7405\":\"97e26c8dbe8b94c17ac9\",\"7424\":\"920b4bb14b7ef164f6ea\",\"7487\":\"f99a7245241b40c68b5a\",\"7499\":\"b71077d766e8046190f9\",\"7561\":\"1665e25dd14333ec9826\",\"7586\":\"77f6f39b7a4e6f37ed3f\",\"7594\":\"5628b088a8023fd67b16\",\"7612\":\"6c8ab8862b830976b5db\",\"7617\":\"34d0c937e4603648722e\",\"7643\":\"4a0415a020164e1d66ce\",\"7688\":\"f95d71b512dcd8a147b1\",\"7738\":\"0dc02b731f56895b7357\",\"7751\":\"e804d3f7bbdf481e5b29\",\"7768\":\"401d64251ac48845c4e1\",\"7854\":\"7be62b41cdba936c60e4\",\"7880\":\"68b59de98783ddb9efe1\",\"7901\":\"4aadbe5fa9ab2c7611da\",\"7939\":\"2813aac25a1b171b9989\",\"7972\":\"678efa36d93c19ed26e7\",\"7978\":\"212c9932786ab38c4554\",\"8043\":\"21401193a3b398303cb2\",\"8062\":\"ebd3ad90c39cc5e25350\",\"8100\":\"bd041507440eee866dc6\",\"8114\":\"c9802556b70ecf3759ff\",\"8142\":\"81da796ad6faa53a5d68\",\"8150\":\"0ba591eb0c58e1fdb970\",\"8169\":\"532cb82eb3a3a8271112\",\"8201\":\"c49763b6fd5c4015d0f2\",\"8213\":\"e581afc854c202a6b6fb\",\"8214\":\"3f3aaca4fffbb683fc2f\",\"8233\":\"ae517c59765c3b7bce41\",\"8308\":\"da1f7667512be214d174\",\"8349\":\"775185f0387e663c5027\",\"8393\":\"db6445b7c7e7f2fb5e93\",\"8590\":\"a91ed5bed2e457e93ce2\",\"8602\":\"c402ccf8ff9e705db27d\",\"8804\":\"f84ae4c11366a3801534\",\"8843\":\"6d23d4789571778235b2\",\"8924\":\"d08e780338c62690dbf5\",\"8980\":\"fec0192ca5989767fd0c\",\"9004\":\"e7575d29ea537f158935\",\"9030\":\"1f951cbe1fc3eed05dbe\",\"9072\":\"39603f8ff791f6826f87\",\"9141\":\"1085becfec856ba7da56\",\"9183\":\"d41c104abc24b4ac62f9\",\"9238\":\"bff8dd1dc0e66d5d0a90\",\"9250\":\"e581647d2044927ff610\",\"9287\":\"cf23b13bca02aebb5369\",\"9295\":\"a6b850b7b7099199fa9c\",\"9359\":\"5f9ee572512a6fae40ed\",\"9375\":\"d7efd3e904f1ac293240\",\"9451\":\"dc3f2226336ea84c7fa4\",\"9549\":\"9a06199a86d29568470b\",\"9623\":\"fdf70ce01a3b6098d93c\",\"9677\":\"a7ac09b5833e5c014541\",\"9710\":\"9b76a0cb719752bfb867\",\"9722\":\"1045c70e601d7d6d8b2d\",\"9753\":\"10215189de20ab980550\",\"9761\":\"62397d08b14e4d5fd188\",\"9849\":\"90f9bfd38c2507007b51\",\"9869\":\"543fec634f8285cd1377\",\"9998\":\"987bf83d84b82dcc5e6d\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"2394\":\"BundleCalls\",\"4765\":\"shared-components\",\"6930\":\"BundleStars\",\"7405\":\"BundleAuth\",\"7768\":\"BundleMain\",\"9451\":\"BundleExtra\"}[chunkId] || chunkId) + \".\" + {\"1184\":\"0d40f5d962d57f9ef64e\",\"2394\":\"37ece7e83ea7094182cc\",\"4369\":\"54ab1e961fe44a65a28f\",\"4765\":\"42f30c9d40ea3d25deb4\",\"6930\":\"e802a8ea9268ba51da18\",\"7405\":\"97e26c8dbe8b94c17ac9\",\"7643\":\"4a0415a020164e1d66ce\",\"7751\":\"e804d3f7bbdf481e5b29\",\"7768\":\"401d64251ac48845c4e1\",\"9451\":\"dc3f2226336ea84c7fa4\"}[chunkId] + \".css\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","if (typeof document === \"undefined\") return;\nvar createStylesheet = (chunkId, fullhref, oldTag, resolve, reject) => {\n\tvar linkTag = document.createElement(\"link\");\n\n\tlinkTag.rel = \"stylesheet\";\n\tlinkTag.type = \"text/css\";\n\tif (__webpack_require__.nc) {\n\t\tlinkTag.nonce = __webpack_require__.nc;\n\t}\n\tvar onLinkComplete = (event) => {\n\t\t// avoid mem leaks.\n\t\tlinkTag.onerror = linkTag.onload = null;\n\t\tif (event.type === 'load') {\n\t\t\tresolve();\n\t\t} else {\n\t\t\tvar errorType = event && event.type;\n\t\t\tvar realHref = event && event.target && event.target.href || fullhref;\n\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + errorType + \": \" + realHref + \")\");\n\t\t\terr.name = \"ChunkLoadError\";\n\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n\t\t\terr.type = errorType;\n\t\t\terr.request = realHref;\n\t\t\tif (linkTag.parentNode) linkTag.parentNode.removeChild(linkTag)\n\t\t\treject(err);\n\t\t}\n\t}\n\tlinkTag.onerror = linkTag.onload = onLinkComplete;\n\tlinkTag.href = fullhref;\n\n\n\tif (oldTag) {\n\t\toldTag.parentNode.insertBefore(linkTag, oldTag.nextSibling);\n\t} else {\n\t\tdocument.head.appendChild(linkTag);\n\t}\n\treturn linkTag;\n};\nvar findStylesheet = (href, fullhref) => {\n\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n\tfor(var i = 0; i < existingLinkTags.length; i++) {\n\t\tvar tag = existingLinkTags[i];\n\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return tag;\n\t}\n\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n\tfor(var i = 0; i < existingStyleTags.length; i++) {\n\t\tvar tag = existingStyleTags[i];\n\t\tvar dataHref = tag.getAttribute(\"data-href\");\n\t\tif(dataHref === href || dataHref === fullhref) return tag;\n\t}\n};\nvar loadStylesheet = (chunkId) => {\n\treturn new Promise((resolve, reject) => {\n\t\tvar href = __webpack_require__.miniCssF(chunkId);\n\t\tvar fullhref = __webpack_require__.p + href;\n\t\tif(findStylesheet(href, fullhref)) return resolve();\n\t\tcreateStylesheet(chunkId, fullhref, null, resolve, reject);\n\t});\n}\n// object to store loaded CSS chunks\nvar installedCssChunks = {\n\t8792: 0\n};\n\n__webpack_require__.f.miniCss = (chunkId, promises) => {\n\tvar cssChunks = {\"1184\":1,\"2394\":1,\"4369\":1,\"4765\":1,\"6930\":1,\"7405\":1,\"7643\":1,\"7751\":1,\"7768\":1,\"9451\":1};\n\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n\t\tpromises.push(installedCssChunks[chunkId] = loadStylesheet(chunkId).then(() => {\n\t\t\tinstalledCssChunks[chunkId] = 0;\n\t\t}, (e) => {\n\t\t\tdelete installedCssChunks[chunkId];\n\t\t\tthrow e;\n\t\t}));\n\t}\n};\n\n// no hmr\n\n// no prefetching\n\n// no preloaded","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t8792: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunktelegram_t\"] = self[\"webpackChunktelegram_t\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import { getActions } from '../global';\n\nimport { DEBUG, DEBUG_MORE, IS_TEST } from '../config';\nimport { formatShareText } from './deeplink';\nimport { validateFiles } from './files';\nimport { notifyClientReady, playNotifySoundDebounced } from './notifications';\nimport { IS_ANDROID, IS_IOS, IS_SERVICE_WORKER_SUPPORTED } from './windowEnvironment';\n\ntype WorkerAction = {\n  type: string;\n  payload: Record<string, any>;\n};\n\nconst IGNORE_WORKER_PATH = '/k/';\n\nfunction handleWorkerMessage(e: MessageEvent) {\n  const action: WorkerAction = e.data;\n  if (DEBUG_MORE) {\n    // eslint-disable-next-line no-console\n    console.log('[SW] Message from worker', action);\n  }\n  if (!action.type) return;\n  const dispatch = getActions();\n  const payload = action.payload;\n  switch (action.type) {\n    case 'focusMessage':\n      dispatch.focusMessage?.(payload as any);\n      break;\n    case 'playNotificationSound':\n      playNotifySoundDebounced(action.payload.id);\n      break;\n    case 'share':\n      dispatch.openChatWithDraft({\n        text: formatShareText(payload.url, payload.text, payload.title),\n        files: validateFiles(payload.files),\n      });\n      break;\n  }\n}\n\nfunction subscribeToWorker() {\n  navigator.serviceWorker.removeEventListener('message', handleWorkerMessage);\n  navigator.serviceWorker.addEventListener('message', handleWorkerMessage);\n  // Notify web worker that client is ready to receive messages\n  notifyClientReady();\n}\n\nif (IS_SERVICE_WORKER_SUPPORTED) {\n  window.addEventListener('load', async () => {\n    try {\n      const controller = navigator.serviceWorker.controller;\n      if (!controller || controller.scriptURL.includes(IGNORE_WORKER_PATH)) {\n        const registrations = await navigator.serviceWorker.getRegistrations();\n        const ourRegistrations = registrations.filter((r) => !r.scope.includes(IGNORE_WORKER_PATH));\n        if (ourRegistrations.length) {\n          if (DEBUG) {\n            // eslint-disable-next-line no-console\n            console.log('[SW] Hard reload detected, re-enabling Service Worker');\n          }\n          await Promise.all(ourRegistrations.map((r) => r.unregister()));\n        }\n      }\n\n      await navigator.serviceWorker.register(new URL('../serviceWorker', import.meta.url));\n\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[SW] ServiceWorker registered');\n      }\n\n      await navigator.serviceWorker.ready;\n\n      // Wait for registration to be available\n      await navigator.serviceWorker.getRegistration();\n\n      if (navigator.serviceWorker.controller) {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.log('[SW] ServiceWorker ready');\n        }\n        subscribeToWorker();\n      } else {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.error('[SW] ServiceWorker not available');\n        }\n\n        if (!IS_IOS && !IS_ANDROID && !IS_TEST) {\n          getActions().showDialog?.({ data: { message: 'SERVICE_WORKER_DISABLED', hasErrorKey: true } });\n        }\n      }\n    } catch (err) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.error('[SW] ServiceWorker registration failed: ', err);\n      }\n    }\n  });\n  window.addEventListener('focus', async () => {\n    await navigator.serviceWorker.ready;\n    subscribeToWorker();\n  });\n}\n","import { addCallback } from '../lib/teact/teactn';\n\nimport type { GlobalState } from './types';\n\nimport { getServerTime } from '../util/serverTime';\nimport { removePeerStory } from './reducers';\nimport { selectTabState } from './selectors';\nimport { getGlobal, setGlobal } from '.';\n\nconst STORY_EXPIRATION_INTERVAL = 2 * 60 * 1000; // 2 min\n\nlet intervals: number[] = [];\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  const previousGlobal = prevGlobal;\n  prevGlobal = global;\n\n  const isCurrentMaster = selectTabState(global)?.isMasterTab;\n  const isPreviousMaster = previousGlobal && selectTabState(previousGlobal)?.isMasterTab;\n  if (isCurrentMaster === isPreviousMaster) return;\n\n  if (isCurrentMaster && !isPreviousMaster) {\n    startIntervals();\n  } else {\n    stopIntervals();\n  }\n});\n\nfunction startIntervals() {\n  if (intervals.length) return;\n  intervals.push(window.setInterval(checkStoryExpiration, STORY_EXPIRATION_INTERVAL));\n}\n\nfunction stopIntervals() {\n  intervals.forEach((interval) => clearInterval(interval));\n  intervals = [];\n}\n\nfunction checkStoryExpiration() {\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  let global = getGlobal();\n  if (!global.isInited) return;\n\n  const serverTime = getServerTime();\n\n  Object.values(global.stories.byPeerId).forEach((peerStories) => {\n    const stories = Object.values(peerStories.byId);\n    stories.forEach((story) => {\n      if (!('expireDate' in story)) return;\n      if (story.expireDate > serverTime) return;\n      if ('isInProfile' in story && story.isInProfile) return;\n      if ('isPublic' in story && !story.isPublic) return;\n\n      global = removePeerStory(global, story.peerId, story.id);\n    });\n  });\n\n  setGlobal(global);\n}\n","import type { GlobalState } from '../global/types';\n\nimport { IS_MOCKED_CLIENT } from '../config';\nimport { loadCache } from '../global/cache';\nimport {\n  getGlobal, setGlobal,\n} from '../global/index';\nimport { INITIAL_GLOBAL_STATE } from '../global/initialState';\nimport { updatePasscodeSettings } from '../global/reducers';\nimport { cloneDeep } from './iteratees';\nimport { clearStoredSession } from './sessions';\n\nexport async function initGlobal(force: boolean = false, prevGlobal?: GlobalState) {\n  prevGlobal = prevGlobal || getGlobal();\n  if (!force && 'byTabId' in prevGlobal) {\n    return;\n  }\n\n  const initial = cloneDeep(INITIAL_GLOBAL_STATE);\n  let global = await loadCache(initial) || initial;\n  if (IS_MOCKED_CLIENT) global.authState = 'authorizationStateReady';\n\n  const { hasPasscode, isScreenLocked } = global.passcode;\n  if (hasPasscode && !isScreenLocked) {\n    global = updatePasscodeSettings(global, {\n      isScreenLocked: true,\n    });\n\n    clearStoredSession();\n  }\n\n  if (force) {\n    global.byTabId = prevGlobal.byTabId;\n\n    // Keep the theme if it was set before\n    global.settings.byKey.theme = prevGlobal.settings.byKey.theme;\n  }\n\n  setGlobal(global);\n}\n","import './intervals';\n\nimport type { ActionReturnType, GlobalState } from './types';\n\nimport { isCacheApiSupported } from '../util/cacheApi';\nimport { getCurrentTabId, reestablishMasterToSelf } from '../util/establishMultitabRole';\nimport { initGlobal } from '../util/init';\nimport { cloneDeep } from '../util/iteratees';\nimport { isLocalMessageId } from '../util/keys/messageKey';\nimport { Bundles, loadBundle } from '../util/moduleLoader';\nimport { parseLocationHash } from '../util/routing';\nimport { updatePeerColors } from '../util/theme';\nimport { IS_MULTITAB_SUPPORTED } from '../util/windowEnvironment';\nimport { initializeChatMediaSearchResults } from './reducers/middleSearch';\nimport { updateTabState } from './reducers/tabs';\nimport { initCache } from './cache';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from './index';\nimport { INITIAL_TAB_STATE } from './initialState';\nimport { replaceTabThreadParam, replaceThreadParam } from './reducers';\nimport { selectTabState, selectThreadParam } from './selectors';\n\ninitCache();\n\naddActionHandler('initShared', async (prevGlobal, actions, payload): Promise<void> => {\n  const { force } = payload || {};\n  await initGlobal(force, prevGlobal);\n});\n\naddActionHandler('init', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId(), isMasterTab } = payload || {};\n\n  const initialTabState = cloneDeep(INITIAL_TAB_STATE);\n  initialTabState.id = tabId;\n  initialTabState.isChatInfoShown = Boolean(global.lastIsChatInfoShown);\n  initialTabState.audioPlayer.playbackRate = global.audioPlayer.lastPlaybackRate;\n  initialTabState.audioPlayer.isPlaybackRateActive = global.audioPlayer.isLastPlaybackRateActive;\n  initialTabState.mediaViewer.playbackRate = global.mediaViewer.lastPlaybackRate;\n\n  global = {\n    ...global,\n    byTabId: {\n      ...global.byTabId,\n      [tabId]: initialTabState,\n    },\n  };\n\n  if (isMasterTab || !IS_MULTITAB_SUPPORTED) {\n    initialTabState.isMasterTab = true;\n  }\n\n  Object.keys(global.messages.byChatId).forEach((chatId) => {\n    const threadsById = global.messages.byChatId[chatId].threadsById;\n    Object.keys(threadsById).forEach((thread) => {\n      const threadId = Number(thread);\n      const lastViewportIds = selectThreadParam(global, chatId, threadId, 'lastViewportIds');\n      // Check if migration from previous version is faulty\n      if (!lastViewportIds?.every((id) => isLocalMessageId(id) || global.messages.byChatId[chatId]?.byId[id])) {\n        global = replaceThreadParam(global, chatId, threadId, 'lastViewportIds', undefined);\n        return;\n      }\n      global = initializeChatMediaSearchResults(global, chatId, threadId, tabId);\n      global = replaceTabThreadParam(\n        global,\n        chatId,\n        threadId,\n        'viewportIds',\n        lastViewportIds,\n        tabId,\n      );\n    });\n  });\n\n  // Temporary state fix\n  Object.keys(global.messages.byChatId).forEach((chatId) => {\n    const threadsById = global.messages.byChatId[chatId].threadsById;\n    const fixedThreadsById = Object.keys(threadsById).reduce((acc, key) => {\n      const t = threadsById[Number(key)];\n      acc[Number(key)] = {\n        ...t,\n        listedIds: t.lastViewportIds,\n      };\n      return acc;\n    }, {} as GlobalState['messages']['byChatId'][string]['threadsById']);\n\n    global = {\n      ...global,\n      messages: {\n        ...global.messages,\n        byChatId: {\n          ...global.messages.byChatId,\n          [chatId]: {\n            ...global.messages.byChatId[chatId],\n            threadsById: fixedThreadsById,\n          },\n        },\n      },\n    };\n  });\n\n  const parsedMessageList = parseLocationHash(global.currentUserId);\n\n  if (global.authState !== 'authorizationStateReady'\n    && !global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n    Object.values(global.byTabId).forEach(({ id: otherTabId }) => {\n      if (otherTabId === tabId) return;\n      global = updateTabState(global, {\n        isInactive: true,\n      }, otherTabId);\n    });\n  }\n\n  if (!IS_MULTITAB_SUPPORTED) {\n    actions.initApi();\n  }\n\n  isCacheApiSupported().then((isSupported) => {\n    global = getGlobal();\n    global.isCacheApiSupported = isSupported;\n    setGlobal(global);\n  });\n\n  if (global.peerColors) {\n    updatePeerColors(global.peerColors.general);\n  }\n\n  return updateTabState(global, {\n    messageLists: parsedMessageList ? [parsedMessageList] : initialTabState.messageLists,\n  }, tabId);\n});\n\naddActionHandler('requestMasterAndCallAction', async (\n  global, actions, payload,\n): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload;\n\n  if (selectTabState(global, tabId).isMasterTab) {\n    const { action, payload: actionPayload } = payload;\n    // @ts-ignore\n    actions[action](actionPayload);\n    return;\n  }\n\n  if (global.phoneCall || global.groupCalls.activeGroupCallId) {\n    await loadBundle(Bundles.Calls);\n    if ('hangUp' in actions) actions.hangUp({ tabId });\n    if ('leaveGroupCall' in actions) actions.leaveGroupCall({ tabId });\n  } else {\n    reestablishMasterToSelf();\n  }\n\n  global = getGlobal();\n  global = updateTabState(global, {\n    multitabNextAction: payload,\n  }, tabId);\n  setGlobal(global);\n});\n\naddActionHandler('clearMultitabNextAction', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  return updateTabState(global, {\n    multitabNextAction: undefined,\n  }, tabId);\n});\n","import { animate } from './animation';\nimport { fastRaf } from './schedulers';\nimport { IS_IOS } from './windowEnvironment';\n\nconst TEST_INTERVAL = 5000; // 5 sec\nconst FRAMES_TO_TEST = 10;\nconst REDUCED_FPS = 35;\n\nlet isImproved = false;\n\nexport function betterView() {\n  if (!IS_IOS) return;\n\n  let interval: number | undefined;\n  let lastFocusAt = Date.now();\n\n  function setupInterval() {\n    if (interval || isImproved) return;\n\n    interval = window.setInterval(testAndImprove, TEST_INTERVAL);\n  }\n\n  window.addEventListener('focus', () => {\n    const now = Date.now();\n    if (now - lastFocusAt < 100) return; // iOS triggers two `focus` events for some reason\n    lastFocusAt = now;\n\n    setupInterval();\n    testAndImprove();\n  });\n\n  window.addEventListener('blur', () => {\n    clearInterval(interval);\n    interval = undefined;\n  });\n\n  if (document.hasFocus()) {\n    setupInterval();\n    testAndImprove();\n  }\n}\n\nasync function testAndImprove() {\n  const fps = await testFps();\n  if (fps <= REDUCED_FPS) {\n    improveView();\n  }\n}\n\nfunction testFps() {\n  return new Promise<number>((resolve) => {\n    const frames: number[] = [];\n    let lastFrameAt = performance.now();\n\n    animate(() => {\n      const now = performance.now();\n      frames.push(now - lastFrameAt);\n      lastFrameAt = now;\n\n      if (frames.length === FRAMES_TO_TEST) {\n        const mean = frames.sort()[Math.floor(frames.length / 2)];\n        resolve(Math.round(1000 / mean));\n        return false;\n      }\n\n      return true;\n    }, fastRaf);\n  });\n}\n\nfunction improveView() {\n  isImproved = true;\n\n  const containerEl = document.createElement('div');\n  containerEl.style.cssText = 'position: absolute; top: 0; left: 0; width: 0; height: 100%; overflow: hidden;';\n\n  const boosterEl = document.createElement('div');\n  const height = window.screen.height * 1.5;\n  boosterEl.style.cssText = `width: 0; height: ${height}px; transform: translateX(100%); transition: transform 100ms;`;\n  boosterEl.innerHTML = '&nbsp;';\n\n  containerEl.appendChild(boosterEl);\n  document.body.appendChild(containerEl);\n\n  requestAnimationFrame(() => {\n    boosterEl.addEventListener('transitionend', () => {\n      containerEl.remove();\n    });\n\n    boosterEl.style.transform = '';\n  });\n}\n","const STORAGE_KEY = 'tt-active-tab';\nconst INTERVAL = 2000;\n\nconst tabKey = String(Date.now() + Math.random());\n\nlocalStorage.setItem(STORAGE_KEY, tabKey);\n\nlet callback: NoneToVoidFunction;\n\nconst interval = window.setInterval(() => {\n  if (callback && localStorage.getItem(STORAGE_KEY) !== tabKey) {\n    callback();\n    clearInterval(interval);\n  }\n}, INTERVAL);\n\nexport function addActiveTabChangeListener(_callback: NoneToVoidFunction) {\n  callback = _callback;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthCodeAsync: FC = () => {\n  const AuthCode = useModuleLoader(Bundles.Auth, 'AuthCode');\n\n  return AuthCode ? <AuthCode /> : <Loading />;\n};\n\nexport default AuthCodeAsync;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthPasswordAsync: FC = () => {\n  const AuthPassword = useModuleLoader(Bundles.Auth, 'AuthPassword');\n\n  return AuthPassword ? <AuthPassword /> : <Loading />;\n};\n\nexport default AuthPasswordAsync;\n","const SITE_FONTS = ['400 1em Roboto', '500 1em Roboto', \"500 1em 'Numbers Rounded'\"];\n\nexport default function preloadFonts() {\n  if ('fonts' in document) {\n    return Promise.all(SITE_FONTS.map((font) => document.fonts.load(font)));\n  }\n\n  return undefined;\n}\n","import type { LangCode } from '../../../types';\n\nexport function getSuggestedLanguage() {\n  let suggestedLanguage = navigator.language.toLowerCase();\n\n  if (suggestedLanguage && suggestedLanguage !== 'pt-br') {\n    suggestedLanguage = suggestedLanguage.substr(0, 2);\n  }\n\n  return suggestedLanguage as LangCode;\n}\n","import { useEffect, useState } from '../lib/teact/teact';\n\nimport type { RegularLangKey } from '../types/language';\n\nimport { LANG_PACK } from '../config';\nimport { callApi } from '../api/gramjs';\nimport useLastCallback from './useLastCallback';\n\nexport default function useLangString(key: RegularLangKey, langCode?: string) {\n  const [value, setValue] = useState<string | undefined>(undefined);\n\n  const fetchLangString = useLastCallback(async () => {\n    if (!langCode) return undefined;\n\n    const result = await callApi('fetchLangStrings', {\n      langCode,\n      langPack: LANG_PACK,\n      keys: [key],\n    });\n    const langString = result?.strings[key];\n    if (!langString || typeof langString !== 'string') return undefined;\n    return langString;\n  });\n\n  useEffect(() => {\n    fetchLangString().then(setValue);\n  }, [key, langCode]);\n\n  return value;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useRef, useState,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiCountryCode } from '../../api/types';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport buildClassName from '../../util/buildClassName';\nimport { isoToEmoji } from '../../util/emoji/emoji';\nimport { prepareSearchWordsForNeedle } from '../../util/searchWords';\nimport renderText from '../common/helpers/renderText';\n\nimport useLang from '../../hooks/useLang';\nimport useSyncEffect from '../../hooks/useSyncEffect';\n\nimport DropdownMenu from '../ui/DropdownMenu';\nimport MenuItem from '../ui/MenuItem';\nimport Spinner from '../ui/Spinner';\n\nimport './CountryCodeInput.scss';\n\ntype StateProps = {\n  phoneCodeList: ApiCountryCode[];\n};\n\ntype OwnProps = {\n  id: string;\n  value?: ApiCountryCode;\n  isLoading?: boolean;\n  onChange: (value: ApiCountryCode) => void;\n};\n\nconst MENU_HIDING_DURATION = 200 + ANIMATION_END_DELAY;\nconst SELECT_TIMEOUT = 50;\n\nconst CountryCodeInput: FC<OwnProps & StateProps> = ({\n  id,\n  value,\n  isLoading,\n  onChange,\n  phoneCodeList,\n}) => {\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const [filter, setFilter] = useState<string | undefined>();\n  const [filteredList, setFilteredList] = useState<ApiCountryCode[]>([]);\n\n  const updateFilter = useCallback((filterValue?: string) => {\n    setFilter(filterValue);\n    setFilteredList(getFilteredList(phoneCodeList, filterValue));\n  }, [phoneCodeList]);\n\n  useSyncEffect(([prevPhoneCodeList]) => {\n    if (!prevPhoneCodeList?.length && phoneCodeList.length) {\n      setFilteredList(getFilteredList(phoneCodeList, filter));\n    }\n  }, [phoneCodeList, filter]);\n\n  const handleChange = useCallback((country: ApiCountryCode) => {\n    onChange(country);\n\n    setTimeout(() => updateFilter(undefined), MENU_HIDING_DURATION);\n  }, [onChange, updateFilter]);\n\n  const handleInput = useCallback((e: React.FormEvent<HTMLInputElement>) => {\n    updateFilter(e.currentTarget.value);\n  }, [updateFilter]);\n\n  const handleInputKeyDown = useCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.keyCode !== 8) {\n      return;\n    }\n\n    const target = e.currentTarget;\n    if (value && filter === undefined) {\n      target.value = '';\n    }\n\n    updateFilter(target.value);\n  }, [filter, updateFilter, value]);\n\n  const CodeInput: FC<{ onTrigger: () => void; isOpen?: boolean }> = useCallback(({ onTrigger, isOpen }) => {\n    const handleTrigger = () => {\n      if (isOpen) {\n        return;\n      }\n\n      setTimeout(() => {\n        inputRef.current!.select();\n      }, SELECT_TIMEOUT);\n\n      onTrigger();\n\n      const formEl = document.getElementById('auth-phone-number-form')!;\n      formEl.scrollTo({ top: formEl.scrollHeight, behavior: 'smooth' });\n    };\n\n    const handleCodeInput = (e: React.FormEvent<HTMLInputElement>) => {\n      handleInput(e);\n      handleTrigger();\n    };\n\n    const inputValue = filter ?? (value?.name || value?.defaultName || '');\n\n    return (\n      <div className={buildClassName('input-group', value && 'touched')}>\n        <input\n          ref={inputRef}\n          className={buildClassName('form-control', isOpen && 'focus')}\n          type=\"text\"\n          id={id}\n          value={inputValue}\n          autoComplete=\"off\"\n          onClick={handleTrigger}\n          onFocus={handleTrigger}\n          onInput={handleCodeInput}\n          onKeyDown={handleInputKeyDown}\n        />\n        <label>{lang('LoginSelectCountryTitle')}</label>\n        {isLoading ? (\n          <Spinner color=\"black\" />\n        ) : (\n          <i onClick={handleTrigger} className={buildClassName('css-icon-down', isOpen && 'open')} />\n        )}\n      </div>\n    );\n  }, [filter, handleInput, handleInputKeyDown, id, isLoading, lang, value]);\n\n  return (\n    <DropdownMenu\n      className=\"CountryCodeInput\"\n      trigger={CodeInput}\n    >\n      {filteredList\n        .map((country: ApiCountryCode) => (\n          <MenuItem\n            key={`${country.iso2}-${country.countryCode}`}\n            className={value && country.iso2 === value.iso2 ? 'selected' : ''}\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => handleChange(country)}\n          >\n            <span className=\"country-flag\">{renderText(isoToEmoji(country.iso2), ['hq_emoji'])}</span>\n            <span className=\"country-name\">{country.name || country.defaultName}</span>\n            <span className=\"country-code\">+{country.countryCode}</span>\n          </MenuItem>\n        ))}\n      {!filteredList.length && (\n        <MenuItem\n          key=\"no-results\"\n          className=\"no-results\"\n          disabled\n        >\n          <span>{lang('CountryNone')}</span>\n        </MenuItem>\n      )}\n    </DropdownMenu>\n  );\n};\n\nfunction getFilteredList(countryList: ApiCountryCode[], filter = ''): ApiCountryCode[] {\n  if (!filter.length) {\n    return countryList;\n  }\n\n  const searchWords = prepareSearchWordsForNeedle(filter);\n\n  return countryList.filter((country) => (\n    searchWords(country.defaultName) || (country.name && searchWords(country.name))\n  ));\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    const { countryList: { phoneCodes: phoneCodeList } } = global;\n    return {\n      phoneCodeList,\n    };\n  },\n)(CountryCodeInput));\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useLayoutEffect, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiCountryCode } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\n\nimport { requestMeasure } from '../../lib/fasterdom/fasterdom';\nimport { preloadImage } from '../../util/files';\nimport preloadFonts from '../../util/fonts';\nimport { pick } from '../../util/iteratees';\nimport { oldSetLanguage } from '../../util/oldLangProvider';\nimport { formatPhoneNumber, getCountryCodesByIso, getCountryFromPhoneNumber } from '../../util/phoneNumber';\nimport { IS_SAFARI, IS_TOUCH_ENV } from '../../util/windowEnvironment';\nimport { getSuggestedLanguage } from './helpers/getSuggestedLanguage';\n\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useLangString from '../../hooks/useLangString';\n\nimport Button from '../ui/Button';\nimport Checkbox from '../ui/Checkbox';\nimport InputText from '../ui/InputText';\nimport Loading from '../ui/Loading';\nimport CountryCodeInput from './CountryCodeInput';\n\nimport monkeyPath from '../../assets/monkey.svg';\n\ntype StateProps = Pick<GlobalState, (\n  'connectionState' | 'authState' |\n  'authPhoneNumber' | 'authIsLoading' |\n  'authIsLoadingQrCode' | 'authErrorKey' |\n  'authRememberMe' | 'authNearestCountry'\n)> & {\n  language?: string;\n  phoneCodeList: ApiCountryCode[];\n};\n\nconst MIN_NUMBER_LENGTH = 7;\n\nlet isPreloadInitiated = false;\n\nconst AuthPhoneNumber: FC<StateProps> = ({\n  connectionState,\n  authState,\n  authPhoneNumber,\n  authIsLoading,\n  authIsLoadingQrCode,\n  authErrorKey,\n  authRememberMe,\n  authNearestCountry,\n  phoneCodeList,\n  language,\n}) => {\n  const {\n    setAuthPhoneNumber,\n    setAuthRememberMe,\n    loadNearestCountry,\n    loadCountryList,\n    clearAuthErrorKey,\n    goToAuthQrCode,\n    setSettingOption,\n  } = getActions();\n\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n  const suggestedLanguage = getSuggestedLanguage();\n\n  const isConnected = connectionState === 'connectionStateReady';\n  const continueText = useLangString('AuthContinueOnThisLanguage', suggestedLanguage);\n  const [country, setCountry] = useState<ApiCountryCode | undefined>();\n  const [phoneNumber, setPhoneNumber] = useState<string | undefined>();\n  const [isTouched, setIsTouched] = useState(false);\n  const [lastSelection, setLastSelection] = useState<[number, number] | undefined>();\n  const [isLoading, markIsLoading, unmarkIsLoading] = useFlag();\n\n  const fullNumber = country ? `+${country.countryCode} ${phoneNumber || ''}` : phoneNumber;\n  const canSubmit = fullNumber && fullNumber.replace(/[^\\d]+/g, '').length >= MIN_NUMBER_LENGTH;\n\n  useEffect(() => {\n    if (!IS_TOUCH_ENV) {\n      inputRef.current!.focus();\n    }\n  }, [country]);\n\n  useEffect(() => {\n    if (isConnected && !authNearestCountry) {\n      loadNearestCountry();\n    }\n  }, [isConnected, authNearestCountry]);\n\n  useEffect(() => {\n    if (isConnected) {\n      loadCountryList({ langCode: language });\n    }\n  }, [isConnected, language]);\n\n  useEffect(() => {\n    if (authNearestCountry && phoneCodeList && !country && !isTouched) {\n      setCountry(getCountryCodesByIso(phoneCodeList, authNearestCountry)[0]);\n    }\n  }, [country, authNearestCountry, isTouched, phoneCodeList]);\n\n  const parseFullNumber = useCallback((newFullNumber: string) => {\n    if (!newFullNumber.length) {\n      setPhoneNumber('');\n    }\n\n    const suggestedCountry = phoneCodeList && getCountryFromPhoneNumber(phoneCodeList, newFullNumber);\n\n    // Any phone numbers should be allowed, in some cases ignoring formatting\n    const selectedCountry = !country\n    || (suggestedCountry && suggestedCountry.iso2 !== country.iso2)\n    || (!suggestedCountry && newFullNumber.length)\n      ? suggestedCountry\n      : country;\n\n    if (!country || !selectedCountry || (selectedCountry && selectedCountry.iso2 !== country.iso2)) {\n      setCountry(selectedCountry);\n    }\n    setPhoneNumber(formatPhoneNumber(newFullNumber, selectedCountry));\n  }, [phoneCodeList, country]);\n\n  const handleLangChange = useCallback(() => {\n    markIsLoading();\n\n    void oldSetLanguage(suggestedLanguage, () => {\n      unmarkIsLoading();\n\n      setSettingOption({ language: suggestedLanguage });\n    });\n  }, [markIsLoading, setSettingOption, suggestedLanguage, unmarkIsLoading]);\n\n  useEffect(() => {\n    if (phoneNumber === undefined && authPhoneNumber) {\n      parseFullNumber(authPhoneNumber);\n    }\n  }, [authPhoneNumber, phoneNumber, parseFullNumber]);\n\n  useLayoutEffect(() => {\n    if (inputRef.current && lastSelection) {\n      inputRef.current.setSelectionRange(...lastSelection);\n    }\n  }, [lastSelection]);\n\n  const isJustPastedRef = useRef(false);\n  const handlePaste = useCallback(() => {\n    isJustPastedRef.current = true;\n    requestMeasure(() => {\n      isJustPastedRef.current = false;\n    });\n  }, []);\n\n  const handleCountryChange = useCallback((value: ApiCountryCode) => {\n    setCountry(value);\n    setPhoneNumber('');\n  }, []);\n\n  const handlePhoneNumberChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (authErrorKey) {\n      clearAuthErrorKey();\n    }\n\n    // This is for further screens. We delay it until user input to speed up the initial loading.\n    if (!isPreloadInitiated) {\n      isPreloadInitiated = true;\n      preloadFonts();\n      void preloadImage(monkeyPath);\n    }\n\n    const { value, selectionStart, selectionEnd } = e.target;\n    setLastSelection(\n      selectionStart && selectionEnd && selectionEnd < value.length\n        ? [selectionStart, selectionEnd]\n        : undefined,\n    );\n\n    setIsTouched(true);\n\n    const shouldFixSafariAutoComplete = (\n      IS_SAFARI && country && fullNumber !== undefined\n      && value.length - fullNumber.length > 1 && !isJustPastedRef.current\n    );\n    parseFullNumber(shouldFixSafariAutoComplete ? `${country!.countryCode} ${value}` : value);\n  }, [authErrorKey, country, fullNumber, parseFullNumber]);\n\n  const handleKeepSessionChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    setAuthRememberMe(e.target.checked);\n  }, [setAuthRememberMe]);\n\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    if (authIsLoading) {\n      return;\n    }\n\n    if (canSubmit) {\n      setAuthPhoneNumber({ phoneNumber: fullNumber });\n    }\n  }\n\n  const handleGoToAuthQrCode = useCallback(() => {\n    goToAuthQrCode();\n  }, [goToAuthQrCode]);\n\n  const isAuthReady = authState === 'authorizationStateWaitPhoneNumber';\n\n  return (\n    <div id=\"auth-phone-number-form\" className=\"custom-scroll\">\n      <div className=\"auth-form\">\n        <div id=\"logo\" />\n        <h1>{lang('AuthTitle')}</h1>\n        <p className=\"note\">{lang('StartText')}</p>\n        <form className=\"form\" action=\"\" onSubmit={handleSubmit}>\n          <CountryCodeInput\n            id=\"sign-in-phone-code\"\n            value={country}\n            isLoading={!authNearestCountry && !country}\n            onChange={handleCountryChange}\n          />\n          <InputText\n            ref={inputRef}\n            id=\"sign-in-phone-number\"\n            label={lang('LoginPhonePlaceholder')}\n            value={fullNumber}\n            error={authErrorKey && lang.withRegular(authErrorKey)}\n            inputMode=\"tel\"\n            onChange={handlePhoneNumberChange}\n            onPaste={IS_SAFARI ? handlePaste : undefined}\n          />\n          <Checkbox\n            id=\"sign-in-keep-session\"\n            label={lang('AuthKeepSignedIn')}\n            checked={Boolean(authRememberMe)}\n            onChange={handleKeepSessionChange}\n          />\n          {canSubmit && (\n            isAuthReady ? (\n              <Button size=\"smaller\" type=\"submit\" ripple isLoading={authIsLoading}>{lang('LoginNext')}</Button>\n            ) : (\n              <Loading />\n            )\n          )}\n          {isAuthReady && (\n            <Button size=\"smaller\" isText ripple isLoading={authIsLoadingQrCode} onClick={handleGoToAuthQrCode}>\n              {lang('LoginQRLogin')}\n            </Button>\n          )}\n          {suggestedLanguage && suggestedLanguage !== language && continueText && (\n            <Button size=\"smaller\" isText isLoading={isLoading} onClick={handleLangChange}>{continueText}</Button>\n          )}\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    const {\n      settings: { byKey: { language } },\n      countryList: { phoneCodes: phoneCodeList },\n    } = global;\n\n    return {\n      ...pick(global, [\n        'connectionState',\n        'authState',\n        'authPhoneNumber',\n        'authIsLoading',\n        'authIsLoadingQrCode',\n        'authErrorKey',\n        'authRememberMe',\n        'authNearestCountry',\n      ]),\n      language,\n      phoneCodeList,\n    };\n  },\n)(AuthPhoneNumber));\n","import React, {\n  memo, useCallback, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\n\nimport { STRICTERDOM_ENABLED } from '../../config';\nimport { disableStrict, enableStrict } from '../../lib/fasterdom/stricterdom';\nimport buildClassName from '../../util/buildClassName';\nimport { oldSetLanguage } from '../../util/oldLangProvider';\nimport { LOCAL_TGS_URLS } from '../common/helpers/animatedAssets';\nimport { getSuggestedLanguage } from './helpers/getSuggestedLanguage';\n\nimport useAsync from '../../hooks/useAsync';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useLangString from '../../hooks/useLangString';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\n\nimport AnimatedIcon from '../common/AnimatedIcon';\nimport Button from '../ui/Button';\nimport Loading from '../ui/Loading';\n\nimport blankUrl from '../../assets/blank.png';\n\ntype StateProps =\n  Pick<GlobalState, 'connectionState' | 'authState' | 'authQrCode'>\n  & { language?: string };\n\nconst DATA_PREFIX = 'tg://login?token=';\nconst QR_SIZE = 280;\nconst QR_PLANE_SIZE = 54;\nconst QR_CODE_MUTATION_DURATION = 50; // The library is asynchronous and we need to wait for its mutation code\n\nlet qrCodeStylingPromise: Promise<typeof import('qr-code-styling')>;\n\nfunction ensureQrCodeStyling() {\n  if (!qrCodeStylingPromise) {\n    qrCodeStylingPromise = import('qr-code-styling');\n  }\n  return qrCodeStylingPromise;\n}\n\nconst AuthCode = ({\n  connectionState,\n  authState,\n  authQrCode,\n  language,\n}: StateProps) => {\n  const {\n    returnToAuthPhoneNumber,\n    setSettingOption,\n  } = getActions();\n\n  const suggestedLanguage = getSuggestedLanguage();\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  const qrCodeRef = useRef<HTMLDivElement>(null);\n\n  const isConnected = connectionState === 'connectionStateReady';\n  const continueText = useLangString('AuthContinueOnThisLanguage', suggestedLanguage);\n  const [isLoading, markIsLoading, unmarkIsLoading] = useFlag();\n  const [isQrMounted, markQrMounted, unmarkQrMounted] = useFlag();\n\n  const { result: qrCode } = useAsync(async () => {\n    const QrCodeStyling = (await ensureQrCodeStyling()).default;\n    return new QrCodeStyling({\n      width: QR_SIZE,\n      height: QR_SIZE,\n      image: blankUrl,\n      margin: 10,\n      type: 'svg',\n      dotsOptions: {\n        type: 'rounded',\n      },\n      cornersSquareOptions: {\n        type: 'extra-rounded',\n      },\n      imageOptions: {\n        imageSize: 0.4,\n        margin: 8,\n      },\n      qrOptions: {\n        errorCorrectionLevel: 'M',\n      },\n    });\n  }, []);\n\n  const transitionClassNames = useMediaTransitionDeprecated(isQrMounted);\n\n  useLayoutEffect(() => {\n    if (!authQrCode || !qrCode) {\n      return () => {\n        unmarkQrMounted();\n      };\n    }\n\n    if (!isConnected) {\n      return undefined;\n    }\n\n    const container = qrCodeRef.current!;\n    const data = `${DATA_PREFIX}${authQrCode.token}`;\n\n    if (STRICTERDOM_ENABLED) {\n      disableStrict();\n    }\n\n    qrCode.update({\n      data,\n    });\n\n    if (!isQrMounted) {\n      qrCode.append(container);\n      markQrMounted();\n    }\n\n    if (STRICTERDOM_ENABLED) {\n      setTimeout(() => {\n        enableStrict();\n      }, QR_CODE_MUTATION_DURATION);\n    }\n\n    return undefined;\n  }, [isConnected, authQrCode, isQrMounted, markQrMounted, unmarkQrMounted, qrCode]);\n\n  const handleLangChange = useCallback(() => {\n    markIsLoading();\n\n    void oldSetLanguage(suggestedLanguage, () => {\n      unmarkIsLoading();\n\n      setSettingOption({ language: suggestedLanguage });\n    });\n  }, [markIsLoading, setSettingOption, suggestedLanguage, unmarkIsLoading]);\n\n  const habdleReturnToAuthPhoneNumber = useCallback(() => {\n    returnToAuthPhoneNumber();\n  }, [returnToAuthPhoneNumber]);\n\n  const isAuthReady = authState === 'authorizationStateWaitQrCode';\n\n  return (\n    <div id=\"auth-qr-form\" className=\"custom-scroll\">\n      <div className=\"auth-form qr\">\n        <div className=\"qr-outer\">\n          <div\n            className={buildClassName('qr-inner', transitionClassNames)}\n            key=\"qr-inner\"\n          >\n            <div\n              key=\"qr-container\"\n              className=\"qr-container\"\n              ref={qrCodeRef}\n              style={`width: ${QR_SIZE}px; height: ${QR_SIZE}px`}\n            />\n            <AnimatedIcon\n              tgsUrl={LOCAL_TGS_URLS.QrPlane}\n              size={QR_PLANE_SIZE}\n              className=\"qr-plane\"\n              nonInteractive\n              noLoop={false}\n            />\n          </div>\n          {!isQrMounted && <div className=\"qr-loading\"><Loading /></div>}\n        </div>\n        <h1>{lang('LoginQRTitle')}</h1>\n        <ol>\n          <li><span>{lang('LoginQRHelp1')}</span></li>\n          <li><span>{lang('LoginQRHelp2', undefined, { withNodes: true, withMarkdown: true })}</span></li>\n          <li><span>{lang('LoginQRHelp3')}</span></li>\n        </ol>\n        {isAuthReady && (\n          <Button size=\"smaller\" isText onClick={habdleReturnToAuthPhoneNumber}>{lang('LoginQRCancel')}</Button>\n        )}\n        {suggestedLanguage && suggestedLanguage !== language && continueText && (\n          <Button size=\"smaller\" isText isLoading={isLoading} onClick={handleLangChange}>{continueText}</Button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    const {\n      connectionState, authState, authQrCode, settings: { byKey: { language } },\n    } = global;\n\n    return {\n      connectionState,\n      authState,\n      authQrCode,\n      language,\n    };\n  },\n)(AuthCode));\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthRegisterAsync: FC = () => {\n  const AuthRegister = useModuleLoader(Bundles.Auth, 'AuthRegister');\n\n  return AuthRegister ? <AuthRegister /> : <Loading />;\n};\n\nexport default AuthRegisterAsync;\n","import '../../global/actions/initial';\n\nimport type { FC } from '../../lib/teact/teact';\nimport React, { memo, useRef } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\n\nimport { PLATFORM_ENV } from '../../util/windowEnvironment';\n\nimport useCurrentOrPrev from '../../hooks/useCurrentOrPrev';\nimport useElectronDrag from '../../hooks/useElectronDrag';\nimport useHistoryBack from '../../hooks/useHistoryBack';\n\nimport Transition from '../ui/Transition';\nimport AuthCode from './AuthCode.async';\nimport AuthPassword from './AuthPassword.async';\nimport AuthPhoneNumber from './AuthPhoneNumber';\nimport AuthQrCode from './AuthQrCode';\nimport AuthRegister from './AuthRegister.async';\n\nimport './Auth.scss';\n\ntype StateProps = Pick<GlobalState, 'authState'>;\n\nconst Auth: FC<StateProps> = ({\n  authState,\n}) => {\n  const {\n    returnToAuthPhoneNumber, goToAuthQrCode,\n  } = getActions();\n\n  const isMobile = PLATFORM_ENV === 'iOS' || PLATFORM_ENV === 'Android';\n\n  const handleChangeAuthorizationMethod = () => {\n    if (!isMobile) {\n      goToAuthQrCode();\n    } else {\n      returnToAuthPhoneNumber();\n    }\n  };\n\n  useHistoryBack({\n    isActive: (!isMobile && authState === 'authorizationStateWaitPhoneNumber')\n      || (isMobile && authState === 'authorizationStateWaitQrCode'),\n    onBack: handleChangeAuthorizationMethod,\n  });\n\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  useElectronDrag(containerRef);\n\n  // For animation purposes\n  const renderingAuthState = useCurrentOrPrev(\n    authState !== 'authorizationStateReady' ? authState : undefined,\n    true,\n  );\n\n  function getScreen() {\n    switch (renderingAuthState) {\n      case 'authorizationStateWaitCode':\n        return <AuthCode />;\n      case 'authorizationStateWaitPassword':\n        return <AuthPassword />;\n      case 'authorizationStateWaitRegistration':\n        return <AuthRegister />;\n      case 'authorizationStateWaitPhoneNumber':\n        return <AuthPhoneNumber />;\n      case 'authorizationStateWaitQrCode':\n        return <AuthQrCode />;\n      default:\n        return isMobile ? <AuthPhoneNumber /> : <AuthQrCode />;\n    }\n  }\n\n  function getActiveKey() {\n    switch (renderingAuthState) {\n      case 'authorizationStateWaitCode':\n        return 0;\n      case 'authorizationStateWaitPassword':\n        return 1;\n      case 'authorizationStateWaitRegistration':\n        return 2;\n      case 'authorizationStateWaitPhoneNumber':\n        return 3;\n      case 'authorizationStateWaitQrCode':\n        return 4;\n      default:\n        return isMobile ? 3 : 4;\n    }\n  }\n\n  return (\n    <Transition activeKey={getActiveKey()} name=\"fade\" className=\"Auth\" ref={containerRef}>\n      {getScreen()}\n    </Transition>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    return {\n      authState: global.authState,\n    };\n  },\n)(Auth));\n","// extracted by mini-css-extract-plugin\nexport default {\"bg\":\"ThfRMqwq\"};","// extracted by mini-css-extract-plugin\nexport default {\"mask\":\"U9MowLv_\",\"main\":\"RcG6eRZw\",\"left\":\"oL7XcRwI\",\"middle\":\"LYe7IaQO\",\"right\":\"wYSGQZXX\",\"blank\":\"kN2M6u9m\"};","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../global';\n\nimport type { TabState } from '../../global/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport { getChatAvatarHash } from '../../global/helpers/chats'; // Direct import for better module splitting\nimport { selectIsRightColumnShown, selectTabState } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { preloadImage } from '../../util/files';\nimport preloadFonts from '../../util/fonts';\nimport { localizationReadyPromise } from '../../util/localization';\nimport * as mediaLoader from '../../util/mediaLoader';\nimport { Bundles, loadModule } from '../../util/moduleLoader';\nimport { pause } from '../../util/schedulers';\n\nimport useEffectOnce from '../../hooks/useEffectOnce';\nimport useFlag from '../../hooks/useFlag';\nimport useShowTransitionDeprecated from '../../hooks/useShowTransitionDeprecated';\n\n// Workaround for incorrect bundling by Webpack: force including in the main chunk\nimport '../ui/Modal.scss';\nimport './Avatar.scss';\nimport appStyles from '../App.module.scss';\nimport styles from './UiLoader.module.scss';\n\nimport lockPreviewPath from '../../assets/lock.png';\nimport monkeyPath from '../../assets/monkey.svg';\nimport spoilerMaskPath from '../../assets/spoilers/mask.svg';\nimport telegramLogoPath from '../../assets/telegram-logo.svg';\n\nexport type UiLoaderPage =\n  'main'\n  | 'lock'\n  | 'inactive'\n  | 'authCode'\n  | 'authPassword'\n  | 'authPhoneNumber'\n  | 'authQrCode';\n\ntype OwnProps = {\n  page?: UiLoaderPage;\n  children: React.ReactNode;\n  isMobile?: boolean;\n};\n\ntype StateProps = Pick<TabState, 'uiReadyState' | 'shouldSkipHistoryAnimations'> & {\n  isRightColumnShown?: boolean;\n  leftColumnWidth?: number;\n};\n\nconst MAX_PRELOAD_DELAY = 700;\nconst SECOND_STATE_DELAY = 1000;\nconst AVATARS_TO_PRELOAD = 10;\n\nfunction preloadAvatars() {\n  const { listIds, byId } = getGlobal().chats;\n  if (!listIds.active) {\n    return undefined;\n  }\n\n  return Promise.all(listIds.active.slice(0, AVATARS_TO_PRELOAD).map((chatId) => {\n    const chat = byId[chatId];\n    if (!chat) {\n      return undefined;\n    }\n\n    const avatarHash = getChatAvatarHash(chat);\n    if (!avatarHash) {\n      return undefined;\n    }\n\n    return mediaLoader.fetch(avatarHash, ApiMediaFormat.BlobUrl);\n  }));\n}\n\nconst preloadTasks = {\n  main: () => Promise.all([\n    loadModule(Bundles.Main)\n      .then(preloadFonts),\n    preloadAvatars(),\n    preloadImage(spoilerMaskPath),\n    localizationReadyPromise,\n  ]),\n  authPhoneNumber: () => Promise.all([\n    preloadFonts(),\n    preloadImage(telegramLogoPath),\n  ]),\n  authCode: () => preloadImage(monkeyPath),\n  authPassword: () => preloadImage(monkeyPath),\n  authQrCode: preloadFonts,\n  lock: () => Promise.all([\n    preloadFonts(),\n    preloadImage(lockPreviewPath),\n  ]),\n  inactive: () => {\n  },\n};\n\nconst UiLoader: FC<OwnProps & StateProps> = ({\n  page,\n  children,\n  isRightColumnShown,\n  shouldSkipHistoryAnimations,\n  leftColumnWidth,\n}) => {\n  const { setIsUiReady } = getActions();\n\n  const [isReady, markReady] = useFlag();\n  const {\n    shouldRender: shouldRenderMask, transitionClassNames,\n  } = useShowTransitionDeprecated(!isReady, undefined, true);\n\n  useEffectOnce(() => {\n    let timeout: number | undefined;\n\n    const safePreload = async () => {\n      try {\n        await preloadTasks[page!]();\n      } catch (err) {\n        // Do nothing\n      }\n    };\n\n    Promise.race([\n      pause(MAX_PRELOAD_DELAY),\n      page ? safePreload() : Promise.resolve(),\n    ]).then(() => {\n      markReady();\n      setIsUiReady({ uiReadyState: 1 });\n\n      timeout = window.setTimeout(() => {\n        setIsUiReady({ uiReadyState: 2 });\n      }, SECOND_STATE_DELAY);\n    });\n\n    return () => {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = undefined;\n      }\n\n      setIsUiReady({ uiReadyState: 0 });\n    };\n  });\n\n  return (\n    <>\n      {children}\n      {shouldRenderMask && !shouldSkipHistoryAnimations && Boolean(page) && (\n        <div className={buildClassName(styles.mask, transitionClassNames)}>\n          {page === 'main' ? (\n            <div className={styles.main}>\n              <div\n                className={styles.left}\n                style={leftColumnWidth ? `width: ${leftColumnWidth}px` : undefined}\n              />\n              <div className={buildClassName(styles.middle, appStyles.bg)} />\n              {isRightColumnShown && <div className={styles.right} />}\n            </div>\n          ) : (page === 'inactive' || page === 'lock') ? (\n            <div className={buildClassName(styles.blank, appStyles.bg)} />\n          ) : (\n            <div className={styles.blank} />\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default withGlobal<OwnProps>(\n  (global, { isMobile }): StateProps => {\n    const tabState = selectTabState(global);\n\n    return {\n      shouldSkipHistoryAnimations: tabState.shouldSkipHistoryAnimations,\n      uiReadyState: tabState.uiReadyState,\n      isRightColumnShown: selectIsRightColumnShown(global, isMobile),\n      leftColumnWidth: global.leftColumnWidth,\n    };\n  },\n)(UiLoader);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useCallback } from '../../lib/teact/teact';\n\nimport useHistoryBack from '../../hooks/useHistoryBack';\n\nimport Button from '../ui/Button';\n\nimport './AppInactive.scss';\n\nimport appInactivePath from '../../assets/app-inactive.png';\n\nconst AppInactive: FC = () => {\n  const handleReload = useCallback(() => {\n    window.location.reload();\n  }, []);\n\n  useHistoryBack({\n    isActive: true,\n    onBack: handleReload,\n    shouldResetUrlHash: true,\n  });\n\n  return (\n    <div id=\"AppInactive\">\n      <div className=\"content\">\n        <img src={appInactivePath} alt=\"\" />\n        <h3 className=\"title\">Such error, many tabs</h3>\n        <div className=\"description\">\n          Telegram supports only one active tab with the app.\n          <br />\n          Please reload this page to continue using this tab or close it.\n        </div>\n        <div className=\"actions\">\n          <Button isText ripple onClick={handleReload}>\n            Reload app\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AppInactive;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { OwnProps } from './LockScreen';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst LockScreenAsync: FC<OwnProps> = (props) => {\n  const { isLocked } = props;\n  const LockScreen = useModuleLoader(Bundles.Main, 'LockScreen', !isLocked);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return LockScreen ? <LockScreen {...props} /> : undefined;\n};\n\nexport default LockScreenAsync;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { OwnProps } from './Main';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst MainAsync: FC<OwnProps> = (props) => {\n  const Main = useModuleLoader(Bundles.Main, 'Main');\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return Main ? <Main {...props} /> : undefined;\n};\n\nexport default MainAsync;\n","import type { FC } from '../lib/teact/teact';\nimport React, { useEffect, useLayoutEffect } from '../lib/teact/teact';\nimport { getActions, withGlobal } from '../global';\n\nimport type { GlobalState } from '../global/types';\nimport type { ThemeKey } from '../types';\nimport type { UiLoaderPage } from './common/UiLoader';\n\nimport {\n  DARK_THEME_BG_COLOR, INACTIVE_MARKER, LIGHT_THEME_BG_COLOR, PAGE_TITLE,\n} from '../config';\nimport { selectTabState, selectTheme } from '../global/selectors';\nimport { addActiveTabChangeListener } from '../util/activeTabMonitor';\nimport buildClassName from '../util/buildClassName';\nimport { setupBeforeInstallPrompt } from '../util/installPrompt';\nimport { parseInitialLocationHash } from '../util/routing';\nimport { hasStoredSession } from '../util/sessions';\nimport { IS_INSTALL_PROMPT_SUPPORTED, IS_MULTITAB_SUPPORTED, PLATFORM_ENV } from '../util/windowEnvironment';\nimport { updateSizes } from '../util/windowSize';\n\nimport useAppLayout from '../hooks/useAppLayout';\nimport useFlag from '../hooks/useFlag';\nimport usePreviousDeprecated from '../hooks/usePreviousDeprecated';\n\n// import Test from './test/TestLocale';\nimport Auth from './auth/Auth';\nimport UiLoader from './common/UiLoader';\nimport AppInactive from './main/AppInactive';\nimport LockScreen from './main/LockScreen.async';\nimport Main from './main/Main.async';\nimport Transition from './ui/Transition';\n\nimport styles from './App.module.scss';\n\ntype StateProps = {\n  authState: GlobalState['authState'];\n  isScreenLocked?: boolean;\n  hasPasscode?: boolean;\n  isInactiveAuth?: boolean;\n  hasWebAuthTokenFailed?: boolean;\n  isTestServer?: boolean;\n  theme: ThemeKey;\n};\n\nenum AppScreens {\n  auth,\n  main,\n  lock,\n  inactive,\n}\n\nconst TRANSITION_RENDER_COUNT = Object.keys(AppScreens).length / 2;\nconst INACTIVE_PAGE_TITLE = `${PAGE_TITLE} ${INACTIVE_MARKER}`;\n\nconst App: FC<StateProps> = ({\n  authState,\n  isScreenLocked,\n  hasPasscode,\n  isInactiveAuth,\n  hasWebAuthTokenFailed,\n  isTestServer,\n  theme,\n}) => {\n  const { disconnect } = getActions();\n\n  const [isInactive, markInactive, unmarkInactive] = useFlag(false);\n  const { isMobile } = useAppLayout();\n  const isMobileOs = PLATFORM_ENV === 'iOS' || PLATFORM_ENV === 'Android';\n\n  useEffect(() => {\n    if (IS_INSTALL_PROMPT_SUPPORTED) {\n      setupBeforeInstallPrompt();\n    }\n  }, []);\n\n  // Prevent drop on elements that do not accept it\n  useEffect(() => {\n    const body = document.body;\n    const handleDrag = (e: DragEvent) => {\n      e.preventDefault();\n      if (!e.dataTransfer) return;\n      if (!(e.target as HTMLElement).dataset.dropzone) {\n        e.dataTransfer.dropEffect = 'none';\n      } else {\n        e.dataTransfer.dropEffect = 'copy';\n      }\n    };\n    const handleDrop = (e: DragEvent) => {\n      e.preventDefault();\n    };\n    body.addEventListener('drop', handleDrop);\n    body.addEventListener('dragover', handleDrag);\n    body.addEventListener('dragenter', handleDrag);\n\n    return () => {\n      body.removeEventListener('drop', handleDrop);\n      body.removeEventListener('dragover', handleDrag);\n      body.removeEventListener('dragenter', handleDrag);\n    };\n  }, []);\n\n  // return <Test />;\n\n  let activeKey: number;\n  let page: UiLoaderPage | undefined;\n\n  if (isInactive) {\n    activeKey = AppScreens.inactive;\n  } else if (isScreenLocked) {\n    page = 'lock';\n    activeKey = AppScreens.lock;\n  } else if (authState) {\n    switch (authState) {\n      case 'authorizationStateWaitPhoneNumber':\n        page = 'authPhoneNumber';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitCode':\n        page = 'authCode';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitPassword':\n        page = 'authPassword';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitRegistration':\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitQrCode':\n        page = 'authQrCode';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateClosed':\n      case 'authorizationStateClosing':\n      case 'authorizationStateLoggingOut':\n      case 'authorizationStateReady':\n        page = 'main';\n        activeKey = AppScreens.main;\n        break;\n    }\n  } else if (hasStoredSession()) {\n    page = 'main';\n    activeKey = AppScreens.main;\n  } else if (hasPasscode) {\n    activeKey = AppScreens.lock;\n  } else {\n    page = isMobileOs ? 'authPhoneNumber' : 'authQrCode';\n    activeKey = AppScreens.auth;\n  }\n\n  if (activeKey !== AppScreens.lock\n    && activeKey !== AppScreens.inactive\n    && activeKey !== AppScreens.main\n    && parseInitialLocationHash()?.tgWebAuthToken\n    && !hasWebAuthTokenFailed) {\n    page = 'main';\n    activeKey = AppScreens.main;\n  }\n\n  useEffect(() => {\n    updateSizes();\n  }, []);\n\n  useEffect(() => {\n    if (IS_MULTITAB_SUPPORTED) return;\n\n    addActiveTabChangeListener(() => {\n      disconnect();\n      document.title = INACTIVE_PAGE_TITLE;\n\n      markInactive();\n    });\n  }, [activeKey, disconnect, markInactive]);\n\n  useEffect(() => {\n    if (isInactiveAuth) {\n      document.title = INACTIVE_PAGE_TITLE;\n      markInactive();\n    } else {\n      document.title = PAGE_TITLE;\n      unmarkInactive();\n    }\n  }, [isInactiveAuth, markInactive, unmarkInactive]);\n\n  const prevActiveKey = usePreviousDeprecated(activeKey);\n\n  // eslint-disable-next-line consistent-return\n  function renderContent() {\n    switch (activeKey) {\n      case AppScreens.auth:\n        return <Auth />;\n      case AppScreens.main:\n        return <Main isMobile={isMobile} />;\n      case AppScreens.lock:\n        return <LockScreen isLocked={isScreenLocked} />;\n      case AppScreens.inactive:\n        return <AppInactive />;\n    }\n  }\n\n  useLayoutEffect(() => {\n    document.body.classList.add(styles.bg);\n  }, []);\n\n  useLayoutEffect(() => {\n    document.body.style.setProperty(\n      '--theme-background-color',\n      theme === 'dark' ? DARK_THEME_BG_COLOR : LIGHT_THEME_BG_COLOR,\n    );\n  }, [theme]);\n\n  return (\n    <UiLoader page={page} isMobile={isMobile}>\n      <Transition\n        name=\"fade\"\n        activeKey={activeKey}\n        shouldCleanup\n        className={buildClassName(\n          'full-height',\n          (activeKey === AppScreens.auth || prevActiveKey === AppScreens.auth) && 'is-auth',\n        )}\n        renderCount={TRANSITION_RENDER_COUNT}\n      >\n        {renderContent}\n      </Transition>\n      {activeKey === AppScreens.auth && isTestServer && <div className=\"test-server-badge\">Test server</div>}\n    </UiLoader>\n  );\n};\n\nexport default withGlobal(\n  (global): StateProps => {\n    return {\n      authState: global.authState,\n      isScreenLocked: global.passcode?.isScreenLocked,\n      hasPasscode: global.passcode?.hasPasscode,\n      isInactiveAuth: selectTabState(global).isInactive,\n      hasWebAuthTokenFailed: global.hasWebAuthTokenFailed || global.hasWebAuthTokenPasswordRequired,\n      theme: selectTheme(global),\n      isTestServer: global.config?.isTestServer,\n    };\n  },\n)(App);\n","import './util/handleError';\nimport './util/setupServiceWorker';\nimport './global/init';\n\nimport React from './lib/teact/teact';\nimport TeactDOM from './lib/teact/teact-dom';\nimport {\n  getActions, getGlobal,\n} from './global';\n\nimport {\n  DEBUG, MULTITAB_LOCALSTORAGE_KEY, STRICTERDOM_ENABLED,\n} from './config';\nimport { enableStrict, requestMutation } from './lib/fasterdom/fasterdom';\nimport { selectTabState } from './global/selectors';\nimport { betterView } from './util/betterView';\nimport { establishMultitabRole, subscribeToMasterChange } from './util/establishMultitabRole';\nimport { initGlobal } from './util/init';\nimport { initLocalization } from './util/localization';\nimport { requestGlobal, subscribeToMultitabBroadcastChannel } from './util/multitab';\nimport { checkAndAssignPermanentWebVersion } from './util/permanentWebVersion';\nimport { onBeforeUnload } from './util/schedulers';\nimport updateWebmanifest from './util/updateWebmanifest';\nimport { IS_MULTITAB_SUPPORTED } from './util/windowEnvironment';\n\nimport App from './components/App';\n\nimport './assets/fonts/roboto.css';\nimport './styles/index.scss';\n\nif (STRICTERDOM_ENABLED) {\n  enableStrict();\n}\n\ninit();\n\nasync function init() {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> INIT');\n  }\n\n  if (!(window as any).isCompatTestPassed) return;\n\n  checkAndAssignPermanentWebVersion();\n\n  await window.electron?.restoreLocalStorage();\n\n  if (IS_MULTITAB_SUPPORTED) {\n    subscribeToMultitabBroadcastChannel();\n    await requestGlobal(APP_VERSION);\n    localStorage.setItem(MULTITAB_LOCALSTORAGE_KEY, '1');\n    onBeforeUnload(() => {\n      const global = getGlobal();\n      if (Object.keys(global.byTabId).length === 1) {\n        localStorage.removeItem(MULTITAB_LOCALSTORAGE_KEY);\n      }\n    });\n  }\n\n  await initGlobal();\n  getActions().init();\n\n  getActions().updateShouldEnableDebugLog();\n  getActions().updateShouldDebugExportedSenders();\n\n  const global = getGlobal();\n\n  initLocalization(global.settings.byKey.language, true);\n\n  if (IS_MULTITAB_SUPPORTED) {\n    subscribeToMasterChange((isMasterTab) => {\n      getActions()\n        .switchMultitabRole({ isMasterTab }, { forceSyncOnIOs: true });\n    });\n    const shouldReestablishMasterToSelf = getGlobal().authState !== 'authorizationStateReady';\n    establishMultitabRole(shouldReestablishMasterToSelf);\n  }\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> START INITIAL RENDER');\n  }\n\n  requestMutation(() => {\n    updateWebmanifest();\n\n    TeactDOM.render(\n      <App />,\n      document.getElementById('root')!,\n    );\n\n    betterView();\n  });\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> FINISH INITIAL RENDER');\n  }\n\n  if (DEBUG) {\n    document.addEventListener('dblclick', () => {\n      // eslint-disable-next-line no-console\n      console.warn('TAB STATE', selectTabState(getGlobal()));\n      // eslint-disable-next-line no-console\n      console.warn('GLOBAL STATE', getGlobal());\n    });\n  }\n}\n\nonBeforeUnload(() => {\n  const actions = getActions();\n  actions.leaveGroupCall?.({ isPageUnload: true });\n  actions.hangUp?.({ isPageUnload: true });\n});\n","// Original idea was found here\n// https://medium.com/@alshakero/how-to-setup-your-web-app-manifest-dynamically-using-javascript-f7fbee899a61\n\nimport { DEBUG } from '../config';\nimport { IS_MAC_OS } from './windowEnvironment';\n\nexport default function updateWebmanifest() {\n  if (!IS_MAC_OS) {\n    return;\n  }\n\n  const manifest = document.getElementById('the-manifest-placeholder');\n  if (!manifest) {\n    return;\n  }\n\n  const url = `site_apple${DEBUG ? '_dev' : ''}.webmanifest`;\n  manifest.setAttribute('href', url);\n}\n"],"names":["leafPrototypes","getProto","inProgress","dataWebpackPrefix","HEALTH_CHECK_TIMEOUT","HEALTH_CHECK_MIN_DELAY","NO_QUEUE_BEFORE_INIT","Set","worker","requestStates","Map","requestStatesByCallback","pendingPayloads","savedLocalDb","chats","users","documents","stickerSets","photos","webDocuments","commonBoxState","channelPtsById","isMasterTab","subscribeToMasterChange","isMasterTabNew","channel","IS_MULTITAB_SUPPORTED","BroadcastChannel","DATA_BROADCAST_CHANNEL_NAME","undefined","postMessagesOnTickEnd","throttleWithTickEnd","payloads","postMessage","postMessageOnTickEnd","payload","push","updateCallback","localApiRequestsQueue","apiRequestsQueue","isInited","initApi","onUpdate","initialArgs","DEBUG","console","log","Worker","URL","addEventListener","data","forEach","type","DEBUG_startAt","performance","now","updates","duration","warn","length","handleMethodResponse","handleMethodCallback","message","error","IGNORE_UNHANDLED_ERRORS","has","Error","navigator","sendBeacon","url","logDebugMessage","level","args","subscribeToWorker","platform","window","ensureWorkerPing","setTimeout","makeRequest","then","request","callApi","fnName","deferred","resolve","catch","reject","callApiLocal","token","getCurrentTabId","initApiOnMasterTab","Promise","updateLocalDb","name","prop","value","updateFullLocalDb","initial","Object","assign","setShouldEnableDebugLog","isEnabled","Deferred","promise","err","messageId","generateUniqueId","requestState","withCallback","callback","pop","set","finally","delete","callApiOnMasterTab","makeRequestToMaster","cancelApiProgress","progressCallback","isCanceled","get","cancelApiProgressMaster","response","callbackArgs","DEBUG_payload","startedAt","Date","async","isResolved","race","pause","terminate","ApiMediaFormat","ApiMessageEntityTypes","MAIN_THREAD_ID","MESSAGE_DELETED","DEFAULT_SIZE","memo","props","size","play","noLoop","className","noTransition","nonInteractive","onLoad","onClick","otherProps","isAnimationLoaded","markAnimationLoaded","useFlag","transitionClassNames","useMediaTransitionDeprecated","handleLoad","useLastCallback","playKey","setPlayKey","useState","String","Math","random","handleClick","React","createElement","AnimatedSticker","_extends","buildClassName","RLottie","ensureRLottie","module","default","getRLottie","ref","renderId","style","tgsUrl","playSegment","speed","quality","isLowPriority","color","forceAlways","forceOnHeavyAnimation","sharedCanvas","sharedCanvasCoords","onEnded","onLoop","containerRef","useRef","viewId","useUniqueId","animation","setAnimation","animationRef","isFirstRender","shouldUseColorFilter","colorFilter","useColorFilter","playRef","useStateRef","playSegmentRef","rgbColor","shouldForceOnHeavyAnimation","canInitialize","markCanInitialize","unmarkCanInitialize","getIsHeavyAnimating","useHeavyAnimation","useEffect","useSyncEffect","r","g","b","hexToRgb","current","isUnmountedRef","useUnmountCleanup","init","offsetWidth","offsetHeight","container","newAnimation","coords","setSpeed","throttledInit","useThrottledCallback","useSharedIntersectionObserver","setColor","removeView","playAnimation","shouldRestart","isFrozen","playAnimationOnRaf","requestMeasure","pauseAnimation","isPlaying","useEffectWithPrevDeps","prevNoLoop","setNoLoop","prevSharedCanvasCoords","setSharedCanvasCoords","changeData","usePriorityPlaybackCheck","useBackgroundMode","buildStyle","IS_ELECTRON","isPriorityPlaybackActive","isBackgroundModeActive","checkBlockQuoteFirstLast","blockElement","gradientContainer","querySelector","getBlockQuoteInnerText","node","HTMLElement","dataset","entityType","Blockquote","childEl","Array","from","childNodes","find","child","HTMLQuoteElement","text","Utils","getTextContentWithBreaks","skipMarkdownMarker","collapsed","isToggleDisabled","isInEditMode","children","isDisabled","isCollapsed","isCollapsible","setIsCollapsed","useCollapsibleLines","canExpand","handleExpand","handleToggle","prev","contentEditable","Icon","getCustomEmojiInnerText","CustomEmoji","alt","documentId","isBig","noPlay","noVideoOnMobile","loopLimit","isSelectable","withSharedAnimation","sharedCanvasRef","sharedCanvasHqRef","withTranslucentThumb","shouldPreloadPreview","observeIntersectionForLoading","observeIntersectionForPlaying","onAnimationEnd","customEmoji","canPlay","useCustomEmoji","loopCountRef","shouldPlay","setShouldPlay","hasCustomColor","shouldUseTextColor","customColor","useDynamicColorListener","handleVideoEnded","e","currentTarget","currentTime","safePlay","handleStickerLoop","isHq","stickerSetInfo","selectIsAlwaysHighPriorityEmoji","getGlobal","emojiElement","emoji","src","blankImg","draggable","StickerView","sticker","isSmall","thumbClassName","fullMediaClassName","shouldLoop","onVideoEnded","onAnimatedStickerLoop","handleClickOnNonContentEditable","withGlobal","global","poll","selectPollFromMessage","storyData","content","story","selectPeerStory","peerId","id","translatedText","noEmoji","highlight","truncateLength","TRUNCATED_SUMMARY_LENGTH","withTranslucentThumbs","inChatList","emojiSize","lang","useOldLang","entities","extractMessageText","hasSpoilers","some","Spoiler","hasCustomEmoji","hasPoll","Boolean","getMessagePollId","statefulContent","groupStatetefulContent","summaryText","getMessageSummaryText","trimmedText","trimText","renderText","getMessageSummaryEmoji","Fragment","getMessageSummaryDescription","MessageText","messageOrStory","isSimple","flat","filter","isForAnimation","isProtected","shouldRenderAsHtml","forcePlayback","focusedQuote","isInSelectMode","canBeEmpty","textCacheBusterRef","formattedText","adaptedFormattedText","stripCustomEmoji","containerId","withSharedCanvas","useMemo","renderTextWithEntities","cacheBuster","toString","CONTENT_NOT_SUPPORTED","utf16","input","output","i","len","RangeError","fromCharCode","join","base","damp","tmin","tmax","skew","maxint","adapt","delta","numpoints","firsttime","k","floor","decode","preserveCase","case_flags","input_length","n","out","bias","basic","j","ic","oldi","w","digit","t","lastIndexOf","charCodeAt","cp","splice","toUpperCase","getUnicodeUrl","href","ensureProtocol","parsedUrl","unicodeDomain","domain","domain_array","split","s","match","slice","convertPunycode","hostname","decodeURI","replace","SafeLink","isRtl","openUrl","getActions","isRegularLink","preventDefault","shouldSkipModal","classNames","title","target","rel","dir","BUTTON_POSITIONS","x","y","durationShift","PROGRESS_POSITIONS","count","positions","velocityX","velocityY","scale","generateRandomProgressPositions","Sparkles","presetSettings","preset","styles","map","position","shiftX","cos","atan2","shiftY","sin","fullMediaHash","noLoad","isLottie","isVideoBroken","markVideoBroken","isUnsupportedVideo","isVideo","IS_WEBM_SUPPORTED","IS_IOS","IS_ANDROID","isStatic","previewMediaHash","getStickerMediaHash","dpr","useDevicePixelRatio","filterStyle","isIntersectingForLoading","useIsIntersecting","shouldLoad","isIntersectingForPlaying","hasIntersectedForPlayingRef","cachedPreview","mediaLoader","isReadyToMountFullMedia","hasIntersected","getNoHeavyAnimation","setNoHeavyAnimation","useSignal","$getIsHeavyAnimating","useDerivedState","useMountAfterHeavyAnimation","shouldForcePreview","shouldLoadPreview","previewMediaData","useMedia","withPreview","shouldSkipLoadingFullMedia","fullMediaData","shouldRenderFullMedia","isPlayerReady","markPlayerReady","isFullMediaReady","thumbDataUri","useThumbnail","thumbData","isThumbOpaque","noCrossTransition","thumbRef","useMediaTransition","noCloseTransition","fullMediaRef","noOpenTransition","useCoordsInSharedCanvas","randomIdPrefix","key","OptimizedVideo","playsInline","muted","loop","isPriority","disablePictureInPicture","onReady","onBroken","TopicDefaultIcon","letterClassName","topicId","iconColor","iconSrc","getTopicDefaultIcon","GENERAL_TOPIC_ID","getFirstLetters","PRETTY_BY_ALIAS","js","javascript","ts","typescript","python","py","go","rust","func","c","cpp","fortran","f90","f","java","sql","swift","kotlin","ruby","rb","php","perl","bash","sh","markdown","cs","json","yaml","yml","solidity","sol","tl","keys","CodeOverlay","noCopy","onWordWrapToggle","showNotification","windowSize","useWindowSize","isWordWrap","setIsWordWrap","withWordWrapButton","setWithWordWrapButton","checkWordWrap","useCallback","isWrap","areLinesWrapping","parentElement","handleCopy","copyTextToClipboard","handleWordWrapClick","contentClass","overlayClass","wrapClass","CONSTANTS","CODE_HEADER","CODE_CONTENT","CODE_FOOTER","checkCodeBlockHeaderFooter","currentNode","header","footer","codeContent","isInHeader","contains","isInFooter","extractCodeBlockData","Pre","headerTextContent","textContent","language","startMarker","endMarker","CodeBlock","setWordWrap","currentLanguage","setCurrentLanguage","codeText","setCodeText","highlightedLayer","setHighlightedLayer","editableRef","highlightedRef","result","highlighted","useAsync","lib","combinedInnerHTML","jsxToHtml","el","innerHTML","useDidMountEffect","deps","didMount","handleWordWrapToggle","wrap","blockClass","setAttribute","onChange","event","BlockMarkdownMarkerRenderer","disableRendering","codeLanguage","toLowerCase","dangerouslySetInnerHTML","__html","onInput","innerText","onScroll","handleScroll","scrollTop","scrollLeft","LOCAL_TGS_URLS","MonkeyIdle","MonkeyTracking","MonkeyClose","MonkeyPeek","FoldersAll","FoldersNew","FoldersShare","DiscussionGroups","Lock","CameraFlip","HandFilled","HandOutline","Speaker","VoiceAllowTalk","VoiceMini","VoiceMuted","VoiceOutlined","JoinRequest","Invite","QrPlane","Congratulations","Experimental","PartyPopper","Flame","ReadTime","Unlock","LastSeen","Mention","StarReactionEffect","StarReaction","Report","ONE_GIGABYTE","ONE_MEGABYTE","getFileSizeString","bytes","toFixed","getDocumentExtension","document","fileName","mimeType","getFileExtension","indexOf","getColorFromExtension","extension","getDocumentHasPreview","previewBlobUrl","thumbnail","MEDIA_VIEWER_MEDIA_QUERY","REM","parseInt","getComputedStyle","documentElement","fontSize","ROUND_VIDEO_DIMENSIONS_PX","GIF_MIN_WIDTH","AVATAR_FULL_DIMENSIONS","width","height","VIDEO_AVATAR_FULL_DIMENSIONS","LIKE_STICKER_ID","DEFAULT_MEDIA_DIMENSIONS","MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM","MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM","MESSAGE_MAX_WIDTH_REM","MESSAGE_OWN_MAX_WIDTH_REM","cachedMaxWidthOwn","cachedMaxWidth","cachedMaxWidthNoAvatar","getAvailableWidth","fromOwnMessage","isWebPageMedia","noAvatars","isMobile","extraPaddingRem","availableWidthRem","windowWidth","min","getMaxMessageWidthRem","calculateDimensionsForMessageMedia","isGif","aspectRatio","availableWidth","availableHeight","getAvailableHeight","mediaWidth","max","calculateDimensions","getMediaViewerAvailableDimensions","withFooter","mql","matchMedia","windowHeight","occupiedHeightRem","matches","IS_TOUCH_ENV","calculateInlineImageDimensions","photo","asForwarded","getPhotoInlineDimensions","calculateVideoDimensions","video","getVideoDimensions","calculateExtendedPreviewDimensions","preview","getPictogramDimensions","getDocumentThumbnailDimensions","smaller","getStickerDimensions","baseWidth","STICKER_SIZE_INLINE_MOBILE_FACTOR","STICKER_SIZE_INLINE_DESKTOP_FACTOR","calculatedHeight","round","calculateMediaViewerDimensions","mediaHeight","calculatedWidth","ChatLink","chatId","openChat","Link","GroupCallLink","groupCall","requestMasterAndJoinGroupCall","accessHash","MessageLink","focusMessage","handleMessageClick","UserLink","sender","MAX_LENGTH","NBSP","renderActionMessageText","oldLang","actionOriginUser","actionOriginChat","targetUsers","targetMessage","targetChatId","topic","options","isExpiredMessage","getExpiredMessageDescription","action","translationValues","amount","currency","call","score","topicEmojiIconId","giftCryptoInfo","pluralValue","noLinks","asPlainText","isEmbedded","translationKey","processed","unprocessed","includes","startsWith","processPlaceholder","user","renderUserContent","SERVICE_NOTIFICATIONS_USER_ID","renderChatContent","formatCurrencyAsString","code","iconEmojiId","topicIcon","priceText","STARS_CURRENCY_CODE","price","messageSummary","MessageSummary","renderMessageContent","invoice","renderProductContent","renderMigratedContent","part","trim","renderGroupCallContent","getUserFullName","chat","getChatTitle","placeholder","replaceValue","separator","placeholderPosition","substring","isArray","index","SIMPLE_MARKDOWN_REGEX","filters","params","compact","reduce","textParts","divEl","escapeHtml","EMOJI_REGEX","lastIndex","replaceEmojis","addLineBreaks","addHighlight","quote","addLinks","replaceSimpleMarkdown","markdownPostProcessor","IS_EMOJI_SUPPORTED","parts","fixNonStandardEmoji","emojis","emojiResult","nativeToUnifiedExtendedWithCache","IS_PACKAGED_ELECTRON","BASE_URL","isLoaded","LOADED_EMOJIS","handleEmojiLoad","splittenParts","line","source","trimmedLine","trimLeft","indentLength","repeat","isQuote","queryPosition","newParts","RE_LINK","RegExp","RE_LINK_TEMPLATE","RE_MENTION_TEMPLATE","allowOnlyTgLinks","links","nextLink","shift","MentionLink","username","endsWith","isDeepLink","postProcessor","postProcess","entityResult","entity","element","lines","lineHeight","lineHeightParsed","parseFloat","clientHeight","revealByContainerId","createClassNameBuilder","contentRef","isRevealed","revealSpoiler","stopEvent","reveal","HQ_EMOJI_THRESHOLD","noLineBreaks","noCustomEmojiPlayback","renderMessagePart","deleteLineBreakAfterPre","organizedEntities","organizedEntityIndexes","organizedEntity","organizeEntity","organizedIndexes","organizedIndex","add","organizeEntities","renderEntity","textPartStart","textPartEnd","isLastEntity","renderResult","nestedEntities","offset","textBefore","textBeforeLength","substr","entityStartIndex","entityEndIndex","entityContent","nestedEntityContent","nestedIndex","nestedEntity","nestedEntityIndex","nestedResult","nestedEntityEndIndex","newEntity","rawEntityText","trimEnd","renderedContent","Bold","Italic","Underline","Code","Strike","MentionName","userId","Url","TextUrl","getLinkUrl","buildCustomEmojiHtmlFromEntity","processEntityAsHtml","processEntity","textAfter","arrayIndex","parsedEntity","isChanged","entityText","renderNestedMessagePart","MarkdownMarkerRenderer","BotCommand","handleBotCommandClick","Hashtag","tag","handleHashtagClick","Cashtag","handleCodeClick","role","tabIndex","Email","Phone","sendBotCommand","command","hashtag","openChatByUsername","onChatChanged","searchHashtag","oldTranslate","LOAD_QUEUE","RENDER_HISTORY","loadFromQueue","throttle","queue","queueToLoad","otherQueue","LIMIT_PER_REQUEST","loadCustomEmojis","ids","updateLastRendered","updateLastRenderedCustomEmojis","reverse","clear","notifyCustomEmojiRender","emojiId","addCustomEmojiInputRenderCallback","setCustomEmoji","customEmojis","byId","setCanPlay","selectCanPlayAnimatedEmojis","handleGlobalChange","newGlobal","addCustomEmojiCallback","removeCustomEmojiCallback","ariaLabel","character","STAR_PATH","GoldStarIcon","randomId","mask1Id","mask2Id","gradient1Id","gradient2Id","gradient3Id","svg","viewBox","fill","maskUnits","d","mask","x1","y1","x2","y2","gradientUnits","PremiumStarIcon","RegularStarIcon","StarIcon","validSvgRandomId","root","clickable","renderIcon","INPUT_CUSTOM_EMOJI_SELECTOR","buildCustomEmojiHtml","isPlaceholder","uniqueId","getInputCustomEmojiParams","rawText","getCustomEmojiSize","maxEmojisInLine","EMOJI_SIZES","preventMessageInputBlur","withBubbling","activeElement","EDITABLE_INPUT_ID","preventMessageInputBlurWithBubbling","userOrChat","selectUser","closeStoryViewer","setShouldCloseRightColumn","useAppLayout","Button","onContextMenu","onMouseDown","onMouseUp","onMouseEnter","onMouseLeave","onFocus","backgroundImage","pill","badge","fluid","isText","isLoading","isShiny","withPremiumGradient","withSparkleEffect","onTransitionEnd","ariaControls","hasPopup","download","disabled","allowDisabledClick","noFastClick","ripple","faded","isRectangular","noPreventDefault","shouldStopPropagation","noForcedUpperCase","elementRef","isClicked","setIsClicked","isNotInteractive","fullClassName","stopPropagation","handleMouseDown","button","MouseButton","Main","Spinner","RippleEffect","Checkbox","label","labelText","subLabel","checked","withIcon","blocking","permissionGroup","rightIcon","onlyInput","isRound","nestedCheckbox","nestedCheckboxCount","nestedOptionList","leftElement","values","onCheck","onClickLabel","labelRef","showNested","setShowNested","handleChange","toggleNested","labelClassName","nestedOptions","nestedOption","DropdownMenu","trigger","transformOriginX","transformOriginY","positionX","positionY","forceOpen","onOpen","onClose","onMouseEnterBackdrop","onHide","menuRef","isOpen","setIsOpen","handleClose","triggerComponent","onTrigger","isMenuOpen","onKeyDown","menu","keyCode","focusedElement","elementChildren","focus","toggleIsOpen","Menu","autoClose","onCloseAnimationEnd","InputText","success","readOnly","autoComplete","inputMode","maxLength","teactExperimentControlled","onKeyPress","onBlur","onPaste","htmlFor","isPrimary","Loading","backgroundColor","EMPTY_RECT","left","top","applyStaticOptions","bubbleRef","bubbleStyle","containerEl","bubbleEl","cssText","addExtraClass","setExtraStyles","transformOrigin","externalRef","shouldCloseFast","bubbleClassName","ariaLabelledBy","noCloseOnBackdrop","backdropExcludedSelector","noCompact","withPortal","positionOptions","isTouchScreen","useShowTransition","optionsRef","useLayoutEffect","options2","requestForcedReflow","staticOptions","anchor","getRootElement","getMenuElement","getTriggerElement","getLayout","withMaxHeight","triggerEl","anchorX","anchorY","menuEl","rootEl","extraPaddingX","extraTopPadding","extraMarginTop","topShiftY","menuElMinWidth","deltaX","shouldAvoidNegativePosition","isDense","marginTop","menuElWidth","menuElHeight","menuRect","rootRect","getBoundingClientRect","yWithTopShift","triggerRect","addedYForPortalPositioning","addedXForPortalPositioning","leftWithPossibleNegative","addedXForMenuPositioning","offsetX","offsetY","processDynamically","useMenuPosition","captureEscKeyListener","useHistoryBack","isActive","onBack","shouldBeReplaced","prevIsOpen","beginHeavyAnimation","handleKeyDown","useKeyboardListNavigation","useVirtualBackdrop","bubbleFullClassName","IS_BACKDROP_BLUR_SUPPORTED","Portal","icon","isCharIcon","customIcon","destructive","withWrap","clickArg","withPreventDefaultOnMouseDown","location","origin","IS_TEST","onTimeUpdate","restProps","localRef","handlePlaying","handlePlayingForAutoPause","playerRef","canPlayRef","mediaRef","shouldPauseRef","isLoadingPlayRef","body","usePlayPause","unfreezePlaying","unfreezePlayingOnRaf","useVideoAutoPause","isReadyRef","handleReady","isBuffered","bufferingHandlers","useBuffering","onPlaying","handlePlayingForBuffering","otherBufferingHandlers","prevIsBuffered","mergedOtherBufferingHandlers","mergedHandlers","keyString","useVideoCleanup","autoPlay","containerSelector","classList","appendChild","TeactDOM","render","removeChild","ripples","setRipples","cleanUpDebounced","debounce","rippleSize","clientX","clientY","CLASSES","ACTIVE_SLIDE_CLASS_NAME","TO_SLIDE_CLASS_NAME","DISABLEABLE_ANIMATIONS","activeKey","nextKey","direction","renderCount","shouldRestoreHeight","shouldCleanup","cleanupExceptionKey","cleanupOnlyKey","shouldWrap","wrapExceptionKey","slideClassName","withSwipeControl","isBlockingAnimation","onStart","onStop","currentKeyRef","shouldDisableAnimation","selectCanAnimateInterface","rendersRef","prevActiveKey","usePreviousDeprecated","forceUpdate","useForceUpdate","isAnimatingRef","isSwipeJustCancelledRef","hasActiveKeyChanged","isBackwards","cleanup","omit","isSlideOptimized","Number","prevActiveIndex","activeIndex","childElements","childElement","transition","transform","toSlide","fromSlide","toggleExtraClass","removeExtraClass","endHeavyAnimation","forceReflow","waitForTransitionEnd","requestMutation","performSlideOptimized","watchedNode","giveUpAnimationEnd","waitForAnimationEnd","allowSwipeControlForTransition","clientWidth","flexBasis","asFastList","renders","contents","rendered","teactOrderKey","teactFastList","APP_CODE_NAME","APP_NAME","RELEASE_DATETIME","process","PRODUCTION_HOSTNAME","PRODUCTION_URL","WEB_VERSION_BASE","IS_MOCKED_CLIENT","IS_BETA","DEBUG_MORE","DEBUG_LOG_FILENAME","STRICTERDOM_ENABLED","BOT_VERIFICATION_PEERS_LIMIT","BETA_CHANGELOG_URL","ELECTRON_HOST_URL","DEBUG_ALERT_MSG","PAGE_TITLE","INACTIVE_MARKER","DEBUG_PAYMENT_SMART_GLOCAL","SESSION_USER_KEY","LEGACY_PASSCODE_CACHE_NAME","GLOBAL_STATE_CACHE_DISABLED","GLOBAL_STATE_CACHE_KEY","GLOBAL_STATE_CACHE_USER_LIST_LIMIT","GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT","GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT","GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT","IS_SCREEN_LOCKED_CACHE_KEY","MEDIA_CACHE_DISABLED","MEDIA_CACHE_NAME","MEDIA_CACHE_NAME_AVATARS","MEDIA_PROGRESSIVE_CACHE_NAME","CUSTOM_BG_CACHE_NAME","LANG_CACHE_NAME","AUTODOWNLOAD_FILESIZE_MB_LIMITS","ESTABLISH_BROADCAST_CHANNEL_NAME","MULTITAB_LOCALSTORAGE_KEY","isBigScreen","innerHeight","MIN_PASSWORD_LENGTH","MESSAGE_LIST_SLICE","MESSAGE_LIST_VIEWPORT_LIMIT","ARCHIVE_MINIMIZED_HEIGHT","CHAT_HEIGHT_PX","TOPIC_HEIGHT_PX","PEER_PICKER_ITEM_HEIGHT_PX","CHAT_LIST_SLICE","CHAT_LIST_LOAD_SLICE","SHARED_MEDIA_SLICE","CHAT_MEDIA_SLICE","MESSAGE_SEARCH_SLICE","GLOBAL_SEARCH_SLICE","GLOBAL_TOPIC_SEARCH_SLICE","MEMBERS_SLICE","MEMBERS_LOAD_SLICE","PROFILE_SENSITIVE_AREA","TOPIC_LIST_SENSITIVE_AREA","API_GENERAL_ID_LIMIT","STATISTICS_PUBLIC_FORWARDS_LIMIT","STORY_VIEWS_MIN_SEARCH","STORY_MIN_REACTIONS_SORT","STORY_VIEWS_MIN_CONTACTS_FILTER","GLOBAL_SUGGESTED_CHANNELS_ID","TOPICS_SLICE","TOPICS_SLICE_SECOND_LOAD","TOP_CHAT_MESSAGES_PRELOAD_LIMIT","DEFAULT_VOLUME","DEFAULT_PLAYBACK_RATE","PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION","ANIMATION_LEVEL_CUSTOM","ANIMATION_LEVEL_MIN","ANIMATION_LEVEL_MED","ANIMATION_LEVEL_MAX","ANIMATION_LEVEL_DEFAULT","DEFAULT_MESSAGE_TEXT_SIZE_PX","IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX","MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX","PREVIEW_AVATAR_COUNT","DRAFT_DEBOUNCE","SEND_MESSAGE_ACTION_INTERVAL","APP_CONFIG_REFETCH_INTERVAL","GENERAL_REFETCH_INTERVAL","EDITABLE_INPUT_MODAL_ID","EDITABLE_STORY_INPUT_ID","EDITABLE_INPUT_CSS_SELECTOR","EDITABLE_INPUT_MODAL_CSS_SELECTOR","EDITABLE_STORY_INPUT_CSS_SELECTOR","CUSTOM_APPENDIX_ATTRIBUTE","MESSAGE_CONTENT_CLASS_NAME","MESSAGE_CONTENT_SELECTOR","RESIZE_HANDLE_CLASS_NAME","RESIZE_HANDLE_SELECTOR","SNAP_EFFECT_CONTAINER_ID","SNAP_EFFECT_ID","STARS_ICON_PLACEHOLDER","MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN","MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN","MOBILE_SCREEN_MAX_WIDTH","MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH","MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT","MAX_INT_32","TMP_CHAT_ID","ANIMATION_END_DELAY","ANIMATION_WAVE_MIN_INTERVAL","SCROLL_MIN_DURATION","SCROLL_MAX_DURATION","SCROLL_MAX_DISTANCE","SCROLL_SHORT_TRANSITION_MAX_DISTANCE","LOCK_SCREEN_ANIMATION_DURATION_MS","STICKER_SIZE_AUTH","STICKER_SIZE_AUTH_MOBILE","STICKER_SIZE_PICKER","EMOJI_SIZE_PICKER","COMPOSER_EMOJI_SIZE_PICKER","STICKER_SIZE_GENERAL_SETTINGS","STICKER_SIZE_PICKER_HEADER","STICKER_PICKER_MAX_SHARED_COVERS","STICKER_SIZE_SEARCH","STICKER_SIZE_MODAL","EMOJI_SIZE_MODAL","STICKER_SIZE_TWO_FA","STICKER_SIZE_PASSCODE","STICKER_SIZE_DISCUSSION_GROUPS","STICKER_SIZE_FOLDER_SETTINGS","STICKER_SIZE_INLINE_BOT_RESULT","STICKER_SIZE_JOIN_REQUESTS","STICKER_SIZE_INVITES","EMOJI_STATUS_LOOP_LIMIT","TOP_SYMBOL_SET_ID","POPULAR_SYMBOL_SET_ID","RECENT_SYMBOL_SET_ID","SEARCH_SYMBOL_SET_ID","FAVORITE_SYMBOL_SET_ID","EFFECT_STICKERS_SET_ID","EFFECT_EMOJIS_SET_ID","CHAT_STICKER_SET_ID","DEFAULT_TOPIC_ICON_STICKER_ID","DEFAULT_STATUS_ICON_ID","EMOJI_IMG_REGEX","BASE_EMOJI_KEYWORD_LANG","MENU_TRANSITION_DURATION","SLIDE_TRANSITION_DURATION","BIRTHDAY_NUMBERS_SET","RESTRICTED_EMOJI_SET","SVG_NAMESPACE","GIF_MIME_TYPE","LOTTIE_STICKER_MIME_TYPE","VIDEO_STICKER_MIME_TYPE","SUPPORTED_PHOTO_CONTENT_TYPES","SUPPORTED_VIDEO_CONTENT_TYPES","SUPPORTED_AUDIO_CONTENT_TYPES","CONTENT_TYPES_WITH_PREVIEW","SUPPORTED_TRANSLATION_LANGUAGES","RE_TG_LINK","RE_TME_LINK","RE_TELEGRAM_LINK","TME_LINK_PREFIX","BOT_FATHER_USERNAME","USERNAME_PURCHASE_ERROR","MESSAGE_ID_REQUIRED_ERROR","PURCHASE_USERNAME","TME_WEB_DOMAINS","LANG_PACK","COUNTRIES_WITH_12H_TIME_FORMAT","API_CHAT_TYPES","HEART_REACTION","emoticon","REPLIES_USER_ID","VERIFICATION_CODES_USER_ID","ANONYMOUS_USER_ID","RESTRICTED_EMOJI_SET_ID","CHANNEL_ID_LENGTH","ALL_FOLDER_ID","ARCHIVED_FOLDER_ID","SAVED_FOLDER_ID","MAX_MEDIA_FILES_FOR_ALBUM","MAX_ACTIVE_PINNED_CHATS","SCHEDULED_WHEN_ONLINE","LANG_PACKS","FEEDBACK_URL","FAQ_URL","PRIVACY_URL","MINI_APP_TOS_URL","FRESH_AUTH_PERIOD","GIVEAWAY_BOOST_PER_PREMIUM","GIVEAWAY_MAX_ADDITIONAL_CHANNELS","GIVEAWAY_MAX_ADDITIONAL_USERS","GIVEAWAY_MAX_ADDITIONAL_COUNTRIES","FRAGMENT_PHONE_CODE","FRAGMENT_PHONE_LENGTH","LIGHT_THEME_BG_COLOR","DARK_THEME_BG_COLOR","DEFAULT_PATTERN_COLOR","DARK_THEME_PATTERN_COLOR","PEER_COLOR_BG_OPACITY","PEER_COLOR_BG_ACTIVE_OPACITY","PEER_COLOR_GRADIENT_STEP","MAX_UPLOAD_FILEPART_SIZE","MAX_UNIQUE_REACTIONS","GROUP_CALL_VOLUME_MULTIPLIER","GROUP_CALL_DEFAULT_VOLUME","DEFAULT_LIMITS","uploadMaxFileparts","stickersFaved","savedGifs","dialogFiltersChats","dialogFilters","dialogFolderPinned","captionLength","channels","channelsPublic","aboutLength","chatlistInvites","chatlistJoined","recommendedChannels","savedDialogsPinned","DEFAULT_MAX_MESSAGE_LENGTH","ONE_TIME_MEDIA_TTL_SECONDS","PREMIUM_FEATURE_SECTIONS","PREMIUM_BOTTOM_VIDEOS","PREMIUM_LIMITS_ORDER","Contest","MMD_Utils","_Contest","isTestMode","Test","createLogger","Logger","_MMD_Utils","LOG_BACKGROUND","constructor","_name","printLog","this","timestamp","toLocaleTimeString","hour12","Random","getRandomElement","array","getRandomElementAndDrop","randomIndex","_xorshift","_seed","getRandomBool","_defineProperty","logger","buildFormattedText","accumulatedText","randomMode","startOffset","JSON","stringify","TestingSystem","try_start","_isStarted","_run","startTime","lastStepTime","logStep","msg","_logger","createMessageWithAllEntities","div","TokenHelper","htmlToMarkdown","tokens","MarkedJS","tokenizer","formattedTextFromTokens","tokensToFormattedText","formattedTextFromHtml","parseHtmlAsFormattedText","areFormattedTextsEqual","log_diffing","textA","entsA","textB","entsB","textC","entsC","normalizeWhitespace","compareEntities","expected","actual","FormattedTextKeys","EventKey","EVENTS","BlockType","MarkdownHandler","_controller","reloadMarkdownCache","getRoot","_prevMarkdown","_prevTokens","checkImmediately","_debounceTimer","onContentChanged","checkMarkdownMarkers","getTopmostBlockLevelEntity","querySelectorAll","MARKDOWN_MARKER_CLASS_NAME","remove","getTopmostInlineEntity","candidate","getClosestElementToCaret","_check","checkForAutoInsert","char","MarkdownEditorUtils","AUTO_INSERT_CHARS","selection","getSelection","rangeCount","range","getRangeAt","cursorPos","getCaretCharacterOffset","currentText","lineInfo","getCaretLineInfo","currentLine","currentLineIndex","info","getBlockInfo","blockType","Paragraph","currentLineCaretOffset","setCaretCharacterOffset","DEFAULT_LANG","extraOffset","newRange","getSelectionRange","textNode","createTextNode","insertNode","lastChar","nextChar","isAccepted","sideChar","isValid","handleInsertCharacter","eachSide","textToInsert","deleteContents","createRange","setStart","setEnd","startContainer","removeAllRanges","addRange","prevMarkdown","hasStructureChanged","prevTokens","queueMicrotask","setup","BlockLevelTypesList","InlineFormattingTypesList","LockType","HistoryManager","initialState","_currentState","saveState","newState","_saveTimeout","clearTimeout","_saveState","saveStateDebounced","_undoStack","_redoStack","undo","redo","getCurrentState","MessageInputController","_richTextEditorRef","caretOffset","MultiLock","_markdownHandler","_init","richTextEditor","_eventHandler","bind","onContentChange","locker","isLocked","ContentChange","History","_saveHistory","initialText","runMessageInputTest","removeEventListener","clearContent","handleCloseTextFormatter","clearSelection","getHtmlBeforeSelection","getSelectedTextInfo","elements","getInlineEntitiesInSelection","selectionInfo","blockLevelEntities","activeFormats","availableFormats","canOpenTextFormatter","_isInsideCodeBlock","applyFormatToSelectedText","moveContentOutsideOfElement","isMarkdownMarker","marker","getMarkerByType","addTextAtStartAndEndOfSelection","getHtml","isTouched","isHtmlEmpty","html","listen","cb","deleteLastCharacterOutsideSelection","getFormattedText","htmlToFormattedText","isHistory","replaceContent","resetEditor","blockInfo","insertEmoji","newEmoji","insertElement","emojiSetId","canSendCustomEmoji","isKeyboardEvent","_keydownHandler","QuoteBlock","isMultipleBlockSelected","messageSendKeyCombo","Enter","shiftKey","ctrlKey","metaKey","Backspace","_handleCodeBlockKeyDown","_handleBlockQuoteKeyDown","Delete","simulateEnter","_redoHistory","_undoHistory","isDebounced","_history","state","lock","unlock","extractFullLineInfo","isInFirstLine","isInLastLine","isCurrentLineEmpty","isStartOfCurrentLine","moveCaretToEndOfPreviousSibling","isInThirdLine","isTwoFirstLineEmpty","firstChild","insertHardBreak","isTwoLastLineEmpty","lastChild","headerOffset","footerOffset","_defaults","breaks","extensions","gfm","hooks","pedantic","renderer","silent","walkTokens","changeDefaults","newDefaults","noopTest","exec","edit","regex","opt","obj","val","valSource","other","caret","getRegex","codeRemoveIndent","outputLinkReplace","indentCodeCompensation","beginningSpace","endingHash","startingSpaceChar","endingSpaceChar","nonSpaceChar","newLineCharGlobal","tabCharGlobal","multipleSpaceGlobal","blankLine","doubleBlankLine","blockquoteStart","blockquoteSetextReplace","blockquoteSetextReplace2","listReplaceTabs","listReplaceNesting","listIsTask","listReplaceTask","anyLine","hrefBrackets","tableDelimiter","tableAlignChars","tableRowBlankLine","tableAlignRight","tableAlignCenter","tableAlignLeft","startATag","endATag","startPreScriptTag","endPreScriptTag","startAngleBracket","endAngleBracket","pedanticHrefTitle","unicodeAlphaNumeric","escapeTest","escapeReplace","escapeTestNoEncode","escapeReplaceNoEncode","unescapeTest","percentDecode","findPipe","splitPipe","slashPipe","carriageReturn","spaceLine","notSpaceStart","endingNewline","listItemRegex","bull","nextBulletRegex","indent","hrRegex","fencesBeginRegex","headingBeginRegex","htmlBeginRegex","hr","bullet","lheading","_paragraph","_blockLabel","def","list","_tag","_comment","paragraph","blockNormal","blockquote","fences","heading","newline","table","gfmTable","blockGfm","blockPedantic","br","_punctuation","_punctuationOrSpace","_notPunctuationOrSpace","punctuation","_punctuationGfmStrongEm","emStrongLDelimCore","emStrongLDelim","emStrongLDelimGfm","emStrongRDelimAstCore","emStrongRDelimAst","emStrongRDelimAstGfm","emStrongRDelimUnd","anyPunctuation","autolink","_inlineComment","_inlineLabel","link","reflink","nolink","inlineNormal","_backpedal","blockSkip","del","escape","reflinkSearch","inlinePedantic","inlineGfm","inlineBreaks","block","normal","inline","escapeReplacements","getEscapeReplacement","ch","encode","test","cleanUrl","encodeURI","splitCells","tableRow","cells","str","escaped","curr","at","rtrim","invert","l","suffLen","currChar","charAt","outputLink","cap","raw","lexer","rules","inLink","inlineTokens","_Tokenizer","space","codeBlockStyle","matchIndentToCode","indentToCode","matchIndentInNode","indentInNode","trimmed","depth","inBlockquote","currentLines","currentRaw","blockTokens","lastToken","oldToken","newText","newToken","isordered","ordered","start","loose","items","itemRegex","endsWithBlankLine","endEarly","itemContents","nextLine","trimStart","search","rawLine","nextLineWithoutTabs","ischecked","istask","task","lastItem","spacers","hasMultipleLineBreaks","pre","headers","aligns","rows","item","align","row","cell","inRawBlock","trimmedUrl","rtrimSlash","lastParenIndex","findClosingBracket","linkLen","emStrong","maskedSrc","prevChar","lLength","rDelim","rLength","delimTotal","midDelimTotal","endReg","lastCharLength","codespan","hasNonSpaceChars","hasSpaceCharsOnBothEnds","prevCapZero","inlineText","_Lexer","create","inlineQueue","lex","lexInline","next","lastParagraphClipped","extTokenizer","cutSrc","startBlock","startIndex","Infinity","tempSrc","tempStart","getStartIndex","errMsg","keepPrevChar","startInline","_Renderer","langString","parser","parse","parseInline","listitem","itemBody","checkbox","unshift","tablecell","tablerow","strong","em","cleanHref","image","_TextRenderer","_Parser","textRenderer","anyToken","renderers","genericToken","ret","textToken","_Hooks","preprocess","postprocess","processAllTokens","provideLexer","provideParser","markedInstance","setOptions","parseMarkdown","use","concat","tableToken","listToken","defaults","childTokens","pack","opts","ext","prevRenderer","apply","extLevel","rendererProp","rendererFunc","tokenizerProp","tokenizerFunc","prevTokenizer","hooksProp","hooksFunc","prevHook","passThroughHooks","arg","packWalktokens","origOpt","throwError","onError","prototype","all","marked","getDefaults","Parser","Renderer","TextRenderer","Lexer","Tokenizer","Hooks","_MarkedJS","OrgTokenType","ExtraTokenType","TokenType","markedLexer","isStructureEqual","tokens1","tokens2","token1","token2","token1HasChildren","token2HasChildren","spoiler","underline","oldTokens","newTokens","INLINE_MARKERS","BLOCK_MARKERS","getInlineMarkerByType","getBlockMarkerByType","_TokenHelper","getEntityFromToken","tblockquote","processTokens","currentOffset","pendingEntities","localText","localOffset","localEntities","tokenText","childTexts","childEntities","getEntityFromHtmlToken","sort","a","checkLength","isOpening","isClosing","extractAttribute","attr","pendingEntity","htmlToTokens","htmlNode","processNode","nodeType","Node","TEXT_NODE","ELEMENT_NODE","tagName","HTMLImageElement","isEmoji","getEntityTypeFromNode","startTag","outerHTML","processChildNodes","tokenType","Unknown","entityTypeToTokenType","context","addNewlineIfNeeded","processChildsNodes","hasChildNodes","addToMarkdown","newMarkdown","lastNodeEntityType","nodeName","Element","endTag","getAttribute","setStartAfter","collapse","markerClassName","useMessageInputEvent","isMessageInputChanged","setIsChanged","unsubscribe","ChangeNotifier","notify","_changeCallbacks","notifySync","responses","textUrl","mentionName","e1","e2","every","_locks","NodeHelper","syncDOMNodes","targetNodes","sourceNodes","targetNode","sourceNode","isEqual","replaceChild","nodeA","nodeB","nodeAType","isEqualNode","logNodeDifferences","path","attrsA","attributes","attrsB","childrenA","childrenB","childA","childB","_Utils","CUSTOM_EMOJI_LENGTH_IN_CARET","createTreeWalker","NodeFilter","SHOW_TEXT","SHOW_ELEMENT","acceptNode","FILTER_ACCEPT","FILTER_SKIP","preCaretRange","cloneRange","selectNodeContents","endContainer","endOffset","tempElement","cloneContents","walker","caretPosition","nextNode","accumulatedLength","targetOffset","parentNode","textLength","isContentEditable","shouldExclude","parent","fragment","createDocumentFragment","nextSibling","insertBefore","textToAddStart","textToAddEnd","insertData","intersectsNode","ancestor","topEntity","previousSibling","prevSibling","getDeepestLastChild","execCommand","caretLineInfo","isEmpty","indexes","newLine","empty","addActionHandler","actions","initialLocationHash","parseInitialLocationHash","hasTestParam","tgWebAuthTest","apiUpdate","userAgent","PLATFORM_ENV","sessionData","loadStoredSession","isWebmSupported","maxBufferSize","MAX_BUFFER_SIZE","webAuthToken","tgWebAuthToken","dcId","tgWebAuthDcId","mockScenario","shouldAllowHttpTransport","settings","byKey","shouldForceHttpTransport","shouldDebugExportedSenders","langCode","isTestServerRequested","shouldCollectDebugLogs","phoneNumber","authIsLoading","authErrorKey","password","file","isFallback","videoTs","bot","tabId","updateManagementProgress","ManagementProgress","InProgress","setGlobal","Complete","loadFullUser","currentUserId","firstName","lastName","authIsLoadingQrCode","passcode","isScreenLocked","storeSession","clearStoredSession","hangUp","leaveGroupCall","resetInitialLocationHash","resetLocationHash","forceWebsync","reset","forceInitApi","clearEncryptedSession","cacheApi","MAIN_IDB_STORE","PASSCODE_IDB_STORE","langCachePrefix","langCacheVersion","updateAppBadge","initShared","force","byTabId","otherTabId","connectionState","authNearestCountry","deviceToken","subscribedAt","sessionJson","globalJson","serializeGlobal","encryptSession","forgetPasscode","updatePasscodeSettings","invalidAttemptsCount","timeoutUntil","clearGlobalForLockScreen","bio","about","updateTabState","profileEdit","progress","ProfileEditProgress","currentUser","updateUser","updateUserFullInfo","shouldUsernameUpdate","usernames","u","isEditable","withPhotos","avatarPhotoId","profilePhoto","deletePeerPhoto","tabState","selectTabState","Idle","checkedUsername","isUsernameAvailable","loadedWallpapers","wallpapers","createObjectURL","slug","UPLOADING_WALLPAPER_SLUG","mediaType","wallpaper","firstWallpaper","withLocalMedia","blocked","blockedIds","totalCount","isOnlyStories","addBlockedUser","removeBlockedUser","addNotifyExceptions","replaceSettings","peerType","isSilent","shouldShowPreviews","updateNotifySettings","oldSettings","hasWebNotifications","hasPushNotifications","subscribe","requestPermission","hasContactJoinedNotifications","languages","phoneNumberSettings","addByPhoneSettings","lastSeenSettings","profilePhotoSettings","forwardsSettings","chatInviteSettings","phoneCallSettings","phoneP2PSettings","voiceMessagesSettings","bioSettings","birthdaySettings","giftsSettings","privacy","addByPhone","lastSeen","forwards","chatInvite","phoneCall","phoneP2P","voiceMessages","birthday","gifts","privacyKey","visibility","onSuccess","buildApiInputPrivacyRules","allowedIds","allowUserIds","allowChatIds","blockUserIds","blockChatIds","botsPrivacy","isAllowList","updatedIds","isPremiumAllowed","isUnspecified","shouldAllowPremium","isSensitiveEnabled","countryList","timeFormat","setSettingOption","setTimeFormat","wasTimeFormatSetManually","nearestCountryCode","hash","appConfig","requestActionTimeout","config","timeout","expiresAt","getServerTime","peerColors","generalHash","general","colors","timezones","buildCollectionByKey","globalSettings","shouldArchiveAndMuteNewNonContact","shouldHideReadMarks","shouldNewNonContactPeersRequirePremium","selectChat","updateChat","loadFullChat","loadUser","prevUsernames","sortedUsernames","res","currentUsername","findIndex","onUpdateConnectionState","update","multitabNextAction","clearMultitabNextAction","isSynced","channelStackIds","flatMap","tab","messageLists","messageList","isChatChannel","isChatSuperGroup","unique","requestChannelDifference","signOut","oldSetLanguage","onUpdateApiReady","wasAuthReady","authState","authorizationState","isLoggingOut","authIsCodeViaApp","isCodeViaApp","authHint","hint","noReset","hasWebAuthTokenPasswordRequired","authQrCode","qrCode","isInactive","onUpdateAuthorizationState","errorKey","onUpdateAuthorizationError","clearWebTokenAuth","hasWebAuthTokenFailed","onUpdateWebAuthTokenFailed","authRememberMe","mainDcId","isTest","isTestServer","saveSession","onUpdateSession","setServerTimeOffset","serverTimeOffset","onUpdateServerTimeOffset","currentUserFullInfo","sessionUserAuth","localStorage","getItem","userAuth","setItem","updateSessionUserId","onUpdateCurrentUser","sync","isFetchingDifference","isFetching","paymentShippingError","getShippingError","addPaymentError","shouldClosePaymentModal","closePaymentModal","showDialog","setSystemThemeChangeCallback","theme","shouldUseSystemTheme","forceSyncOnIOs","hasPasscode","decryptSessionByCurrentHash","session","hasStoredSession","setupCaching","startWebsync","destroyConnection","stopWebsync","clearCaching","onSomeTabSwitchedMultitabRole","selectNotifySettings","events","subscribeAfterUserGesture","once","addCallback","isUpdated","shouldInit","messageTextSize","globalTheme","selectTheme","systemTheme","getSystemTheme","performanceType","selectPerformanceSettings","setProperty","applyPerformanceSettings","IS_MAC_OS","IS_WINDOWS","IS_LINUX","IS_SAFARI","canAnimate","switchTheme","canInstall","uiReadyState","authPhoneNumber","shouldSkipHistoryAnimations","prevGlobal","updatePageTitle","updateShouldDebugExportedSenders","updateShouldEnableDebugLog","oldGlobal","prevSettings","prevPerformance","prevPeerColors","updatePeerColors","withAnimation","hasFocus","canDisplayChatInTitle","initDebugConsole","disableDebugConsole","replaceThemeSettings","screen","foldersAction","nextSettingsScreen","nextFoldersAction","folderId","isOnlyInvites","isModal","chatFolder","selectChatFolder","requestNextSettingsScreen","SettingsScreens","FoldersEditFolderInvites","FoldersEditFolderFromChatList","noRequestNextScreen","isChatList","shareFolderScreen","isFromSettings","openEditChatFolder","updateCacheThrottled","onFullyIdle","updateCache","updateCacheForced","unsubscribeFromBeforeUnload","isCaching","isRemovingCache","cacheGlobal","cacheIsScreenLocked","initCache","resetCache","removeItem","loadCache","cache","time","cachedFromLocalStorage","cached","timeEnd","migrateCache","readCache","onBeforeUnload","removeCallback","untypedCached","themes","chatFolders","animationLevel","INITIAL_PERFORMANCE_STATE_MIN","INITIAL_PERFORMANCE_STATE_MID","limits","similarChannelsById","similarBotsById","lastMessageIds","darkPeerColors","fileUploads","byMessageKey","reactions","quickReplies","previewMediaByBotId","loadingParameters","topBotApps","defaultTags","commonChatsById","botAppPermissionsById","topicsInfoById","messages","pollById","botVerificationShownPeerIds","peers","unsafeMigrateCache","forceUpdateCache","noEncrypt","serializedGlobal","reduceGlobal","availableReactions","INITIAL_GLOBAL_STATE","pick","lastIsChatInfoShown","getIsMobile","reduceCustomEmojis","reduceUsers","reduceChats","reduceMessages","reduceSettings","reduceChatFolders","groupCalls","reduceGroupCalls","lastRendered","idsToSave","forEmoji","added","statusRecent","statusesById","fullInfoById","currentChatIds","selectCurrentMessageList","isUserId","visibleUserIds","selectVisibleUsers","chatStoriesUserIds","selectChatMessages","webPage","attachBotIds","attachMenu","bots","topPeers","userIds","recentlyFoundChatIds","getOrderedIds","contactList","pickTruthy","messagesChatIds","viewportIds","selectViewportIds","threadId","replyPeer","replyInfo","replyToPeerId","isFullyLoaded","saved","byChatId","forumPanelChatIds","forumPanelChatId","chatIdsToSave","openedChatThreadIds","acc","tabChatId","pollIdsToSave","chatLastMessageId","selectChatLastMessageId","openedThreadIds","commentThreadIds","threadsById","threadInfo","isCommentsInfo","originMessageId","threadIds","threadsToSave","viewportIdsToSave","thread","lastViewportIds","topics","selectTopics","topicLastMessageIds","lastMessageId","savedLastMessageIds","lastMessageIdsToSave","listedIds","pinnedIds","typingStatus","cleanedById","cleanedMessage","blobUrl","isPreloadedGlobally","previousLocalId","omitLocalMedia","results","reaction","localAmount","omitLocalPaidReactions","pollId","sponsoredByChatId","miniAppsCachedPosition","miniAppsCachedSize","notifyExceptions","activeGroupCallId","getBotCoverMediaHash","convertToApiChatType","getWebAppKey","webApp","requestUrl","appName","botId","isSystemBot","FOREVER_BANNED_DATE","entityId","isPeerChat","isPeerUser","toChannelId","mtpId","padStart","isChatGroup","isChatBasicGroup","isCommonBoxChat","isChatWithRepliesBot","isChatWithVerificationCodesBot","isAnonymousForwardsChat","getChatTypeString","getPrivateChatUserId","isSelf","getChatLink","activeUsername","getMainUsername","getChatAvatarHash","owner","isChatAdmin","adminRights","isCreator","getHasAdminRight","getCanManageTopic","isOwner","isUserRightBanned","chatFullInfo","unrestrictedByBoosts","boostsToUnrestrict","boostsApplied","currentUserBannedRights","defaultBannedRights","getCanPostInChat","isMessageThread","isForum","isNotJoined","isClosed","isRestricted","isForbidden","migratedTo","getAllowedAttachmentOptions","isChatWithBot","isStoryReply","canAttachMedia","canAttachPolls","canSendStickers","canSendGifs","canAttachEmbedLinks","canSendPhotos","canSendVideos","canSendRoundVideos","canSendAudios","canSendVoices","canSendPlainText","canSendDocuments","isAdmin","getMessageSendingRestrictionReason","sendMessages","untilDate","formatDateToString","formatTime","getForumComposerPlaceholder","isReplying","isChatArchived","selectIsChatMuted","notifySettings","isMuted","hasPrivateChatsNotifications","hasBroadcastNotifications","hasGroupNotifications","selectShouldShowMessagePreview","hasPrivateChatsMessagePreview","hasBroadcastMessagePreview","hasGroupMessagePreview","getCanDeleteChat","getFolderDescriptionText","folder","chatsCount","excludedChatIds","includedChatIds","groups","contacts","nonContacts","getMessageSenderName","getUserFirstOrLastName","filterChatsByName","chatIds","chatsById","query","searchWords","prepareSearchWordsForNeedle","translatedTitle","isChatPublic","getOrderedTopics","pinnedOrder","shouldSortByLastMessage","pinned","isPinned","isHidden","hidden","getCleanPeerId","getPeerColorKey","peer","abs","getPeerColorCount","getIsSavedDialog","getGroupStatus","chatTypeString","membersCount","getCustomPeerFromInvite","invite","isVerified","isFake","isScam","isCustomPeer","peerColorId","fakeType","getMessageRecentReaction","isOutgoing","recentReactions","checkIfHasUnreadReactions","isUnread","isOwn","areReactionsEmpty","getReactionKey","isSameReaction","first","second","canSendReaction","chatReactions","areCustomAllowed","allowed","sortReactions","topReactions","right","reactionOne","reactionTwo","indexOne","indexTwo","getUserReactions","isReactionChosen","chosenOrder","updateReactionCount","reactionCount","newReactions","existingIndex","addPaidReaction","isAnonymous","localIsPrivate","localPreviousChosenOrder","STORY_ALT_VIDEO_WIDTH","getStoryMediaHash","isAlt","altVideos","media","getVideoMediaHash","getPhotoMediaHash","getStoryKey","storyId","usersById","allowedUserIds","allowedChatIds","partition","blockedUserIds","blockedChatIds","allowedUsers","allowedChats","blockedUsers","blockedChats","getMessageContent","hasMessageMedia","getMessagePhoto","getMessageVideo","getMessageDocument","getMessageSticker","getMessageContact","getMessageAction","getMessageAudio","getMessageVoice","canEditMedia","audio","otherMedia","getMessageRoundVideo","voice","isDocumentPhoto","innerMediaType","isDocumentVideo","isMessageDocumentSticker","contact","getMessageInvoice","getMessageLocation","getMessageWebPage","getMessagePaidMedia","paidMedia","getMessageWebPagePhoto","getMessageWebPageVideo","getMessageWebPageAudio","getMessageDownloadableMedia","getMessageMediaThumbDataUri","extendedMedia","getMessageMediaThumbnail","dataUri","getMediaThumbUri","getMessageIsSpoiler","invoiceMedia","isSpoiler","buildStaticMapHash","geo","zoom","long","lat","accuracyRadius","getMessageMediaHash","messagePhoto","actionPhoto","getMessageActionPhoto","messageVideo","messageDocument","getMessageWebPageDocument","messageAudio","getDocumentMediaHash","getAudioMediaHash","getVoiceMediaHash","isAction","hasMediaLocalBlobUrl","getVideoProfilePhotoMediaHash","getProfilePhotoMediaHash","appendProgressiveQueryParameters","getVideoPreviewMediaHash","hasVideoPreview","getAudioHasCover","getWebDocumentHash","webDocument","previewPhotoSizes","getMediaHash","getGamePreviewPhotoHash","game","getGamePreviewVideoHash","IS_PROGRESSIVE_SUPPORTED","thumbnailSizes","getMediaFormat","hasInnerVideo","isAudio","isVoice","getMediaFileSize","IS_OPFS_SUPPORTED","DownloadUrl","BlobUrl","Progressive","IS_OPUS_SUPPORTED","getChatMediaMessageIds","isFromSharedMedia","getMessageContentIds","getPhotoFullDimensions","sizes","getMediaTransferState","isLoadNeeded","isUploading","isTransferring","transferProgress","messageIds","contentType","validator","matchLinkInMessageText","getMediaDuration","canReplaceMessageMedia","attachment","isPhotoOrVideo","isFile","fileType","getAttachmentMediaType","isMediaLoadableInViewer","newMessage","getMediaFilename","getIsDownloading","activeDownloads","SPOILER_CHARS","isExtended","getMessageTextWithSpoilers","transcription","getMessageTranscription","textWithoutTranscription","getMessageText","accText","generateBrailleSpoiler","groupedId","getMediaContentTypeDescription","getSummaryDescription","truncatedText","mediaContent","giveaway","giveawayResults","summary","hasUsedTruncatedText","boughtExtendedMedia","isBought","previewExtendedMedia","isPaidMediaAlbum","isPaidMediaSingleVideo","isPaidMediaSinglePhoto","performer","getMessageAudioCaption","question","description","winnersCount","isExpiredMessageContent","expiredMessageText","getExpiredMessageContentDescription","getMessageHtmlId","getMessageOriginalId","transcriptionId","transcriptions","hasMessageText","isExpiredVoice","getMessageStatefulContent","storyPeerId","stories","byPeerId","getMessageCustomShape","hasOtherFormatting","emojiOnlyCount","getMessageSingleRegularEmoji","getMessageSingleCustomEmoji","getFirstLinkInMessage","firstTextUrl","firstUrl","isOwnMessage","isReplyToMessage","isForwardedMessage","forwardInfo","isActionMessage","isServiceNotificationMessage","isAnonymousOwnMessage","senderId","getPeerTitle","titleKey","getSendingState","sendingState","isMessageLocal","isLocalMessageId","isMessageFailed","isHistoryClearMessage","isGeoLiveExpired","date","period","isMessageTranslatable","allowOutgoing","isLocal","isServiceNotification","isScheduled","getMessageSingleInlineButton","inlineButtons","orderHistoryIds","orderPinnedIds","mergeIdRanges","ranges","idsUpdate","hasIntersection","newOutlyingLists","areSortedArraysIntersecting","prevArray","contentText","authCode","oldEntities","langFn","isExpiredRoundVideo","hasMessageTtl","ttlSeconds","isJoinedChannelMessage","shouldSendAsFile","isUploadingFileSticker","getMessageLink","chatUsername","normalizedId","chatPart","topicPart","messagePart","splitMessagesForForwarding","limit","currentArr","lastGroup","batch","buildChatThreadKey","getMessageReplyInfo","getStoryReplyInfo","getStickerHashById","stickerId","isPreview","containsCustomEmoji","isDeletedUser","formatPhoneNumber","getUserStatus","userStatus","isSupport","botActiveUsers","wasOnline","getServerTimeOffset","wasOnlineDate","diff","getTime","today","setHours","yesterday","setDate","getDate","formatFullDate","isUserOnline","withSelfOnline","isUserBot","getCanAddContact","isContact","sortUserIds","userStatusesById","priorityIds","orderBy","expires","DAY","filterUsersByName","savedMessagesLang","getPeerStoryHtmlId","typed","typify","INITIAL_PERFORMANCE_STATE_MAX","animatedEmoji","autoplayGifs","autoplayVideos","contextMenuAnimations","contextMenuBlur","loopAnimatedStickers","mediaViewerAnimations","messageComposerAnimations","messageSendingAnimations","pageTransitions","reactionEffects","rightColumnAnimations","stickerEffects","storyRibbonAnimations","snapEffect","twoFaSettings","isAppUpdateAvailable","isElectronUpdateAvailable","shouldShowContextMenuHint","audioPlayer","lastPlaybackRate","mediaViewer","phoneCodes","giftsById","profilePhotosById","listIds","orderedPinnedIds","active","archived","orderedPeerIds","hasNext","hasNextInArchive","stealthMode","attachmentSettings","shouldCompress","shouldSendGrouped","isInvertedMedia","webPageMediaSize","scheduledMessages","messagesById","invites","recentEmojis","recentCustomEmojis","effectReactions","availableEffectById","stickers","setsById","recent","favorite","greeting","premium","featured","setIds","effect","emojiKeywords","gifs","topInlineBots","activeSessions","byHash","orderedHashes","activeWebSessions","canAutoLoadPhotoFromContacts","canAutoLoadPhotoInPrivateChats","canAutoLoadPhotoInGroups","canAutoLoadPhotoInChannels","canAutoLoadVideoFromContacts","canAutoLoadVideoInPrivateChats","canAutoLoadVideoInGroups","canAutoLoadVideoInChannels","canAutoLoadFileFromContacts","canAutoLoadFileInPrivateChats","canAutoLoadFileInGroups","canAutoLoadFileInChannels","autoLoadFileMaxSizeMb","notificationSoundVolume","shouldSuggestStickers","shouldSuggestCustomEmoji","shouldSkipWebAppCloseConfirmation","shouldUpdateStickerSetOrder","isConnectionStatusMinimized","canTranslate","canTranslateChats","doNotTranslate","shouldWarnAboutSvg","light","isBlurred","patternColor","dark","serviceNotifications","trustedBotIds","translations","archiveSettings","isMinimized","INITIAL_TAB_STATE","isLeftColumnShown","isChatInfoShown","newChatMembersProgress","NewChatMembersProgress","Closed","gifSearch","stickerSearch","activeChatFolder","tabThreads","inlineBots","byUsername","webApps","openedWebApps","openedOrderedKeys","sessionKeys","modalState","isModalOpen","isMoreAppsTabActive","globalSearch","userSearch","middleSearch","byChatThreadKey","sharedMediaSearch","chatMediaSearch","management","storyViewer","isRibbonShown","volume","playbackRate","isShareMessageModalShown","isWebAppsCloseConfirmationModalOpen","forwardMessages","replyingMessage","pollResults","payment","starsPayment","notifications","dialogs","activeReactions","statistics","pollModal","requestedTranslations","DEFAULT_CHAT_LISTS","replaceChatListIds","newIds","replaceChatListLoadingParameters","nextOffsetId","nextOffsetPeerId","nextOffsetDate","updateChatLastMessageId","listType","updateChatsLastMessageId","addChatListIds","replaceChats","newById","addUnreadMentions","shouldUpdateCount","prevChatUnreadMentions","unreadMentions","updatedUnreadMentions","unreadMentionsCount","removeUnreadMentions","removedCount","chatUpdate","noOmitUnreadReactionCount","withDeepCheck","updateKeys","areDeepEqual","updatedChat","getUpdatedChat","updateChatFullInfo","fullInfoUpdate","currentFullInfo","selectChatFullInfo","updatedFullInfo","replaceChatFullInfo","fullInfo","updateChats","updatedById","addChats","addedById","existingChat","newChat","membersCountChanged","isMin","omitProps","omitUndefined","updateChatListType","currentListIds","listTypeKey","currentFolderList","updateChatListSecondaryInfo","totalCountKey","totalChatCount","leaveChat","leftChatId","removeChatFromChatLists","joinInfo","addChatMembers","membersToAdd","currentMembers","members","newMemberIds","m","updatedMembers","currentIds","areSortedArraysEqual","adminMembers","adminMembersById","addSimilarChannels","similarChannelIds","shouldShowInChat","toggleSimilarChannels","similarChannels","addSimilarBots","similarBotsIds","updateStickerSearch","resultIds","updateStickerSets","category","sets","updatedSets","stickerSet","existing","regularSetIds","updateCustomEmojiSets","addedSetIds","updateStickerSet","stickerSetId","currentStickerSet","isCustomEmoji","addedSets","installedDate","isArchived","customEmojiById","updateGifSearch","isNew","nextOffset","currentResults","newResults","gif","replaceAnimatedEmojis","animatedEmojis","updateStickersForEmoji","remoteStickers","allStickers","selectStickersForEmoji","uniqueIds","updateCustomEmojiForEmoji","localStickers","selectCustomEmojiForEmoji","updateRecentStatusCustomEmojis","rebuildStickersForEmoji","replaceUsers","updateContactList","updatedUsers","contactUserIds","contactUserIdsFromUpdate","userUpdate","updatedUser","getUpdatedUser","updateUsers","addUsers","existingUser","newUser","deleteContact","MEMO_EMPTY_ARRAY","updateUserSearch","searchStatePartial","updateUserSearchFetchingStatus","fetchingStatus","updateUserBlockedState","isBlocked","replaceUserStatuses","userFullInfo","updateUserCommonChats","commonChats","addUserStatuses","closeNewContactDialog","newContact","updateMissingInvitedUsers","missingUsers","inviteViaLinkModal","updateBotAppPermissions","permissions","replacePeerSavedGifts","updateGlobalSearch","updateGlobalSearchContent","currentContent","updateGlobalSearchResults","newFoundMessages","nextOffsetRate","resultsByType","newFoundMessagesById","getSearchResultKey","foundIdsForType","foundIds","newId","updateGlobalSearchFetchingStatus","prevFoundIds","newFoundIds","foundOrPrevFoundIds","updateManagement","newSettings","notifyException","exceptionData","addNotifyException","contactId","updateTwoFaSettings","clearPasscodeSettings","withTabState","updatePayment","updateStarsPayment","starPayment","selectStarsPayment","updateShippingOptions","shippingOptions","setRequestInfoId","requestId","setPaymentStep","step","setStripeCardInfo","cardInfo","stripeCredentials","setSmartGlocalCardInfo","smartGlocalCredentials","setConfirmPaymentUrl","confirmPaymentUrl","setReceipt","receipt","clearPayment","clearStarPayment","closeInvoice","isPaymentModalOpen","isExtendedMedia","updateStarsBalance","balance","stars","appendStarsTransactions","transactions","history","newTypeObject","appendStarsSubscriptions","subscriptions","newObject","updateStarsSubscriptionLoading","openStarsTransactionModal","transaction","starsTransactionModal","openStarsTransactionFromReceipt","transactionId","totalAmount","nanos","updateStatistics","updateMessageStatistics","currentMessage","currentStory","updateStoryStatistics","updateStatisticsGraph","updateChannelMonetizationStatistics","monetization","updateVerifyMonetizationModal","monetizationVerificationModal","updatePeer","peerUpdate","updatePeerFullInfo","peerFullInfoUpdate","updatePeerPhotosIsLoading","profilePhotos","selectPeerPhotos","replacePeerPhotos","updatePeerPhotos","newPhotos","shouldInvalidateCache","currentPhotos","fallbackPhoto","personalPhoto","currentPhotoArray","uniqueByField","photoId","isFromActionMessage","selectPeer","isChannel","selectUserFullInfo","isAvatar","nextAvatarPhoto","newProfilePhoto","addStories","newStoriesByPeerId","updatedByPeerId","entries","newPeerStories","orderedIds","profileIds","lastUpdatedAt","lastReadId","updateOrderedStoriesPeerIds","addStoriesForPeer","newStories","newPinnedIds","addToArchive","archiveIds","deletedIds","updatedOrderedIds","updatedArchiveIds","updatedProfileIds","isInProfile","expireDate","selectIsChatWithSelf","storyChangelogUserId","peerStories","updatePeerLastUpdatedAt","updatePeerStoriesFullyLoaded","isArchive","updateLastReadStoryForPeer","selectPeerStories","hasUnreadStories","updateLastViewedStoryForPeer","lastViewedId","lastViewedByPeerIds","updatePeersWithStories","storiesByPeerId","hasStories","maxStoryId","updateStoryViews","views","viewModal","newViews","updateStoryViewsLoading","removePeerStory","newOrderedIds","newProfileIds","lastStoryId","previousStoryId","newLastReadId","isDeleted","updateStoriesForPeer","updateSentStoryReaction","reactionsCount","hasReaction","newReactionsCount","updatePeerStory","sentReaction","storyUpdate","updatePeerStoryViews","viewsUpdate","updatePeerProfileStory","updatePeerStoriesHidden","areHidden","areStoriesHidden","updatePeerIds","newOrderedPeerIds","compare","peerIdA","peerIdB","peerA","peerB","diffCurrentUser","compareFields","luaA","orderedA","lriA","hasUnreadA","luaB","orderedB","lriB","hasUnreadB","diffUnread","diffPremium","updateStealthMode","updateTopicsStore","updateListedTopicIds","topicIds","selectTopicsInfo","listedTopicIds","updateTopics","topicsCount","oldTopics","newTopics","topicsById","updateThread","firstMessageId","updateThreadInfo","updateTopic","selectTopic","updatedTopic","deleteTopic","replacePinnedTopicIds","pinnedTopicIds","orderedPinnedTopicIds","getEmojiOnlyCountForMessage","parseEmojiOnlyString","updateCurrentMessageList","shouldReplaceHistory","shouldReplaceLast","newMessageLists","previous","replaceChatMessages","updateMessageStore","threadUpdate","replaceTabThreadParam","paramName","newValue","replaceThreadParam","updateTabThread","addMessages","addedByChatId","messagesByChatId","addChatMessagesById","replaceMessages","updatedByChatId","updateChatMessage","messageUpdate","isMediaUnread","updatedMessage","updateScheduledMessage","selectScheduledMessage","updateScheduledMessages","updateQuickReplyMessage","selectQuickReplyMessage","updateQuickReplyMessages","deleteQuickReplyMessages","deleteChatMessages","updatedThreads","mediaIdsToRemove","selectThreadIdFromMessage","threadMessages","clearMessageTranslation","deletedForwardedPosts","isLinkedChannelPost","threadMessageIds","selectThreadInfo","selectListedIds","selectPinnedIds","outlyingLists","selectOutlyingLists","newMessageCount","messagesCount","excludeSortedArray","nonLocalMessageCount","originChatId","mediaHash","cancelMessageMediaDownload","mediaId","removeIdFromSearchResults","newViewportIds","currentMessageList","canDeleteCurrentThread","currentThreadId","fromChatId","fromMessageId","originalPost","selectChatMessage","deleteChatScheduledMessages","selectChatScheduledMessages","scheduledIds","selectScheduledIds","newScheduledIds","updateListedIds","removeOutlyingList","updateOutlyingLists","addViewportId","safeReplaceViewportIds","safeReplacePinnedIds","doNotUpdateLinked","newThreadInfo","linkedUpdate","fromChannelId","updateThreadInfos","originChannelId","updateFocusedMessage","noHighlight","isResizingContainer","scrollTargetPosition","focusedMessage","updateSponsoredMessage","deleteSponsoredMessage","updateFocusDirection","enterMessageSelectMode","selectedMessages","toggleMessageSelection","messageListType","childMessageIds","withShift","oldSelectedMessages","selectMessageIdsByGroupId","selectedMessageIds","newMessageIds","newSelectedMessageIds","selectCurrentMessageIds","prevIndex","currentIndex","to","exitMessageSelectMode","updateThreadUnreadFromForwardedMessage","originMessage","isDeleting","channelPostId","threadInfoOld","addActiveMediaDownload","metadata","mediaHashes","newActiveDownloads","updateUploadByMessageKey","messageKey","updateQuickReplies","quickRepliesUpdate","deleteQuickReply","quickReplyId","updatePoll","pollUpdate","selectPoll","oldResults","isChosen","option","updatedPoll","updatePollVote","recentVoterIds","totalVoters","newRecentVoterIds","newTotalVoters","targetOptionIndex","targetOption","updatedOption","votersCount","replaceMiddleSearch","chatThreadKey","searchParams","rest","updateMiddleSearch","currentSearch","updated","isHashtag","savedTag","resetMiddleSearch","replaceMiddleSearchResults","fetchingQuery","updateMiddleSearchResults","prevQuery","closeMiddleSearch","replaceSharedMediaSearch","updateSharedMediaSearchType","currentType","updateSharedMediaSearchResults","replaceSharedMediaSearchResults","mergeWithChatMediaSearchSegment","loadingState","segment","mergedFoundIds","mergedLoadingState","areAllItemsLoadedForwards","areAllItemsLoadedBackwards","updateChatMediaSearchResults","currentSegment","segments","mergeChatMediaSearchSegments","replaceChatMediaSearch","replaceChatMediaSearchResults","removeIdFromSegment","foundId","selectChatMediaSearch","updatedSearchParams","removeIdsFromChatMediaSearchParams","updateChatMediaLoadingState","resetForwardsLoadingStateInParams","initializeChatMediaSearchResults","setChatMediaSearchLoading","tabStatePartial","updateMessageTranslation","toLanguageCode","translation","translatedMessages","selectMessageTranslations","byLangCode","chatTranslations","newByLangCode","newTranslatedMessages","updateMessageTranslations","isPending","updateRequestedChatTranslation","toLanguage","updateRequestedMessageTranslation","manualMessages","removeRequestedMessageTranslation","newManualMessages","selectPeerFullInfo","selectChatListLoadingParameters","selectIsChatWithBot","selectChatUser","selectSupportChat","selectChatOnlineCount","onlineCount","selectIsTrustedBot","selectChatType","selectBot","selectIsChatBotNotStarted","lastMessage","selectChatLastMessage","selectAreActiveChatsLoaded","selectIsChatListed","targetList","selectChatListType","selectIsChatPinned","chatFoldersById","pinnedChatIds","selectChatByUsername","usernameLowered","selectIsServiceChatReady","selectSendAs","sendAsId","selectRequestedDraft","requestedDraft","files","selectRequestedDraftFiles","filterChatIdsByType","selectCanInviteToChat","isJoinRequest","selectCanShareFolder","excludeArchived","excludeMuted","excludeRead","selectShouldDetectChatLanguage","isPremium","selectIsCurrentUserPremium","isSavedMessages","IS_TRANSLATION_SUPPORTED","selectCanTranslateChat","selectRequestedChatTranslationLanguage","isLanguageDetectable","detectedLanguage","selectSimilarChannelIds","selectSimilarBotsIds","realChatId","selectManagement","selectCurrentManagementType","selectCanManage","canAddContact","isBot","selectStatistics","selectIsMediaViewerOpen","isAvatarView","standaloneMedia","isSponsoredMessage","selectRightColumnContentKey","editTopicPanel","RightColumnContent","EditTopic","createTopicPanel","CreateTopic","PollResults","currentManagement","selectCurrentManagement","Management","isStatisticsShown","currentMessageId","MessageStatistics","currentStoryId","StoryStatistics","currentChatId","canViewStatistics","selectIsStatisticsShown","Statistics","boostStatistics","BoostStatistics","monetizationStatistics","MonetizationStatistics","StickerSearch","GifSearch","AddingMembers","ChatInfo","selectIsRightColumnShown","selectIsForumPanelOpen","selectIsForumPanelClosed","selectIsReactionPickerOpen","reactionPicker","selectPerformanceSettingsValue","selectCanAutoPlayMedia","canAutoPlayVideos","canAutoPlayGifs","asGif","selectShouldLoopStickers","selectIsContextMenuTranslucent","selectIsSynced","selectCanAnimateSnapEffect","IS_SNAP_EFFECT_SUPPORTED","selectWebApp","selectActiveWebApp","activeWebAppKey","selectCurrentGlobalSearchQuery","selectPaymentInputInvoice","inputInvoice","selectPaymentRequestId","selectProviderPublishableKey","form","nativeParams","publishableKey","selectProviderPublicToken","publicToken","selectStripeCredentials","selectSmartGlocalCredentials","selectNotifyExceptions","selectLanguageCode","selectCanSetPasscode","isCacheApiSupported","selectTranslationLanguage","translationLanguage","selectNewNoncontactPeersRequirePremium","selectShouldHideReadMarks","selectCurrentChat","selectTabThreadParam","selectThreadParam","selectThread","messageInfo","selectOutlyingListByMessageId","selectScrollOffset","selectLastScrollOffset","selectEditingId","selectEditingDraft","selectEditingScheduledId","selectEditingScheduledDraft","selectDraft","selectNoWebPage","selectFirstMessageId","selectReplyStack","selectThreadMessagesCount","selectThreadByMessage","selectIsMessageInCurrentMessageList","selectIsViewportNewest","isSavedDialog","chatMessages","selectEditingMessage","selectFocusedMessageId","focusedChatId","selectIsMessageFocused","focusedId","selectIsMessageUnread","lastReadOutboxMessageId","selectOutgoingStatus","isScheduledList","selectSender","areProfilesShown","getSendersFromSelectedMessages","selectSenderFromMessage","selectSenderFromHeader","fromId","selectForwardedSender","isChannelPost","hiddenUserName","savedFromPeerId","selectTopicFromMessage","MAX_MESSAGES_TO_DELETE_OWNER_TOPIC","selectCanDeleteTopic","selectCanDeleteOwnerTopic","selectSavedDialogIdFromMessage","savedPeerId","savedDialogId","replyToMsgId","replyToTopId","isForumTopic","selectCanReplyToMessage","messageTopic","selectCanForwardMessage","hasTtl","isChatProtected","selectIsChatProtected","isStoryForwardForbidden","noForwards","isForwardingAllowed","selectAllowedMessageActionsSlow","isPrivate","isChatWithSelf","isBasicGroup","isSuperGroup","isBotChat","isFailed","isForwarded","isDocumentSticker","isBoostMessage","hasChatPinPermission","hasPinPermission","isMessageEditable","editTimeLimit","viaBotId","canReply","canReplyGlobally","canPin","canUnpin","pinnedMessageIds","canNotDeleteBoostMessage","canDelete","canReport","canDeleteForAll","hasMessageEditRight","canEdit","hasSticker","hasFavoriteSticker","selectIsStickerFavorite","canFaveSticker","canUnfaveSticker","canCopy","canCopyLink","canSelect","canDownload","canSaveGif","canRevote","closed","quiz","canClosePoll","noOptions","ability","selectCanDeleteSelectedMessages","messageActions","selectCanReportSelectedMessages","selectCanDownloadSelectedMessages","selectActiveDownloads","selectUploadProgress","getMessageKey","selectRealLastReadId","lastReadInboxMessageId","unreadCount","selectFirstUnreadId","lastReadServiceNotificationId","notification","findAfterLastReadId","isTopicAction","isFromScheduled","found","selectIsForwardModalOpen","selectCommonBoxChatId","fromLastMessage","selectIsInSelectMode","selectIsMessageSelected","selectForwardedMessageIdsByGroupId","selectIsDocumentGroupSelected","selectedIds","groupIds","selectSelectedMessagesCount","selectNewestMessageWithBotKeyboardButtons","findLast","keyboardButtons","shouldHideKeyboardButtons","isKeyboardSelective","isMentioned","replyToMessageId","replyMessage","selectShouldDisplayReplyKeyboard","replyHideMessageId","isHideKeyboardSelective","selectShouldHideReplyKeyboard","selectCanAutoLoadMedia","isPhoto","canAutoLoadMedia","canAutoLoadMediaFromContacts","canAutoLoadMediaInPrivateChats","canAutoLoadMediaInGroups","canAutoLoadMediaInChannels","isMediaFromContact","selectLastServiceNotification","maxId","selectIsMessageProtected","selectHasProtectedMessage","selectCanForwardMessages","selectSponsoredMessage","selectDefaultReaction","defaultReaction","enabledReactions","selectMaxUserReactions","maxUserReactionsPremium","maxUserReactionsDefault","selectShouldSchedule","selectCanScheduleUntilOnline","chatBot","selectUserStatus","selectMessageCustomEmojiSets","selectCustomEmojis","doc","shortName","selectForwardsContainVoiceMessages","selectChatTranslations","selectRequestedMessageTranslationLanguage","requestedInChat","selectReplyCanBeSentToChat","toChatId","fromRealChatId","selectForwardsCanBeSentToChat","isRoundVideo","isDocument","isSticker","isPlainText","сheckMessageSendingDenied","selectCanTranslateMessage","isTranslationEnabled","canTranslateLanguage","isTranslatable","chatRequestedLanguage","selectTopicLink","selectMessageReplyInfo","additionalReplyInfo","isMainThread","selectCurrentMiddleSearch","selectCurrentSharedMediaSearch","selectCurrentChatMediaSearch","selectCanGift","areStarGiftsAvailable","selectIsPremiumPurchaseBlocked","selectCurrentViewedStory","selectIsStoryViewerOpen","selectPinnedStories","selectPeerFirstUnreadStoryId","lastReadIndex","selectPeerFirstStoryId","selectStoryListForViewer","isSingleStory","isSinglePeer","peerIds","storyIdsByPeerId","storyIds","getPeerStoryIdsForViewer","currentPeerId","storySourceProp","MONTH_EMOTICON","STAR_EMOTICON","selectCurrentStickerSearch","selectCurrentGifSearch","selectStickerSet","stickersForEmoji","packs","cleanEmoji","isCurrentUserPremium","addedCustomSets","customEmojiForEmoji","isFree","selectCustomEmojiForEmojis","selectIsSetPremium","selectAnimatedEmoji","cleanedEmoji","selectRestrictedEmoji","restrictedEmoji","selectAnimatedEmojiEffect","animatedEmojiEffects","selectAnimatedEmojiSound","emojiSounds","defaultEmojiStatusesStickerSetId","selectGiftStickerForDuration","premiumGifts","selectGiftStickerForStars","starCount","selectUserCommonChats","selectIsUserBlocked","isTestUserPremium","isPremiumPurchaseBlocked","selectIsGiveawayGiftsPurchaseAvailable","isGiveawayGiftsPurchaseAvailable","selectUserByPhoneNumber","phoneNumberCleaned","selectBotAppPermissions","useSelector","selector","selectorSignal","useSelectorSignal","bySelector","setter","getter","createSignal","clientsCount","state2","WINDOW_RESIZE_LINE_RECALC_DEBOUNCE","maxLinesBeforeCollapse","cutoutRef","isFirstRenderRef","cutoutHeightRef","setIsCollapsible","maxHeight","recalculateTextLines","totalLines","calcTextLineHeightAndCount","debouncedRecalcTextLines","useDebouncedCallback","observer","MutationObserver","observe","childList","subtree","characterData","disconnect","SVG_MAP","SvgColorFilter","filterId","addSvgDefinition","xmlns","getFilterId","referenceCount","removeReference","removeSvgDefinition","isUsed","asValue","prepareStyle","TRANSITION_PROPERTY","TRANSITION_STYLE","hexColor","setHexColor","updateColor","currentHexColor","getPropertyHexColor","useResizeObserver","removeProperty","handleTransitionEnd","propertyName","mediaQueryCache","callbacks","createCallbackManager","isTablet","isLandscape","getIsTablet","getIsWebAppsFullscreenSupported","handleMediaQueryChange","updateSizes","runCallbacks","isDesktop","mobileQuery","tabletQuery","landscapeQuery","isTouchScreenQuery","initMediaQueryCache","fn","defaultValue","setIsLoading","setError","setResult","wasCancelled","noInitiallyBuffered","setIsBuffered","isReady","setIsReady","bufferedProgress","setBufferedProgress","bufferedRanges","setBufferedRanges","setIsBufferedDebounced","handleBuffering","isSafariPatchInProgress","buffered","end","getTimeRanges","bufferedLength","currentRanges","readyState","onPLay","onLoadedData","onLoadStart","onPause","onProgress","checkBuffering","THROTTLE_MS","setX","setY","recalculate","canvas","targetBounds","canvasBounds","throttledRecalculate","useCurrentOrPrev","shouldSkipUndefined","shouldForceCurrent","ms","noFirst","noLast","fnMemo","resolverOrDependency","dependencies","isAsync","resolver","getValue","setValue","resolverRef","runCurrentResolver","currentResolver","useSignalEffect","resolverOrSignal","valueRef","isSync","debugKey","prevDepsRef","prevDeps","isDragging","screenX","screenY","distance","handleMousedown","handleDrag","buttons","sqrt","handleDoubleClick","electron","setTrigger","startCallbacks","endCallbacks","onEnd","lastOnStart","lastOnEnd","useThrottleForHeavyAnimation","afterHeavyAnimation","isScheduledRef","PATH_BASE","pathname","historyUniqueSessionId","historyState","historyCursor","isAlteringHistory","deferredHistoryOperations","deferredPopstateOperations","isSafariGestureAnimation","handleTouchEnd","applyDeferredHistoryOperations","goOperations","op","stateOperations","goCount","processStateOperations","deferHistoryOperation","historyOperation","resetHistory","back","replaceState","cleanupClosed","alreadyClosedCount","countClosed","cleanupTrashedState","isAnimationDisabled","disableHistoryAnimations","shouldResetUrlHash","lastOnBack","indexRef","wasReplaced","pushState","forceReplace","shouldReplace","previousRecord","markReplaced","processBack","useEffectOnce","prevIsActive","TEST_getHistoryState","TEST_getHistoryCursor","touches","pageX","innerWidth","previousUniqueSessionId","useIntersectionObserver","rootRef","throttleMs","throttleScheduler","debounceMs","shouldSkipFirst","margin","threshold","rootCallback","controllerRef","rootCallbackRef","freezeFlagsRef","onUnfreezeRef","freeze","unfreeze","destroy","targetCallback","entriesAccumulator","observerCallback","observerCallbackSync","entry","callbackManager","throttleWith","IntersectionObserver","rootMargin","hasCallbacks","initController","controller","unobserve","useOnIntersect","targetRef","lastCallback","isIntersecting","setIsIntersecting","onSelectWithEnter","itemSelector","noCaptureFocus","focusedIndex","setFocusedIndex","newIndex","useLang","addLocalizationCallback","getTranslationFn","mediaFormat","delay","mediaData","spentTime","isMediaReady","noMountTransition","useShowTransitionDeprecated","useModuleLoader","bundleName","moduleName","autoUpdate","getModuleFromMemory","addLoadListener","loadModule","langProvider","dispatchPriorityPlaybackEvent","elementObserverMap","onResize","onResizeRef","contentRect","ResizeObserver","refOrElement","onIntersectionChange","onIntersectionChangeLast","flush","offsetParent","useLayoutEffectWithPrevDeps","CLOSE_DURATION","closeDuration","prefix","shouldForceOpen","closingTimeoutRef","getState","setState","onCloseEndLast","useSyncEffectWithPrevDeps","applyClassNames","shouldRender","hasOpenClass","withShouldRender","getIsClosing","useDerivedSignal","onCloseTransitionEnd","noFirstOpenTransition","setIsClosed","closeTimeoutRef","hasOpenClassName","setHasOpenClassName","shouldHaveOpenClassName","hasShownClass","isFirstRun","dependency","isSignal","cleanupEffect","cleanupRef","msOrSchedulerFn","uri","idRef","videoRef","handlers","handlersRef","videoEl","handlers2","resolveEventType","unloadVideo","BACKDROP_CLASSNAME","ignoreRightClick","excludedClosestSelector","handleEvent","closest","blurCallbacks","focusCallbacks","isFocused","lastOnBlur","lastOnFocus","createListener","devicePixelRatio","setDpr","THROTTLE","initialWidth","initialHeight","setWidth","setHeight","isResizing","setIsResizing","setIsResizingDebounced","throttledSetIsResizing","throttledSetSize","newWidth","newHeight","handleResize","pendingMeasureTasks","pendingMutationTasks","pendingForceReflowTasks","runUpdatePassOnRaf","currentMeasureTasks","safeExec","setPhase","currentMutationTasks","pendingForceReflowMutationTasks","mutationTask","throttledFn","fastRaf","requestNextMutation","methods","VisualViewport","Document","HTMLInputElement","MouseEvent","Range","nativeMethods","phase","isStrict","newPhase","enableStrict","LAYOUT_CAUSES","causes","nativeGetter","getOwnPropertyDescriptor","defineProperty","onMeasure","method","nativeMethod","mutations","attributeName","forcedMutationAllowedFor","markdownMarker","disableStrict","forceMeasure","forceMutation","nodes","propName","NON_BUBBLEABLE_EVENTS","documentEventCounters","delegationRegistryByEventType","delegatedEventTypesByElement","handler","asCapture","eventType","canUseEventDelegation","resolveDelegationRegistry","newSet","resolveDelegatedEventTypes","addDelegatedListener","removeDelegatedListener","realEventType","removeAllDelegatedListeners","eventTypes","realEvent","furtherCallsPrevented","Proxy","p","Reflect","documentListenersCount","delegatedHandlersCount1","counter","delegationRegistriesCount","delegatedHandlersCount2","delegationRegistry","delegationElementsCount","delegatedEventTypesCount","AUTO_END_TIMEOUT","counterBlocking","getIsAnimating","setIsAnimating","getIsBlockingAnimating","setIsBlockingAnimating","isBlocking","hasEnded","onIdle","throttleWithFullyIdle","HTML_NAMESPACE","FILTERED_ATTRIBUTES","HTML_ATTRIBUTES","CONTROLLABLE_TAGS","MAPPED_ATTRIBUTES","INDEX_KEY_PREFIX","headsByElement","WeakMap","extraClasses","extraStyles","renderWithVirtual","parentEl","$current","$new","$parent","currentContext","skipComponentUpdate","namespace","isCurrentComponent","VirtualType","Component","isNewComponent","$newAsReal","isCurrentFragment","isNewFragment","Tag","hasElementChanged","componentInstance","renderComponent","updateComponent","mountState","MountState","Mounted","setupComponentUpdateListener","newTarget","initComponent","mountChildren","Text","createNode","setElementRef","remount","getNextSibling","renderChildren","forceMoveToEnd","$currentAsReal","$newAsTag","processControlled","currentEntries","newEntries","currentValue","removeAttribute","updateAttributes","$element","New","mountComponent","$child","$renderedChild","Empty","createElementNS","hasOwnProperty","defaultChecked","processUncontrolledOnMount","componentNextSibling","isComponent","isFragment","unmountComponent","unmountChildren","unmountRealTree","currentEl","DEBUG_checkKeyUniqueness","currentChildren","newChildren","newKeys","$newChild","isParentElement","currentRemainingIndex","remainingByKey","$currentChild","isKeyPresent","newChildKey","orderKey","fragmentIndex","fragmentSize","currentPreservedIndex","currentChildInfo","renderFragment","newOrderKey","shouldMoveNode","isMovingDown","renderFastListChildren","currentChildrenLength","newChildrenLength","lastCurrentChild","fragmentNextSibling","isValueControlled","isCheckedControlled","selectionStart","selectionEnd","isCaretAtEnd","setSelectionRange","selectionState","__teactSelectionState","updateClassName","inputEl","selectionStateJson","updateStyle","htmlElement","extra","extraArray","applyExtraStyles","standardStyles","runImmediateEffects","captureImmediateEffects","$head","KEYS_TO_IGNORE","counters","renderCountersThrottled","loggerEl","clearEl","setupOverlay","halfSecondAgo","maxRenders","maxDuration","lastUpdateAt","factor","incrementOverlayCounter","Symbol","DEBUG_RENDER_THRESHOLD","DEBUG_EFFECT_THRESHOLD","DEBUG_SILENT_RENDERS_FOR","renderingInstance","lastComponentId","buildChildren","buildFragmentElement","buildComponentElement","createComponentInstance","buildTagElement","noEmpty","cleanChildren","isEmptyPlaceholder","dropEmptyTail","buildChildElement","DEBUG_components","TOTAL","DEBUG_memos","DEBUG_MEMOS_CALLS_THRESHOLD","avgRenderTime","calls","hitRate","instancesPendingUpdate","idsToExcludeFromUpdate","pendingEffects","pendingCleanups","pendingLayoutEffects","pendingLayoutCleanups","areImmediateEffectsCaptured","instancesToUpdate","currentCleanups","currentEffects","prepareComponentForFrame","instance","currentElement","forceUpdateComponent","runCapturedImmediateEffects","currentLayoutCleanups","currentLayoutEffects","newRenderedValue","cursor","effects","memos","refs","componentName","DEBUG_resolveComponentName","renderedValue","$old","byCursor","releaseSignals","Unmounted","hook","schedule","nextValue","helpGc","useEffectBase","isLayout","effectConfig","cleanupsContainer","effectsContainer","effectId","runEffectCleanup","runEffect","scheduleEffect","causedBy","prevValue","cleanups","signal","setupSignals","debugHitRateKey","DEBUG_state","instanceKey","misses","logUnequalProps","newCallback","signalRef","TeactMemoWrapper","DEBUG_contentComponentName","DEBUG_currentRandomId","currentGlobal","DEBUG_invalidateGlobalOnTickEnd","actionHandlers","containers","mapStateToProps","ownProps","mappedProps","activateContainer","newMappedProps","handleError","isNaN","DEBUG_componentName","arePropsShallowEqual","DEBUG_updates","updateTime","runCallbacksThrottled","setUntypedGlobal","forceOutdated","DEBUG_randomId","getUntypedGlobal","getUntypedActions","actionQueue","addUntypedActionHandler","handleAction","withUntypedGlobal","activationFn","TeactNContainer","stuckTo","stickTo","vs16RegExp","zeroWidthJoiner","removeVS16s","rawEmoji","LoadMoreDirection","FocusDirection","LeftColumnContent","GlobalSearchContent","MediaViewerOrigin","StoryViewerOrigin","AudioOrigin","ChatCreationProgress","ProfileState","PaymentStep","ManagementScreens","resolved","currentInstance","animateSingle","tick","schedulerFn","isCancelled","cancelSingleAnimation","dumbCb","animate","animateInstantly","timingFunctions","linear","easeIn","easeOut","easeInOut","PI","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","animateNumber","timing","t0","t1","applyStyles","css","setAppBadge","value1","value2","type1","isArray1","array1","array2","member1","object1","object2","keys1","key1","currentProps","newProps","currentKeys","currentKeysLength","promisifyRequest","oncomplete","onsuccess","onabort","onerror","createStore","dbName","storeName","indexedDB","open","onupgradeneeded","createObjectStore","dbp","txMode","db","objectStore","defaultGetStoreFunc","defaultGetStore","eachCursor","store","openCursor","continue","IdbStore","customStore","put","setMany","getMany","delMany","getAll","getAllKeys","getEntries","getKeys","getValues","updater","load","elementName","modifiers","baseName","modifier","self","caches","isSupported","Type","fetch","cacheName","isHtmlAllowed","Request","Blob","blob","shouldRecreate","resolvedType","Json","ArrayBuffer","arrayBuffer","save","cacheData","Response","captureKeyboardListener","onEsc","SwipeDirection","IOS_SCREEN_EDGE_THRESHOLD","SWIPE_DIRECTION_THRESHOLD","SWIPE_DIRECTION_TOLERANCE","MOVE_THRESHOLD","SWIPE_THRESHOLD_DEFAULT","RELEASE_WHEEL_ZOOM_DELAY","RELEASE_WHEEL_DRAG_DELAY","getDistance","hypot","pageY","getTouchCenter","lastClickTime","lethargy","stability","sensitivity","tolerance","lastUpDeltas","lastDownDeltas","deltasTimestamp","check","lastDelta","originalEvent","wheelDelta","deltaY","detail","isInertia","lastDeltas","lastDeltasOld","lastDeltasNew","oldSum","newSum","oldAverage","newAverage","captureEvents","captureEvent","hasMoved","hasSwiped","isZooming","initialDistance","wheelZoom","initialZoom","initialDragOffset","isDragCanceled","currentWindowSize","initialSwipeAxis","initialTouchCenter","minZoom","maxZoom","onCapture","includedClosestSelector","withNativeDrag","withCursor","onDrag","onMove","onRelease","passive","selectorToPreventScroll","scrollable","overflow","onDoubleClick","centerX","centerY","clamp","newWindowSize","onZoom","endDistance","touchCenter","dragOffsetX","dragOffsetY","zoomFactor","initialCenterX","initialCenterY","currentCenterX","currentCenterY","shouldPreventScroll","onSwipe","xAbs","yAbs","swipeThreshold","axis","currentSwipeAxis","offsets","Left","Right","Up","Down","processSwipe","releaseWheelDrag","releaseWheelZoom","onWheelCapture","onWheel","doubleTapZoom","is","metaKeyPressed","onWheelZoom","isUserEvent","sign","dx","dy","onWheelDrag","withWheelDrag","isNotPassive","keyToHandlerName","Esc","Escape","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","onEnter","onDelete","onBackspace","onUp","onDown","onLeft","onRight","onTab","captureKeyboardListeners","hasActiveHandlers","handlerName","currentEventHandlers","releaseKeyboardListener","keyHandlers","CLIPBOARD_ITEM_SUPPORTED","clipboard","ClipboardItem","textCopyEl","rangeToRestore","select","copyHtmlToClipboard","write","copyImageToClipboard","imageUrl","ctx","getContext","imageEl","Image","onload","img","drawImage","toBlob","copyBlobToClipboard","copyTextToClipboardFromPromise","getTextPromise","onFailure","copyTextToClipboardFallback","hasGetDataError","rejectGetDataError","clipboardTextItem","pngBlob","fallbackMs","waitForEndEvent","animationName","detailedName","isHandled","handleAnimationEnd","TransitionEvent","AnimationEvent","WEEKDAYS_FULL","MONTHS_FULL_LOWERCASE","month","MIN_SEARCH_YEAR","MAX_DAY_IN_MONTH","MAX_MONTH_IN_YEAR","MILLISECONDS_IN_DAY","isToday","getDayStartAt","getDayStart","datetime","toYearMonth","getFullYear","getMonth","toIsoString","hours","getHours","getMinutes","formatPastTimeShort","alwaysShowTime","weekAgo","weekday","getDay","noYear","formattedDate","formatMonthAndYear","isShort","formatCountdown","msLeft","days","formatMediaDuration","formatCountdownShort","ceil","formatLastUpdated","lastUpdated","seconds","formatRelativeTime","lastUpdatedDate","formatTimeDuration","showLast","durationRecords","labels","multiplier","idx","modulus","formatHumanDate","noWeekdays","isUpperFirst","upperFirst","lowerFirst","weekAhead","formatWeekday","day","weekDay","formatMediaDateTime","maxValue","minutes","maxHours","maxMinutes","string","formatVoiceRecordDuration","durationInMs","milliseconds","formatDayToStringWithCache","withCache","dayStartAt","locale","monthFormat","noDay","toLocaleString","year","formatDateTimeToString","noSeconds","hour","minute","hourCycle","formatDateAtTime","formatShortDuration","isValidDate","parseDateString","matchStringDate","matchEuropeStringDate","matchNumberDate","dateParts","monthIndex","timestampPlusDay","HOUR","roundDown","getDays","DEBUG_LEVELS","ORIGINAL_FUNCTIONS","DEBUG_LOGS","getDebugLogs","ELIGIBLE_HOSTNAMES","tryParseDeepLink","correctUrl","queryParams","getQueryParams","pathParams","getPathParams","boost","isUsernameValid","isNumber","getHttpDeepLinkType","single","comment","buildPublicMessageLink","commentId","mediaTimestamp","channelId","buildPrivateMessageLink","buildShareLink","buildChatFolderLink","buildLoginCodeLink","buildPublicUsernameOrBotLink","startApp","startapp","mode","startAttach","startattach","attach","choose","buildPrivateChannelLink","buildBusinessChatLink","buildChatBoostLink","isPrivateChannel","buildGiftUniqueLink","parseHttpLink","urlToParse","IS_BAD_URL_PARSER","post","bot_id","scope","public_key","nonce","getTgDeepLinkType","publicKey","callbackUrl","buildTelegramPassportLink","callback_url","appname","referrer","buildPremiumReferrerLink","buildPremiumMultigiftLink","parseTgLink","parseDeepLink","isSingle","fromEntries","processDeepLink","parsedLink","handlePrivateMessageLink","parseChooseParameter","startParam","originalParts","openPrivateChannel","resolveBusinessChatLink","openPremiumModal","openGiftRecipientPicker","processBoostParameters","usernameOrId","openUniqueGiftBySlug","protocol","checkChatInvite","openChatByPhoneNumber","openStickerSet","joinVoiceChatByLink","openInvoice","openChatWithDraft","checkChatlistInvite","openStoryViewerByUsername","checkGiftCode","openStarsBalanceModal","phone","voicechat","livestream","inviteHash","urlParam","formatShareText","purpose","balanceNeeded","topup","textContainer","scrollHeight","jsx","INPUT_WAITING_CUSTOM_EMOJI_IDS","renderCallbacks","loaded","processMessageInputForCustomEmoji","checkInputCustomEmojiLoad","callInputRenderHandlers","fetchAndProcess","placeholderSrc","shouldUseStaticFallback","blankSrc","getCustomEmojiMediaDataForInput","EXCLUDE_EMOJIS","ISO_FLAGS_OFFSET","unifiedToNative","unified","codePoints","fromCodePoint","pairs","nativeToUnified","uncompressEmoji","emojiData","categories","emojiRaw","names","native","isoToEmoji","iso","codePointAt","EMOJI_EXCEPTIONS","replacement","DETECT_UP_TO","textWithoutNewlines","countIfEmojiOnly","iterator","matchAll","PROTOCOL_WHITELIST","FALLBACK_PREFIX","ESTABLISH_TIMEOUT","addCallbackTokenDied","runCallbacksTokenDied","collectedTokens","isEstablished","initialEstablishment","masterToken","reestablishToken","isWaitingForMaster","handleMessage","currentPasscodeHash","setPasscodeHash","hasGaveUpMaster","shouldGiveUpMaster","getPasscodeHash","tokenDied","prevLength","establishMultitabRole","shouldReestablishMasterToSelf","reestablishMasterToSelf","signalTokenDead","close","signalPasscodeHash","getAllMultitabTokens","subscribeToTokenDied","initialEstablishmentPromise","isCurrentTabMaster","blobToDataUri","reader","FileReader","readAsDataURL","blobToFile","File","lastModified","preloadImage","preloadVideo","onloadedmetadata","createPosterForVideo","onseeked","videoWidth","videoHeight","fetchBlob","imgToCanvas","validateFiles","fixMovMime","fileBits","super","DEBUG_DURATION_LIMIT","initials","buildInitials","prepared","DEBUG_getFolderManager","updateFolderManagerThrottled","updateFolderManager","inited","updateFolders","orderedIdsByFolderId","getPinnedChatsCount","pinnedCountByFolderId","getChatsCount","chatsCountByFolderId","getUnreadCounters","unreadCountersByFolderId","getAllNotificationsCount","notificationsCount","getOrderKey","isForSaved","chatSummariesById","orderInSaved","orderInAll","addOrderedIdsCallback","addChatsCountCallback","addUnreadCountersCallback","DEBUG_startedAt","isAllFolderChanged","isMainFolderChanged","isArchivedFolderChanged","isSavedFolderChanged","isAllFullyLoadedChanged","isAllFolderFullyLoaded","isArchivedFullyLoadedChanged","isArchivedFolderFullyLoaded","isSavedFolderFullyLoadedChanged","isSavedFolderFullyLoaded","areFoldersChanged","foldersById","areChatsChanged","areSavedLastMessageIdsChanged","lastSavedMessageIds","areAllLastMessageIdsChanged","lastAllMessageIds","areTopicsChanged","areUsersChanged","areNotifySettingsChanged","areNotifyExceptionsChanged","affectedFolderIds","emptyFolderIds","folderSummariesById","updateFullyLoaded","updateResults","prevAllFolderListIds","allFolderListIds","prevArchivedFolderListIds","archivedFolderListIds","prevSavedFolderListIds","savedFolderListIds","newChatsById","newUsersById","newAllLastMessageIds","newSavedLastMessageIds","newNotifySettings","newNotifyExceptions","folderSummaries","newAllFolderListIds","newArchivedFolderListIds","newSavedFolderListIds","newGeneralIds","allIds","newFolderIds","currentSummary","isRemovedFromAll","isRemovedFromSaved","newSummary","chatUnreadCount","chatUnreadMentionsCount","hasUnreadMark","userInfo","shouldHideServiceChat","creationDate","draftDate","lastMessageInSaved","isListedInAll","isListedInSaved","isUserContact","buildChatSummary","chatSummary","folderSummary","isChatInFolder","buildChatFolderIds","currentFolderIds","folderIdsByChatId","deletedFolderIds","currentFolderIdsSet","newFolderIdsSet","currentFolderOrderedIds","chatIdsByFolderId","isOrderedListJustPatched","updateListsForChat","newListIds","currentPinnedIds","allFolderPinnedIds","savedFolderPinnedIds","archivedFolderPinnedIds","changedFolders","buildFolderSummaryFromMainList","newFoldersById","buildFolderSummary","wasUnreadCountersChanged","wasChatsCountChanged","pinnedCount","newPinnedCount","prevOrderedIds","isSavedFolder","sortedPinnedIds","allListIds","sortedNotPinnedIds","chatId1","chatId2","buildFolderOrderedIds","currentOrderedIds","currentPinnedCount","currentChatsCount","newChatsCount","currentUnreadCounters","newUnreadCounters","buildFolderUnreadCounters","newInitials","formatCurrency","totalPrice","getCurrencyExp","iconClassName","shouldOmitFractions","isInteger","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","format","TOPIC_MAPPING","blue","violet","green","rose","red","getTopicColors","grey","getTopicColorCssVariable","READABLE_ERROR_MESSAGES","CHAT_RESTRICTED","CHAT_SEND_POLL_FORBIDDEN","CHAT_SEND_STICKERS_FORBIDDEN","CHAT_SEND_GIFS_FORBIDDEN","CHAT_SEND_MEDIA_FORBIDDEN","CHAT_LINK_EXISTS","SLOWMODE_WAIT_X","USER_BANNED_IN_CHANNEL","USER_IS_BLOCKED","YOU_BLOCKED_USER","IMAGE_PROCESS_FAILED","MEDIA_EMPTY","MEDIA_GROUPED_INVALID","MEDIA_NEW_INVALID","MESSAGE_NOT_MODIFIED","MEDIA_INVALID","PASSWORD_HASH_INVALID","PHOTO_EXT_INVALID","PHOTO_INVALID_DIMENSIONS","PHOTO_SAVE_FILE_INVALID","MESSAGE_DELETE_FORBIDDEN","MESSAGE_POLL_CLOSED","MESSAGE_EDIT_TIME_EXPIRED","PINNED_DIALOGS_TOO_MUCH","CHANNEL_PRIVATE","MEDIA_CAPTION_TOO_LONG","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_CITY_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_POSTCODE_INVALID","ADDRESS_STATE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_PHONE_INVALID","REQ_INFO_EMAIL_INVALID","LINK_NOT_MODIFIED","MESSAGE_TOO_LONG","SERVICE_WORKER_DISABLED","MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS","FRESH_RESET_AUTHORISATION_FORBIDDEN","BOTS_TOO_MUCH","BOT_GROUPS_BLOCKED","USERS_TOO_MUCH","USER_CHANNELS_TOO_MUCH","USER_KICKED","USER_NOT_MUTUAL_CONTACT","USER_PRIVACY_RESTRICTED","INVITE_HASH_EMPTY","INVITE_HASH_EXPIRED","INVITE_HASH_INVALID","CHANNELS_TOO_MUCH","USER_ALREADY_PARTICIPANT","SCHEDULE_DATE_INVALID","WALLPAPER_DIMENSIONS_INVALID","ADMINS_TOO_MUCH","ADMIN_RANK_EMOJI_NOT_ALLOWED","ADMIN_RANK_INVALID","FRESH_CHANGE_ADMINS_FORBIDDEN","INPUT_USER_DEACTIVATED","BOT_PRECHECKOUT_TIMEOUT","PROVIDER_ACCOUNT_TIMEOUT","STARGIFT_CONVERT_TOO_OLD","SUBSCRIPTION_ALREADY_ACTIVE","PEERS_LIST_EMPTY","PAID_MEDIA_FORBIDDEN","CHAT_WRITE_FORBIDDEN","CHAT_ADMIN_REQUIRED","SHIPPING_ERRORS","field","FINAL_PAYMENT_ERRORS","getReadableErrorText","isSlowMode","textParams","extraPartIndex","errorMessage","showError","handleErrorEvent","alert","getErrorMessage","throttleError","ErrorEvent","reason","stack","promptInstall","setupBeforeInstallPrompt","prompt","userChoice","outcome","setInstallPrompt","getPromptInstall","collection","member","buildCollectionByCallback","mapValues","newByKey","object","stringKeys","stringKey","orderRule","compareValues","currentOrderRule","isAsc","aValue","bValue","mode1","mode2","orderRule1","orderRule2","isAsc1","isAsc2","isInsideSortedArrayRange","findIntersectionWithSet","toExclude","excludeIndex","chunkSize","pass","fail","arr","cloneDeep","isObject","isLiteralObject","predicate","buildMessageKey","getMessageServerKey","msgId","parseMessageKey","parseSearchResultKey","parseLine","separatorIndex","isEscaped","isInsideString","FALLBACK_LANG_CODE","FALLBACK_VERSION","FALLBACK_TRANSLATE_URL","LANGPACK_STORE_PREFIX","FORMATTERS_FALLBACK_LANG","TRANSLATION_CACHE","LimitedMap","formatters","langPack","fallbackLangPack","translationFn","createTranslationFn","areCallbacksScheduled","scheduleCallbacks","localizationReady","loadCachedLangData","cacheLangData","notifyLangpackUpdate","fallbackLoadPromise","loadFallbackPack","forLocalScript","fileData","readFileSync","rawStrings","readStrings","strings","clearKey","pluralSuffix","knownValue","version","stringsCount","nativeName","pluralCode","translatedCount","translationsUrl","readFallbackStrings","fallbackData","updateLanguage","fetchDifference","fromVersion","applyLangPackDifference","keysToRemove","newLangPack","updateLangPack","newLang","createFormatters","listFormatFallback","createListFormat","IS_INTL_LIST_FORMAT_SUPPORTED","ListFormat","pluralRules","PluralRules","region","DisplayNames","conjunction","disjunction","number","initLocalization","canLoadFromServer","cachedData","loadAndChangeLanguage","refreshFromCache","shouldCheckCache","changeLanguage","remoteLanguage","requestLangPackDifference","newLanguage","remoteLangPack","baseLangCode","variables","areAdvancedLangFnOptions","processTranslationAdvanced","processTranslation","with","withRegular","withAdvanced","of","languageInfo","getString","langKey","langPackStringValue","initialStrings","isDeletedLangString","isPluralLangString","cacheKey","finalString","valueAsString","isFinite","variableEntries","tempResult","specialReplacement","replaceInStringsWithTeact","withMarkdown","renderTextFilters","preparedValue","localizationReadyPromise","isRegularLangString","isLangFnParam","withNodes","num","isBetween","decimals","lerp","interpolationRatio","roundToNearestEven","SAMPLE_RATE","BIT_DEPTH","oggToWav","opusData","typedArray","Uint8Array","decoderWorker","wavWorker","onmessage","buffers","buffer","page","wavBitDepth","wavSampleRate","decoderSampleRate","outputBufferSampleRate","pages","asCacheApiType","PROGRESSIVE_URL_PREFIX","URL_DOWNLOAD_PREFIX","MAX_MEDIA_RETRIES","memoryCache","fetchPromises","progressCallbacks","cancellableCallbacks","callbackUniqueId","progressiveUrl","getProgressive","getDownloadUrl","fetchFromCacheOrRemote","activeCallbacks","getFromMemory","cancelProgress","parentCallback","getProgressiveUrl","retryNumber","prepareMedia","makeOnProgress","remote","getRetryTimeout","debug","dataBlob","revokeObjectURL","serviceWorker","fullSize","Bundles","LOAD_PROMISES","MEMORY_CACHE","loadBundle","Auth","Extra","Calls","Stars","bundle","EQUAL","DELETE","__delete","DELETE_ALL_CHILDREN","__deleteAllChildren","deepDiff","keys2","subValue1","subValue2","subDiff","deepMerge","oldValue","reduceDiff","MULTITAB_ESTABLISH_TIMEOUT","resolveGlobalPromise","isFirstGlobalResolved","lastBroadcastDiffGlobal","isBroadcastDiffScheduled","subscribeToMultitabBroadcastChannel","appVersion","APP_VERSION","reload","batchedUpdates","localDb","argsWithCallback","refreshLangPackFromCache","requestGlobal","resolveWithoutGlobal","getDeviceToken","subscription","toJSON","endpoint","checkIfPushSupported","IS_SERVICE_WORKER_SUPPORTED","ServiceWorkerRegistration","Notification","permission","checkIfNotificationsSupported","expirationTime","soundPlayedDelay","soundPlayedIds","notificationSound","Audio","playNotifySound","currentVolume","playNotifySoundDebounced","unsubscribeFromPush","deleteDeviceToken","serviceWorkerRegistration","ready","pushManager","getSubscription","areSettingsLoaded","loadNotificationSettings","resultSettings","resultExceptions","isSubscriptionFailed","checkIfOfflinePushFailed","setDeviceToken","updateWebNotificationSettings","checkIfShouldResubscribe","userVisibleOnly","DOMException","ABORT_ERR","NOT_SUPPORTED_ERR","getAvatar","imageHash","notifyAboutCall","vibrate","onclick","notifyAboutMessage","isReaction","shouldNotifyAboutMessage","isListed","checkIfShouldNotify","areNotificationsSupported","activeReaction","loadCustomEmoji","messageSenderChat","messageSenderUser","messageAction","actionTargetMessage","replyFrom","targetUserIds","actionTargetUserIds","actionTargetChatId","actionTargetUsers","isChat","senderName","getReactionEmoji","getNotificationContent","dispatch","onshow","closeMessageNotifications","notifyClientReady","SUBSTITUTION_REGEX","PLURAL_OPTIONS","PLURAL_RULES","en","ar","be","n10","n100","ca","v0","de","es","fa","fi","fr","it","i10","i100","f10","f100","hu","ko","nb","nl","pl","ru","sk","sr","tr","uk","uz","currentLangCode","currentTimeFormat","createLangFn","cacheValue","importFallbackLangPack","preferredPluralOption","optionIndex","getPluralOption","template","otherValue","translationSlices","initialValue","processTemplate","formatInteger","withFallback","sourceLangPacks","fetchRemote","langInfo","langName","ENTITY_CLASS_BY_NODE_NAME","B","STRONG","I","EM","INS","U","S","STRIKE","DEL","CODE","PRE","BLOCKQUOTE","MAX_TAG_DEEPNESS","withMarkdownLinks","skipMarkdown","fixImageContent","getNodeInnerText","textIndex","recursionDeepness","addEntity","COMMENT_NODE","rawIndex","getEntityDataFromNode","replaceWith","IV_LENGTH","SALT","UnrecoverablePasscodeError","passcodeHash","setupPasscode","sha256","sessionEncrypted","aesEncrypt","globalEncrypted","aesDecrypt","decryptSession","plaintext","crypto","subtle","digest","TextEncoder","asArray","pwHash","iv","getRandomValues","alg","importKey","ptUint8","ctBuffer","encrypt","ct","dataArray","plainBuffer","decrypt","TextDecoder","patchSafariProgressiveAudio","audioEl","patchedForSafari","patchForSafariInProgress","paused","preventPlayAfterPatch","toggle","SEARCH_ENGINE_REGEX","PERMANENT_VERSION_KEY","CLIENT_VERSION","setPermanentWebVersion","switchPermanentWebVersion","clearWebsync","skipLockOnUnload","checkAndAssignPermanentWebVersion","host","currentVersion","getPermanentWebVersion","hasTest","URLSearchParams","shouldRedirect","PATTERN_PLACEHOLDER","DEFAULT_PATTERN","getCountryCodesByIso","phoneCodeList","country","iso2","getCountryFromPhoneNumber","bestMatches","countryCode","prefixes","pattern","numberWithoutCode","patterns","defaultPattern","stripped","getBestPattern","formatPhoneNumberWithCode","numberWithPlus","insertionQueue","keyToRemove","callbackfn","thisArg","toStringTag","replaceWithTeact","searchValue","firstElement","timerId","parsedInitialLocationHash","messageHash","isAlreadyParsed","createLocationHash","displayType","parseLocationHash","isType","createMessageHashUrl","parsedHash","cur","SAFE_EXEC_ENABLED","rescue","always","getIsVideoPlaying","ended","mediaEl","shouldRunFirst","shouldRunLast","waitingTimeout","interval","_args","setInterval","clearInterval","onTickEnd","waiting","rafPromise","FAST_RAF_TIMEOUT_FALLBACK_MS","fastRafCallbacks","fastRafFallbackCallbacks","fastRafFallbackTimeout","onTickEndCallbacks","withTimeoutFallback","requestAnimationFrame","currentCallbacks","currentTimeoutCallbacks","IDLE_TIMEOUT","onIdleCallbacks","beforeUnloadCallbacks","requestIdleCallback","deadline","timeRemaining","isLast","RE_NOT_LETTER","haystack","needle","needleWords","haystackLower","haystackWords","needleWord","haystackWord","_serverTimeOffset","DC_IDS","userAuthJson","dcID","hashes","SIGNAL_MARK","unsubscribesByEffect","currentEffect","unsubscribes","unsub","DEFINITION_MAP","defs","appendElement","INERTIA_DURATION","INERTIA_EASING","swipeOffsets","cancelCurrentReleaseAnimation","isSwipeActive","captureControlledSwipe","onSwipeLeftStart","onSwipeRightStart","onCancel","currentSlide","nextSlide","onCancelForTransition","targetPosition","getAnimations","KeyframeEffect","keyframe","getKeyframes","extractPositionFromTransform","extractAnimationEndPosition","currentDirection","animationTimingFunction","initialPositionPx","units","dragOffset","newProgress","updateAnimationProgress","onCancelForClient","isRevertSwipe","cancel","releaseProgress","getTiming","transformRule","isInitialized","HEX_COLOR_REGEX","RGB_VARIABLES","themeColors","property","hex","lerpRgb","applyColorAnimationStep","endIndex","propertyColors","roundedA","themeClassName","isDarkTheme","shouldAnimate","startAt","themeColorTag","uninjectCss","head","injectCss","themeChangeCallback","systemThemeCache","formatFixedNumber","formatIntegerCompact","formatPercent","fractionDigits","phrase","word","FILE_SIZE_UNITS","formatFileSize","GENERAL_VARIABLES","LIGHT_VARIABLES","DARK_VARIABLES","setVariable","lightValueOrGeneral","darkValue","isUpdateScheduled","updateVariables","generalVariables","buildVariables","lightVariables","darkVariables","setPeerColor","darkColors","mainLightColor","mainDarkColor","lightBgColor","darkBgColor","lightBgActiveColor","darkBgActiveColor","lightGradientColors","darkGradientColors","extractCurrentThemeParams","secondaryTextColor","bgColor","textColor","buttonColor","buttonTextColor","linkColor","hintColor","secondaryBgColor","sectionSeparatorColor","bg_color","text_color","hint_color","link_color","button_color","button_text_color","secondary_bg_color","header_bg_color","accent_text_color","section_bg_color","section_header_text_color","subtitle_text_color","destructive_text_color","section_separator_color","validateHexColor","getPropertyValue","MIN_USERNAME_LENGTH","MIN_UPDATE_USERNAME_LENGTH","MAX_USERNAME_LENGTH","USERNAME_REGEX","isUpdating","minUsernameLength","WEBSYNC_URLS","WEBSYNC_VERSION","WEBSYNC_KEY","WEBSYNC_TIMEOUT","getTs","lastTimeout","authed","currentTs","canRedirect","script","removeElement","saveSync","maxTouchPoints","getPlatform","IS_MOBILE","IS_YA_BROWSER","IS_FIREFOX","IS_PWA","standalone","IS_APP","IS_VOICE_RECORDING_SUPPORTED","mediaDevices","AudioContext","webkitAudioContext","inlineEl","newEmojiWidth","legacyEmojiWidth","isLastEmojiVersionSupported","chromeVersion","hasBrokenServiceWorkerStreaming","canPlayType","IS_CANVAS_FILTER_SUPPORTED","IS_REQUEST_FULLSCREEN_SUPPORTED","ARE_CALLS_SUPPORTED","LAYERS_ANIMATION_NAME","IS_WAVE_TRANSFORM_SUPPORTED","TEST_VIDEO","ARE_WEBCODECS_SUPPORTED","MASK_IMAGE_DISABLED","storage","getDirectory","directory","removeEntry","recursive","IS_OFFSET_PATH_SUPPORTED","CSS","supports","IS_INSTALL_PROMPT_SUPPORTED","IS_OPEN_IN_NEW_TAB_SUPPORTED","MESSAGE_LIST_SENSITIVE_AREA","IS_GEOLOCATION_SUPPORTED","getGeolocationStatus","permissionStatus","accessRequested","accessGranted","geolocation","getCurrentPosition","handleOrientationChange","visualViewport","pageTop","vh","getIsKeyboardVisible","fnCache","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","__webpack_modules__","__esModule","getPrototypeOf","ns","getOwnPropertyNames","definition","o","enumerable","chunkId","promises","miniCssF","globalThis","Function","done","needAttach","scripts","getElementsByTagName","charset","nc","onScriptComplete","doneFns","scriptUrl","importScripts","currentScript","installedCssChunks","miniCss","fullhref","existingLinkTags","dataHref","existingStyleTags","findStylesheet","oldTag","linkTag","errorType","realHref","createStylesheet","loadStylesheet","baseURI","installedChunks","installedChunkData","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","handleWorkerMessage","scriptURL","ourRegistrations","getRegistrations","unregister","register","getRegistration","hasErrorKey","intervals","checkStoryExpiration","serverTime","isPublic","previousGlobal","isCurrentMaster","isPreviousMaster","initGlobal","initialTabState","isPlaybackRateActive","isLastPlaybackRateActive","fixedThreadsById","parsedMessageList","actionPayload","isImproved","testAndImprove","frames","lastFrameAt","mean","boosterEl","improveView","STORAGE_KEY","tabKey","AuthCodeAsync","AuthCode","AuthPasswordAsync","AuthPassword","SITE_FONTS","preloadFonts","font","fonts","getSuggestedLanguage","suggestedLanguage","useLangString","fetchLangString","MENU_HIDING_DURATION","getFilteredList","defaultName","CountryCodeInput","inputRef","setFilter","filteredList","setFilteredList","updateFilter","filterValue","prevPhoneCodeList","handleInput","handleInputKeyDown","CodeInput","handleTrigger","formEl","getElementById","scrollTo","behavior","inputValue","MenuItem","isPreloadInitiated","AuthPhoneNumber","setAuthPhoneNumber","setAuthRememberMe","loadNearestCountry","loadCountryList","clearAuthErrorKey","goToAuthQrCode","isConnected","continueText","setCountry","setPhoneNumber","setIsTouched","lastSelection","setLastSelection","markIsLoading","unmarkIsLoading","fullNumber","canSubmit","parseFullNumber","newFullNumber","suggestedCountry","selectedCountry","handleLangChange","isJustPastedRef","handlePaste","handleCountryChange","handlePhoneNumberChange","monkeyPath","shouldFixSafariAutoComplete","handleKeepSessionChange","handleGoToAuthQrCode","isAuthReady","onSubmit","qrCodeStylingPromise","returnToAuthPhoneNumber","qrCodeRef","isQrMounted","markQrMounted","unmarkQrMounted","QrCodeStyling","blankUrl","dotsOptions","cornersSquareOptions","imageOptions","imageSize","qrOptions","errorCorrectionLevel","append","habdleReturnToAuthPhoneNumber","AnimatedIcon","AuthRegisterAsync","AuthRegister","handleChangeAuthorizationMethod","useElectronDrag","renderingAuthState","Transition","getActiveKey","AuthQrCode","getScreen","preloadAvatars","avatarHash","preloadTasks","main","spoilerMaskPath","telegramLogoPath","authPassword","lockPreviewPath","inactive","isRightColumnShown","leftColumnWidth","UiLoader","setIsUiReady","markReady","shouldRenderMask","safePreload","appStyles","AppInactive","handleReload","appInactivePath","LockScreen","AppScreens","TRANSITION_RENDER_COUNT","INACTIVE_PAGE_TITLE","isInactiveAuth","App","markInactive","unmarkInactive","isMobileOs","dataTransfer","dropzone","dropEffect","handleDrop","auth","renderContent","isCompatTestPassed","restoreLocalStorage","switchMultitabRole","manifest","updateWebmanifest","lastFocusAt","setupInterval","betterView","isPageUnload"],"sourceRoot":""}